<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Tiktok 0~1完整版（建议收藏）</title>
      <link href="2022/09151805.html"/>
      <url>2022/09151805.html</url>
      
        <content type="html"><![CDATA[<h1 id="Tiktok-0-1完整版（建议收藏）"><a href="#Tiktok-0-1完整版（建议收藏）" class="headerlink" title="Tiktok 0~1完整版（建议收藏）"></a>Tiktok 0~1完整版（建议收藏）</h1><blockquote><p>原链接：<a href="https://mp.weixin.qq.com/s/aXBjloJR3scJ5NOwWkgVHA">https://mp.weixin.qq.com/s/aXBjloJR3scJ5NOwWkgVHA</a></p><p>下面的内容是按系统化、分模块书写，大家学习起来就比较有逻辑性，易于掌握。</p><p>文章知识点至少覆盖市面上所有培训班的一半课程，甚至是全部，掌握这些内容，运营TikTok不是太大问题。就算要去培训班学习，也能分辨出是不是被割韭菜啦。</p><p>以后大家运营TikTok就不再是技术问题，而是找对圈子问题。</p><p>好的圈子能为你节省宝贵的时间，掌握最新资讯动态、问题得到有效解答、同行知识交流等内容才是我们要关注的重点。</p><p>写文章的初衷是一起出海赚美金，钱是赚不完的，何不把知识点一起分享，交个朋友更好？</p><p>本文的初衷不变，让大家快速掌握TikTok底层架构、构建自己的知识体系。</p><p><a href="http://mp.weixin.qq.com/s?__biz=Mzg3NDY0MjE2MA==&amp;mid=2247486919&amp;idx=1&amp;sn=9de6b935fa9f5a9167bf88399d1189a3&amp;chksm=cecce258f9bb6b4ed6dc6b695c1c8fd9f24db0f96f5d8f9a782bb50bb338e3db2a92e99f3cae&amp;scene=21#wechat_redirect">撸基金</a>、<a href="http://mp.weixin.qq.com/s?__biz=Mzg3NDY0MjE2MA==&amp;mid=2247486907&amp;idx=1&amp;sn=e60ebf912161deb626b969e631a1e3cd&amp;chksm=cecce224f9bb6b32b4debe12e001c14a9f523a2fcaea2561a330044761785aeef6ea72df3d27&amp;scene=21#wechat_redirect">开通创作者市场</a>、<a href="http://mp.weixin.qq.com/s?__biz=Mzg3NDY0MjE2MA==&amp;mid=2247486919&amp;idx=1&amp;sn=9de6b935fa9f5a9167bf88399d1189a3&amp;chksm=cecce258f9bb6b4ed6dc6b695c1c8fd9f24db0f96f5d8f9a782bb50bb338e3db2a92e99f3cae&amp;scene=21#wechat_redirect">提现流程</a>、<a href="http://mp.weixin.qq.com/s?__biz=Mzg3NDY0MjE2MA==&amp;mid=2247484477&amp;idx=1&amp;sn=95eb2e206fd8690f12e6e52a745fd6c9&amp;chksm=cecceba2f9bb62b435ea636c5c3260ef483061c85babee5633f1e75ffc757ad00883dbaa4ad5&amp;scene=21#wechat_redirect">广告投放</a>、<a href="http://mp.weixin.qq.com/s?__biz=Mzg3NDY0MjE2MA==&amp;mid=2247487210&amp;idx=1&amp;sn=97c7842ef876100ba8841a480877bb41&amp;chksm=cecce175f9bb686390629f31df02c854cbb0095f87fccebfd8f6c88984b506a7d233d6d81b44&amp;scene=21#wechat_redirect">变现案例</a>、<a href="http://mp.weixin.qq.com/s?__biz=Mzg3NDY0MjE2MA==&amp;mid=2247486946&amp;idx=1&amp;sn=284e0f709ebe4d9bdf869213cf62d7de&amp;chksm=cecce27df9bb6b6b30d65497aa3b9a55c92f33923e8a288eadcbeb3e3f17d5d47025da4a263f&amp;scene=21#wechat_redirect">实操技巧</a>等内容较多，不添加到此篇文章中，操作流程已发布在启程增长公众号，有兴趣的小伙伴可移步查看。</p><p>也希望借助此篇文章，能帮助更多的人上手TikTok，同时希望借助启程增长这个公众号，让我们一起交流更多关于社交流量与变现方面的知识。</p><p>我将知无不言。</p></blockquote><p><img src="http://5coder.cn/img/1663228814_c95fa3e1f36ca2472e446e6aad7fe9cf.png" alt="640"></p><p>闲话不多说，我们直接进入主题！</p><p>本文会从以下十五个部分来写，分别是：</p><p><img src="http://5coder.cn/img/1663229560_390abf2e51065d99add3ffa5a865e1a7.png" alt="img174"></p><h2 id="一、术语集合"><a href="#一、术语集合" class="headerlink" title="一、术语集合"></a>一、术语集合</h2><p>做TikTok，首先你应该了解在这个行业中的基本术语，也就是“行话”，让自己门清。</p><h3 id="1、搬运"><a href="#1、搬运" class="headerlink" title="1、搬运"></a>1、搬运</h3><p>我们不生产视频，我们只是视频的搬运工。对于一般玩家来说，自己创作视频成本较高，时间成本、人力成本都不是太划算。</p><p>因此，目前国内玩家进入TikTok的常规操作就是把国内或国外其他平台的优质、爆款视频搬运到TikTok平台，获得流量曝光。</p><h3 id="2、MD5值"><a href="#2、MD5值" class="headerlink" title="2、MD5值"></a>2、MD5值</h3><p>MD5是message-digest algorithm 5（信息-摘要算法）的缩写，被广泛用于加密和解密技术上，它可以说是文件的“数字指纹”。</p><p>任何一个文件，无论是可执行程序、图像文件、临时文件或者其他任何类型的文件，也不管它体积多大，都有且只有一个独一无二的MD5信息值。</p><p>并且如果这个文件被修改过，它的MD5值也将随之改变。</p><p>讲人话，就是每一个视频都有一个唯一的MD5值，相当于视频基因、身份证。</p><h3 id="3、查重"><a href="#3、查重" class="headerlink" title="3、查重"></a>3、查重</h3><p>任何一个短视频平台需要的是源源不断优秀原创视频，而不是视频的重复堆积，那会对用户体验感造成极大伤害。</p><p>因此视频平台会用各种方法对新上传的视频进行检查，是否为搬运的视频。被判定为搬运的视频将被限流甚至下架。</p><h3 id="4、去重（消重）"><a href="#4、去重（消重）" class="headerlink" title="4、去重（消重）"></a>4、去重（消重）</h3><p>你有张良计，我有登云梯。</p><p>面对视频平台的查重，玩家们就用尽浑身解数对视频进行重新剪辑、编排等手段，防止视频被查重，不让系统检测到是by，实现正常推荐。</p><p>这个过程，被称作去重。</p><h3 id="5、网感"><a href="#5、网感" class="headerlink" title="5、网感"></a>5、网感</h3><p>林徽因在《你是人间四月天》里写道“我说你是人间的四月天，笑响点亮了四面风”。</p><p>“四月天”是对对方的莫名且不可言状的情感。</p><p>网感，就是你对视频优劣、受众喜好、流行趋势的判断和感觉。</p><p>不懂？想想你喜欢的人就懂了。</p><h3 id="6、爬楼梯的孩子（读黄色部分）"><a href="#6、爬楼梯的孩子（读黄色部分）" class="headerlink" title="6、爬楼梯的孩子（读黄色部分）"></a>6、爬楼梯的孩子（读黄色部分）</h3><p>现在TikTok必须要爬楼梯才能操作，没有稳定的楼梯，TK就玩不起。</p><p>但同学们我们必须遵纪守法的操作，切不可做出违规的事，不然后果可能被请喝茶哦。</p><p><img src="http://5coder.cn/img/1663229811_f1f090236e0b46de27e5665451b12f34.png" alt="img16"></p><h3 id="7、权重"><a href="#7、权重" class="headerlink" title="7、权重"></a>7、权重</h3><p>在这个社会上，每个人说话的话语权不同，有些人说话的份量重一点，有些人讲的再大声了也没人听。</p><p>同样的做TK也是，视频是有权重，有份量的。</p><p>一个视频账号对平台来说，能不能爆，很重要的是这个账号/视频权重怎么样。大家也会经常听到“权重被降低”等词汇。</p><h3 id="8、算法"><a href="#8、算法" class="headerlink" title="8、算法"></a>8、算法</h3><p>简单点说，算法就是用系统的方法描述解决问题的策略机制。</p><p>作为用户，你刷抖音时是不是经常刷出自己喜欢的内容。</p><p>作为上传视频的你，是不是希望你的视频被喜欢你视频类别的人看到，这样更容易吸引粉丝。</p><p>算法会给你的账号贴标签，判定你是做什么类目的账号，如宠物、美妆、搞笑类。</p><p>系统就会把你的视频推送给喜欢宠物、美妆、搞笑内容的用户。</p><p>这就是算法的结果。</p><p>抖音、TikTok就是用电脑系统算出用户的习惯、喜好，然后精准推荐你感兴趣的内容。</p><h2 id="二、-算法概述"><a href="#二、-算法概述" class="headerlink" title="二、.算法概述"></a>二、.算法概述</h2><p>你要和平台打交道，那么肯定要知道平台在关心什么。 </p><p>就好像你和女孩子谈恋爱，要知道这个女孩子喜欢什么样的男生，爱什么，关心什么。 </p><p>你知道她的喜好，谈恋爱成功的概率就大很多。</p><p>同样的在TikTok上，了解算法是我们可以更能理解平台在关心什么，那么我们成功的概率就更大。</p><h3 id="1、算法类别"><a href="#1、算法类别" class="headerlink" title="1、算法类别"></a>1、算法类别</h3><p>作为TikTok玩家的我们，有3个算法内容需要我们重点关注。</p><h4 id="（1）流量池算法机制"><a href="#（1）流量池算法机制" class="headerlink" title="（1）流量池算法机制"></a>（1）流量池算法机制</h4><p>在科学上网环境安全的情况下，TikTok会给每一个作品提供一个流量池，通过这个流量池反馈视频的传播效果，决定是否将内容放到更大的流量池中，因此应当想尽办法让视频作品有突出表现。</p><p><img src="http://5coder.cn/img/1663229976_5f6cac71cb410de345e69937e6aceed4.png" alt="img71"></p><p>上图是流量池算法图示，为倒三角模型，也称为信息流漏斗算法。</p><p>TikTok算法根据视频的内容、质量、表现逐级进行曝光推荐，实现阶梯型增长。</p><p>所以我们在一开始制作视频内容的时候，要尽可能地提高点赞、评论、转发要素，做好视频内容。</p><h4 id="（2）作品分发机制"><a href="#（2）作品分发机制" class="headerlink" title="（2）作品分发机制"></a>（2）作品分发机制</h4><p>来看下一个视频出来之后，到底在TK内部是经过怎样的运行？我做了下面这张图，大家可以看下</p><p><img src="http://5coder.cn/img/1663230047_101b33592ac9a93f057c45fd5f38c92f.png" alt="img83"></p><p>TikTok的分发机制按照其先后顺序依次是：机器消重机制、审核机制、特征识别和人工干预。</p><h5 id="①消重机制"><a href="#①消重机制" class="headerlink" title="①消重机制"></a>①消重机制</h5><p>就是避免搬运。为了维护平台的用户好感度，官方肯定会保护原创。如果你的视频是别人发过的，那么视频很大可能得不到推荐。</p><h5 id="②审核机制"><a href="#②审核机制" class="headerlink" title="②审核机制"></a>②审核机制</h5><p>审核分为机器审核和人工审核。</p><p>机器审核为主，人工做一些机器无法判断的审核或机器审核出问题后再次确认。</p><p>审核一般是审核视频内容、视频标题等。主要审核是否有敏感信息、是否有导流到其他平台、是否有违反TikTok社区规则的内容。</p><p>多发积极向上的视频，因为TikTok的理念就是：Make Your Day，记录美好生活。</p><h5 id="③特征识别"><a href="#③特征识别" class="headerlink" title="③特征识别"></a>③特征识别</h5><p>当视频通过了审核以后，抖音系统会根据视频的内容和标题，对这条发布的视频打标签， 并匹配相关的用户人群，准备推送这条视频给这部分人群。</p><h5 id="④人工干预"><a href="#④人工干预" class="headerlink" title="④人工干预"></a>④人工干预</h5><p>由于机器并不能完全准确的判断视频是否违规，质量如何，而且由于机器是基于以往数据来判断，并不能很完整的预测用户发布视频的方式等。诸多因素后，引入了人工干预机制，填补一部分机器审核的漏洞。</p><p>了解好了TK的术语，算法，内部运行机制之后，接下来我们来看下我们去做TikTok要准备什么。</p><h4 id="（3）去中心化算法"><a href="#（3）去中心化算法" class="headerlink" title="（3）去中心化算法"></a>（3）去中心化算法</h4><p>一句话概括，平台不负责流量分配，只负责匹配。</p><p>去中心化分发机制是用户依靠自己对视频封面和标题的判断，决定是否打开视频进行观看，该机制对所有的视频都是公平的，一个刚注册的账号上传第一个视频也可能成为爆款。</p><p>造成的结果就是大V形成不了垄断地位，必须持续的输出优质的视频才能吸引用户。</p><p>除了头部玩家以外，粉丝量没有太大意义，因为TikTok平台更像是公域流量，虽然你的账号是你的，内容是你的，但用户使用TikTok更像是在读本知识百科，在不断的挖掘发现新的内容，粉丝没有太大的粘性。</p><p>小白的账号，只要你参与不违规也能活，新人进场永远有机会！</p><h3 id="2、算法为谁服务"><a href="#2、算法为谁服务" class="headerlink" title="2、算法为谁服务"></a>2、算法为谁服务</h3><p>字节跳动本质上是一家数字广告公司，它的商业收入有80%以上来自于广告收入。</p><p>对于广告公司（或者说是媒体平台），能获得多少收入取决于有多少广告金主愿意在你平台上花钱，更进一步在于平台上有多少优质用户和注意力可以出售。</p><p>所以对于字节跳动来说，用户就是金钱，用户的注意力就是生产力。</p><h3 id="3、算法主要解决三个核心问题"><a href="#3、算法主要解决三个核心问题" class="headerlink" title="3、算法主要解决三个核心问题"></a>3、算法主要解决三个核心问题</h3><h4 id="（1）让用户喜欢上你的内容"><a href="#（1）让用户喜欢上你的内容" class="headerlink" title="（1）让用户喜欢上你的内容"></a>（1）让用户喜欢上你的内容</h4><p>任何平台，产品才是赖以生存的基础。</p><p>内容好坏，直接关系到用户对你的喜好、停留时间、使用频率。</p><p>如果平台花了极大力气推广营销，却忽略了内容打造，用户进来后要么转头就走，要么不会长久。</p><p>从这逻辑上来看，TikTok对搬运账号的打压只会更加严厉。</p><p>在疯狂扩张期需要海量的视频内容来填充用户需求，因此搬运的检测不会太过严厉。</p><p>TikTok不会搞死你，只会把你搞的半死，比如玩家们的账号最多只是被限流、黑屏，搞到死号的程度那好比中彩票。</p><h4 id="（2）让用户快速找到想要看的内容"><a href="#（2）让用户快速找到想要看的内容" class="headerlink" title="（2）让用户快速找到想要看的内容"></a>（2）让用户快速找到想要看的内容</h4><p>抖音、TikTok算法牛逼就在于能够快速匹配你的喜好。</p><p>想瞌睡时有人给你递枕头，多么舒服的事！</p><p>古语云礼多人不怪，TikTok是把人性拿捏死死的，投其所好。</p><p>因此我们运营TikTok就可以很好的利用这一点快速起号、精准的找到用户群体。</p><h4 id="（3）保持用户增长"><a href="#（3）保持用户增长" class="headerlink" title="（3）保持用户增长"></a>（3）保持用户增长</h4><p>一套完整的用户增长模型不仅包括拉新，还有活跃、留存、转化、推荐等。</p><p>一方面要留住老用户，一个用户的流失可能会影响一片人群。</p><p>另一方面平台要存活、发展，有好内容的同时也需要持续的流量、用户注入。</p><p>从这个逻辑上，用户间互相转发视频是提高活跃度、参与度最有效的方法，因此，我们要高度重视视频转发数据。</p><p>了解好了TK的术语，算法，内部运行机制之后，接下来我们来看下我们去做TikTok要准备什么。</p><p>接下来，重头戏来了~</p><h2 id="三、准备工作"><a href="#三、准备工作" class="headerlink" title="三、准备工作"></a>三、准备工作</h2><p>了解了以上基本内容后，我们就正式进入TikTok操作流程。</p><p>首先解决的是手机问题。</p><h3 id="1、硬件要求"><a href="#1、硬件要求" class="headerlink" title="1、硬件要求"></a>1、硬件要求</h3><p><img src="http://5coder.cn/img/1663230382_908a61f4c94d6af084d0d35767b1be52.png" alt="img95"></p><p><img src="http://5coder.cn/img/1663230388_0694988f558a3fa07ea5aea5cc5827b4.png" alt="img107"></p><p>如上图</p><h4 id="（1）苹果手机"><a href="#（1）苹果手机" class="headerlink" title="（1）苹果手机"></a>（1）苹果手机</h4><p>虽然目前iPhone6能使用，但随着TikTok软件的不断升级和考虑到手机版本以及使用流畅度，强烈建议使用iPhone 7、内存32G以上。</p><h4 id="（2）安卓手机"><a href="#（2）安卓手机" class="headerlink" title="（2）安卓手机"></a>（2）安卓手机</h4><p>安卓手机市面上的一般都可以，推荐oppo r9s及以上、红米6A及以上，美版的三星S7、谷歌pixel2及以上都可以。</p><p>注意事项：</p><ul><li>手机必须能刷机。</li><li>绝大部分同学做TikTok用的是二手机，因此在网购时，一定要问清楚能否刷机。</li><li>新手建议用苹果机。软件无法下载、后台自动关闭、网络不稳定等幺蛾子没有安卓那么多，当然也看个人习惯。</li><li>对于TikTok新手而言，首要任务是打通TikTok操作流程和玩法，再精细化运营，先把账号做起来，再谈引流变现。</li></ul><h4 id="（3）运营TikTok账号的三阶段"><a href="#（3）运营TikTok账号的三阶段" class="headerlink" title="（3）运营TikTok账号的三阶段"></a>（3）运营TikTok账号的三阶段</h4><p>会不会觉得很奇怪，明明讲的是设备要求，怎么讲起运营账号了。</p><p>目的就是和大家提个醒，手机多准备两个，把鸡蛋多放几个篮子，路才能走得长远。</p><p>第一阶段：基础设置起号注册</p><p>期间，死掉几个账号。</p><p>第二阶段：熟悉操作快速涨粉</p><p>期间，死掉几个账号。</p><p>中间你会遇到账户间涨粉速度不同，单个账号涨粉不稳定等问题，再正常不过。</p><p>第三阶段：精细化运营爆款带货</p><p>大家应该猜到答案了，还是死掉几个账号。</p><p>到该阶段你的运营基础技术都没问题，就是求突破、批量复制成功账号案例的时候。</p><p>死掉几个账号不仅是账号被封无法登陆，还包含涨粉不快、限流、视频下架等问题。</p><p>同样情况下，两部手机同时上传一个视频，有的视频表现好，有的表现差，这是正常的事。</p><p>多准备两部手机就是缩短打通TikTok操作流程时间。</p><p>运营TikTok，时间成本是最宝贵的投资成本。</p><p>切记切记。</p><h3 id="2、其他准备事项"><a href="#2、其他准备事项" class="headerlink" title="2、其他准备事项"></a>2、其他准备事项</h3><h4 id="（1）美区苹果ID"><a href="#（1）美区苹果ID" class="headerlink" title="（1）美区苹果ID"></a>（1）美区苹果ID</h4><p>下载TikTok等海外软件需要用美区苹果ID登录苹果商店才能购买。</p><p>建议买永久的ID，买到后立即换密码。</p><p>一次性ID风险太大，容易锁机。</p><h4 id="（2）Gmail邮箱"><a href="#（2）Gmail邮箱" class="headerlink" title="（2）Gmail邮箱"></a>（2）Gmail邮箱</h4><p>主要是用来注册TikTok账户。</p><p>可以自己注册，也可以批量注册。</p><p>对于新手而言，建议还是买吧，一个不到2元，而且以后TikTok可以卖钱，就不用担心Gmail邮箱的问题了。</p><p>等上手后再研究邮箱批量注册问题。</p><h2 id="四、基础设置"><a href="#四、基础设置" class="headerlink" title="四、基础设置"></a>四、基础设置</h2><p>对手机的基础设置包括恢复出厂设置、对上网环境进行处理、下载软件等。</p><p><img src="http://5coder.cn/img/1663230542_2237ca1b84fd1d32c418a216d74ee49e.png" alt="img120"></p><h3 id="1、背景介绍"><a href="#1、背景介绍" class="headerlink" title="1、背景介绍"></a>1、背景介绍</h3><p>为什么要对手机进行基础设置?</p><p>系统会根据手机卡的运营商、IP地址、系统位置、手机语言、时区等要素来判定是否属于大陆用户。</p><p>TikTok会根据你的手机设置情况判定你是否为正常的非大陆地区用户。</p><p>若被发觉为大陆地区用户，你的账号将面临被限流减少推荐、视频下架、无法打开等情况。</p><h3 id="2、基础设置"><a href="#2、基础设置" class="headerlink" title="2、基础设置"></a>2、基础设置</h3><p>以苹果8、红米6pro手机为例。</p><h4 id="（1）苹果8手机基础设置"><a href="#（1）苹果8手机基础设置" class="headerlink" title="（1）苹果8手机基础设置"></a>（1）苹果8手机基础设置</h4><p>上图为敬</p><p><img src="http://5coder.cn/img/1663230606_3afc6d47fb6a2731ec40d16c5d01983b.png" alt="img132"></p><p><img src="http://5coder.cn/img/1663230620_c4530ab9921d76c891afdd704ed74f95.png" alt="img145"></p><p>看图是不是清晰多了，大家可以对比下苹果、安卓设置流程的不同。</p><p>就这4步。</p><p>大家一定要根据自己的手机操作流程写一遍导图，拍张照，以后要进行基础设置就直接拿出来对着操作一遍。</p><p>好记忆不如烂笔头。</p><p>下面就开始具体讲解：</p><h5 id="①刷机"><a href="#①刷机" class="headerlink" title="①刷机"></a>①刷机</h5><ul><li>拔卡</li></ul><p>拔掉手机里的电话卡，电话卡在手机里，你的手机上网环境就会被检测出来是中国的。</p><p>插海外卡是可以的，但你得确认你的，海外卡是你要做的地区。</p><p>比如你要做美国市场，你买了张英国运营商的卡，那你的流量就会跑偏，跑英国区去了。</p><p>就算你买的是美国的卡也得注意，因为美国和中国电话卡运营商和中国的不同，美国的卡运营商也有其他国家的。</p><ul><li>重置（恢复出厂设置）</li></ul><p>要抹掉手机所有内容和设置，不能保留任何手机卡信息、文档、软件残留信息，这些信息容易被TikTok判定为上网环境不安全。</p><ul><li>激活</li></ul><p>几个点需要注意：跳过所有设置，关闭手机定位功能。</p><p>激活时不要登入苹果ID，除非这个ID是你的，属于美区的，而且保证安全。</p><p>有些同学在某宝、某多上购买一次性的美区账号，在激活时登录苹果ID，过阵子，锁机。</p><p>有些同学在苹果商店上登录苹果ID，过阵子，锁机。</p><p>搞得你一点脾气都没有。</p><h5 id="②设置节点"><a href="#②设置节点" class="headerlink" title="②设置节点"></a>②设置节点</h5><p>节点这里以astrill为例。</p><p>astrill贵了点，相对来说比较稳定。</p><p>节点的稳定对大家来说是非常有必要的，在开始运营TikTok后，你就会发觉稳定的上网环境有多么重要。</p><p>良好的科学上网环境，是基础中的基础。</p><ul><li>注册astrill账户</li></ul><p>先登录astrillcn.com注册账号，之后购买套餐。</p><p><img src="http://5coder.cn/img/1663230749_75b8491ae2072f9c53ae563c7ca1d348.png" alt="640 (1)"></p><p><img src="http://5coder.cn/img/1663230763_981fed69ed3a7ab69c3908ed2b007f95.png" alt="640 (2)"></p><p><img src="http://5coder.cn/img/1663230779_d4bd128f5be4006872b47e0f7b4d1e05.png" alt="640 (3)"></p><p><img src="http://5coder.cn/img/1663230786_9924c040cf9e29567e11fb43d5fae85b.png" alt="640 (4)"></p><ul><li>下载登录astril</li></ul><p>打开苹果商店，登录美区ID，直接搜索astrill下载即可。</p><p><img src="http://5coder.cn/img/1663230806_3a944ce7872dec05fbc30e2801c8ff9e.png" alt="640 (5)"></p><p>软件下载完成后，打开登录，选择你需要的目标地区节点。</p><p><img src="http://5coder.cn/img/1663230828_e22ad08bc9ca1970c1a00a8d386c17ea.png" alt="640 (6)"></p><h5 id="③基础设置"><a href="#③基础设置" class="headerlink" title="③基础设置"></a>③基础设置</h5><ul><li>节点查询</li></ul><p>节点安装完成后要查询下节点是否已经成功出去了、已经用了国外的IP。</p><p>网页登录ipip.net进行查询。</p><p><img src="http://5coder.cn/img/1663230856_b75165388dce2fa4fbbddc9430c305c0.png" alt="640 (7)"></p><p>节点成功出去后，根据节点信息对手机进行设置。</p><ul><li>时区时间</li></ul><p>设置路线：设置》通用》日期与时间》关闭自动设置》时区选择节点的时区</p><p><img src="http://5coder.cn/img/1663230879_3e368c7a083bbc6483437d1d3207761f.png" alt="640 (8)"></p><ul><li>关闭定位</li></ul><p>设置路径：设置 》隐私 》定位服务 》关闭</p><p><img src="http://5coder.cn/img/1663230898_b0489b4c0855f3a9160bb86bff3227b1.png" alt="640 (9)"></p><ul><li>关闭广告</li></ul><p>设置路径：设置 》隐私 》广告》开启限制广告追踪 Limit Ad Tracking</p><p><img src="http://5coder.cn/img/1663230955_80bab5b5f69cac47876dbaf19c20e4c2.png" alt="640 (11)"><img src="http://5coder.cn/img/1663230922_2a194c2f2e9c14226e8dbcf428e7e83f.png" alt="640 (10)"><img src="http://5coder.cn/img/1663230969_dd7c53ae457165425a5f64a4aff99080.png" alt="640 (12)"></p><ul><li>设置语言</li></ul><p>设置路径：设置》通用》语言与地区》英语或目的地区语言</p><p><img src="http://5coder.cn/img/1663231019_1044a4efb8acb013ec105238eb7d678c.png" alt="640 (13)"><img src="http://5coder.cn/img/1663231024_f1bc968cf152d77449c0314716acba4c.png" alt="640 (14)"><img src="http://5coder.cn/img/1663231028_cbf018c57c0eae68ac745ea9af9d2b03.png" alt="640 (15)"></p><h5 id="④伪装度查询"><a href="#④伪装度查询" class="headerlink" title="④伪装度查询"></a>④伪装度查询</h5><p>手机基础设置完成后，得检查上网环境是否安全。</p><p>打开astrill状态下进行检查，两种检查方式。</p><p>一是网页登录whoer.net（经常出现网页无法打开的情况）</p><p><img src="http://5coder.cn/img/1663231061_275fa006d72e3f5e07523cd0a777030c.png" alt="640 (16)"></p><p>二是网页登录网址：</p><p><a href="https//www.astrill.com/vpn-leak-test">https//www.astrill.com/vpn-leak-test</a></p><p><img src="http://5coder.cn/img/1663231089_45ff34439d1aad0390ed47d4e6d82f30.png" alt="640 (17)"><img src="http://5coder.cn/img/1663231092_192de470b448667e8ca05b0f4db6e256.png" alt="640 (18)"></p><p>==环境监测100%安全就可以下载TikTok了。==</p><p>如果没有达到100%，可以按照提示的问题进行修正。</p><h4 id="（2）安卓手机基础设置"><a href="#（2）安卓手机基础设置" class="headerlink" title="（2）安卓手机基础设置"></a>（2）安卓手机基础设置</h4><p><img src="http://5coder.cn/img/1663231472_c4530ab9921d76c891afdd704ed74f95.png" alt="640 (19)"></p><p>手机设置和苹果手机大同小异。</p><h5 id="①刷机-1"><a href="#①刷机-1" class="headerlink" title="①刷机"></a>①刷机</h5><ul><li>拔卡</li></ul><p>不要插卡就是对的。</p><ul><li>刷机</li></ul><p>恢复出厂设置。</p><ul><li>激活</li></ul><p>跳过所有设置，关闭手机定位功能</p><h5 id="②设置节点-1"><a href="#②设置节点-1" class="headerlink" title="②设置节点"></a>②设置节点</h5><ul><li>注册astrill账户</li></ul><p>注册流程详见苹果手机注册astrill账户流程。</p><ul><li>下载登录astrill</li></ul><p>下载环节和苹果手机有所不同，因为安卓手机没有苹果商店。</p><p>登录官网<a href="http://www.astrillcn.com注册账号,app需要登录账号才会显示下载按钮./">www.astrillcn.com注册账号，app需要登录账号才会显示下载按钮。</a></p><p><img src="http://5coder.cn/img/1663231540_4718ca26573ec39a01f35298dea9e9c7.png" alt="640 (20)"><img src="http://5coder.cn/img/1663231540_e78ab1d8fde4befef28c3ca42f448a41.png" alt="640 (21)"><img src="http://5coder.cn/img/1663231540_14baa72ce41be3593f0298daa8fc21e0.png" alt="640 (22)"></p><p><img src="http://5coder.cn/img/1663231540_9ae10be6a52ffb1122349b46c420a4ca.png" alt="640 (23)"><img src="http://5coder.cn/img/1663231540_5d009ed3a9113e048273958c8195979c.png" alt="640 (24)"></p><p>下载完成后直接打开app并登录。</p><p><img src="http://5coder.cn/img/1663231657_cbc896b52429828a040bfd747ce165d6.png" alt="640 (25)"><img src="http://5coder.cn/img/1663231657_771b2e0967e56149c7dcbce0a113d86f.png" alt="640 (26)"><img src="http://5coder.cn/img/1663231657_aae9ef0fce4f6095d7a0b9bfce7bdb25.png" alt="640 (27)"></p><h5 id="③基础设置-1"><a href="#③基础设置-1" class="headerlink" title="③基础设置"></a>③基础设置</h5><ul><li>节点查询</li></ul><p>网页登录ipip.net进行查询。</p><p><img src="http://5coder.cn/img/1663231684_f1de71ed8ad86b50b1e61066fb4679bd.png" alt="640 (28)"></p><p>节点成功出去后，根据节点信息对手机进行设置。</p><ul><li>时区时间</li></ul><p>设置路线：设置》更多设置 》系统安全》位置信息关</p><p><img src="http://5coder.cn/img/1663231752_264be649252ddfa9239b0640fecf689f.png" alt="640 (29)"><img src="http://5coder.cn/img/1663231752_f0c47662e3973006e6549cab6e5b18ed.png" alt="640 (30)"><img src="http://5coder.cn/img/1663231752_e7685d760f0c783a2af1a95dace0dd0b.png" alt="640 (31)"></p><ul><li>关闭广告</li></ul><p>设置路线：设置》更多设置 》系统安全》广告服务关闭</p><p><img src="http://5coder.cn/img/1663231787_5afe319c362eb39831bc14cf7a211b19.png" alt="640 (32)"><img src="http://5coder.cn/img/1663231787_e04af50469998fdf6422ee90489180e9.png" alt="640 (33)"></p><ul><li>日期时间</li></ul><p>设置路线：设置》更多设置》日期与时间》关闭自动设置》时区选择伪装度查询IP节D的时区</p><p><img src="http://5coder.cn/img/1663231826_96e677446df32d258b409a1c6b2d6284.png" alt="640 (34)"><img src="http://5coder.cn/img/1663231826_9ae76eb89adf5b0ac4fd6083109e7f09.png" alt="640 (35)"><img src="http://5coder.cn/img/1663231826_ffaba1e79eed1ae75700238496fb47a8.png" alt="s"></p><ul><li>设置语言</li></ul><p>设置路线：设置》更多设置 》语言和输入法》选择英文</p><p><img src="http://5coder.cn/img/1663231856_161c0af7417b68f9bc4c92cfd27cd7a9.png" alt="640 (36)"><img src="http://5coder.cn/img/1663231856_f3dc37315c3c2efd66cdd736e5a8ef53.png" alt="640 (37)"></p><h5 id="④伪装度查询-1"><a href="#④伪装度查询-1" class="headerlink" title="④伪装度查询"></a>④伪装度查询</h5><p>方法和苹果手机检查伪装度相同。</p><p>一是网页登录whoer.net（经常出现网页无法打开的情况）</p><p><img src="http://5coder.cn/img/1663231879_275fa006d72e3f5e07523cd0a777030c.png" alt="640 (38)"></p><p>二是网页登录：</p><p>https//<a href="http://www.astrill.com/vpn-leak-test">www.astrill.com/vpn-leak-test</a></p><p>到这，手机的基础设置就全部完成，可以放心下载TikTok软件。</p><h2 id="五、软件安装"><a href="#五、软件安装" class="headerlink" title="五、软件安装"></a>五、软件安装</h2><p>上网环境没问题后，就可以下载软件了。</p><p>==苹果手机直接在苹果商店搜索下载TikTok。== </p><p>若苹果商店搜索不到，可用chrome网页搜索TikTok点击下载软件，会自动跳转到苹果商店下载。</p><p><img src="http://5coder.cn/img/1663232332_29425b11d5210e25992a0f24bc7d233c.png" alt="640 (39)"></p><p>==安卓手机安装TikTok软件有两种下载方法。==</p><p>一是开梯子登陆apkpure.com</p><p>搜索栏直接输入TikTok，点击下载就ok。</p><p>这种方法比下面要讲的安装谷歌三件套要方便快捷。</p><p><img src="http://5coder.cn/img/1663232374_3f33550ec3d8e1f8c7b32aa99fdbb8a5.png" alt="640 (40)"><img src="http://5coder.cn/img/1663232374_61e7b3628c1f3b65db5e004ad73cd6bc.png" alt="640 (41)"></p><p>二是安装谷歌三件套后下载</p><p>谷歌手机自带苹果商店和服务系统，不用安装三件套。</p><p>国内的手机就需要安装。</p><p>设置流程：手机安装360手机助手或者应用宝 》搜索下载GO谷歌安装器 》 打开谷歌安装器一键安装谷歌三件套》安装完成后登录苹果商店搜索下载。</p><p><img src="http://5coder.cn/img/1663232474_9b0366d026f781b3bd54d54207788ed7.png" alt="640 (42)"><img src="http://5coder.cn/img/1663232474_35927077ba60ae9ab8f2219ee721cd54.png" alt="640 (43)"><img src="http://5coder.cn/img/1663232474_cab895a6242814197acb431c6250225b.png" alt="640 (44)"></p><p>若谷歌商店搜索不到TikTok，可打开chrome网页搜索TikTok，点击下载，会自动跳转到谷歌商店下载。</p><p>==ps：同时下载一些常用的下载TikTok视频的软件。==</p><p>如TikTok Downloader，Downloader for TikTok，Save TikTok，WeChat，视频剪辑软件如capcut（剪映海外版），当然有些是要收费的。</p><h2 id="六、账号设置"><a href="#六、账号设置" class="headerlink" title="六、账号设置"></a>六、账号设置</h2><p>TikTok软件下载完成后，就开始注册账号。</p><p>如下图，本篇文章要讲5个部分内容。</p><p><img src="http://5coder.cn/img/1663234638_10118faa99b667f30da38bbf94ced56a.png" alt="640 (45)"></p><h3 id="1、账号领域"><a href="#1、账号领域" class="headerlink" title="1、账号领域"></a><strong>1、账号领域</strong></h3><p>注册账号前，必须清楚你注册TikTok准备做什么领域、什么类目、什么内容。</p><p>必须让TikTok系统认定你的账号是做什么领域的账号，系统会对应将你的视频分发给对应标签的用户。</p><p><img src="http://5coder.cn/img/1663234666_e05376afd579a7e2f112b50c1398ac43.png" alt="640 (46)"></p><p>上图是注册TikTok账号时出现的界面，选择你的账号领域，可以挑选一个也可以多选。</p><p>一开始TikTok就给你的账号分类了，选择你要做的账号领域是可以给你增加定向流量。</p><p>后续刷相关的内容视频，对相关视频点赞评论，也会同样增加对应内容的推送。</p><h3 id="2、账号类型"><a href="#2、账号类型" class="headerlink" title="2、账号类型"></a><strong>2、账号类型</strong></h3><p><img src="http://5coder.cn/img/1663234694_b4d06230583c288e1c716a23b433ad9f.png" alt="640 (47)"></p><p>目前TikTok个人账号类型有流量号、带货号、IP号、引流号四大类，每个类别特点和变现方向不同。</p><h4 id="（1）流量号"><a href="#（1）流量号" class="headerlink" title="（1）流量号"></a><strong>（1）流量号</strong></h4><p>追求曝光，视频上传的内容和产品推广、带货营销无关，只为快速涨粉和视频播放量，后期的变现方向也包括成为网红账号接广告单。</p><p>如解压、宠物、搞笑、美女、美景、运动等类目。</p><p><img src="http://5coder.cn/img/1663234728_431a2aa200dc0b3ae0fb272b3d31f641.png" alt="640 (48)"><img src="http://5coder.cn/img/1663234728_3606efdd10ee31e1044821919075ee5a.png" alt="640 (49)"></p><h4 id="（2）带货号"><a href="#（2）带货号" class="headerlink" title="（2）带货号"></a><strong>（2）带货号</strong></h4><p>账号特点很突出，包括好物号、营销号等，为电商导流。</p><p>目前比较少的账号能做到十分垂直，比如好物号的视频内容比较杂，包含生活用品、简易工具等内容的营销。</p><p>当然，视频源比较少是一大原因，跨境电商卖家没有更多的精力投入视频拍摄中，大都处于BY视频状态。</p><p>另一个原因是在TikTok上测品时间漫长、流量不精准等，或者卖家对爆款产品把握不准，只能大面积铺货，商家产品，把店铺做成杂货铺样式。</p><p><img src="http://5coder.cn/img/1663235811_a64a91189b2550e06a80a1e9bcb60932.png" alt="640 (50)"><img src="http://5coder.cn/img/1663235811_b32626f9a5ec77dfb3b42e944abc7af2.png" alt="640 (51)"></p><h4 id="（3）IP号"><a href="#（3）IP号" class="headerlink" title="（3）IP号"></a><strong>（3）IP号</strong></h4><p>最突出的特点就是账号内容高度垂直、视频调性高度统一。</p><p>可以是真人出镜，也可以是以宠物出镜代替、一双手出镜（饮料调配）等方式。</p><p>该类型账号粉丝群体精准，受广告商青睐，带货能力较强，可以很好的结合广告、电商平台、独立站等进行变现，收益可观。</p><p><img src="http://5coder.cn/img/1663235856_7c4937d84c62799a5919028806b444ff.png" alt="640 (52)"><img src="http://5coder.cn/img/1663235856_9618f272b480b075d598a5fa300dc7bc.png" alt="640 (53)"><img src="http://5coder.cn/img/1663235856_0c2fa7755686f34e05ae50c8e27f40c5.png" alt="640 (54)"></p><h4 id="（4）引流号"><a href="#（4）引流号" class="headerlink" title="（4）引流号"></a><strong>（4）引流号</strong></h4><p>给谁引流？</p><p>一是给电商平台引流，为卖家带来流量。</p><p>跨境卖家注册TikTok账号营销产品，看中的是TikTok流量，这些账号可以通过强势、暴力曝光等手段引流到店铺。</p><p>当然，采取多账号登录、强势、暴力引流等方式对账号不太有利，容易死号，但跨境卖家看中的就是流量曝光，而不是极低成本的账号。</p><p>也可以精细化运营账号，沉淀粉丝，不断提高账号权重，形成推广产品、粉丝沉淀、引流转化的良性循环。</p><p><img src="http://5coder.cn/img/1663250477_8eb32e873f2394ae9f6fe401ec0937ea.png" alt="640"></p><p><img src="http://5coder.cn/img/1663250477_5bee9b3581383c5d4813333085f0915b.png" alt="640 (1)"></p><p>二是给TikTok主账号引流。</p><p>众多大牌厂家都在TikTok上开设官方账户，为了加大营销成果，都会以矩阵号方式设立众多的子账号。</p><p>这些子账号就是引流号，子账号内容和官方账号内容相同，账户垂直，从账号简介、视频内容、文案书写、标签使用等方面都指向品牌和主账号，给品牌方带来曝光。</p><p>如国货品牌花西子出海。</p><p><img src="http://5coder.cn/img/1663250548_8a73d124555804ac18763ae4814fd965.png" alt="640 (2)"></p><p><img src="http://5coder.cn/img/1663250548_87c383b3aea5b598410bc5668b1c8517.png" alt="640 (3)"></p><h3 id="3、什么样的内容比较好做"><a href="#3、什么样的内容比较好做" class="headerlink" title="3、什么样的内容比较好做"></a><strong>3、什么样的内容比较好做</strong></h3><p>账号内容可分为四大类：大文娱、技能类、生活化、安利类</p><p><img src="http://5coder.cn/img/1663250578_5bd286a1db4ef8372226f41d56f3e0a9.png" alt="640 (4)"></p><p>带货能力比较：安利类》生活类》技能类》大文娱</p><p>涨粉速度比较：大文娱》技能类》生活类》安利类</p><p><strong>这里罗列16种涨粉速度快、新手可以快速入手、打通运营巧的内容：</strong></p><h4 id="（1）搞笑类"><a href="#（1）搞笑类" class="headerlink" title="（1）搞笑类"></a><strong>（1）搞笑类</strong></h4><p>搞笑类短视频是较为普遍的，容易涨粉，但变现方式较少，可以赚创作者基金。</p><p>粉丝多的话，还可以接广告，带货转化难度较大。</p><h4 id="（2）美女类"><a href="#（2）美女类" class="headerlink" title="（2）美女类"></a><strong>（2）美女类</strong></h4><p>这类视频比较普遍，纯原创的较少，大多是by。</p><p>如果是展示个人的话，可以靠创作者基金变现，还可以直播，也可以做服装电商等；</p><h4 id="（3）健身类"><a href="#（3）健身类" class="headerlink" title="（3）健身类"></a><strong>（3）健身类</strong></h4><p>健身类视频属于垂直细分类，可以做健身、瑜伽等课程，也可以转化私教，或者带货健身器材、增肌等衍生产品；</p><h4 id="（4）宠物类"><a href="#（4）宠物类" class="headerlink" title="（4）宠物类"></a><strong>（4）宠物类</strong></h4><p>宠物类如果不是实拍个人的宠物，by视频则容易重复。变现主要是创作者基金，接广告，带货宠物粮食和玩具等；</p><h4 id="（5）特效类"><a href="#（5）特效类" class="headerlink" title="（5）特效类"></a><strong>（5）特效类</strong></h4><p>这类视频有一定的门槛，可以快速吸引大家的目光，赚创作者基金不错。后期可以做特效课，引流私域等；</p><h4 id="（6）好物类"><a href="#（6）好物类" class="headerlink" title="（6）好物类"></a><strong>（6）好物类</strong></h4><p>家居、时尚、小家电，视频内容越垂直，变现效果越好。好物类特别适合想做电商变现的朋友；</p><h4 id="（7）影视类"><a href="#（7）影视类" class="headerlink" title="（7）影视类"></a><strong>（7）影视类</strong></h4><p>影视剪辑作品一直深受网友的喜爱，但不同地区的人群，对内容的喜好度也不一样，适合赚创作者基金，也挺好涨粉的，不好的一点是容易涉及版权问题；</p><h4 id="（8）美食类"><a href="#（8）美食类" class="headerlink" title="（8）美食类"></a><strong>（8）美食类</strong></h4><p>美食类涨粉快，也容易接广告，菜谱、试吃，就看大家怎么去做定位了；</p><h4 id="（9）母婴类"><a href="#（9）母婴类" class="headerlink" title="（9）母婴类"></a><strong>（9）母婴类</strong></h4><p>内容主要是亲子日常，也可以是萌娃展现，后期变现除了赚基本的创作者基金，还可以做幼儿教育、母婴电商等产品；</p><h4 id="（10）手工类"><a href="#（10）手工类" class="headerlink" title="（10）手工类"></a><strong>（10）手工类</strong></h4><p>手工制作者可以展现自己的工艺品，一般都具有鉴赏价值和创意，这些手工艺品除非量产，不然变现是有限的；</p><h4 id="（11）运动类"><a href="#（11）运动类" class="headerlink" title="（11）运动类"></a><strong>（11）运动类</strong></h4><p>徒步、蹦极、滑雪……涨粉快，可以通过创作者基金变现。如果是个人IP，还可以后期直播变现；</p><h4 id="（12）游戏类"><a href="#（12）游戏类" class="headerlink" title="（12）游戏类"></a><strong>（12）游戏类</strong></h4><p>要看做什么内容，可以是游戏精彩剪辑，也可以是游戏攻略，除了赚创作者基金，还可以接广告；</p><h4 id="（13）明星类"><a href="#（13）明星类" class="headerlink" title="（13）明星类"></a><strong>（13）明星类</strong></h4><p>多发一些外国人喜欢的明星，这类视频涨粉快，但变现能力弱，适合赚创作者基金；</p><h4 id="（14）猎奇类"><a href="#（14）猎奇类" class="headerlink" title="（14）猎奇类"></a><strong>（14）猎奇类</strong></h4><p>涨粉快，但内容容易出现不推荐或被删除的情况，变现渠道较少，主要是创作者基金；</p><h4 id="（15）魔术类"><a href="#（15）魔术类" class="headerlink" title="（15）魔术类"></a><strong>（15）魔术类</strong></h4><p>魔术类视频浏览量会高，涨粉也快，变现有创作者基金，也可以考虑魔术道具的电商带货；</p><h4 id="（16）美妆类"><a href="#（16）美妆类" class="headerlink" title="（16）美妆类"></a><strong>（16）美妆类</strong></h4><p>仿妆、美妆知识、美妆测评……美妆类可以变现的渠道多，内容做得足够垂直细分，后期美妆电商带货是不错的。</p><h3 id="4、注意事项"><a href="#4、注意事项" class="headerlink" title="4、注意事项"></a><strong>4、注意事项</strong></h3><h4 id="（1）类目垂直"><a href="#（1）类目垂直" class="headerlink" title="（1）类目垂直"></a><strong>（1）类目垂直</strong></h4><p>账号类目是否垂直极其重要，不要一会儿上传个宠物视频，一会儿上传个好物视频，对账号是不太友好的，影响权重。</p><p>但不是说视频内容就一成不变，在账号类目下的视频内容可以使用。</p><p>比如你卖钢铁侠玩具，类目上属于玩具类，你可以同时捆绑售卖绿巨人、蜘蛛侠、奇异博士等玩具。</p><p>再比如你的账号是画画类流量号，就为了涨粉，你BY的内容就可以是简笔画、彩色画、油彩画，甚至是涂鸦，你的标签用上#draw#art等就很ok。</p><h4 id="（2）明确核心需求"><a href="#（2）明确核心需求" class="headerlink" title="（2）明确核心需求"></a><strong>（2）明确核心需求</strong></h4><p>在进入TikTok前想好做TikTok、设立账号准备干什么。是撸基金、接单做广告，还是做潜力收益巨大电商引流、品牌出海。</p><p>想好了，干就完了。</p><h4 id="（3）打牢基础"><a href="#（3）打牢基础" class="headerlink" title="（3）打牢基础"></a><strong>（3）打牢基础</strong></h4><p>基础不牢，地动山摇。作为新手入门，万万不可有做2个账号就定下涨粉多少多少的目标，或者给你带来多少多少转化的期望。</p><p>要把前几个账号为测试号（看做是必死号），以打基础、熟悉流程、测试运营手法为目标。</p><h4 id="（4）多账号运营"><a href="#（4）多账号运营" class="headerlink" title="（4）多账号运营"></a><strong>（4）多账号运营</strong></h4><p>目的是把随机事件变为概率事件。</p><p>经过测试，同时起的号，类目领域统一，注册、养号流程一样，发布手法、时间相同，但同样的视频再不同账号中的表现却不相同。</p><p>主要原因在于TikTok给账号推送的第一波观众是不一样的，如果你的第一波观众喜欢你的视频，你的视频就表现的更好，反之亦然。</p><p>因此在科学上网环境下，运营TikTok存在一个随机事件。</p><p>发现问题、解决问题，这是我们对工作、对生活应有的态度。</p><p>要应对这个问题，就是多准备几部手机，同时运营，表现不好的就弃号，重新注册，把随机事件变成概率事件。</p><p>简单，粗暴，有效。</p><h3 id="5、账号注册"><a href="#5、账号注册" class="headerlink" title="5、账号注册"></a><strong>5、账号注册</strong></h3><p>完成了手机基础设置、科学上网、账户领域的选择，就正式进入TikTok账户注册和设置环节。</p><p>打开TikTok app，首页呈现出的是注册和账号登入页面。</p><p>注册的方式很多，手机号、邮箱，facebook、google、twitter账号等，为方便注册，我们选择“Use phone or email”邮箱注册。</p><p><img src="http://5coder.cn/img/1663250731_ebcc499014c1687933f1d9075247c9a3.png" alt="640 (5)"></p><p>弹出一个让你填写生日的界面，选择的一定要年满18周岁的日期作为你的生日。</p><p>未满18周岁很多功能无法使用，基金因为没法撸。</p><p><img src="http://5coder.cn/img/1663250747_cb5dba95be5bcf5ea98b8f17a545e517.png" alt="640 (6)"></p><p>填写生日后点击“Next”弹出下方界面。</p><p>我们可以看到当我们选择“Phone”的时候，下方会显示“US+1”的区号。</p><p>这从侧面说明我们设备目前伪装成功，如果你手机这个界面显示“+86”说明你的设备还存在问题。</p><p><img src="http://5coder.cn/img/1663250770_709c4badf6cc5a3592c14478748f3e29.png" alt="640 (7)"></p><p>因为我们选择使用邮箱注册TikTok，那我们点击右边“Email”，可以看到下方TikTok平台支持注册的邮箱类型，这边我们选择gmail邮箱进行注册账号。</p><p><img src="http://5coder.cn/img/1663250780_f90ec2b53e0d36406b2629b006985177.png" alt="640 (8)"></p><p>进入账号类目选择界面，选择账号垂直领域即可，可多选，一定要选择和自己账号类目一样的领域。</p><p>选择完成后，系统会为你推荐建议关注的账户，直接跳过，选择start watching。</p><p>注册就完成了。</p><p>接下来就可以刷视频，针对自己感兴趣的内容或要做的领域去刷，相应的点赞、评论、分享。</p><p><img src="http://5coder.cn/img/1663250806_b8241db04028abb407efa131a5bf752d.png" alt="640 (9)"></p><p><img src="http://5coder.cn/img/1663250806_592e1108bf51b42ce53ae22e158eec13.png" alt="640 (10)"></p><p><img src="http://5coder.cn/img/1663250806_a5b9b6937e22a85362a5f05e7084052a.png" alt="640 (11)"></p><h3 id="6、账号设置"><a href="#6、账号设置" class="headerlink" title="6、账号设置"></a><strong>6、账号设置</strong></h3><p>和抖音相同，注册成功的TikTok账号个人界面都是空的，需要进行完善。</p><h4 id="（1）账号界面介绍"><a href="#（1）账号界面介绍" class="headerlink" title="（1）账号界面介绍"></a><strong>（1）账号界面介绍</strong></h4><p>首先介绍下TikTok界面的基本信息和功能。</p><p>如下图，根据手机界面，自左下角起分别介绍各模块功能。</p><p>主页：有系统推荐的视频For You，和抖音相同。也有你关注账号的视频Following，这个功能抖音是没有的。</p><p><img src="http://5coder.cn/img/1663250872_2bfbd943942f586a1a7a74c3349f7a6a.jpg" alt="640"></p><p>搜索：可以搜索账号、关键词、标签、音乐等，页面下端是最流行的标签。</p><p><img src="http://5coder.cn/img/1663250900_5db18fe97e7ad875cca85b8718fa60f0.jpg" alt="640 (1)"></p><p>加号：就是上传视频按钮，可进行直播。</p><p>如下图：</p><ul><li><p>Add sound视频最上端的Addsound功能是添加音乐，拍摄的视频只有音乐声音。</p></li><li><p>Camera最多可上传3分钟的视频，</p></li><li><p>Template由几张图片组成的合集组成动图。</p></li><li><p>LIve直播功能。</p></li><li><p>Effects特效，给视频加上特效。</p></li><li><p>Upload上传手机上的视频。</p></li><li><p>在右侧有调转摄像头、调速、滤镜、倒计时、闪光功能。</p></li></ul><p><img src="http://5coder.cn/img/1663250933_f4ce0818c2e39998f84b7d23ef54499a.png" alt="640 (12)"></p><p>inbox：账户所有收到的信息，包括你的账号被关注、@或询问，视频被点赞、评论，最重要的是TikTok官方给你发的信息都在这里。</p><p><img src="http://5coder.cn/img/1663250944_2b2b26756204f5a710961696f8eac45a.png" alt="640 (13)"></p><ul><li><p>Me：个人账号后台，可以对账号进行设置，查看账号信息。</p></li><li><p>Creator Playlist播放列表：建立一个视频合集文件夹，把同类项或者播放量很好的视频放置其中，提高用户在你账户停留时间的好方法。</p></li><li><p>创建直播预告：在右上角有个按钮可以创建直播预告，告知你的粉丝你要做直播的时间、主题、内容等，TikTok官方一直大力推广直播，值得关注。</p></li></ul><p>个人和他人账号主页基本信息、功能如下图。</p><p><img src="http://5coder.cn/img/1663250974_53891d9b6c6a08d78e85231c79085cee.png" alt="640 (14)"></p><p><img src="http://5coder.cn/img/1663250974_9d5cd7c232b41fa7da11a092dbb2649e.jpg" alt="640 (2)"></p><h4 id="（2）账号界面设置"><a href="#（2）账号界面设置" class="headerlink" title="（2）账号界面设置"></a><strong>（2）账号界面设置</strong></h4><p>点击账号主页的Edit profile，进入个人账号设置界面。</p><p><img src="http://5coder.cn/img/1663251003_3f3c5e8c72b8a1dc6752a9d0f7ba2b0e.png" alt="640 (15)"></p><ul><li><p>头像：可以是图片或视频，尽量是高清的，不要频繁修改。</p></li><li><p>Name：用户名，全网唯一的名称，不可重复，取适合自己定位内容的名字，看起来显得专业。不要太复杂和冗长，尽量简单好记。</p></li><li><p>Username：账号昵称。</p></li><li><p>Bio：介绍你这个账号做什么内容，可以指引用户添加关注等，follow me for more。外国人还没有习惯在短视频平台购物，因此在BIO栏可以用箭头、手指等符号加以引导。（把他们当做小学生就好了）</p></li><li><p>Website：可以挂网站链接、邮箱、社媒账号等。新开通的账户需要1000粉丝才可以挂链接。</p></li><li><p>Noneprofit：推广公益事业，加上后会给人好感。</p></li><li><p>Category：账号类目。绑定社媒账号：如Ins、YouTube。</p></li></ul><p><img src="http://5coder.cn/img/1663251057_4a97ec6bd1946f15e2bbcf0363f72073.png" alt="640 (16)"></p><h4 id="（3）个人后台设置"><a href="#（3）个人后台设置" class="headerlink" title="（3）个人后台设置"></a><strong>（3）个人后台设置</strong></h4><p>点击个人主页右上角三点进入个人后台，补充完整账号信息（养成好习惯，刚起号就把这些操作走一遍。）</p><p><img src="http://5coder.cn/img/1663251074_0fa839ceec81156c82ed41303f3e8494.png" alt="640 (17)"></p><p>后台功能很多，着重介绍几个功能。</p><h5 id="①-切换为商家账号"><a href="#①-切换为商家账号" class="headerlink" title="①.切换为商家账号"></a>①.切换为商家账号</h5><p>账号类别有Personal account个人号和Business account商家号，之前还有创作者号，现在取消了，个人号和商家号都可以撸基金。</p><p>新注册的账号系统默认是个人号，需要后台切换为商家账号。</p><p>开通商家号后，可以分析账号的播放量、粉丝来源分布、粉丝性别等，最重要的是可以直接挂链接。</p><p>当然，商业账户和个人账户可随时切换。</p><p><img src="http://5coder.cn/img/1663251091_0911ce3df8d9c2e15153a5e37e797a8e.png" alt="640 (18)"></p><h5 id="②-数据分析功能"><a href="#②-数据分析功能" class="headerlink" title="②.数据分析功能"></a>②.数据分析功能</h5><p>进入创作者账号数据分析界面，可以使用账号数据分析功能。</p><p>在overview界面，包含账号的粉丝数、总浏览量、点赞量、评论量等数据。</p><p><img src="http://5coder.cn/img/1663251156_360063d83380b25df67b22f4ccea9edf.png" alt="640 (19)"></p><p><img src="http://5coder.cn/img/1663251156_63f5c614399dffcab65e812955b7dec3.png" alt="640 (20)"></p><p><img src="http://5coder.cn/img/1663251156_f21e2320163fd21c1703e948836d2f1c.png" alt="640 (21)"></p><p>进入overview的engagement界面，可以查看具体的数据柱状图。</p><p><img src="http://5coder.cn/img/1663251185_e02cd45c52aebac27cc8766710e3bfe0.png" alt="640 (22)"></p><p><img src="http://5coder.cn/img/1663251185_41b4eb11648fd4d90d9bd0cb76c1087f.png" alt="640 (23)"></p><p>在content界面，可以查看你账号的视频总数、每天粉丝增长情况、粉丝性别比和来源地区，也可以查看粉丝的活跃时间段、账户直播情况。</p><p>通过这些数据可以直接判定账号是否可以带货。</p><p>比如粉丝前五的地区图中，你的目标国家至少要超过50%，数据越集中说明你的账号越垂直、客户越集中。</p><p>你想卖货给美国，但如果你的主要粉丝跑非洲去，那还卖个鬼，赶紧弃号。</p><p>同时，我们可以根据粉丝的活跃时间段发布视频，有利于视频实现冷启动，提高播放量。</p><p><img src="http://5coder.cn/img/1663251215_c662d4ba2feb047e85c1a886378c3b01.png" alt="640 (24)"></p><p><img src="http://5coder.cn/img/1663251219_6bb49ff2c016c9cc342073970f571038.jpg" alt="640 (3)"></p><p><img src="http://5coder.cn/img/1663251250_2cf24618ae4d2284b2b61880ccc20e21.jpg" alt="640 (4)"></p><p><img src="http://5coder.cn/img/1663251267_7da3fb4c097ce5d11f9c5b1b69ef9817.png" alt="640 (26)"></p><h5 id="③-Report-a-problem"><a href="#③-Report-a-problem" class="headerlink" title="③.Report a problem"></a>③.Report a problem</h5><p>这个类似客服的功能大家不要忽略，是极其强大的。</p><p>账号的任何问题都可以在里面提问，最喜欢它的留言提问帮助解决问题功能，账号被限制、资金无法提取、更改年龄、10万粉后系统没给你开通创作者市场等问题都可以通过它完成。</p><p><img src="http://5coder.cn/img/1663251299_161c12f8dd08721debd63d78d8a1acb0.png" alt="640 (27)"></p><h2 id="七、精准养号"><a href="#七、精准养号" class="headerlink" title="七、精准养号"></a>七、<strong>精准养号</strong></h2><p><img src="http://5coder.cn/img/1663251551_a8fa9c15d971920c205523790e7cc5cd.png" alt="640 (28)"></p><h3 id="1、为什么要养号"><a href="#1、为什么要养号" class="headerlink" title="1、为什么要养号"></a><strong>1、为什么要养号</strong></h3><h4 id="（1）提高系统推荐精准度"><a href="#（1）提高系统推荐精准度" class="headerlink" title="（1）提高系统推荐精准度"></a><strong>（1）提高系统推荐精准度</strong></h4><p>系统不了解新账户人设、喜好、特点等，没有养号只能随机推送300-500左右用户，用户不精准，效果不理想。</p><h4 id="（2）提高自我画像精准度"><a href="#（2）提高自我画像精准度" class="headerlink" title="（2）提高自我画像精准度"></a><strong>（2）提高自我画像精准度</strong></h4><p>养号目的是为了给自己账号打标签，让AI认识你的账号，知道你的视频和账号属于什么内容，更加精准的分发给对此类内容感兴趣的人。</p><h4 id="（3）提高用户画像精准度"><a href="#（3）提高用户画像精准度" class="headerlink" title="（3）提高用户画像精准度"></a><strong>（3）提高用户画像精准度</strong></h4><p>给希望的用户群体打标签，构建用户画像。</p><h4 id="（4）迎合系统交互设计"><a href="#（4）迎合系统交互设计" class="headerlink" title="（4）迎合系统交互设计"></a><strong>（4）迎合系统交互设计</strong></h4><p>TikTok通过双向打标签的交互设计实现视频精准投放。</p><p>讲直白点，养号就是为了让你的视频被系统推荐给你希望看到的人。</p><h3 id="2、如何养号"><a href="#2、如何养号" class="headerlink" title="2、如何养号"></a><strong>2、如何养号</strong></h3><p>像个人！像个人！像个人！</p><p>重要的事情说三遍。</p><p>像个正常人刷视频就OK。</p><h4 id="（1）刷视频"><a href="#（1）刷视频" class="headerlink" title="（1）刷视频"></a><strong>（1）刷视频</strong></h4><p>一是刷账号标签类别的视频。</p><p>一定要有账号垂直、细分主题的观念，账号标签一定要突出。在刷foryou时观看账号标签类别视频，滑走无关视频。</p><p>不要一看到美女帅哥就多看两眼，要看可以注册个账号专门观看。</p><p>二是看完、点赞、评论、转发。看视频时完成这些步骤。</p><h4 id="（2）收藏标签"><a href="#（2）收藏标签" class="headerlink" title="（2）收藏标签"></a><strong>（2）收藏标签</strong></h4><p>两种方法。</p><p>一是关注账号同类目的标签。</p><p>比如你做的是画画账号，你就搜索Hashtags，把#draw#drawing等同类标签全部收藏。</p><p><img src="http://5coder.cn/img/1663251636_75f0dfff8c8c8172224769635be6117a.png" alt="640 (29)"></p><p>二是关注账号类目扩展标签。</p><p>进入账号类目的视频，在文案处可以看到别人使用的标签，就可以看到账号内容相光联的标签，比如#art#sketch等，点击收藏即可。</p><p><img src="http://5coder.cn/img/1663251742_d59cb5eda443722f6cb6feb0d7ac99be.png" alt="640 (30)"></p><h4 id="（3）如何判断养号成功"><a href="#（3）如何判断养号成功" class="headerlink" title="（3）如何判断养号成功"></a><strong>（3）如何判断养号成功</strong></h4><p>一是在foryou中系统是否大量推送目标视频</p><p>比如你刷foryou，5个中有没2-3个是你账号类目的视频。</p><p>有些人养号时间十几二十分钟就OK了。</p><p>二是有同类目推荐</p><p>只有少部分的账号能达到，也和大家说一说。</p><p>用小号进入你的账号，如下图展示，点击同类目账号，看下方出现的是和你的账号类目相同的账号，那就说明你养号成功了。</p><p><img src="http://5coder.cn/img/1663251805_948703dff9758413c7674243fb5f0979.png" alt="640 (31)"></p><h3 id="3、保护好账号"><a href="#3、保护好账号" class="headerlink" title="3、保护好账号"></a><strong>3、保护好账号</strong></h3><p>对于新手来说，操作流程一定要规范，保护好账号，不规范的运营会让你之前的努力付之东流。</p><h4 id="（1）登入账号和退出账号要规范"><a href="#（1）登入账号和退出账号要规范" class="headerlink" title="（1）登入账号和退出账号要规范"></a><strong>（1）登入账号和退出账号要规范</strong></h4><p>登入TikTok时，先开启WiFi，开启科学上网，检测环境安全（whoer.net），打开TikTok。</p><p>退出TikTok时，关闭TikTok，关闭WiFi。</p><p>成为老司机后基本也就不用检测环境了。</p><h4 id="（2）安卓手机登录TikTok时，要经常打开科学上网，查看是否被后台关闭"><a href="#（2）安卓手机登录TikTok时，要经常打开科学上网，查看是否被后台关闭" class="headerlink" title="（2）安卓手机登录TikTok时，要经常打开科学上网，查看是否被后台关闭"></a><strong>（2）安卓手机登录TikTok时，要经常打开科学上网，查看是否被后台关闭</strong></h4><p>安卓手机幺蛾子多，就算你已经设置了软件后台电池耗电量不再优化，但它还是会给你关闭掉。</p><p>因此如果要在安卓手机上长时间使用TikTok，要经常看科学上网情况。</p><h3 id="4、注意事项-1"><a href="#4、注意事项-1" class="headerlink" title="4、注意事项"></a><strong>4、注意事项</strong></h3><h4 id="（1）一机一号"><a href="#（1）一机一号" class="headerlink" title="（1）一机一号"></a><strong>（1）一机一号</strong></h4><p>如字面意思，一部手机上就登录一个TikTok账号。多个账号登录同一个IP，且经常切换容易造成账号不稳定。</p><p>想想，一般的用户谁用多个抖音账号，能用多个抖音账号的主，都是要通过抖音搞钱的。</p><p>这些账号很容易被判定为营销号，或因为一个IP多账号登录而被TikTok限流、封禁等。</p><h4 id="（2）个人信息不要随便更改"><a href="#（2）个人信息不要随便更改" class="headerlink" title="（2）个人信息不要随便更改"></a><strong>（2）个人信息不要随便更改</strong></h4><p>个人信息是账号标签的重要组成元素，起号时就想好这个账号要做什么，人设是什么，你的个人信息根据既定方向填写就完事；</p><p>不要经常性修改，让系统一脸懵逼“这家伙要干嘛”，你的账号标签变得不那么明显，流量表现也会变差。</p><h4 id="（3）账号不要在电脑端登录"><a href="#（3）账号不要在电脑端登录" class="headerlink" title="（3）账号不要在电脑端登录"></a><strong>（3）账号不要在电脑端登录</strong></h4><p>我们对手机进行刷机、更改语言、时区、节点设置，就是为了建造一个良好的上网环境，让TikTok认为你是正常的海外用户。</p><p>但是电脑端的科学上网环境就不那么干净，因此就不要在电脑端登录了。</p><h4 id="（4）TikTok读取手机联系人权限，可以再手机里输入外国联系人电话。"><a href="#（4）TikTok读取手机联系人权限，可以再手机里输入外国联系人电话。" class="headerlink" title="（4）TikTok读取手机联系人权限，可以再手机里输入外国联系人电话。"></a><strong>（4）TikTok读取手机联系人权限，可以再手机里输入外国联系人电话。</strong></h4><p><img src="http://5coder.cn/img/1663251881_830e92e9155dd38ec68caec78115b7bd.png" alt="640 (32)"></p><p>既然TikTok会读取手机联系人，那我们就迎合他的做法，在手机里导入一些外国人手机号。外国人的手机号网络上可以查找。</p><p>当然，你可以不同意。</p><h4 id="（5）科学上网保持稳定"><a href="#（5）科学上网保持稳定" class="headerlink" title="（5）科学上网保持稳定"></a><strong>（5）科学上网保持稳定</strong></h4><p>和不要随意更改账号信息一样，你的网络节点也不要随意更改。</p><p>比如，你是个正常的用户，节点在哪就说明你人在哪。</p><p>正常人是不会现在在洛杉矶，一会儿就跑波特兰或者亚特兰大，这不符合常理。</p><p>况且我们使用的节点还会出现不稳定、跳转等情况。</p><p>如果你要换节点，可以先把手机关机几个小时（当做你坐飞机从洛杉矶飞亚特兰大需要几个小时），再开机更换节点。</p><h2 id="八、发布视频"><a href="#八、发布视频" class="headerlink" title="八、发布视频"></a>八、发布视频</h2><p>养号完成后我们就可以大胆的发布视频了。</p><p><img src="http://5coder.cn/img/1663251920_be898bfdc818bc081bf7b348a5f8f457.png" alt="640 (33)"></p><h3 id="1、寻找素材"><a href="#1、寻找素材" class="headerlink" title="1、寻找素材"></a><strong>1、寻找素材</strong></h3><p>顾名思义，就是寻找你要上传的短视频素材。</p><p>除了品牌商有专业推广团队拍摄视频和部分团队自己拍摄短视频外，目前绝大部分玩家都是通过BY来获得素材。</p><h3 id="2、素材来源"><a href="#2、素材来源" class="headerlink" title="2、素材来源"></a><strong>2、素材来源</strong></h3><p>国内：抖音、快手/B站、小红书、微博/火山、淘宝、微视</p><p>国外：youtube、instagram、速卖通、facebook</p><p>这些视频平台的视频素材都可以使用，当然，有些是长视频需要进一步剪辑。</p><p>平台上视频内容较多，该如何判断素材优劣，我BY后能爆。</p><ul><li>培养网感</li></ul><p>还是要经常刷视频，让自己熟悉TikTok用户的格调、喜好，培养自己对爆款视频的敏感度。</p><ul><li>画面清晰</li></ul><p>是的，只要画面清晰就够了，不要求像素有多高清。</p><ul><li>顺应口味</li></ul><p>熟悉目的区域的风土人情，了解他们的口味是什么。</p><p>目前TikTok上视频的主要特点是新奇特、色彩鲜艳为主。</p><p><img src="http://5coder.cn/img/1663251987_4a215f8eb1297635a8991f6e064f7331.png" alt="640 (34)"></p><h3 id="3、视频下载"><a href="#3、视频下载" class="headerlink" title="3、视频下载"></a><strong>3、视频下载</strong></h3><p>市面上的下载方式还是挺多的，下载工具、网站、流程在下文的常用工具模块，这里不再赘述。</p><h3 id="4、视频剪辑"><a href="#4、视频剪辑" class="headerlink" title="4、视频剪辑"></a><strong>4、视频剪辑</strong></h3><p>找到素材后就得对视频进行剪辑，去重后再上传。</p><h4 id="（1）为何要剪辑"><a href="#（1）为何要剪辑" class="headerlink" title="（1）为何要剪辑"></a><strong>（1）为何要剪辑</strong></h4><p>主要是要遵循TikTok的社区规定。</p><p>每一个视频都有一个唯一的MD5值，相当于视频基因、身份证。</p><p>剪辑的目的就是为了修改这个值，进行消重处理，不让系统检测到是by，实现正常推荐。</p><p>剪辑的主要软件有剪映和PR、哼哼猫批量处理软件。</p><p>常用的剪辑方式有去水印、放大、缩小、加滤镜、加特效、加转场、调色、抽帧、镜像、添加画中画、添加其他视频、调整视频顺序等手法。</p><h4 id="（2）视频样式建议"><a href="#（2）视频样式建议" class="headerlink" title="（2）视频样式建议"></a><strong>（2）视频样式建议</strong></h4><p>建议采用竖屏、9:16尺寸，相同视频，竖屏会比横屏表现更优秀。</p><p>视频时长尽量控制在15秒内，8-12秒最佳，时长过短会让系统判定你是劣质视频。</p><h3 id="5、发布视频"><a href="#5、发布视频" class="headerlink" title="5、发布视频"></a><strong>5、发布视频</strong></h3><h4 id="（1）发布视频流程"><a href="#（1）发布视频流程" class="headerlink" title="（1）发布视频流程"></a><strong>（1）发布视频流程</strong></h4><h5 id="①进入账号首页，选择“-”，即发布视频。"><a href="#①进入账号首页，选择“-”，即发布视频。" class="headerlink" title="①进入账号首页，选择“+”，即发布视频。"></a><strong>①进入账号首页，选择“+”，即发布视频。</strong></h5><p>有实时录制、上传本机视频、图片合成为视频、直播功能。</p><p>视频时长有15秒、60秒、3分钟三种，按需选择。</p><p>建议新手上传视频时长控制在15秒内，视频的完播率非常重要。</p><p>如果你的视频长度太长，内容又不优质，用户观看视频中就会跳出造成完播率低。</p><p><img src="http://5coder.cn/img/1663252106_2cdd377b916c9f55ab59962827d4a386.png" alt="640 (35)"></p><p><img src="http://5coder.cn/img/1663252106_a7f9d0bcf1f82f56a66da9ed6b75facd.png" alt="640 (36)"></p><p><img src="http://5coder.cn/img/1663252106_6363502b6b5050bdb4b924cb40156518.png" alt="640 (37)"></p><p>该界面有对视频的添加音乐、特效、文字、贴纸功能。</p><p><img src="http://5coder.cn/img/1663252119_d39cd3f1e4c56dd7f5ad1c5066b023f8.png" alt="640 (38)"></p><h5 id="②选择音乐"><a href="#②选择音乐" class="headerlink" title="②选择音乐"></a><strong>②选择音乐</strong></h5><ul><li><p>使用剪辑好的视频自带的音乐。</p><p>需要注意个问题，有些音乐国内能用，但在国外就有版权保护不能使用，很可能会侵权，建议大家选择TikTok音乐库里的音乐。</p></li><li><p>使用TikTok账号收藏的音乐。</p></li><li><p>使用TikTok里推荐的或者自己去音乐库里搜索的音乐。</p></li></ul><p> 注意：一个视频能不能打爆，你选的BGM音乐非常重要 </p><p>建议大家在刷视频的时候，如果刷到好的BGM，你喜欢的或当下比较火的你就收藏。</p><p>以后你可以在后台发送同类型的视频就可以调用这些音乐。</p><p>背景音乐是一大亮点，如果热门背景音乐跟你的内容高度匹配，那这个视频被爆的概率就很高。</p><p>音乐不是说要选好听的，而是要配合内容，尽量要卡点，节拍跟着内容走。</p><p>如果你的视频节奏很快，尽量选择劲爆的音乐，若比较抒情，可选择舒缓的音乐。</p><p>卡点很关键，选音乐还是需要花功夫的。</p><p>一般我会选择节奏感强的劲爆音乐，可能是因为TikTok平台目前大多数用户是小年轻，比较喜欢这类音乐。</p><p><img src="http://5coder.cn/img/1663252153_061aaeb3a1cfbee54c47da359de12de3.png" alt="640 (39)"></p><p><img src="http://5coder.cn/img/1663252153_d96e84ff5b200593db45924a5155246e.png" alt="640 (40)"></p><p>在右下角的Volume界面，可以对视频声音进行调解，Original sound为视频的原声，Added sound为添加的音乐音量。</p><p><img src="http://5coder.cn/img/1663252165_6a953f196691ad60d416f61be0c13128.png" alt="640 (41)"></p><h5 id="③文案、标签、封面"><a href="#③文案、标签、封面" class="headerlink" title="③文案、标签、封面"></a><strong>③文案、标签、封面</strong></h5><p><img src="http://5coder.cn/img/1663252178_2a294ea29b6af4626012ea8a294a6af3.png" alt="640 (42)"></p><p>文案描述要提炼亮点，或者吐槽点，引发用户点赞评论分享，增加互动性。</p><p>也可以在视频发布后，评论区里自己先发一条去引导评论。</p><p><strong>标签Hashtag</strong>，泛标签搭配精准词标签（一般我会用5-8个）。</p><p>如果用户根据Hashtag主动搜索的，就会增加你的曝光。（有Hashtag的流量）</p><p><strong>封面Cover</strong>很重要的，当粉丝关注你之后，有部分的粉丝很可能会进入你的主页。</p><p>这时候如果你的这个视频播放量很高，封面也很吸引人，就会大大增加点击率。</p><p>所以，在选择封面时，要挑选一眼就抓眼球的画面，哇就是它了要这种感觉。</p><p>如果连你自己看了都吸引不了，怎么可能会吸引粉丝呢？</p><p><strong>Allow comments</strong> 打开，允许用户评论。</p><p><strong>Allow Duet and React</strong> 打开，允许用户和你的视频进行合拍。</p><p>也就是说，你跟一个很火的视频，去合拍，大家通过这个热门视频看到你，这也是免费增加曝光的方法。</p><p>最下一行左边是存草稿，点击发布Post。</p><h4 id="（2）Duet合拍"><a href="#（2）Duet合拍" class="headerlink" title="（2）Duet合拍"></a><strong>（2）Duet合拍</strong></h4><p>着重介绍下Duet。</p><p>Duet就是合拍，首先进入别人的视频界面，点击转发按钮，会出现duet按钮。</p><p>当然，前提是视频作者在上传视频时同意别人进行合拍，之后就进入拍摄界面。</p><p>点击中间的红色圆点就开始了摄像头录制，录制完成后，其他操作和上传视频的步骤类似。</p><p><img src="http://5coder.cn/img/1663252220_eca6fd5be009de22989599d95c9d4d42.png" alt="640 (43)"></p><p>一是可以蹭爆款视频的流量。</p><p>一般情况下，合拍别人的爆款视频，你的视频播放量都会有提升。</p><p>二是检测手机上网环境是否安全。</p><p>当你的上传视频出现0播放时，你可以找个爆款视频进行合拍，如果播放量还是0，就说明手机的上网环境不安全。</p><p>用绿幕上传视频也是检测环境的好方法。</p><h4 id="（3）功能介绍"><a href="#（3）功能介绍" class="headerlink" title="（3）功能介绍"></a><strong>（3）功能介绍</strong></h4><p>点击自己视频右下角的三给点，可以看到账号的众多功能。</p><p><img src="http://5coder.cn/img/1663252247_e690a0e9791f8b1bbd68dc6679e44eaa.png" alt="640 (44)"></p><p><img src="http://5coder.cn/img/1663252247_740dae7887528ccff64e2d550026219f.png" alt="640 (45)"></p><p><img src="http://5coder.cn/img/1663252247_c0f106a67b465adbd207a02e02cd5ccd.png" alt="640 (46)"></p><ul><li>Analytics：该视频数据表现情况。</li><li>Save video：下载该视频，带水印。</li><li>Promote：即抖加功能，可以花钱对该视频进行推广。</li><li>Use the effect：如果该视频使用了一些特效功能，点击该按钮可以直接使用该特效上传视频。</li><li>Duet：和该视频进行合拍。</li><li>Add to favorite：添加收藏。</li><li>Privacy settings：权限设置。</li><li>Live photo：保存为图片。</li><li>Share as GIF：gif格式分享。</li><li>Delete：删除该视频。</li><li>点击analytics（也可以直接点击视频右下角的More Date），查看视频相关数据。</li></ul><p><img src="http://5coder.cn/img/1663252311_b7f40bf96c74b6990e1686dc0a1d70e0.png" alt="640 (47)"></p><p><img src="http://5coder.cn/img/1663252311_03237fa52f161e7a17cdf5e8aaddfaf9.png" alt="640 (48)"></p><p><img src="http://5coder.cn/img/1663252311_0a835ec67916fbc01498c929334de868.png" alt="640 (49)"></p><p>我们点击Privacy settings，可以对视频的权限进行管理，如果自己发布的视频表现不好，或者不想让别人看到，可以进入该功能对视频进行隐藏。</p><p><img src="http://5coder.cn/img/1663252337_d7131776e393a31b97423b5078c1b3e2.jpg" alt="640 (5)"></p><p><img src="http://5coder.cn/img/1663252342_ca483a328cb898b5fa7f92749a09ab70.jpg" alt="640 (6)"></p><p><img src="http://5coder.cn/img/1663252346_9f81ac29d22d24e25337514c91884082.jpg" alt="640 (7)"></p><h4 id="（4）注意事项"><a href="#（4）注意事项" class="headerlink" title="（4）注意事项"></a><strong>（4）注意事项</strong></h4><h5 id="①前几个视频极其重要"><a href="#①前几个视频极其重要" class="headerlink" title="①前几个视频极其重要"></a><strong>①前几个视频极其重要</strong></h5><p>特别是如果你的前几个视频中出现被下架等特殊情况，基本就可以扔掉了。</p><h5 id="②发布时间"><a href="#②发布时间" class="headerlink" title="②发布时间"></a><strong>②发布时间</strong></h5><p>根据目标地区的高峰区间发布视频。</p><p>比如做美国地区的，我们就可以根据他们上下班、晚上时间段发布视频。</p><p>也可分析账号数据，查看粉丝高峰活动时段。</p><p>最好提前半个小时发布，因为视频发布后得经过系统审核是否违规、实现冷启动等步骤，抵达高峰期时段是要些时间。</p><p><img src="http://5coder.cn/img/1663252373_b727e15622ebdc3193c6af7dcd60adf8.png" alt="640 (50)"></p><h5 id="③发布间隔"><a href="#③发布间隔" class="headerlink" title="③发布间隔"></a><strong>③发布间隔</strong></h5><p>作为正常用户而言，特别不是实时录制视频发布的，剪辑个视频需要15分钟左右，很难短时间内大量发布视频，太频繁发布视频看起来就不太正常，会影响账号权重。</p><p>最好在上一个视频有几百左右播放、实现冷启动后后再发布下一个视频，不会造成堵车。</p><h5 id="④发布数量"><a href="#④发布数量" class="headerlink" title="④发布数量"></a><strong>④发布数量</strong></h5><p>每个号每天可以发布约250个左右的视频。</p><p>TikTok官方更希望的是有更多的用户参与到视频创作中来，而不是把流量向一个账户内的所有视频倾斜。</p><h5 id="⑤使用热门音乐"><a href="#⑤使用热门音乐" class="headerlink" title="⑤使用热门音乐"></a><strong>⑤使用热门音乐</strong></h5><p>流行音乐自带流量，特别是最近特别火的音乐，观众观看你的视频的时间会更久，你的账号权重会更高。</p><p>上文也说过，尽量使用TikTok自带的音乐。与国内不同，国外对音乐版权保护非常严格，很多在国内能使用的音乐在国外都是被禁止使用或禁止用于商业用途。</p><h5 id="⑥使用热门标签"><a href="#⑥使用热门标签" class="headerlink" title="⑥使用热门标签"></a><strong>⑥使用热门标签</strong></h5><p>热门标签也自带流量，我们使用流行音乐和热门标签的目的就是为了蹭音乐和标签的流量。</p><p>在发布视频添加标签时会显示较火的热门标签和挑战标签等。</p><p>也可以在搜索栏搜索热门标签上升趋势榜。</p><p><img src="http://5coder.cn/img/1663252412_cf4b023d3d89f84f08f644ee825eec36.png" alt="640 (51)"></p><h5 id="⑦引导观众"><a href="#⑦引导观众" class="headerlink" title="⑦引导观众"></a><strong>⑦引导观众</strong></h5><p>完播、点赞、评论、转发、观看时长都关系到视频和账号的权重。</p><p>我们可以使用文案、贴纸、特效、表情包等引导观众看完视频并点赞、评论、转发。</p><p>这些在我们看来很初级的玩法在TikTok上还是很香。</p><p><img src="http://5coder.cn/img/1663252427_d2fa187eb30931eba1f79eabcd0e2b02.jpg" alt="640 (8)"></p><h5 id="⑧文案书写"><a href="#⑧文案书写" class="headerlink" title="⑧文案书写"></a><strong>⑧文案书写</strong></h5><p>表达要口语化，要符合当地书写习惯，最好能引起评论、共鸣、争议等。</p><p>Lol = laughing out loud / lots of laughs 大笑</p><p>WTF = what the f u c k 等同于“吊”</p><p>WTH = what the hell 比较文雅的 WTF ，常作为疑问“怎么会这样？”</p><p>Omg = oh my God 相当于“天呀！”</p><h5 id="⑨及时回复评论"><a href="#⑨及时回复评论" class="headerlink" title="⑨及时回复评论"></a><strong>⑨及时回复评论</strong></h5><p>一个账号一天可以回复150个评论，新起的好最好能用完这些指标。</p><p>用户会对你的评论进行回复，对炒热视频有很大帮助，</p><h5 id="⑩链接设置"><a href="#⑩链接设置" class="headerlink" title="⑩链接设置"></a><strong>⑩链接设置</strong></h5><p>独立站、电商平台的链接目前只能放Bio、文案、视频上。</p><p>评论区不能放链接，会被删除或被封。</p><p>用户若有询问商品可引导至首页点击链接购买。</p><h5 id="⑪爆款视频重发"><a href="#⑪爆款视频重发" class="headerlink" title="⑪爆款视频重发"></a><strong>⑪爆款视频重发</strong></h5><p>出现爆款视频后，第一件事就是再发布视频，蹭爆款视频的流量。</p><p>爆款视频冷却后可以再次发布，表现依然会抢眼，甚至比原先的还要好。</p><h5 id="⑫遵循TikTok的社群自律公约"><a href="#⑫遵循TikTok的社群自律公约" class="headerlink" title="⑫遵循TikTok的社群自律公约"></a><strong>⑫遵循TikTok的社群自律公约</strong></h5><p>别人的地盘别人说了算，得按照他们的规矩办事。</p><h2 id="九、账号权重"><a href="#九、账号权重" class="headerlink" title="九、账号权重"></a>九、账号权重</h2><p>了解账号权重后才能知道哪里坑，哪些方法可以引流，更好的运营TikTok账号。</p><p><img src="http://5coder.cn/img/1663252547_674cef5121937b32d95e252d3c3d2044.png" alt="640 (52)"></p><h3 id="1、影响账号权重的关键指标"><a href="#1、影响账号权重的关键指标" class="headerlink" title="1、影响账号权重的关键指标"></a><strong>1、影响账号权重的关键指标</strong></h3><p>根据算法概述，我们可以得出初步结论，影响账号权重的5个关键指标。</p><h4 id="（1）完播率"><a href="#（1）完播率" class="headerlink" title="（1）完播率"></a><strong>（1）完播率</strong></h4><p>开头前三秒最关键，用户可能只需要3秒来判断是否要看下去，如果开头太拖沓，大部分用户会离开。</p><p>开头不要拖泥带水，快速切入。</p><p>可用文案、贴纸等手段引导用户完成点赞、评论、转发或看完视频的动作。</p><p>比如在视频描述和视频开头、结尾写到“Surprise at the end”等来提升完播率。</p><p>视频时不要过长，除非视频内容质量极高，8-15比较适合。</p><h4 id="（2）评论率"><a href="#（2）评论率" class="headerlink" title="（2）评论率"></a><strong>（2）评论率</strong></h4><p>在视频中设置互动问题或者埋下槽点，引导用户留下评论，提升评论量。</p><p>及时回复用户，提炼出视频的核心观点，引导更多用户参与讨论，进一步提升评论量。</p><p>和国人一样，外国人也很喜欢神评论，准备好神评论，视频发出后，用小号在评论区评论，引导用户围观、讨论。</p><h4 id="（3）关注比"><a href="#（3）关注比" class="headerlink" title="（3）关注比"></a><strong>（3）关注比</strong></h4><p>粉丝增长量和播放量之间的关系，一个爆款视频能带来几十万粉丝，粉丝增长越快，关注比越高。</p><p>可采取一个故事分两个是视频上传，埋下钩子，引导用户关注。</p><h4 id="（4）点赞率和转发率"><a href="#（4）点赞率和转发率" class="headerlink" title="（4）点赞率和转发率"></a><strong>（4）点赞率和转发率</strong></h4><p>初级别的手法可采用贴纸等技巧引导。</p><p>对于带货号就需要物品的使用功能有效集中用户痛点、槽点、关注点，转化为自然的点赞和转发。</p><h3 id="2、账号权重类别和改进方法"><a href="#2、账号权重类别和改进方法" class="headerlink" title="2、账号权重类别和改进方法"></a><strong>2、账号权重类别和改进方法</strong></h3><h4 id="（1）垃圾号"><a href="#（1）垃圾号" class="headerlink" title="（1）垃圾号"></a><strong>（1）垃圾号</strong></h4><p>连发视频一周或发视频20个左右均为100左右播放。</p><p>所有的账号前期表现非常重要，这种账号就算后期再用心运营也大概率表现不如意。</p><p>改进方法：换内容或重新起号。换内容的做法，比如你做好物号的账号，之前上传的是厨房类的用品，可以再上传浴室、户外、办公等类别的好物视频。</p><p>多测试视频内容，只要不跳出账号垂直领域。</p><h4 id="（2）低权重号"><a href="#（2）低权重号" class="headerlink" title="（2）低权重号"></a><strong>（2）低权重号</strong></h4><p>连发视频一周或发视频20个左右均为1000左右的播放量。</p><p>能进入1000左右播放量的账号说明网络环境、基础设置都是很OK的，就差一个爆款视频突破临界点。</p><p>改进方法：内容分方向测试20个左右视频。</p><h4 id="（3）待爆号"><a href="#（3）待爆号" class="headerlink" title="（3）待爆号"></a><strong>（3）待爆号</strong></h4><p>播放超过1千，普遍在3000-5000。说明账号的内容问题不大，受用户欢迎。</p><p>改进方法：不断提高视频质量，采用蹭热点、引导点赞、评论、转发等技巧。</p><h4 id="（4）高权重号"><a href="#（4）高权重号" class="headerlink" title="（4）高权重号"></a><strong>（4）高权重号</strong></h4><p>每个视频播放量基本过万，做到这一步就进入高手运营级别了。</p><p>用好标签，是提升TikTok视频曝光度的重要手段。 </p><h2 id="十、标签使用"><a href="#十、标签使用" class="headerlink" title="十、标签使用"></a>十、<strong>标签使用</strong></h2><p>我们都知道标签很重要，但是，你用对了标签吗？</p><p>这篇文章就来聊聊TikTok标签的使用方法，全网最全，没有之一。</p><ul><li>为什么要使用标签</li><li>标签的种类</li><li>如何正确使用标签</li></ul><p><img src="http://5coder.cn/img/1663252697_e6ce4f8c0c096add980fc0e8f77d29f6.png" alt="640"></p><h3 id="1、为什么要使用标签？"><a href="#1、为什么要使用标签？" class="headerlink" title="1、为什么要使用标签？"></a><strong>1、为什么要使用标签？</strong></h3><p>世上没有无缘无故的爱。</p><p>在发视频最后总会苦恼到底要用怎么样的标签，选择好后心里又没底怀疑自己到底用对了没有。</p><p>总之，就是有让我们不够自信、不满意的感觉。</p><h4 id="（1）给自己账号、视频打标签，得到精准的推荐"><a href="#（1）给自己账号、视频打标签，得到精准的推荐" class="headerlink" title="（1）给自己账号、视频打标签，得到精准的推荐"></a><strong>（1）给自己账号、视频打标签，得到精准的推荐</strong></h4><p>添加标签主要原因是为了迎合TikTok算法机制，让视频得到更多的曝光流量。</p><p>TikTok是交互式算法，用户有他的喜好、憎恶、地域、性别等标签，你的账号也有类目、地域、音乐、内容标签，账号越垂直TikTok推送的用户越精准。</p><p>因此我们要对账号、视频打标签，算法会帮我们找到目标群体，同时由于内容符合目标群体的喜好，所以更容易获得更多观看、粉丝和转化。</p><p>简单点，就是大家都有相同喜好，那就在一起吧。</p><p><img src="http://5coder.cn/img/1663252728_d7e30bdcfad7e711503647467d767f25.png" alt="640 (1)"></p><h4 id="（2）给用户打标签，挖掘潜在粉丝人群"><a href="#（2）给用户打标签，挖掘潜在粉丝人群" class="headerlink" title="（2）给用户打标签，挖掘潜在粉丝人群"></a><strong>（2）给用户打标签，挖掘潜在粉丝人群</strong></h4><p>用户如果对某个主题或者话题感兴趣，他就会搜索该标签，如果你的视频使用了该标签，你的视频就有可能被他点击观看。</p><p>如果您使用热门话题标签，你的内容还可以被拉入相关的 Discovery 页面，就可以蹭蹭热度。</p><p>比如，你的TikTok视频添加了eyeliner tutorial。你的视频也将归入eyeliner tutorial主题标签下。</p><p><img src="http://5coder.cn/img/1663252758_30ebfd6ef9026d6ebb12bf8a434f8c50.png" alt="640 (2)"></p><p><img src="http://5coder.cn/img/1663252765_8f6b59b6c31b948924d789b529b5d050.png" alt="640 (3)"></p><p>同样，如果使用热度很高的趋势标签，你的视频也会享受到趋势标签的流量红利。</p><p><img src="http://5coder.cn/img/1663252777_43c048f6947d5a202e0a0de5ef8bb13b.png" alt="640 (4)"></p><h4 id="（3）进入标签流量池"><a href="#（3）进入标签流量池" class="headerlink" title="（3）进入标签流量池"></a><strong>（3）进入标签流量池</strong></h4><p>如果你在TikTok上使用“eyeliner tutorial”标签，你的视频将纳入该标签下。</p><p>如果在 TikTok上搜索“eyeliner tutorial”时，想学习如何画眼线，你的视频就会出现在他的搜索页面，就会增加曝光率。</p><h4 id="（4）创建自己的流量池"><a href="#（4）创建自己的流量池" class="headerlink" title="（4）创建自己的流量池"></a><strong>（4）创建自己的流量池</strong></h4><p>刚看到这个标题是不是会诧异，流量池推荐机制是TikTok的，我们也可以创建流量池？</p><p>大家不要认为品牌标签有多么高大上，从底层思维来理解，他们的标签也只是为了提高品牌知名度而创造出来的，也就只是个标签。</p><p>比如国内品牌花西子通过TikTok出海，他们使用的品牌标签是#florasis，也是在品牌出海后创建的。</p><p>视频有#florasis的标签都归入他的主题标签，无形中形成了花西子专属的品牌曝光流量池</p><p><img src="http://5coder.cn/img/1663252818_a27085058fbab8881121448a369d7e40.png" alt="640 (5)"></p><p><img src="http://5coder.cn/img/1663252818_727a8ae18b71e28cf4488572206aab9a.png" alt="640 (6)"></p><p>国内玩家有个骚操作的玩法，简单说下。</p><p>这是他店铺，luxe-pods.com</p><p>他通过shopify卖货，产品就3款耳机，然后自己发明了个产品名称Luxe Pods。</p><p><img src="http://5coder.cn/img/1663252842_6be7e34b3226d3903dd4a426ece21a59.png" alt="640 (7)"></p><p>嗯，网站搞得挺高大上，还是自建名牌。</p><p>给人的第一感官就是，不错不错，是要找的人。</p><p><img src="http://5coder.cn/img/1663252860_bec7731dd430de6627d0dd9ddd55d612.png" alt="640 (8)"></p><p>他的产品都是国货，淘宝一大把。</p><p>通过自己建立品牌，在TikTok上建立品牌标签#luxepods，然后搞网红营销，经过流量监测和预估，79天赚了2万多美金。</p><p><img src="http://5coder.cn/img/1663252894_ba1f193c46740a1634cc9058d080750a.png" alt="640 (9)"></p><p><img src="http://5coder.cn/img/1663252899_88358e6010a8d4e1618a7a0fbafce8b2.png" alt="640 (10)"></p><p>虽然有网红的助力，但自创标签的玩法还是值得跨境卖家学习。</p><h3 id="2、标签的种类"><a href="#2、标签的种类" class="headerlink" title="2、标签的种类"></a><strong>2、标签的种类</strong></h3><p>知己知彼，百战不殆。</p><p>要想更好的使用标签就得先了解标签的种类。</p><p>主要有13大类。</p><p><strong>产品标签</strong></p><p>如#cloth，#shose等。</p><p><strong>位置标签。</strong></p><p>想要让视频更精准的投放到目的区域带货的朋友，就要加上位置标签。</p><p><strong>节日标签</strong></p><p>如#Valentine’s Day，#April Fools ‘ Day等。</p><p><strong>行业标签</strong></p><p>#Agriculture，#finance等。</p><p><strong>每日主题标签</strong></p><p>如#sunday，#Monday。</p><p><strong>形容词标签</strong></p><p>#cute， #funny。</p><p><strong>首字母缩略词标签</strong></p><p>#gf</p><p><strong>表情符号标签</strong></p><p>＃???，#!!!，#cuteness</p><p><strong>品牌标签</strong></p><p>#NIKE，#NBA</p><p><strong>话题标签/挑战赛标签</strong></p><p>把二者归为一类，本质上是属于话题性质。</p><p>#Icebucketchallenge，#fliptheswitch。</p><p><strong>通用标签</strong></p><p>如#fyp，#foryoupage，#viral，#TikTok，这些标签具有普适性，所有的视频都可以应用，最大的作用是让视频抵达更多的用户。</p><p><strong>趋势标签</strong></p><p>Trending hashtag，当下最流行、火热或上升趋势最快的标签，当你不知道怎么蹭流量时，参考趋势标签就OK，准没错。趋势标签在discover里可以查看。</p><p><strong>小众标签</strong></p><p>#nailprices，#mite，#caesarean birth，这类标签较少人使用，领域较窄，针对性较强，专业性更强，但也正是因为这些原因，这些标签的受众精准度更高。</p><h3 id="3、如何使用标签？"><a href="#3、如何使用标签？" class="headerlink" title="3、如何使用标签？"></a><strong>3、如何使用标签？</strong></h3><p>主要有5个方面</p><ul><li>对标优秀玩家</li><li>流量视频的标签使用策略</li><li>带货视频的标签使用策略</li><li>标签数量的选择</li><li>遵守社区规则</li></ul><h4 id="（1）对标优秀玩家"><a href="#（1）对标优秀玩家" class="headerlink" title="（1）对标优秀玩家"></a><strong>（1）对标优秀玩家</strong></h4><p>当你的账号还不够优秀时，最好的策略就是学习，对标学习。</p><p>看优秀玩家是如何使用标签，从数量、范围频率等对照研究。</p><p>但不建议学习头部玩家特别是蓝V玩家，要学习粉丝几十万的玩家账号。</p><p>为什么？</p><p>因为头部玩家的自然流量太优秀，有些带蓝V的账号是官方邀请入驻，都有平台流量扶持，参考没有任何意义。</p><p>这些流量账号就算标签使用一两个，有粉丝数和平台流量支撑，直接促使视频完成冷启动，进入更高层级流量池。</p><p><img src="http://5coder.cn/img/1663252990_e1e71d43492805c4dc002f3b5fcca5a9.png" alt="640 (11)"></p><p><img src="http://5coder.cn/img/1663252994_6c050404caaf9063486c72eb363de7e8.png" alt="640 (12)"></p><h4 id="（2）流量视频的标签使用策略"><a href="#（2）流量视频的标签使用策略" class="headerlink" title="（2）流量视频的标签使用策略"></a><strong>（2）流量视频的标签使用策略</strong></h4><p>运营TikTok久了都会感觉到所使用的标签就那么几个了，这种做法是不可取的，因为你把自己圈死在固有的标签里了，你没有去发掘其他标签的潜在粉丝。</p><p>对于大部分TikTok玩家而言，TikTok视频基本分为流量视频和带货视频，流量视频追求曝光，赚创作者基金或者涨粉做TCM。</p><p>带货视频在追求曝光度的同时，更加追求精准流量，就是售卖市场、区域的流量。</p><p>不知道怎么设置标签咱们就套用标签使用公式。</p><p>账号类目标签+外延标签+热门标签=流量视频标签</p><p><img src="http://5coder.cn/img/1663253011_8225e937cbd3ca86a0adf69067ee422a.png" alt="640 (13)"></p><p>比如这个视频，该账号主题是画画，文案是Draw with child，这就很贴合TikTok年轻化的市场。</p><p>标签用了#draw、#emoji、#child三个主题标签，和账号类目一致，不要随意更换。</p><p>#family #satisfy属于外延标签，视频讲述的是#family成员画画，让人#satisfy。</p><p>最后用了#funny和#music热门标签，都是在挖掘潜在的粉丝。</p><p>套用了公式，妈妈就再也不用担心我的视频了！！！</p><p><img src="http://5coder.cn/img/1663253027_e3efbac4240dcb21b6133604365e577a.png" alt="640 (14)"></p><h4 id="（3）带货视频的标签使用策略"><a href="#（3）带货视频的标签使用策略" class="headerlink" title="（3）带货视频的标签使用策略"></a><strong>（3）带货视频的标签使用策略</strong></h4><p>TikTok为全球流量，电商带货有无限的潜力。</p><p>因此，讲解带货视频的标签使用策略还是很有必要。</p><p>账号类目标签+带货目标区域标签+描述性标签+拓展性标签=带货视频标签</p><p>账号类目参看上面内容，就不用再说了。</p><h5 id="①目标区域标签"><a href="#①目标区域标签" class="headerlink" title="①目标区域标签"></a><strong>①目标区域标签</strong></h5><p>TikTok是全球流量，流量能不能精准到带货区域非常关键。</p><p>比如你想在美国售货，在TK上推广产品，节点选的都是美区，但一不小心你的大部分流量就跑非洲去了。</p><p>因此选择地区范围标签极其关键，。我要做美国区，最好添加#USA、#Amarican，甚至可以使用更精准的#Portland、#newyork等。</p><p>这种做法是给视频贴标签，TikTok系统算法察觉你发布视频的目的是什么，受众地区在哪里，流量也就更精准。</p><h5 id="②描述性标签"><a href="#②描述性标签" class="headerlink" title="②描述性标签"></a><strong>②描述性标签</strong></h5><p>每个地区都有自己的历史、建筑、人物、景点等，辨认度极高，这些名词自身带有很强的地域指代性。</p><p>比如英国人看到#queen、#BigBen、#Buckingham Palace、#afternoon tea等标签就会有较强的亲切感。</p><p>美国的#White House、#Sunset Boulevard等标签就有认同感。</p><p>如此，观众在视频的停留时间就会更久，完播率也就更高，系统会判定该地域的受众很喜欢你的视频，就会持续推送至该地区，我们的目的也就达到了。</p><h5 id="③拓展性标签"><a href="#③拓展性标签" class="headerlink" title="③拓展性标签"></a><strong>③拓展性标签</strong></h5><p>拓展关键词主要是地区重大事件、节日活动、奇闻异事等内容。</p><p>为什么要用这个关键词呢，很多人就疑惑，重大事件比如#Blackllivematter美国的黑命贵运动是世界范围关注的，添加了应该没用才是。</p><p>不，重大新闻事件它有个传播周期。</p><p>比如黑人运动在兴起初期有在国内传播一阵子，现在已经没什么人关注了，但美国是持续的游行、争吵、聚集等，他们对该标签的关注无论从深度还是广度而言都是高过我们的。</p><p>因此我们要对TikTok的趋势标签保持关注，而且要对我们的目的区域新闻保持敏感。</p><h4 id="（4）标签数量的选择"><a href="#（4）标签数量的选择" class="headerlink" title="（4）标签数量的选择"></a><strong>（4）标签数量的选择</strong></h4><p>最常见的标签数是1-3个，但因为标签太少讲不出具体内容，无法包含视频的重要信息。</p><p>根据经验，5-8个标签是比较理想的。</p><p>建议字数不要太多。</p><p>视频的标题最高限制150个字符，含文案和标签，而 Instagram 限制可以写2200个字符。</p><p>从字数的限定上可以看出TikTok想让创作者更加精准的描述视频并添加精准的标签，而不是无所谓的堆砌。</p><p>不过可以肯定的是，你的字数太多，视频会被遮挡，体验感就变差了。</p><p><img src="http://5coder.cn/img/1663253086_1e8522352e5a77ba32ef298328f5c5bf.png" alt="640 (15)"></p><h4 id="（5）遵守社区规则"><a href="#（5）遵守社区规则" class="headerlink" title="* （5）遵守社区规则*"></a><em><strong>* （5）遵守社区规则*</strong></em></h4><p>TikTok的社区规则明确指出，发布重复的评论或内容是不行的，算法将进行惩罚。</p><p>因此，不要使用无关或重复的标签。</p><p>如果照抄别人的文案、标签或者自己使用内容、顺序完全一样的标签都会影响账号权重。</p><h2 id="十一、基金变现"><a href="#十一、基金变现" class="headerlink" title="十一、基金变现"></a>十一、基金变现</h2><p>对于大部分TikTok玩家而言，TikTok创作者基金是保底收益，可以让我们解决温饱问题，也是宝妈赚取奶粉钱的不二选择。</p><p><img src="http://5coder.cn/img/1663253125_3e753f50e4dc91695482fcce6ef093e2.png" alt="640 (16)"></p><p>今天我们就来讲讲TikTok创作者基金，让你轻松掌握基金的起源、开通和政策。</p><ul><li>什么是创作者基金</li><li>如何开通TikTok创作基金</li><li>创作基金如何计算奖金</li></ul><h3 id="1-什么是创作者基金"><a href="#1-什么是创作者基金" class="headerlink" title="1.什么是创作者基金"></a><strong>1.什么是创作者基金</strong></h3><p>2020年7月23日，TikTok官方宣布在美国投入2亿美金用于创作者激励。</p><p>2020年7月29日，官方称美国该基金在未来三年将增至10亿美金。</p><p>2020年9月，欧洲区（英法德意西）开通创作者基金，预计未来三年投入3亿美金。</p><p>关于基金的用途，官方原话如下，“用于梦想用自己的声音和创造力来点燃励志事业的人”。</p><p>We’re launching the TikTok Creator Fund to encourage those who dream of using their voices and creativity to spark inspirational careers.TikTok newsroom</p><p>用意就是对优质内容创作者予以奖励，说人话就是在基金所在国家，创作者上传视频有播放就给钱，真金白银的给。</p><p><strong>撸创作者基金有什么优缺点？</strong></p><p><strong>优点</strong></p><ul><li>门槛低。小白只要经过培训都可以入场赚得第一桶金。</li><li>稳定。能有稳定的保底收益。</li></ul><p><strong>缺点</strong></p><ul><li>有时间限制，不能做太久。</li><li>随着入局TikTok玩家增多，创作者基金池减少，收益减少。</li><li>与电商相比，收益较少。</li></ul><h3 id="2、如何开通创作者基金"><a href="#2、如何开通创作者基金" class="headerlink" title="2、如何开通创作者基金"></a><strong>2、如何开通创作者基金</strong></h3><p><img src="http://5coder.cn/img/1663253202_6659a939594e44635742e962a4cbc336.jpg" alt="640"></p><h4 id="（1）开通条件"><a href="#（1）开通条件" class="headerlink" title="（1）开通条件"></a><strong>（1）开通条件</strong></h4><p>如上图，开通TikTok创作者基金需要满足以下条件：</p><ul><li>至少有 10，000 名粉丝</li><li>在过去 30 天内至少有 10，000 次视频观看</li><li>年满 18 岁</li><li>位于美国、英国、西班牙、法国、德国或意大利</li><li>符合TikTok社区准则</li></ul><h4 id="（2）开通流程"><a href="#（2）开通流程" class="headerlink" title="（2）开通流程"></a><strong>（2）开通流程</strong></h4><p>进入个人账号后台，点击TikTok Creator Fund进入开通页面，当你的账号符合开通条件时，在开通条件前会呈现打钩，点击选择同意条款，就可以申请了。</p><p><img src="http://5coder.cn/img/1663253229_61b3f847f2fd6871a6ac516c0d073815.png" alt="640 (17)"></p><p>确认你的年龄已经达到18周岁。</p><p>操作时使用谷歌浏览器，其他浏览器会出现缓冲慢或者无法跳转情况。 </p><p><img src="http://5coder.cn/img/1663253242_f9721a18596506df483ba247d809ceeb.png" alt="640 (18)"></p><p>此处会让你填写出生日期、出生日期、电子邮箱、地区等，出生日期和地区与要提现的身份证信息相同。</p><p>在Document type栏要选择信息的核验方式，有身份证、驾驶证和护照三个可选项。护照通过率最高，其次是驾驶证、身份证。</p><p>没有护照的选择大陆身份证即可。</p><p><img src="http://5coder.cn/img/1663253257_73e2a39880e6136310b2db4824f079bd.png" alt="640 (19)"></p><p>上传身份证正方面，有拍照上传或手机相册上传两种方式。</p><p>拍照上传时手机不要对着电脑屏幕的身份证照片拍照，审核很难通过。</p><p><img src="http://5coder.cn/img/1663253279_3bf13db01da1a5db9dadabe0e4bfbb6f.png" alt="640 (20)"></p><p>相片上传完成后进入TikTok账号后台对税务信息进行设置。</p><p>税务信息根据账号的定位选择美国或者欧洲五国，并据此选择对应的货币。</p><p>至此，TikTok创作者基金申请也就完成了。</p><p><img src="http://5coder.cn/img/1663253293_600ee1b1c1f4f16cce2fb0d6cea7c024.png" alt="640 (21)"></p><h4 id="（3）开通难点分析"><a href="#（3）开通难点分析" class="headerlink" title="（3）开通难点分析"></a><strong>（3）开通难点分析</strong></h4><p>因为节点、账号设置、年龄等各种原因造成基金开通不通过。</p><h5 id="①万粉了还是没法申请"><a href="#①万粉了还是没法申请" class="headerlink" title="①万粉了还是没法申请"></a><strong>①万粉了还是没法申请</strong></h5><ul><li>账号没有开通创作者账号</li></ul><p>​    创作者基金必须开通创作者账号才能申请，开通商业账号是无法申请的。</p><p>​    有些账号TikTok官方会通过inbox告知你已经满足了开通创作者基金的条件，但一般是达到万粉就要记得去开通创作者基金。</p><ul><li>限流30天中</li></ul><p>​    主要有三个方面原因</p><p>​    视频违规被下架，如被判重或内容有血腥暴力种族歧视等，出现该情况一般等30天后再申请。</p><ul><li>数据未更新</li></ul><p>​    比如你的粉丝刚满10000粉就申请，那时TikTok后台还未对你的账号数据进行更新造成无法申请，等两天就好了。</p><ul><li>年龄未通过</li></ul><p>​    因此说在开通TikTok账户时就要确认提现时的身份信息，所有信息要一致。如果年轻未通过，可以主动向TikTok官方报告你的年龄出错，希望更正年龄。</p><p>settings and privacy&gt;Report a problem&gt;Account and profile&gt;Profile Page&gt;Other&gt;Need more help</p><p><img src="http://5coder.cn/img/1663253378_ab6f78b0b6b85f970b8da80dcdb332b0.png" alt="640 (22)"></p><p>在出现的对话框里告诉官方我很喜欢用TikTok，但是因为在开户时填错了身份信息，希望进行更改。</p><p>反正就是吹一波我爱TikTok，TikTok你也要爱我的情话。</p><p>一两天内官方会在inbox里给你回复，你可以在回复件里上传你的身份证，就完成年龄更改了。</p><p>我当时是当天回复，应该是TikTok客服那天心情比较好。</p><p><img src="http://5coder.cn/img/1663253392_22f472ba2330053f6f976eb63bab326e.png" alt="640 (23)"></p><h5 id="②基金开通失败"><a href="#②基金开通失败" class="headerlink" title="②基金开通失败"></a><strong>②基金开通失败</strong></h5><p>主要有四个方面的原因：</p><ul><li>数据延迟</li></ul><p>​    如账号粉丝暴涨，TikTok后台数据更新不及时，24小时候再申请。</p><ul><li>技术原因</li></ul><p>​    就算你账号所有条件都满足申请条件，但还是无法申请，两种解决方法，一是等一两天，二是主动向TikTok官方后台说明情况，步骤同更改年龄步骤相似，24小时候再申请。</p><ul><li>定位原因</li></ul><p>​    一般是因为节点不稳定造成账号定位跳转到其他地区。这种情况是无法防范的，因此一定要保护好自己的账号，没用的时候要关闭TikTok、关闭WiFi。</p><p>如果出现下图情况（因为地区原因造成无法申请），过一个月后再试，但一般是无法再申请。</p><p><img src="http://5coder.cn/img/1663253465_b44c06630b161a2300a1d2089e43aebf.png" alt="640 (24)"></p><p>●年龄原因</p><p>一般常见的原因是出生的年月填错或者是上传的证件不够清晰。</p><h3 id="3、如何计算基金收入"><a href="#3、如何计算基金收入" class="headerlink" title="3、如何计算基金收入"></a><strong>3、如何计算基金收入</strong></h3><p>主要有4个主要因素影响基金收入：</p><p>（1）不同国家基金力度不同，美国奖励最高。</p><p>（2）播放量只计算for you流量，不计算粉丝和profile播放量。</p><p>（3）for you流量中仅计算有基金的国家的播放量，比如日本、韩国、俄罗斯的for you就没有基金。</p><p>（4）点赞有少部分影响，评论几乎忽略不计。</p><p>其实不用太纠结于此，把视频播放量怼上去就OK了。</p><p>以上就是撸取创作者基金的基本情况，但不得再强调下科学上网环境的重要性。</p><p>搞个半天因为上网环境问题导致不能开通创作者基金，那就得不偿失啦。</p><h2 id="十二、红人变现"><a href="#十二、红人变现" class="headerlink" title="十二、红人变现"></a>十二、红人变现</h2><p>如果你的TikTok账号粉丝达到10万粉，就达到了成为“网红”账号的标准，可以通过TikTok创作者市场承接品牌方广告等方式变现。 </p><p>接下来就来聊聊如何打造营销TikTok网红账号。</p><p><img src="http://5coder.cn/img/1663253555_d30c4c9a74ea3a1f7c2d86f9db9fb139.png" alt="640 (25)"></p><h3 id="1、TikTok创作者市场是什么？"><a href="#1、TikTok创作者市场是什么？" class="headerlink" title="1、TikTok创作者市场是什么？"></a>1、TikTok创作者市场是什么？</h3><p><a href="https://creatormarketplace.tiktok.com/">https://creatormarketplace.TikTok.com</a></p><p><img src="http://5coder.cn/img/1663253576_a1f8ebf2744c64743f8eb109f8050943.png" alt="640 (26)"></p><p>创作者市场的英文名称叫TikTok Creator Marketplace，对标的是国内抖音的星图。</p><p>由TikTok自主开发的连接品牌和创作者的官方合作平台，相关数据只链接TikTok自己的生态系统。</p><p>品牌方可以在这里找到网红进行营销，TikTok网红可以借助 TikTok Creator Marketplace与品牌合作开展付费活动。</p><p>目前该平台还是免费开放的，没有向广告商收取使用TCM使用费，而且还为品牌方和网红提供全面而精准的第一手数据、工具。</p><h4 id="（1）数据可靠"><a href="#（1）数据可靠" class="headerlink" title="（1）数据可靠"></a><strong>（1）数据可靠</strong></h4><p>该平台的数据是由 TikTok 直接提供和维护，能及时展现网红门的账号数据和分析情况，帮助我们做出决策。</p><p><img src="http://5coder.cn/img/1663253600_00b30809b258fdca3f1b96f143b815f7.png" alt="640 (27)"></p><h4 id="（2）分析精准"><a href="#（2）分析精准" class="headerlink" title="（2）分析精准"></a><strong>（2）分析精准</strong></h4><p>可以通过活动报告工具了解网红门的账号活动，如视频总数、费用等。</p><p><img src="http://5coder.cn/img/1663253614_00b30809b258fdca3f1b96f143b815f7.png" alt="640 (28)"></p><h4 id="（3）搜索功能"><a href="#（3）搜索功能" class="headerlink" title="（3）搜索功能"></a><strong>（3）搜索功能</strong></h4><p>TCM 有强大的搜索功能，能让我们根据具体的数据指标搜索网红。</p><p><img src="http://5coder.cn/img/1663253634_5d7adf7dc3fa37477dfa44e61d0b64b5.png"></p><h4 id="（4）直接联系"><a href="#（4）直接联系" class="headerlink" title="（4）直接联系"></a>（4）直接联系</h4><p>可以通过 TCM 直接联系创作者。 通过平台内的简单通信工具与任何已确定的创作者发起合作。</p><h3 id="2、注册流程"><a href="#2、注册流程" class="headerlink" title="2、注册流程"></a><strong>2、注册流程</strong></h3><p>当TikTok个人的创作者账号达到一定标准后，TikTok官方会邀请你成为TikTok creator marketplace 的成员，就是成为网红账号。</p><h4 id="（1）申请条件"><a href="#（1）申请条件" class="headerlink" title="（1）申请条件"></a><strong>（1）申请条件</strong></h4><ul><li>18周岁以上</li><li>粉丝超过10万</li><li>28天内至少上传3个视频</li><li>28天内有10万个赞</li></ul><h4 id="（2）开通注册流程"><a href="#（2）开通注册流程" class="headerlink" title="（2）开通注册流程"></a><strong>（2）开通注册流程</strong></h4><p>和开通创作者基金类似，超过10万粉后，TikTok官方会通过inbox通知你可以参与创作者市场。</p><p>但很多人都没收到该信息，这时我们也就可以主动向TikTok官方说明账号已经满足开通条件，请求开通。</p><p>主动申请流程和主动更正年龄信息步骤类似。</p><p>如下图，直接给TikTok官方发信息说明自己账号情况，申请给予开通。</p><p><img src="http://5coder.cn/img/1663253706_34773acfbfca58b3890227f3060df45e.png" alt="640 (30)"></p><p>TikTok官方答复快的话，当天在你个人账号后台就会出现TikTok creator marketplace按钮，如下图。</p><p>点击进入同意隐私条款后就开始个人信息填写。</p><p><img src="http://5coder.cn/img/1663253722_a48c746794fabe61822349ec3d051978.png" alt="640 (31)"></p><p>在个人信息页面有Opportunities 和Dashboard两个界面。</p><p><img src="http://5coder.cn/img/1663253732_92184e6afbc3bee0b1823b148f480871.png" alt="640 (32)"></p><p>首先填写Account信息。</p><p><strong>Intro</strong>：主要向品牌方展示你账号的基本情况和优势，比如什么时候开设账号、什么主题类目、粉丝情况、你可以提供什么广告、有什么优势等。</p><p><strong>Rate：</strong>设置你的广告费用，价格自定义，我是定在1000美金。</p><p>如下图，如果你打开The price is negotiable，就表示允许品牌商协商价格。</p><p>Free products accepted as payment表示你可以选择产品作为报酬进行支付。</p><p><img src="http://5coder.cn/img/1663253763_b07298caa9eaf23f97b55fc42ebebbf6.png" alt="640 (33)"></p><p>Bussiness phone、Bussiness email、Social media栏最好填写完整，让品牌方觉你的专业，也方便联系，特别是Bussiness email。</p><p><strong>Pause new requests：</strong>你不想接单了就可以开启停止接单功能。</p><p>填写完个人账号信息，现在来看看Dashboard界面。</p><p><img src="http://5coder.cn/img/1663253779_d25eec4621c786cd776578037390998f.png" alt="640 (34)"></p><ul><li><strong>Pengding：</strong>品牌方正在和你协商营销推广费用。</li><li><strong>Active：</strong>正在进行中的营销推广项目。</li><li><strong>Conpleted：</strong>完成的项目。</li><li><strong>Inactive：</strong>取消的项目。</li><li><strong>Creator account info：</strong>功能和上文讲的account一样</li><li><strong>Achievement badges：</strong>TikTok官方会给你的账号一些勋章，等同官方认证，五星好评，能帮助你提升信任度</li></ul><p><img src="http://5coder.cn/img/1663253796_4c73e96a27b4497e1b9e67abeebcfc2c.png" alt="640 (35)"></p><h3 id="3、运营流程"><a href="#3、运营流程" class="headerlink" title="3、运营流程"></a><strong>3、运营流程</strong></h3><p>当你的账号接到品牌方的推广邀约后，你可以选择接单或者拒绝。</p><p>如果接单了，你需要按照品牌方的要求进行视频创作，视频创作完成后需要先提交品牌方审核通过。</p><p><img src="http://5coder.cn/img/1663253829_78b019203662019462c838d88f88c88e.png" alt="640 (36)"></p><p>品牌方同意你的视频内容后就可以上传视频了。</p><p>在你上传推广视频时，点击Branded content，选择你要推广的品牌就OK，你的推广经费也就到手了。</p><p><img src="http://5coder.cn/img/1663253841_c2ead8b6d4c0c67ce170ed90a298b20a.png" alt="640 (37)"></p><p>账号十万粉很简单，如果你的广告费不是太高接到订单也不难，只是单纯的推广音乐，那就更简单了。</p><p>难点在于视频创作上。</p><p>跨境商家都清楚，品牌店铺都是让老外模特拍摄产品推广视频，拍摄成本是多么恐怖。</p><p>如果做网红接单，在账号定位上就得想清楚如果来单了要怎么处理，而且得让品牌方满意。</p><p>未雨绸缪，有备无患！</p><h2 id="十三、基金体现"><a href="#十三、基金体现" class="headerlink" title="十三、基金体现"></a>十三、基金体现</h2><p>申请了创作者基金、开通创作者市场就是为了撸基金、赚美金，这些美金会存放在TikTok账号里，提现到国内银行卡还有一些程序需要操作。</p><p>TikTok国内玩家的基金提现主要通过PayPal提现，我们就来讲讲TikTok通过paypal提现的七个流程。</p><ul><li>注册PayPal账号</li><li>TikTok账号绑定PayPal</li><li>TikTok税务信息登记</li><li>TikTok基金提现至PayPal</li><li>万里汇注册流程</li><li>PayPal转账至万里汇WorldFirst</li><li>万里汇转账至国内银行卡</li></ul><h3 id="1、注册PayPal账号"><a href="#1、注册PayPal账号" class="headerlink" title="1、注册PayPal账号"></a><strong>1、注册PayPal账号</strong></h3><p>进入PayPal官网</p><p><a href="https://www.paypal.com,注册类型选择个人账户./">https://www.PayPal.com，注册类型选择个人账户。</a></p><p><img src="http://5coder.cn/img/1663253905_141c6c91559935eafbe187f27d53b2a5.png" alt="640 (38)"></p><p><img src="http://5coder.cn/img/1663253905_a50bd8aa1a4eb1b7ca1b00a73fb00ba6.png" alt="640 (39)"></p><p>输入手机号，核对验证码即可，流程相对简单。</p><p><img src="http://5coder.cn/img/1663253919_d97cfd27bbde62903f6951b8e3f95167.png" alt="640"></p><p>根据实际情况填写个人信息，个人信息要与TikTok实名的身份信息相同。</p><p>信息填写完成后，注册也就完成了，登录邮箱进行验证就可以使用PayPal了。</p><p><img src="http://5coder.cn/img/1663253943_5b81a5312c4996d7aad10766e952ca53.png" alt="640 (40)"></p><p><img src="http://5coder.cn/img/1663253943_a375e1725073c2dc827923bf88043fba.png" alt="640 (41)"></p><h3 id="2、TikTok账号绑定PayPal流程"><a href="#2、TikTok账号绑定PayPal流程" class="headerlink" title="2、TikTok账号绑定PayPal流程"></a><strong>2、TikTok账号绑定PayPal流程</strong></h3><p>进入TikTok账号后台。</p><p><img src="http://5coder.cn/img/1663254024_cda6f2b1ac697a5232084990a9de06fa.png" alt="640 (42)"></p><p>选择提现方式后需要再次邮箱认证。</p><p><img src="http://5coder.cn/img/1663254034_550989be75a242d147612342d92d2d25.png" alt="640 (43)"></p><p>邮箱确认完成后再次点击提款方式后，出现添加提款方式界面，点击进入。</p><p><img src="http://5coder.cn/img/1663254044_ac4f52e2dbd75b9356126617f936d33e.png" alt="640 (44)"></p><p>选择PayPal，同意条款，选择链接PayPal账号。</p><p><img src="http://5coder.cn/img/1663254057_9483bf4a8e8e15ef86604c3a086075cd.png" alt="640 (45)"></p><p>输入PayPal邮箱登入PayPal账号就完成了绑定。</p><p>进入账号后台，选择提款方式，已经绑定成功了。</p><p><img src="http://5coder.cn/img/1663254076_5b364ed540cb23fd152b1ccace4e1145.png" alt="640 (46)"></p><h3 id="3、TikTok税务信息登记"><a href="#3、TikTok税务信息登记" class="headerlink" title="3、TikTok税务信息登记"></a><strong>3、TikTok税务信息登记</strong></h3><p>在TikTok提现至PayPal前，需要添加税务信息，即网传的W9表格。</p><p>首先选择Tax information，根据要求填写个人信息。</p><p>个人信息必须与TikTok账号绑定的个人信息一致，并用英文填写，完成后选择继续。</p><p><img src="http://5coder.cn/img/1663254096_52128b5e20b4d589bf8b05797bba97af.png" alt="640 (47)"></p><p>在该网页，需要填入个人的美国税务表。</p><p>如下图。</p><p>左右两边是跳转后的网页的上下部分，中间是美国居民地址生成器Fake Address Generator打开的网页。</p><p>首先登入美国居民地址生成器网址:</p><p><a href="https://www.fakeaddressgenerator.com/">https://www.fakeaddressgenerator.com/</a> </p><p> 注册账号，根据TikTok账号地区选择税务地区。</p><p>左右两边的网页根据该税务信息，逐一填写即可。</p><p><img src="http://5coder.cn/img/1663254125_ab645204738f33e33a9bd163f01f9a1a.png" alt="640 (48)"></p><p>信息填写完成后，系统会让你对填写的信息进行确认，可以修改信息，确定信息无误后选择确认。</p><p><img src="http://5coder.cn/img/1663254125_39c00d1014e597240903d8525926c6dd.png" alt="640 (49)"></p><p>到这里，信息都填写完整了，选择提交后，就成功绑定W9表格了。</p><p><img src="http://5coder.cn/img/1663254125_ce3272d5c0cb43dcbb741c5e6976d02c.png" alt="640 (50)"></p><p><img src="http://5coder.cn/img/1663254125_d97cfd27bbde62903f6951b8e3f95167.png" alt="640"></p><p><img src="http://5coder.cn/img/1663254125_b78fd512d7511675d57c39d5c7e9186f.png" alt="640 (51)"></p><h3 id="4、TikTok基金提现至Pa-yPal账户"><a href="#4、TikTok基金提现至Pa-yPal账户" class="headerlink" title="4、TikTok基金提现至Pa****yPal账户"></a><strong>4、<strong><strong>TikTok基金提</strong></strong>现至Pa****yPal账户</strong></h3><p>老步骤，进入balance、income。</p><p><img src="http://5coder.cn/img/1663254187_805df29cbb93b5eea59133f30b2d1f0e.png" alt="640 (52)"></p><p>输入邮箱验证码后，直接点击确定提款。</p><p><img src="http://5coder.cn/img/1663254187_1cd6e7afde6c68458091c828fe8e8914.png" alt="640 (53)"></p><p>再次进入TikTok账号余额后就，余额已经减少了。</p><p>登入PayPal账号，资金已经提款到位。</p><p>会不会太简单了。</p><p><img src="http://5coder.cn/img/1663254187_45698920583fe39472fb021e3e521e47.png" alt="640 (54)"></p><h3 id="5、万里汇WorldFirst注册流程"><a href="#5、万里汇WorldFirst注册流程" class="headerlink" title="5、万里汇WorldFirst注册流程"></a><strong>5、万里汇WorldFirst注册流程</strong></h3><p>在操作前，需要注意以下事项：</p><ul><li>登入旧版万里汇网址注册账户。</li></ul><p>注册万里汇账户有新版和旧版之分，在新版主页注册的账户转账到国内银行账，需要提供电商交易凭证等材料，旧版不用提供。</p><p>旧版地址：</p><p><a href="https://www.worldfirst.com.cn/static/register-old">https://www.worldfirst.com.cn/static/register-old</a></p><ul><li><p>注册完成后可在网页搜索万里汇网页进行登入。</p></li><li><p>用google搜索引擎操作，系统兼容，不用F墙。</p></li><li><p>申请香港的银行账户转账，0手续费，2%汇率差（提现到美金账户35美金手续费）</p></li><li><p>港币万里汇转到国内账号0.3%手续费。</p></li><li><p>万里汇最低提现现金50美金。</p></li></ul><p>登入旧版万里汇网址：</p><p><a href="https://www.worldfirst.com.cn/static/register-old">https://www.worldfirst.com.cn/static/register-old</a></p><p>选择个人账号，店铺经营范围随便选一个，其他信息根据实际填写。</p><p>注意：万里汇的身份信息和TikTok、PayPal的身份信息要一致。</p><p><img src="http://5coder.cn/img/1663254292_c383f0e9d2bd3d9cfbe6eb576887df57.png" alt="640 (55)"></p><p>账号创建成功后，选择上传资料后会跳转至登录页面，选择登入。</p><p><img src="http://5coder.cn/img/1663254292_c16573c39eca95590eb9fee7a06e7c32.png" alt="640 (56)"></p><p>登入后需要将个人资料填写完整，保存后，开始对手机号进行验证。</p><p><img src="http://5coder.cn/img/1663254292_f7b36a8736d6c72ac4c6cb44b15a10ed.png" alt="640 (57)"></p><p>手机验证完成后就进入了万里汇账号首页，开始上传身份证信息。</p><p><img src="http://5coder.cn/img/1663254292_c92a28c4f6ff1a65b5a3b9f3c2343a8b.png" alt="640 (58)"></p><p><img src="http://5coder.cn/img/1663254292_146a82080246058dc6858928360393e3.png" alt="640 (59)"></p><p>身份信息上传完成后，开始申请香港货币账户。</p><p>点击货币账户，选择申请货币账户。</p><p><img src="http://5coder.cn/img/1663254292_07f518b23c99db6198d440909c16f37c.png" alt="640 (60)"></p><p>记住，选择香港区的货币账户，手续费低。</p><p>当然，土豪随意。</p><p><img src="http://5coder.cn/img/1663254292_aee88043ce8b73d4be5931121e0355c7.png" alt="640 (61)"></p><p>申请后你的货币账户就开通成功了，这个页面还有用。</p><p>paypa提现至万里汇账户需要填写下面的信息。</p><p><img src="http://5coder.cn/img/1663254292_488bff1c442ba3ef2ac5c4e3e909a538.png" alt="640 (62)"></p><h3 id="6、PayPal转账至万里汇WorldFirst"><a href="#6、PayPal转账至万里汇WorldFirst" class="headerlink" title="6、PayPal转账至万里汇WorldFirst"></a><strong>6、PayPal转账至万里汇WorldFirst</strong></h3><p>先登入PayPal账号，选择转账，提现到您的银行账户。</p><p><img src="http://5coder.cn/img/1663254377_155a655211c7b6b7a58bcd6650ceaa53.png" alt="640 (63)"></p><p>选择关联银行账户，关联美国或中国香港行政区的银行账户，之后选择中国香港特别行政区的银行账户。</p><p><img src="http://5coder.cn/img/1663254377_425542bcaf4ee42519ffeb19a21c435f.png" alt="640 (64)"></p><p>好了，重点来了。</p><p>这时就需要填入万里汇香港账户的相关新消息，账户信息选择支票，完成后关联账户。</p><p>系统会显示提现需要3-6个工作日。</p><p>选择下一页，就完成了PayPal到万里汇的提款。</p><p><img src="http://5coder.cn/img/1663254377_ac09bd938c2cfbcf3db8f835e12b3742.png" alt="640 (65)"></p><p>万里汇转账到国内账号就简简单单了，不再赘述。</p><h2 id="十四、常见问题"><a href="#十四、常见问题" class="headerlink" title="十四、常见问题"></a>十四、常见问题</h2><p><strong>玩TikTok最大的痛点是什么？</strong></p><p>不是涨粉慢、播放量低，而是出现黑屏、0播、低播、限流、死号等问题，有时真想让自己代替TikTok账号去关小黑屋。</p><p><img src="http://5coder.cn/img/1663254439_bbd79c11a8ddb2f1c93dceb555634414.gif" alt="640"></p><h3 id="1、视频0播"><a href="#1、视频0播" class="headerlink" title="1、视频0播"></a><strong>1、视频0播</strong></h3><p>做TikTok是一个心态的较量，特别是对于新手来说。因此碰到0播问题先放宽心，大家都是这么摸爬滚打出来的。</p><h4 id="（1）原因分析"><a href="#（1）原因分析" class="headerlink" title="（1）原因分析"></a><strong>（1）原因分析</strong></h4><p><strong>①网络环境问题</strong></p><p>手机设置出现问题、vv污染等都会造成0播，这是最常见的。</p><p>同时，是不是你手速太快、vv刚点击就打开TikTok软件，这就是开了“假”的vv，因为vv软件还没缓冲。手速慢点就OK，这个问题多人没在意。</p><p><strong>②视频内容问题</strong></p><p>是否违反TikTok社群自律公约（机器操作，刷粉，色情、暴力等）</p><p>是否持续发布低质量视频。（视频分辨率太差，模糊不清，满屏都是像素点。）</p><p>是否侵犯音乐版权。（老外对版权的保护是极其严苛的，国内小视频播放的音乐在TikTok上就有版权问题）</p><p>视频被判BY或被投诉</p><p>审核延迟问题。（偶尔会出现视频数据更新延迟的情况，一般是6个小时内会有数据，超过12小时就有问题。）</p><h4 id="（2）破解方法"><a href="#（2）破解方法" class="headerlink" title="（2）破解方法"></a><strong>（2）破解方法</strong></h4><h5 id="①让子弹飞一会儿"><a href="#①让子弹飞一会儿" class="headerlink" title="①让子弹飞一会儿"></a><strong>①让子弹飞一会儿</strong></h5><p>是的，就是等一会儿，喝杯咖啡坐等。等多久呢？不超过12小时</p><h5 id="②检查网络环境"><a href="#②检查网络环境" class="headerlink" title="②检查网络环境"></a><strong>②检查网络环境</strong></h5><p>检查自己的IP：</p><p><a href="http://www.ipip.net、www.whoer.net、/">www.ipip.net、www.whoer.net、</a></p><p><a href="https://www.astrill.com/vpn-leak-test">https://www.astrill.com/vpn-leak-test</a></p><p>在环境检测没问题后，重新下载登录TikTok就OK了。</p><p>找不出网络环境问题怎么办？</p><p>好办，让“刷机”常伴你左右！！！</p><h5 id="③提高视频质量"><a href="#③提高视频质量" class="headerlink" title="③提高视频质量"></a><strong>③提高视频质量</strong></h5><p>目前国内玩家大都处在BY视频阶段，提高视频的质量从三个方面入手。</p><p>对标头部玩家。学习人家怎么玩，培养网感。</p><p>对优质视频深度剪辑。寻找新奇特、吸睛、清晰的高质量视频并深度剪辑，这是玩TikTok的基本技能。</p><p>尽量使用TikTok平台提供的音乐，避免侵权。</p><h3 id="2、限流"><a href="#2、限流" class="headerlink" title="2、限流"></a><strong>2、限流</strong></h3><p><img src="http://5coder.cn/img/1663254528_6c5ade6e407d4522b208f5218383f576.png" alt="640 (66)"></p><p>限流可以看做是0播的升级版，看到限流给人的第一感觉就是我的孩子最近怎么长不高了。</p><h4 id="（1）限流四大特征"><a href="#（1）限流四大特征" class="headerlink" title="（1）限流四大特征"></a><strong>（1）限流四大特征</strong></h4><p>①连续三天0播；</p><p>②视频播放量小于粉丝量的1%；</p><p>③视频数据没有for you流量或极少；</p><p>④持续掉粉；</p><h4 id="（2）原因分析和破解方法"><a href="#（2）原因分析和破解方法" class="headerlink" title="（2）原因分析和破解方法"></a><strong>（2）原因分析和破解方法</strong></h4><p>造成限流的原因和0播雷同。不过还有几点需要注意：</p><p><strong>①系统未推送。</strong>你的视频因质量等问题，系统只推送给你的粉丝。</p><p><strong>②多账号登录。</strong>对的，一机一号是保护好账号的基本要求，多账号登录不不可取，当然，如果你是暴力引流和矩阵号等玩法例外。</p><p><strong>③开通创作者基金。</strong>在TikTok刚开通创作者基金时很多头部网红都反映开通创作者基金后流量受限，之后都选择关闭。</p><p><strong>④涨粉太快。</strong>你太优秀也是个错！！！一般在50万粉左右系统会设定限流。只能选择持续输出高质量视频。</p><p>有2点经验供大家参考</p><p>①账号正常解除限流的时间在10～15天（根据运营经验，没有确切依据）。</p><p>②刚起的号或者粉丝较少就出现0播、视频被下架等情况，想都不要想，把这账号扔了，乖乖刷机、重新注册账号吧。</p><p>记住这句话，让刷机常伴你左右！！！</p><h3 id="3、低播"><a href="#3、低播" class="headerlink" title="3、低播"></a><strong>3、低播</strong></h3><p><img src="http://5coder.cn/img/1663254597_6e9bb7d11775a92480a666100f8435b1.png" alt="640 (67)"></p><p>如果连续一周，或发了10-20个视频，都是100左右或者较低的播放。</p><p>怎么办？区别对待。</p><p>低播说明你的账号已经被降权。</p><p>新号、粉丝少的账号，就考虑卖了、扔了。</p><p>粉丝较多的号有三个方法应对：</p><h4 id="（1）选择换内容不换类目"><a href="#（1）选择换内容不换类目" class="headerlink" title="（1）选择换内容不换类目"></a><strong>（1）选择换内容不换类目</strong></h4><p>很多人看到换内容会很奇怪，不是说做账号要类目垂直吗？</p><p>低播说明第一波看到你视频的人对你的视频不感兴趣，造成你的视频无法突破第一流量池，这时就得想方法测试新的内容让观众喜欢。</p><p>TikTok账号类目一定要垂直，但具体内容可以细分。比如你的账号是关于卖手办的，你可以上传所有品类的手办，也可以只上传DC英雄的垂直类手办。</p><h4 id="（2）重发爆款视频"><a href="#（2）重发爆款视频" class="headerlink" title="（2）重发爆款视频"></a><strong>（2）重发爆款视频</strong></h4><p>爆款视频再发一遍还是会有流量，甚至表现根号，蹭自己的流量，把账号炒热起来。</p><h4 id="（3）合拍蹭流量"><a href="#（3）合拍蹭流量" class="headerlink" title="（3）合拍蹭流量"></a><strong>（3）合拍蹭流量</strong></h4><p>目的是通过热点视频带动账号流量。</p><h3 id="4、黑屏、无网络、无法登陆"><a href="#4、黑屏、无网络、无法登陆" class="headerlink" title="4、黑屏、无网络、无法登陆"></a><strong>4、黑屏、无网络、无法登陆</strong></h3><p><img src="http://5coder.cn/img/1663254643_6353b721db3ac53027094afcbe1b2746.png" alt="640 (68)"></p><p>注意注意注意，重要的事情说三遍，一出现黑屏，立即关闭TikTok账号！！！</p><h4 id="（1）原因分析-1"><a href="#（1）原因分析-1" class="headerlink" title="（1）原因分析"></a><strong>（1）原因分析</strong></h4><p>根本原因是网络环境问题，玩TikTok出现的问题绝大多数是网络环境造成的，账号被封是极个别情况。</p><p>另外的原因就是你手速太快。打开wifi，打开节点，打开TikTok，因为节点软件还没安全连接，就打开了TikTok造成网络环境问题，俗称“开了假vv”。</p><h4 id="（2）破解方法-1"><a href="#（2）破解方法-1" class="headerlink" title="（2）破解方法"></a><strong>（2）破解方法</strong></h4><h5 id="①让子弹飞一会儿-1"><a href="#①让子弹飞一会儿-1" class="headerlink" title="①让子弹飞一会儿"></a><strong>①让子弹飞一会儿</strong></h5><p>去喝杯咖啡等一会儿再打开。节点不稳定、甚至WiFi不稳定都是影响因素。</p><h5 id="②卸载重装TikTok"><a href="#②卸载重装TikTok" class="headerlink" title="②卸载重装TikTok"></a><strong>②卸载重装TikTok</strong></h5><p>卸载TikTok后清除缓存，重新安装即可。当然，我的习惯是刷机。</p><h5 id="③换节点"><a href="#③换节点" class="headerlink" title="③换节点"></a><strong>③换节点</strong></h5><p>不要随意换节点。养号时像个真人养号，太经常换节点也是个禁忌。</p><h5 id="④插海外卡"><a href="#④插海外卡" class="headerlink" title="④插海外卡"></a><strong>④插海外卡</strong></h5><p>建议插实体SIM卡，前提是得确定发卡的运营商是美国本土的（老美手机卡的运营商也有不是美国本土的），同时确认该SIM卡没有注册过TikTok。</p><p>优点是不用配置网络。缺点是套餐收费比购买的VV贵，最低大概一个月要16美金。</p><h3 id="5、死号"><a href="#5、死号" class="headerlink" title="5、死号"></a><strong>5、死号</strong></h3><p>是账号被封</p><p><img src="http://5coder.cn/img/1663254718_8ec5026525ec315fada6a5fce6393c7a.png" alt="640 (69)"></p><p>出现这种情况，恭喜你中奖了，而且是头彩。目前被封号的概率还是很低的。</p><p>两点需要注意</p><p><strong>（1）让刷机常伴TikTok左右。</strong>网络问题就刷机，刷机耗时比查找原因耗时少很多。</p><p>心态要躺平，以上问题是玩TikTok常见问题，我们要在战术上藐视敌人，方法总比困难多</p><p><strong>（2）懂得取舍。</strong>有些账号运营不起来就舍弃掉，毕竟现在时间成本最宝贵。</p><h2 id="十五、常用工具"><a href="#十五、常用工具" class="headerlink" title="十五、常用工具"></a>十五、常用工具</h2>]]></content>
      
      
      <categories>
          
          <category> TikTok 0-1 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TikTok 0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>001认知篇之1.2《全面认识OA套利》</title>
      <link href="2022/091553636.html"/>
      <url>2022/091553636.html</url>
      
        <content type="html"><![CDATA[<h1 id="001认知篇之1-2《全面认识OA套利》"><a href="#001认知篇之1-2《全面认识OA套利》" class="headerlink" title="001认知篇之1.2《全面认识OA套利》"></a>001认知篇之1.2《全面认识OA套利》</h1><p>更新于：2022-04-14 7:12:35</p><h2 id="一、什么是OA套利Online-arbitrage（线上套利模式）"><a href="#一、什么是OA套利Online-arbitrage（线上套利模式）" class="headerlink" title="一、什么是OA套利Online arbitrage（线上套利模式）"></a>一、什么是OA套利Online arbitrage（线上套利模式）</h2><p>是指在线上各大零售网站，找到低价打折的大牌商品，通过第三方物流换标，然后在亚马逊上进行二次销售。OA模式，其实本质就是在线上倒买倒卖，通过信息差来赚钱。</p><p>可以这样理解，我们都知道拼多多和阿里巴巴上的商品普遍比京东淘宝的商品价格低。那我们就可以将阿里巴巴，拼多多上的同款商品，在淘宝京东上销售，赚取差价。</p><p>但是国内这种模式很难运行，主要的原因就是我知道有信息差，但是我想要在淘宝京东上销售产品，我需要自己重新来上传商品，自己花钱去引流，花钱去做基础销量和评级，然后才能成交。这样就算有差价，也基本上赚不到什么钱。</p><h2 id="二、OA套利为啥能够运行？"><a href="#二、OA套利为啥能够运行？" class="headerlink" title="二、OA套利为啥能够运行？"></a>二、OA套利为啥能够运行？</h2><p> 而亚马逊OA模式能运行，最主要的原因就是因为亚马逊共享listing（产品链接）的政策，也就是亚马逊允许跟卖。</p><p>什么意思呢?</p><p>同一个商品，如果有多个卖家卖，那么大家可以在这同一个链接下挂上自己的销售价格进行销售。</p><p>不需要重新上传产品，不需要自己单独去引流，只要你有正品，就可以直接在这个链接下销售。</p><p>那么这样我们就能通过其他打折购物网站上挑选和购买低价商品，然后贴上亚马逊的商品标签，在亚马逊上销售。</p><p>大家可以看一下，下图这种就是一共有68个OA卖家在销售同一个商品：</p><p> <img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/04/%E5%9B%BE%E7%89%871-8.png" alt="img"></p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/04/%E5%9B%BE%E7%89%872-7.png" alt="img"></p><p>OA模式的这种特性，决定了，我们不需要上传商品，不需要做广告引流，只需要找到有利可图的商品就可以了。</p><p>简单来说就是每天逛网站，看看打折商品，寻找可套利的商品，然后就可以赚钱了。这也决定了OA模式最大的门槛在于选品能力，或者说只要把选品这个能力修炼好了，我们就可以通过OA来赚钱了。是不是比学习其他跨境电商项目简单多了？</p><h2 id="三、OA模式的流程"><a href="#三、OA模式的流程" class="headerlink" title="三、OA模式的流程"></a>三、OA模式的流程</h2><p>OA模式我们知道是怎么一回事了，那接下来就是OA套利模式的流程到底是怎样的呢？ 具体有哪些步骤。以下是一个OA套利模式简单的流程图。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/04/%E5%9B%BE%E7%89%873-7.png" alt="img">简单来讲，</p><ol><li>第1步准备工作：准备可以销售的亚马逊账户，可以用来付款的visa卡，以及可以帮你贴换标的第三方物流商</li><li>第2步选品：到各种购物网站上找到大牌可以在亚马逊上销售的低价产品</li><li>第3步下单：下单购买，发货到第三方物流，</li><li>第4步上架发货：第三方物流换标之后，创建发货计划，上架销售</li><li>第5步回款赚钱：卖出后回款赚钱。</li></ol><p>我认为OA套利模式的最核心的其实就是要选到能在亚马逊上销售的大牌的低价商品。</p><p>一般我们所说的OA套利模式选品，都是针对一些美国本土大品牌商品，一般不会去跟卖国内做精品的卖家。</p><p>跟卖美国本土大牌商品主要是因为美国大牌商品一般都不是品牌拥有方在亚马逊上直接销售商品，一般都是他们的经销商或者代理商创建的链接，所以只要拿到了授权，销售的正牌商品，一般品牌方都不会投诉你，这样我们就可以正常销售。</p><p>而如果跟卖国内做精品的卖家，链接一般都是品牌方自己上传，自己推广的，而你想要直接过来分一杯羹，一般都会被投诉的。</p><h2 id="四、OA模式的优点以及难点"><a href="#四、OA模式的优点以及难点" class="headerlink" title="四、OA模式的优点以及难点"></a>四、OA模式的优点以及难点</h2><h3 id="OA模式的优点："><a href="#OA模式的优点：" class="headerlink" title="OA模式的优点："></a>OA模式的优点：</h3><p>1、行业前景好：有前景，有大玩家（店铺产品高达10万种），可以持续玩很多年：亚马逊不倒，你就可以持续做OA套利.</p><p>2、商业模式比较简单：底层逻辑就是利用信息差，低买高卖赚差价。这个模式的重点就是选品能力，只要你能花比较少的时间找到好的低价商品，就可以快速赚钱。</p><p>3、新手比较容易操作上手：相对亚马逊精品模式或者说其他的跨境电商，这个真的是最简单最容易上手的了。真正要花时间研究的，其实就是选品，不需要自己开发产品，做包装，做设计，不需要编写商品的listing，不需要拍图拍视频，不需要做测评做基础销量，不需要开广告引流，不需要做促销活动站外引流。 只需要选品，然后买买买就行了。</p><p>4、起步资金要求少：根据各自的经济情况，1000-2000美金都可以开始起步来做。套利不像精品那样，需要一款产品备货几十几百上千个，刚开始的时候，我们都是1-3个每款。这样1000-2000美金也可以铺很多的SKU，只要品选的好，资金就可以快速运转起来，1-2K美金也能玩得转。当然如果想要收获更多，也需要投入更多。</p><p>5、投入时间相对灵活：不需要朝九晚五，不需要固定时间，只需要每天或者每周花一点点时间选品，就能维持整个模式运行</p><p>6、试错成本低：每个产品我们最少可以买1件就可以测试了，不需要大批量备货压货，我们可以多SKU来铺货，每个SKU1-3件，那么每天不是这个商品出单就是那个商品出单，这样就可以快速让资金转动起来。不会因为某个商品没有选好，就压掉大量资金。</p><p>7、回报率可控：你可以根据自己的情况，来选择你想要多高的回报，然后根据自己的情况去选品。</p><h3 id="OA模式的难点："><a href="#OA模式的难点：" class="headerlink" title="OA模式的难点："></a>OA模式的难点：</h3><p>1、选品困难，货源不稳定： 新手在前期，不太熟悉的情况下，比较难选到合适的商品。前期也是需要花大量时间来做选品工作的。另外因为OA套利模式，大多数都是从打折清仓区购买的商品，那清仓完了之后，我们就很难再补货。需要重新持续的选品。</p><p>2、竞争激烈：随着这个模式被更多的人知道，必然会有大量卖家入场，那么选品，买货，销售都会有大量的竞争对手。</p><p>3、网站砍单：有些网站会有自己的风控部门，我们下的订单，有一部分会被网站自动取消订单。 也就是所谓的砍单。</p><p>4、品类品牌限制：作为新手卖家，我们刚刚申请的账号权重是比较低的。所以有很多大的品牌我们是没有销售权限的，只有随着我们账号的权重慢慢增加，亚马逊才会开放给我们来销售，当然一些品牌我们也可以按照亚马逊要求，提交发票和图片资料来申请开通。 品类限制一般也是需要我们提交一些资料来开通。</p><h2 id="五、什么人适合来做OA？"><a href="#五、什么人适合来做OA？" class="headerlink" title="五、什么人适合来做OA？"></a>五、什么人适合来做OA？</h2><p> 如果你是一名宝妈，没有太多的时间，但是又不想脱离社会，想在陪娃的时候也能有自己的一份事业，赚点钱维持家用如果你在其他行业做的不开心，听说跨境电商行业还不错，想要入行，却不知道具体应该如何来做如果你有一份稳定的工作，但是不满足于现状。想要通过一份副业增加自己的收入和技能如果你是一个人在家SOHO，没有资源，没有人脉，有点迷茫，想要有所突破如果你想要时间自由，工作地点自由，一台电脑，一根网线走天下如果你想要做亚马逊，但是还不知道如何开始如果你现在迷茫又焦虑OA都值得你来尝试。</p><h2 id="六、OA需要多少起步资金？"><a href="#六、OA需要多少起步资金？" class="headerlink" title="六、OA需要多少起步资金？"></a>六、OA需要多少起步资金？</h2><p>店铺注册相关费用：注册公司，挂靠地址，代理记账等。国内不同城市收费不同，一般在0~4000左右。举个例子深圳这边注册公司免费，挂靠地址1500元，代理记账大概是2000-2400元/年。如果只是做OA，有些同学个体户入驻亚马逊也是可以的。</p><p>亚马逊店铺月租：每个月$39.9</p><p>物流商开户费用：0~$99 (不同物流商不同的收费）</p><p>工具费用：Keepa，H10，卖家精灵，IP Alert, 前期可以先用免费的。TA，SM等选品工具，前期可以手动选品，等赚钱了之后再考虑选品工具。</p><p>科学上网：每月$5-$15(不同的方式，不同的收费)</p><p>采购产品费用: 这个可以根据个人资金实力，酌情投入，慢慢增加物流服务费用：这个因为是在产品销售之前产生的费用，也是需要先投入的，一般是在$1~$2/件。</p><p>综合上面提到的费用，个人觉得，刚开始投入2W人民币左右，是比较合适的。等流程跑通之后，个人技能熟悉一些之后，再酌情加大投入。</p>]]></content>
      
      
      <categories>
          
          <category> 亚马逊套利（OA）从0~1教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 亚马逊套利（OA）从0~1教程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>002准备篇之1.0《准备工作之店铺注册整理版—详》</title>
      <link href="2022/091327266.html"/>
      <url>2022/091327266.html</url>
      
        <content type="html"><![CDATA[<h1 id="002准备篇之1-0《准备工作之店铺注册整理版—详》"><a href="#002准备篇之1-0《准备工作之店铺注册整理版—详》" class="headerlink" title="002准备篇之1.0《准备工作之店铺注册整理版—详》"></a>002准备篇之1.0《准备工作之店铺注册整理版—详》</h1><p>更新于：2022-03-14 8:56:27</p><p>一、公司注册</p><p>亚马逊目前不支持个人卖家入驻，所以需要大家提前办好公司或个体工商户的营业执照。</p><h2 id="1-营业执照类型"><a href="#1-营业执照类型" class="headerlink" title="1.营业执照类型"></a>1.营业执照类型</h2><p>关于营业执照类型，@ 吉吉吉 同学说：</p><p>1.1个体工商户</p><p>每个城市的政策不太一样，办理前可以了解下自己的城市是否支持使用居住地址办理个体工</p><p>商户，如果可以的话自己申请办下来就好。现在有很多地方是可以在网上办事大厅申请完成，最后邮寄到家里的，简单方便。另一种方法是在淘宝找服务商，直接搜索你要办理的城市+个体工商户，他们会帮你处理好地址、申请的问题，最后邮寄到家。</p><h3 id="1-2有限公司"><a href="#1-2有限公司" class="headerlink" title="1.2有限公司"></a>1.2有限公司</h3><p>注册公司营业执照，需要看你是否有商用地址。如果有的话，可以自己申请公司，然后找服</p><p>务商代理记账报税。如果没有，那么也可以找服务商买个挂靠地址。</p><p>注1：@莹莹不冻 同学说：</p><p><strong>关于营业执照：</strong></p><p>1、有可以出具水电账单的地址就千万不要选择挂靠地址。</p><p>2、如果实在没有可用地址，要跟服务商确定挂靠地址是否被其他做亚马逊的人用过。</p><p>3、如果需要注册欧洲站点的话，法人的出资比例最好超过80%，这样在后期提供受益所有人资料的时候会方便很多，不需要每个股东的资料都提供。</p><p>4、如果美日欧都打算注册的话，可以申请合并账号，这样美日欧三个店铺可以每月只扣一份月租费。</p><p>5、有条件的最好在注册店铺之前提前开好水电煤气宽带账单和采购发票，以防店铺遇到二审的时候没有资料申诉。</p><p>6、询问经理后得知可以在后台把办公地址改成自己能提供水电账单的地址，再补开水电账单来过审。（但是，本人实操并没有成功，提供了真实的水电账单+发票；找服务商开了真实可查带发票的宽带账单都没有过审。似乎是被机审了，一直提示说提交的信息不够充分，无法重新激活账户，让再提交资料）</p><p>遇到过的坑：</p><p>挂靠地址是多人共用一个地址，并且不能提供水电账单。我当初报着侥幸心理想着之前注册也从来没有二审过，就选择了挂靠地址。</p><p>并且也把自己选择的服务商推荐给了圈里的其他好友。她先注册的，经历了明信片审核之后就过了。但是我注册美国店铺后不到三小时就触发了二审。后来问服务商才知道，给我们两个人注册营业执照挂靠的是同一个地址。目前遇到二审的美国站点至今都还没通过审核……</p><p>注2：@Jasmine 同学说：</p><p>营业执照被抽查及其他：</p><p>1、办理营业执照过程中被抽查到，需要提供场地使用证明（因为我的是出租房-深圳，有点麻烦）。我首先去的街道居委会拿场地使用证明单，然后去村委盖章，村委那里说我的地址不可以用作办公地址，但是我又不想用挂靠的地址，后面就花钱找代理走的内部渠道，这个花了2500大洋办理下来了。因为我暂时还不打算用这个账户注册欧洲站，不需要办对公账户，否则还得花钱找代理解决。</p><p>2、遇到明信片认证，用中文填营业执照上面的地址。因为我后面搬家了，所以我当时和快递员说里面就是一个验证码，给口令码他帮忙签收,他拆开告诉了我。</p><p>3、店铺下来后上传链接的时候出现5665品牌报错（如果只做OA，自己不上新链接，不会有这个报错）提示： 亚马逊必须先批准您的品牌，然后您才能使用它发布商品。</p><p>解决办法：</p><p>首先联系客服，客服会告诉你需要提供什么信息，然后提交给他们就可以了。</p><p>需要的信息：</p><p><strong>·</strong> 创建链接用的品牌名</p><p><strong>·</strong> 产品或者产品包装上面需要有永久性的品牌名（但是我北美站上产品和产品包装都需要有永久性品牌名；日本站就是产品或者包装其中一个有就行），如果你的产品和包装都有品牌就很好解决，如果没有就去淘宝买那个英文字母贴，然后贴在产品和产品包装上，包装我用的opp袋，产品用的是迷你风扇。</p><p><strong>·</strong> 当然你也可以找服务商去解决，好像几百块；还可以叫供应商印logo,但是他们基本都收200打样费,还要十天半个月的才搞好。</p><h2 id="2-公司注册类别和代记账的方式"><a href="#2-公司注册类别和代记账的方式" class="headerlink" title="2.公司注册类别和代记账的方式"></a>2.公司注册类别和代记账的方式</h2><p>@ 一口大米 同学说：</p><p>关于公司类别：推荐电子科技类或者贸易类公司比较合适。</p><p>关于记账：专业的事交给专业的人去做就好了，能省些时间成本出来。自己申报的话，一定切记不要漏申报，以防后续会受到信用影响。</p><p>PS：</p><p>① 目前个体户的执照，不清楚是否可以注册成功，稳妥起见，还是公司执照靠谱些。</p><p>②官网上提到过营业执照要注册过 45 天，但是听其他小伙伴说，在企查查或者工商注册官网上，能查到你自己的公司之后，就可以进行亚马逊注册了！稳妥起见，还是多等一等，没毛病的。</p><h2 id="3-公司注册案例分享："><a href="#3-公司注册案例分享：" class="headerlink" title="3.公司注册案例分享："></a>3.公司注册案例分享：</h2><h3 id="3-1坐标深圳：（代理注册）"><a href="#3-1坐标深圳：（代理注册）" class="headerlink" title="3.1坐标深圳：（代理注册）"></a>3.1坐标深圳：（代理注册）</h3><p>@风筝 同学说：</p><p>大陆营业执照；地址属于挂靠的，对方可以提供二审所需的水电账单等；</p><p>公司是找代理记账报税的时候帮我免费注册公司的，注册公司不收费，代理记账一年2600，专事交给专人负责，自己可以省去很多麻烦。深圳不知道是不是今年比较严格，我跟我朋友基本都中奖要去GSJ实审，就是去到那里拍照跟签字，过程很快；</p><p>解决银行U盾问题，这个现在很多银行都会说没货，比较难办理，后悔之前银行开户的时候没有要U盾（现在银行开户听说也挺麻烦的），后面只能线下申请CA证书（法人必须在深圳办理U盾/申请CA证书，二选一，深圳这边需要一个监事，监事也需要有U盾或CA证书），CA证书到指定点去申请办理就好，办理1年就可以了，100一年。</p><h3 id="3-2坐标北京-西安："><a href="#3-2坐标北京-西安：" class="headerlink" title="3.2坐标北京+西安："></a>3.2坐标北京+西安：</h3><p>@知言 同学说：</p><p><strong>·</strong> 因为我人在北京，公司办理这块淘宝上找过北京的，北京开公司，地址是3300元/年，代理记账2400元/年，合计5700元/年。自己提供地址的话是500元，一次性费用，不过得是商住两用房才可以（商业地址）。还是蛮贵的，所以最后选择在老家办理了，在老家办理可以用住宅地址，费用也便宜。</p><p><strong>·</strong>也了解过西安的，西安开公司，目前不能用虚拟地址了。地址选择挂靠地址的话，费用是2000元/年；如果是自有地址的话，不花钱，不过自有地址需要有个地址有个办公桌形式的空间，会有人来核查（可以是住宅地址），代理记账的费用是2400元/年（一个月费用是200元）</p><p><strong>·</strong> 公司类型，推荐用贸易或网络科技公司的。关于公司经营范围，如果不确定的话，可以到亚马逊上查查别人家是怎么写的，具体如下图：</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%871-1.png" alt="img"></p><p>获取他家的统一社会信用代码</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%872-1.png" alt="img"></p><p>然后企查查之类的查询下</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%873-1.png" alt="img"></p><h2 id="4、注册渠道："><a href="#4、注册渠道：" class="headerlink" title="4、注册渠道："></a>4、注册渠道：</h2><p>@刘小青chitsing 同学说：</p><p><strong>·</strong> 如果自己有商用地址,直接去工商局注册即可，免费。不过得人工多跑几次。(部分城市支持民用居住地址注册，建议咨询当地工商局，或者当地工商网站)</p><p><strong>·</strong> 如果自己没有地址的话，可以直接TB购买相应服务。一般注册免费或者200块钱以内。税务记账大概一年2400左右。地址分能开票的地址和不能开票的地址。能开票的地址大概3000左右一年；</p><p><strong>·</strong> 不能开票的地址大概1500左右即可。刻章大概200-600。加起来费用大概3000-5000不等。也有些人注册义乌个体户，超便宜。</p><p><del><strong>·</strong> 也可以在腾讯云,阿里云,里面选择工商注册，然后注册云上公司。费用基本上2500-4000左右。包含一年记账，地址，注册，刻章，银行开户等。</del></p><blockquote><p>上面的云上公司经核实，并不可以做亚马逊、TikTok、Shopee等电商</p><p><img src="http://5coder.cn/img/1663207071_49241adb071afeb0cdf28fcb925dac89.png"></p></blockquote><p>我自己在广州,没有商用地址,所以采用的在腾讯云注册云上公司的方式。大概花了2周的时间下证。</p><p>店铺注册前需知</p><p>@ Tiffany 同学 帮我们具体罗列了该注意的事项：</p><h2 id="1、账户关联"><a href="#1、账户关联" class="headerlink" title="1、账户关联"></a>1、账户关联</h2><p>亚马逊规定一个卖家（即一个营业执照）只能拥有一个店铺。如果亚马逊判定多账号为同一个卖家操作，就产生了关联。</p><h2 id="2、亚马逊为什么会禁止多账户操作"><a href="#2、亚马逊为什么会禁止多账户操作" class="headerlink" title="2、亚马逊为什么会禁止多账户操作"></a>2、亚马逊为什么会禁止多账户操作</h2><p>亚马逊一切以买家为中心，如果卖家多账户操作，即使有一个账户违规，卖家也不会太Care，所以它禁止分散风险；同时多个账号卖同一个产品对客户的选择是没有好处的，会产生产品垄断，也不会给买家带来更好的购物体验。</p><h2 id="3、产生关联的后果"><a href="#3、产生关联的后果" class="headerlink" title="3、产生关联的后果"></a>3、产生关联的后果</h2><p>**<br>·** 同站点的关联，且所售卖的产品存在交叉，亚马逊会强制要求你下架新账号的全部Listing。</p><p><strong>·</strong> 任何站点，关联账号中一个被关闭，其它几个也难逃厄运，亚马逊喜欢“秋后算账”。</p><h2 id="4、主要关联因素及预防措施"><a href="#4、主要关联因素及预防措施" class="headerlink" title="4、主要关联因素及预防措施"></a>4、主要关联因素及预防措施</h2><p>**<br>·** 网络关联：每个账户都对应干净的IP地址。</p><p><strong>·</strong> 浏览器指纹关联：亚马逊可以搜集浏览器的数据如插件、系统字体、操作字体、打字方式、打字速度等判断是不是同一个人操作。</p><p><strong>·</strong> 注册信息关联：每个店铺的注册信息必须唯一性，营业执照、电话、邮箱不能相同。</p><p><strong>·</strong> 密码相同关联：每个店铺的账号及密码不能相同。</p><p>综上就是新邮箱、新电脑、新系统、新浏览器、新路由、新宽带、新手机号。</p><ol><li>店铺注册渠道</li></ol><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%874-1.png" alt="img"></p><h2 id="1、（公司）招商经理注册："><a href="#1、（公司）招商经理注册：" class="headerlink" title="1、（公司）招商经理注册："></a><strong>1、（公司）招商经理注册：</strong></h2><p>@ 曼哈 同学友情提示：</p><p>招商注册条件是什么呢？</p><p>首先要说明的是，不是所有的卖家都可以通过招商经理链接注册亚马逊的，像个人或者个体工商执照是不接收的，需要有公司企业的营业执照才可以。</p><p>也并不是所有的营业执照都可以注册，其中营业执照不合规，比如服务类型的，供应链管理，物流，咨询，传媒，教育，广告等，也是不能通过招商链接注册的。</p><p>步骤：</p><p>①、填好公众号里的潜在卖家登记表后或者找熟人推荐的招商经理（需自行斟酌），但是注意不要被骗了，因为也会有人冒充是招商经理来骗取费用。</p><p>注意：通过官方招商经理注册都是免费的。现在有些群里代理冒充招商经理，那些要收费的都是假的。（目前越来越严格了，审核时间可能会比较长）</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%875-1.png" alt="img"></p><p>②、之后招商经理会回复给你一封邮件里面有资料登记的表格，你按说明填写，回复邮件，他审核没问题之后就给你发邀请注册链接（点进去就是亚马逊店铺注册的页面），表格尽量不要填错，经理很少会跟你频繁的邮件往来，建议一次性填写完成方便经理快速发链接给你。（如图是我之前收到的件）</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%876-1.png" alt="img"></p><p>注1：</p><p>@西洲 同学说:</p><p><strong>·</strong> 自注册 or 招商经理：在Q4和Q1招商经理普遍比较好下链接，Q2和Q3不那么容易，所以如果资料真实就自注册也ok。</p><p><strong>·</strong> 招商经理一般是一周内下链接，随时关注，超过14天链接就作废了。这个14天是指特定网络环境下打开那个链接，弄上账户名密码即可（让亚马逊系统知道你在注册过程中就行），而不是必须在14天内完成注册。因为有些人注册过程中会遇到各种各样的问题，注册时间花费的时间都不一样。</p><p>注2:</p><p>@慕德成蝶同学说：</p><p>买的服务商链接（风险高）</p><p>我觉得注册公司麻烦以及公司每年要交那么多费用去养，所以我是直接找的服务商买的营业执照花了600块钱，然后服务商指导我去亚马逊全球开店公众号填开店申请资料，等待一个周左右有开店链接邮件发来，然后按要求填好资料店铺就下来了。</p><p>目前开店不久店铺暂时没问题，服务商说是会提供二审水电煤账单等资料的。</p><p>这样子的账号安全性可能不是很高，但是成本相对还算低，万一出事就当练手了。</p><p>@Tokimhaha同学说：</p><p>不推荐找服务商买链接注册，后期有可能亚马逊扫号，比如每年12 11月旺季的时候很多人重仓的时候，到时候暴雷钱都取不出来。</p><p>注3：</p><p>@风扬 同学说：</p><p>借朋友的资料开</p><p>我是6月初借的朋友的营业执照开始注册的。</p><p>前期的准备资料：</p><p><strong>·</strong> 朋友公司的个人独资企业营业执照副本</p><p><strong>·</strong> 法人身份证的扫描件（用的CS这个扫描App，比拍照清楚点）</p><p><strong>·</strong> 自己的双币信用卡visa/mastcard</p><p><strong>·</strong> 新的邮箱</p><p><strong>·</strong> 全新的笔记本</p><p><strong>·</strong> 网络是办了张电信的上网流量卡开手机热点，基础套餐费用好像是16元，然后800M/元/天</p><p><strong>·</strong> 收款卡WF卡费率0.3%</p><p>接下来就是自注册啦</p><p>值得注意的是前不久朋友变更过经营地址，还好注册前和他再确认了一遍资料，注册过程中地址要和营业执照一致并能收到明信片地址验证码或者自己没办法收到的，就让快递小哥打开告诉你验证码，公司名称和地址全部用拼音写。</p><p>绑信用卡的时候填营业执照法人也就是我朋友的名字，但是实际上却是填我自己的卡号。</p><p>对了，联系电话也是填我自己的电信卡的。</p><p>剩下的就是一步步按照步骤走了，到了最后一步，需要明信片地址验证，填的是营业执照的地址和法人收件，但是号码是我自己的，填了后，在亚马逊后台可以看到物流状态到哪了，2天就收到了，亚马逊会发个验证码到你的联系手机上告诉快递小哥签收，然后让朋友拆开填入验证码，马上就扣了$39.99扣费成功了。</p><p>注4：</p><p>凡天坚心 同学说：</p><p>找服务商买招商链接为什么说是个大坑呢，因为服务商给的链接可能是用黑科技反向生成的链接，不是招商经理给的。2020年8月，亚马逊有一次大规模的扫号二审事件，网络上流传的原因是这个黑科技。不幸我也中招了。</p><p>听说很多卖家的账号要不回来就放弃了。不过我不想放弃，首先和服务商确认，不管怎么他也不招，只说链接没问题，是通过招商经理给的姑且相信他吧，不管有没有可能救回来，不妨试试。二审的过程漫长，内心很煎熬，前后提交了6次资料，终于二审通过了。</p><h2 id="2-（公司）个人自注册："><a href="#2-（公司）个人自注册：" class="headerlink" title="2.（公司）个人自注册："></a><strong>2.（公司）个人自注册：</strong></h2><p>@IRI 同学说：</p><p>做OA，建议自注册。</p><p>阅读官方文件：登录gs.amazon.cn，找到我要开店一栏，里面需要准备的资料，和流程比任何一篇攻略文都要清楚明白准确！跟着做就好啦。</p><p>@olin 同学说：</p><p>我是自注册的。也有找过招商经理，但招商经理那边说没有美国商标是不给你下链接。所以就自行注册了。用来OA的自行注册也没有问题的，不参加BD也没事。用的是紫鸟浏览器注册。但有些说不要用VPS和紫鸟注册，目前我的账号没有问题，可以自己选择哈。</p><p>注册前准备的内容有营业执照+VISA卡+第三方收款方式+邮箱</p><p>邮箱和营业执照是需要全新的，第三方收款方式去官方拿经理的联系方式有特殊的汇率点，我自己用WF。注册时候填写的美国银行内容可以咨询经理是怎么填写法，他会跟你讲的；VISA卡我用的是广发，找的广发业务员上门办理的两张卡，一张VISA一张国内白金卡，很快，3天就下卡了。</p><p>自注册最主要的是视频认证。</p><p>100%触发。先是地址验证，我写的不是营业执照的地址（因为是挂靠地址，没办法收到邮件的），写家里的就可以，USPS寄上海再寄过来，大概也是2-3天左右，实在收不到就叫快递小哥签收后拆开，要里面的一个码就行了。</p><p>就等视频认证。紫鸟方的话需要跟紫鸟约，开VPS去认证。最麻烦的是设备问题，请一定一定！！要测试视频+音频。我用了4台设备才可以，最好就用安卓手机去认证，电脑版很复杂。</p><p>注：</p><ul><li><p>上传身份证+营业执照一定要清晰，资料是等视频认证再审核的，一定要传高清图，而且视频强制30分内完成！过了就要约下一次了！！！</p></li><li><p>紫鸟那边开VPS也是有时间的，记得跟紫鸟那边沟通说还没认证过。</p></li><li><p>认证的内容很简单：也是验证身份证和营业执照，讲普通话的，不用太紧张。</p></li><li><p>验证过了，等个半小时就扣费成功就能进去了，然后进去账户里完善一下基本资料就开通成功了！</p></li></ul><h2 id="3-个人卖家自注册："><a href="#3-个人卖家自注册：" class="headerlink" title="3.个人卖家自注册："></a><strong>3.个人卖家自注册：</strong></h2><p>@Zora 同学说：</p><p>我是个人注册卖家，历经两周完成了注册。</p><ul><li><p>输入邮箱、密码之后，需要选择企业或个人。因为我没有注册公司，直接选择了个人；</p></li><li><p>选择个人之后，需要输入个人的身份证信息，地址填家里，付款方式（双币卡），收款账号；</p></li><li><p>最后税务信息选择了非美国籍，就不用提交税务信息。</p></li><li><p>历经两周是因为需要提交身份证照片、双币卡账单对账单。双币卡账单需要三个月内的，我只有中行万事达，为了出国旅游办的卡，从来没有消费过，而且要求必须纸质账单。当时银行不肯给我寄纸质账单，只有电子账单。我就把账单打印出来再拍照上传。</p></li><li><p>注册的时候，基本每走一步都停留了好几天。途中去了解如何注册亚马逊店铺，才知道亚马逊店铺需要准备很多东西。但是已经开始注册了，不可以重选，就硬着头皮注册下去了。</p></li><li><p>对于付款账号，当时疑惑了很久，已经给了信用卡为什么还需要付款账号，后面才明白发现这是给亚马逊打钱过来的账号。</p></li><li><p>我是全程拼音注册，后面随便翻看账号信息的时候，发现亚马逊把我中文名字搞错了，就重新添加了另一张付款账号。</p></li><li><p>提前把水电账单准备了。亚马逊还没有用上水电账单，但是PayPal用上了。前一阵完成了明信片验证,希望能平安渡过,不要碰上二审。</p></li></ul><p>注：@Emma 同学说：</p><p>注册个人卖家的话，到最后一步需要到跟亚马逊预约面签验证；并且相比较企业卖家账户来说，个人可能被审核的几率更大点。</p><h1 id="二、注册指南"><a href="#二、注册指南" class="headerlink" title="二、注册指南"></a>二、注册指南</h1><p>@ 小秋 同学，友情赞助了我们注册指南</p><h2 id="1-注册新变化"><a href="#1-注册新变化" class="headerlink" title="1.注册新变化"></a>1.注册新变化</h2><p>亚马逊的注册规则一直在变化，难度也越来越大，因此建议及早注册，说不定哪天能用上呢。</p><h3 id="1-1自注册"><a href="#1-1自注册" class="headerlink" title="1.1自注册"></a>1.1自注册</h3><p>之前网上攻略大多推荐通过招商经理注册，但今年开始，招商经理不再接受普通卖家（需要有工厂资源），而且寻找招商经理需要时间，招商经理链接要7天才能下来，自注册准备好资料，2-3天就能完成。从成功率上说，之前网上有说自注册通过难，但自身和群里小伙伴的实践结果是通过率挺高的。</p><h3 id="1-2收款方式"><a href="#1-2收款方式" class="headerlink" title="1.2收款方式"></a>1.2收款方式</h3><p>这个部分也是最近调整，之前网上攻略是注册的时候是可以跳过，等注册完成后补充。但我实操的时候发现并不能跳过，而且是要填写法人或者公司抬头的账号，但这个部分可以先填写，等店铺注册下来之后改变收款方式。</p><h1 id="三、资料准备"><a href="#三、资料准备" class="headerlink" title="三、资料准备"></a>三、资料准备</h1><p>1、资料准备</p><p>@ WanTing 同学， 感谢提供如何详细的信息准备清单：</p><ul><li><p>注册账号的地址：<a href="https://gs.amazon.cn/sign-up.html">https://gs.amazon.cn/sign-up.html</a></p></li><li><p>亚马逊注册模拟网站：<a href="https://sellercentral.amazon.com/">https://sellercentral.amazon.com/</a></p></li></ul><p>（注意：有些内容跟现在是不一样的，只当练手可以，比如里面要求说写英文信息英文地址，但是当我实际在用国内的营业执照注册时，一开始填的都是中文信息中文地址，但是不要慌，你才是对的）</p><p>（资料信息必须从未注册过亚马逊任何一个站点的）</p><h3 id="1-1公司营业执照彩色扫描件：必须由中国大陆-中国香港-中国台湾出具"><a href="#1-1公司营业执照彩色扫描件：必须由中国大陆-中国香港-中国台湾出具" class="headerlink" title="1.1公司营业执照彩色扫描件：必须由中国大陆/中国香港/中国台湾出具"></a>1.1公司营业执照彩色扫描件：必须由中国大陆/中国香港/中国台湾出具</h3><p>①中国大陆企业∶营业执照</p><p>②中国香港企业∶公司注册证明书和商业登记条例</p><p>③中国台湾企业：有限公司设立登记表/股份有限公司设立登记表/有限公司变更登记表/</p><p>股份有限公司变更登记表</p><p>中国大陆营业执照距离过期日期应超过45天，中国香港商业登记条例距离过期日期应超过45天</p><p>注：@刘小青chitsing 同学说：</p><p>办公地址可以填写非注册公司的地址。但这个地址最好能弄到地址证明,比如房产证,水电煤账单。</p><h3 id="1-2法人身份证彩色扫描件∶"><a href="#1-2法人身份证彩色扫描件∶" class="headerlink" title="1.2法人身份证彩色扫描件∶"></a>1.2法人身份证彩色扫描件∶</h3><p>①身份证上的姓名必须与营业执照上法定代表人的姓名一致</p><p>②身份证件上的姓名应与注册的亚马逊账户上的姓名完全匹配，必须由中国大陆/中国香港/中国台湾出具</p><p>③身份证必须在有效期内</p><p>注：法人身份证正反面照片必须为彩色照片或扫描件高清完整，照片缺角缺边不行，黑白的或者屏幕截图不行。@义乌kyle &amp; @Garin 同学</p><h3 id="1-3网络环境"><a href="#1-3网络环境" class="headerlink" title="1.3网络环境"></a>1.3网络环境</h3><ul><li><p>干净的网络环境IP和电脑。网络和电脑之前都没有注册过亚马逊店铺。注册时开手机热点作为网络，稳妥。（不建议用紫鸟浏览器）</p></li><li><p>切记一定要关闭VV （VV上网提子软件）。我的做法是要注册店铺之前先重启电脑关闭后台所有进程，开电脑以后把需要文件打开准备好，连手机热点再开始注册。</p></li></ul><h3 id="1-4收付款账号"><a href="#1-4收付款账号" class="headerlink" title="1.4收付款账号"></a>1.4收付款账号</h3><ul><li><p>付款账号：双币信用卡 带visa或master标志的信用卡（是不是法人的 不重要、我用的是招行的，招行的基本上3-4天就搞好寄出来了，信用卡要激活消费）</p></li><li><p>收款账号：万里汇worldfirst、派安盈payoneer(P卡)、Pingping、连连支付</p></li></ul><p>@ WanTing 同学还说，我用的是万里汇。</p><p>流程：注册账号-认证个人信息（选择企业或个人都可以，我用的人）– “申请新的收款账户” – 店铺选亚马逊和选站点-店铺名（自己能识别就好,不重要）– 申请 – 点“”店铺管理“”能看到账号信息</p><p>申请后会得到需要的收款账户信息：</p><p>①银行名称Bank Name</p><p>②汇款路线号码Routing Number</p><p>③账户号码Account Number</p><h3 id="1-5个人资料和地址"><a href="#1-5个人资料和地址" class="headerlink" title="1.5个人资料和地址"></a>1.5个人资料和地址</h3><ul><li><p>全新的邮箱。百度查的建议尽量不要用qq和163。（我用的outlook邮箱，注册网址<a href="https://www.microsoft.com/zh-cn/%EF%BC%89">https://www.microsoft.com/zh-cn/）</a></p></li><li><p>手机号码。没有注册过亚马逊的号码，没有的话用“和多号”或想想办法</p></li><li><p>确认一下公司地址的邮编。</p></li></ul><h3 id="1-6完善信息表"><a href="#1-6完善信息表" class="headerlink" title="1.6完善信息表"></a>1.6完善信息表</h3><p>基本要用到的信息这里都有，事先准备好所有信息。（但是在注册的时候我是手动输入，然后再对照信息表和图片一个一个核对清）</p><ul><li>把所有信息都填好，中文和英文都要核对</li><li>把营业执照、法人身份证、银行卡、收款账号的截图，全部放在表格里，填的时候可以再次再次核对（我就是在再次核对的时候发现错别字的o(╥﹏╥)o）</li></ul><p>大家可以参考一下信息表，<a href="https://docs.qq.com/sheet/DT2NHYlpHU3RNY21P?tab=BB08J2">戳这里</a></p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%877-1.png" alt="img"></p><p>另外，@ WanTing 同学还给我们做了小笔记：</p><p>有一些小细节的问题在表格里写明了，比如：</p><ul><li>企业名称的英文：直接拼音小写无间隔，怕错可以用这个拼音转换网站：<a href="https://www.aies.cn/pinyin.htm">https://www.aies.cn/pinyin.htm</a></li><li>公司地址：</li></ul><p>中文：按照营业执照上的地址完全一模一样</p><p>英文：不一样，要从小到大，从尾巴开始，直接拼音直译 带空格 如：几号 几房 什么单位 什么街道 什么镇/区 什么市 什么省（地址要逐字逐字核对清楚，不要有错别字，不要被同音字给搞混了）</p><ul><li>信用卡的账单地址：建议添加不同的账单地址，要是有二审的话要提供水电煤网的账单时可以用到，写你有水电煤网账单的地址</li><li>永久地址：要同公司地址一模一样，断点也是一样的，写的时候可以截图保存可以对照着看</li><li>英文名字: first name 是名，last name是姓，跟我们中文的书写习惯是反过来的</li></ul><p>另外，关于文件资料，亚马逊的邮件是这么说的，可以看一下：（注册店铺主要看1-3点的要求，4和5暂时不重要）</p><p>以下指南为卖家常犯错误提醒。请确保您的文档符合审核标准：1. 对于居民身份证，请将您身份证正反两面的彩色扫描件或照片合并在同一个文档中提交。2. 所有文件必须完全清晰可读，没有任何模糊信息或相机闪光灯反射。3. 您在验证页面中输入的信息（例如您的身份证号、姓名、出生日期、营业执照的统一社会信用代码、公司名称）必须与您所提交文件中的信息一致。4. 当我们要求您提供银行账户或信用卡账单时，我们不会接受网络截图形式的文件。账单文件除保证完整、清晰之外，还必须包括：1. 银行的名称、标志（公章）2. 账户持有人的姓名3. 账单开具日期（必须在过去 90 天内开具）5. 我们目前不接受以下类型的文件：1. 我们目前不接受以下类型的文件：2. 银行开户证明3. 银行存折4. 水电费账单（例如电费或天然气费）5. 信用卡的照片6. MS Word 格式的任何文件（.doc 和 .docx 文件扩展名）</p><h2 id="2-注册注意事项："><a href="#2-注册注意事项：" class="headerlink" title="2.注册注意事项："></a>2.注册注意事项：</h2><ul><li><p>注册过程不可逆，但是可以中断，也就是可以离开一段时间然后回来用正确的注册邮箱和设置好的密码登陆继续注册。如果遇到无法登陆的情况请确定网络环境稳定，可以尝试清除浏览器Cookie，更换浏览器</p></li><li><p>除了注册过程中特别要求以外，所有填的信息都使用拼音或英文填写</p></li><li><p>营业执照在帐户运营期间不要注销，否则后期会触发审核</p></li><li><p>所有的注册资料尽量用真实有效的</p></li><li><p>尽量使用本地电脑和单独的网络宽带注册，不要用云服务器/VVV等，后期等账号稳定为了方便管理再去使用超级浏览器之类的软件</p></li></ul><p>注：</p><p>@知言 同学说：</p><ul><li>招商经理邮件给链接（5个工作日内）</li><li>线上注册，走开店流程（一小时左右）</li><li>等待验证（一周左右的时间，具体时间记不清了）</li><li>注册中用到的资料明细如下图：</li></ul><p>注：注册流程是不可逆的，将需要填写的资料提前准备好，核对清楚，到时直接复制即可。</p><table><thead><tr><th>开店准备资料</th><th>具体内容</th><th>填写内容</th></tr></thead><tbody><tr><td>邮箱信息</td><td>通过邮箱，接收招商链接，点开链接操作设密，接收验证码，注册</td><td>自己的gmail邮箱</td></tr><tr><td>联系信息</td><td>手机号、验证码</td><td>自己的手机号</td></tr><tr><td>收款信息（付费用的）</td><td>信用卡卡号、有效期、持卡人姓名</td><td>自己的信用卡（VISA卡）</td></tr><tr><td>存款信息</td><td>银行地址（美国）、账号持有人（填法人）、汇款路径号码、银行账号</td><td>第三方收款方式，我选的万里汇</td></tr><tr><td>税务信息（W-8BEN0E）</td><td>税务分类-业务、是否美国人-否、受益所有人类型-公司、组织名称-公司拼音、永久地址-营业执照上的注册地址、签名-法人拼音</td><td>扣税率0%</td></tr><tr><td>商品信息</td><td>跳过</td><td>跳过</td></tr><tr><td>商品分类信息</td><td>跳过</td><td>跳过</td></tr><tr><td>身份信息</td><td>身份选法人、身份证号、有效期、签发国家、姓名、出生日期</td><td>法人的证件信息</td></tr><tr><td>公司信息</td><td>公司名称、营业执照编号、营业执照地址、办公地址</td><td>法人的公司信息【公司名称用拼音】</td></tr><tr><td>上传文件</td><td>身份证正反面、营业执照</td><td>法人的照片信息</td></tr></tbody></table><h1 id="四、流程"><a href="#四、流程" class="headerlink" title="四、流程"></a>四、流程</h1><h2 id="1-注册概要说明"><a href="#1-注册概要说明" class="headerlink" title="1.注册概要说明"></a>1.注册概要说明</h2><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%878-1.png" alt="img"></p><p>注册美国亚马逊店铺有两种开店模式，有个人的开店计划和专业销售计划。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%879-1.png" alt="img"></p><p>选择哪种具体看自己的计划，这两个计划在卖家后台还可以自由切换。我们这边选择的是专业销售计划，可以用亚马逊的FBA服务。</p><p>准备工作：</p><ul><li>重启电脑 ，不想重启那你一定注意你电脑的翻墙有没有关闭（反正我特谨慎，注册完也重启了）</li><li>打开手机热点，电脑连热点</li><li>打开的页面：邮箱登录 （收验证码）、上面提到的信息表、存放扫描件的文件夹放桌面、手机（收验证码）、登个微信，可以截图和以备不时之需传资料</li></ul><p>浏览器打开注册账号的地址：<a href="https://sellercentral.amazon.com/">https://sellercentral.amazon.com/</a></p><h2 id="2-具体注册步骤："><a href="#2-具体注册步骤：" class="headerlink" title="2.具体注册步骤："></a>2.具体注册步骤：</h2><p>@ 青山 同学赞请赞助详细的注册步骤</p><h3 id="2-1-打开网站-gs-amazon-cn"><a href="#2-1-打开网站-gs-amazon-cn" class="headerlink" title="2.1 打开网站 gs.amazon.cn"></a>2.1 打开网站 gs.amazon.cn</h3><p>打开手机热点，电脑连上手机热点。直接输入网站gs.amazon.cn，点击右上角的“立即注册”，选择“北美注册”。然后再新画面中，点击下方的“创建你的Amazon账户”按钮。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8710-1.png" alt="img"></p><h3 id="2-2-输入姓名和邮箱地址"><a href="#2-2-输入姓名和邮箱地址" class="headerlink" title="2.2 输入姓名和邮箱地址"></a>2.2 输入姓名和邮箱地址</h3><p>分别输入姓名拼音（建议填写法人姓名的拼音）、联系邮箱、设置好密码（记得保存好联系邮箱、登录密码，很重要）。点击下一步之后，亚马逊会向邮箱发一个包含验证码的邮件。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8711-1.png" alt="img"></p><h3 id="2-3-验证邮箱"><a href="#2-3-验证邮箱" class="headerlink" title="2.3 验证邮箱"></a>2.3 验证邮箱</h3><p>去联系邮箱查看，找到亚马逊的验证邮件，里面有6位数字验证码，填回到验证页面，然后点击“创建您的亚马逊账户”，到下一步。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8712-1.png" alt="img"></p><h3 id="2-4-来到设定公司之地类型和名称页面"><a href="#2-4-来到设定公司之地类型和名称页面" class="headerlink" title="2.4 来到设定公司之地类型和名称页面"></a>2.4 来到设定公司之地类型和名称页面</h3><p>公司地址选择 中国，根据企业类型选择，一般就是私有企业。</p><p>然后填写营业执照上的公司名称的汉语拼音，然后把营业执照上的公司中文名称添到下一行，如图所示。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8713-1.png" alt="img"></p><p>友情提示：这里的公司汉语拼音我是这么填写的，比如北京未来城市贸易有限公司，我填写的是 Beijing Weilai Chengshi Maoyi Youxian Gongsi</p><h3 id="2-5-填写公司信息（非常重要的一步）"><a href="#2-5-填写公司信息（非常重要的一步）" class="headerlink" title="2.5 填写公司信息（非常重要的一步）"></a>2.5 填写公司信息（非常重要的一步）</h3><p>公司注册号，填写营业执照上的统一社会信用代码。</p><p>公司地址填写你的实际经营地址，可以和营业执照不一样！一定要确保这个地址可以收到顺丰快递（后面明信片认证要用到，非常非常重要），而且地址可以直接用中文填写。</p><p>选择短信认证，最好是法人的手机号，确保填写正确</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8714-1.png" alt="img"></p><h3 id="2-6-填写法人信息"><a href="#2-6-填写法人信息" class="headerlink" title="2.6 填写法人信息"></a>2.6 填写法人信息</h3><p>按照要求填写法人信息，身份证上姓名用中文写即可。</p><p>我在地址栏，把公司注册地址也加了进去，但还是选择显示前面能收到顺丰快递的实际经营地址。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8715-1.png" alt="img"></p><p>网页最下面的两个方框选项，我都勾选了。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8716-1.png" alt="img"></p><h3 id="2-7-填写收款账户和付款信用卡信息"><a href="#2-7-填写收款账户和付款信用卡信息" class="headerlink" title="2.7 填写收款账户和付款信用卡信息"></a>2.7 填写收款账户和付款信用卡信息</h3><p>这里我填写的P卡美元账户信息，也是用法人身份注册的P卡</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8717.png" alt="img"></p><p>信用卡信息也可以中文填写，这里要注意收费地址，填写信用卡的账单地址，最好提前把信用卡的账单地址改成前面填写的实际经营地址（也就是能收到顺丰快递的地址），给银行打电话就能改。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8718.png" alt="img"></p><h3 id="2-8-填写店铺信息"><a href="#2-8-填写店铺信息" class="headerlink" title="2.8 填写店铺信息"></a>2.8 填写店铺信息</h3><p>店铺名称用英文填写，后两个问题，都选择其中一部分</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8719.png" alt="img"></p><h3 id="2-9-提交验证"><a href="#2-9-提交验证" class="headerlink" title="2.9 提交验证"></a>2.9 提交验证</h3><p>点击下一页，来到验证页面，在这里确认各项信息。同时上传营业执照、法人身份证正反面彩色扫描件。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8720.png" alt="img"></p><p>友情提示：居住地址和公司地址，可以是同一个。这里的居住地址就是一开始填写的能够收到明信片的地址。</p><h3 id="2-10-明信片认证"><a href="#2-10-明信片认证" class="headerlink" title="2.10 明信片认证"></a>2.10 明信片认证</h3><p>上一步提交完毕后，会来到明信片认证环节。告诉你地址认证码会邮寄到你的地址</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8721.png" alt="img"></p><p>点击确认后，会看到下面这个页面，可以追踪明信片的邮递进度。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8722.png" alt="img"></p><p>我是晚上提交的，第二天就看到手机上有顺丰发出的信息，第三天下午就收到了快递。我让快递小哥直接拆开，拍了照片给我。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8723.png" alt="img"></p><p>填进去验证码之后，就完成了。3天完成了注册。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8724.png" alt="img"></p><h3 id="2-11-邮箱激活邮件"><a href="#2-11-邮箱激活邮件" class="headerlink" title="2.11 邮箱激活邮件"></a>2.11 邮箱激活邮件</h3><p>明信片验证码提供后，身份验证完成，邮箱会收到激活邮件。进邮箱点击链接，激活店铺账户</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8725.png" alt="img"></p><h3 id="2-12-店铺注册基本完成，接着完成两步验证"><a href="#2-12-店铺注册基本完成，接着完成两步验证" class="headerlink" title="2.12 店铺注册基本完成，接着完成两步验证"></a>2.12 店铺注册基本完成，接着完成两步验证</h3><p>这时候，激活链接会转到新的页面，还要进行一个两步验证（亚马逊的风控真的很严格）。</p><p>很简单，其实就是让你同意登录账户的时候，给你的注册手机号发一个登录验证码，保障账户安全。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8726.png" alt="img"></p><p>注意：填写之前的联系电话，记得把区号选成+86。</p><p>然后第二步，直接勾选下面的，就可以了。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8727.png" alt="img"></p><p>到这一步店铺就算是注册好了！！！可以开心一下！！！</p><p>注：@圆圈 同学说：</p><p>拿到新号后，7天内不要使用VPS或者VPN登陆，先养养号，不然会很容易触发二审。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8728.png" alt="img"></p><h1 id="五、完善工作"><a href="#五、完善工作" class="headerlink" title="五、完善工作"></a>五、完善工作</h1><h2 id="1、税务"><a href="#1、税务" class="headerlink" title="1、税务"></a>1、税务</h2><p>细心的朋友会发现，税务和收款方式是红色的，还需要完善。</p><p>点进去税务，是下面这个图片</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8729.png" alt="img"></p><p>根据页面提示，个人和独资公司选择“个人”，我的是有合伙人的有限公司，就选择了“业务”。</p><p>不是美国人，诚实回答即可。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8730.png" alt="img"></p><p>检查一下组织名称，默认拼音，不用管。</p><p>重要的是看一下红圈里的内容，要改成拼音，把营业执照上的地址用拼音写一遍。</p><p>邮编的邮寄地址，去掉同永久地址，新添加上那个能收到明信片的地址即可。</p><p>然后就可以了，会看到下面这个页面。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8731.png" alt="img"></p><h2 id="2、收款"><a href="#2、收款" class="headerlink" title="2、收款"></a>2、收款</h2><p>收款信息完善比较简单，因为注册的时候已经填写过P卡，所以点击后直接分配账户即可。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8732.png" alt="img"></p><p>个体户注册店铺指南</p><p><a href="https://alidocs.dingtalk.com/core/api/resources/22f26676-9d76-49e9-a5d2-234f7c7cb1e9/detail">个体户营业执照怎么注册店铺，全解.pdf</a></p><p>收款方式之万里汇</p><p>@ tune 同学，感谢提供收款方式之万里汇信息</p><p>注册好店铺后，就可以设置第三方收款，这里以万里汇为例。万里汇可以是个人身份申请的账号。</p><p>只所以选择万里汇，是因为可以提现到支付宝比较方便，毕竟是阿里旗下的。</p><p>第一步：打开亚马逊店铺的添加新的存款方式的页面</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8733.png" alt="img"></p><p><a href="https://www.worldfirst.com.cn/cn/?default_source=WF-1v000030HhM1">https://www.worldfirst.com.cn</a></p><p>第二步：打开万里汇，切换到相应的货币账户信息：方框标记的分别是银行识别代码和银行账号</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8734.png" alt="img"></p><p>第三步：将万里汇的相应货币账户信息填入亚马逊中即可，姓名是你的万里汇个人资料中的英文名</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8735.png" alt="img"></p><p>所以第三方收款也是比较easy的。</p><h1 id="六、明信片地址验证"><a href="#六、明信片地址验证" class="headerlink" title="六、明信片地址验证"></a>六、明信片地址验证</h1><p>完成注册信息的录入以后就等亚马逊给你邮寄验证码</p><p>是从上海发出的顺丰快递，一般2-3天就能收到，可以在手机微信绑定“顺丰速运”，可以跟踪到物流信息，派送当天你会收到一个“口令签收码”（或语音电话通知），到时候告诉顺丰这个码就能签收了。这个地址一般是公司的经营地址，亚马逊就是为了验证地址是否属实</p><p>收到明信片，把上面的验证码输入到如下图的输入框中，点“提交”就验证好了。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8736.png" alt="img"></p><h1 id="七、视频电话验证"><a href="#七、视频电话验证" class="headerlink" title="七、视频电话验证"></a>七、视频电话验证</h1><h2 id="1-注意事项："><a href="#1-注意事项：" class="headerlink" title="1.注意事项："></a>1.注意事项：</h2><p>\1. ）约好之间之后，到时候⻚⾯上会有⼀个“进⼊视频验证”的⼊⼝，到时间之后就可以</p><p>点击，否则不能点击。</p><p>\2. ）最好在视频验证之前先测试⼀下⻨克⻛和摄像头有没有问题。</p><p>\3. ）要把握整体的时间，整个时间只有半⼩时，超过时间之后就要重新约时间，这半⼩</p><p>时包括重新上传证件、⽿机摄像头调试时间等等。错过了可以重来，这个环节对时效</p><p>性要求⽐较⾼。所以我们还是谨慎⼀点。</p><p>\4. ）其他环境准备：把⾕歌浏览器、⽕狐浏览器（这两个是视频验证时，亚⻢逊和我说的兼容⽐较好的）都准备好，⼿机也可以接⼊视频验证，</p><p>但是⼀定要是这两年新的机型，以前的机型不可以。</p><h2 id="2-流程"><a href="#2-流程" class="headerlink" title="2.流程"></a>2.流程</h2><p>整个视频通话验证出境流程大概是：</p><p>1.念出名字，先举身份证，后面举营业执照，审核员都会相应截屏的，我整个流程就5分钟</p><p>2.出境不会问地址的，出境是为了资料真实性</p><p>3.然后审核员告知前面资料都审核通过了，然后后面转给其他审核组审核，没问题的话，几分钟后店铺就注册好了</p><p>注：</p><p>视频验证的时候注意不要用紫鸟浏览器，小编环境是Mac，然后无法加入视频通话验证，后面换成了chrome浏览器可以了。</p><p>为了店铺独立及安全性，后续店铺可以用紫鸟浏览器登录。</p><p>注：@i 同学 说：</p><p>我的是视频验证+地址验证。</p><p>地址验证应该大家都会有的，不过这个送验证码的快递也是有点坑的，送到了一点电话或者短信提醒都没有，害我白白浪费了几天，所以大家还是要时不时的上线看下后台显示的快件状态，如果实在寄丢了找不到，就尽快让系统重寄一份，重寄一份的话，之前那份的验证码就无效了。</p><p>接着就是视频验证了，我是没有一次性完成。。。</p><p>视频验证需要的资料（法人出席）：法人身份证/驾驶证/护照（三选一，是政府开具的有生日有照片有地址的证照就好）、营业执照</p><p>视频验证需要的资料（法人不出席，主要联系人代出席）：法人身份证/驾驶证/护照（三选一，是政府开具的有生日有照片有地址的证照就好）、营业执照、主要联系人自己的身份证、法人授权书、手机上可以查询到与该公司的社保关系。</p><p>约好视频验证的时间后，到那天只要提前5分钟左右从后台进入视频验证地址就好。你只要半小时时间，多一分钟都没有，所以该准备好的东西提前准备好。</p><p>如果你有带摄像头的电脑，视频验证前一定要检查清楚，看看视频像素是不是够清晰，你举着身份证、营业执照，这些资料上的文字能否被看清晰！！看不清一切都白搭，就得约下一次，每次要隔一天才能约上，双休日不营业！</p><p>如果你没有电脑，并且你不是法人（就算你是法人，没有电脑，你也得准备2部手机完成视频验证），只是主要联系人，注意主要联系人一定要跟你申请的那个公司有社保上的关系，否则你是不可以代表的！！</p><p>你要准备2部手机！2部！而且参加视频验证的那部一定要是IOS系统，另一部倒是可以安卓，因为这一部只是为了让你在线给客服人员操作你与公司的社保关系。任何截图，照片，纸张亚马逊客服都是不承认的。</p><p>如果你是主要联系人，你还要准备一份中英文版本的法人授权书，邮件里是这么说的，不过视频验证的时候，客服又只是问问你是否得到授权了仅此而已。</p><p>有准备总比没准备好以下附上中英文版本的授权书，授权书最后还要盖上申请公司的公章：</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8737.png" alt="img"></p><p>触发二审该如何做</p><p>@圆圈 同学说：</p><p>二审的核心是要求提供带公司地址的水电煤气账单。如果我们的办公室是租的，一般很难拿到水电煤气账单的，很多都是物业统一去开。如果实在拿不到带公司地址的水电煤气账单的，可以尝试找电信去牵一条宽带，然后拿网费注册登记单来过二审，通过率也是不错的。如果再配上网费的发票，通过率可以高达9成以上。</p><p>@知言 同学说：</p><p>二审准备</p><p>（备用，二审概率不高、下面三个三选一，用于验证公司地址，提供一个公司抬头的账单）</p><ul><li><p>办公室的水电费（水电局开的，不是物业）</p></li><li><p>网费月度账单+发票（网络运营商-移动/联通/电信等开具，这2份材料中至少有一个能体现：公司名+地址）</p></li><li><p>对公账户的账单+开户证明（银行开具，这2份材料中至少有一个能体现：公司名+地址）</p></li><li><p>其他：</p></li><li><p>主要受益人/法人的个人银行账户综合查询凭证</p></li><li><p>公司银行账户综合查询凭证</p></li><li><p>信用卡账单：这里要求后台填写的信用卡账单地址必须是该信用卡账单的真实地址</p></li></ul><p>@难得 同学说：</p><p>需要的资料：</p><p>1、再次提供你的营业执照（真实有效存续）</p><p>要求上传是采取复印件+拍照件的方式，复印要注意，不能用300ppi的分辨率，要求用600ppi的分辨率。把复印和拍照的2张照片合成到一份pdf文档上传。</p><p>营业执照的红章一定要清楚，如果不清楚会界定为作假，所以副本章如果不清楚，请再上传正本，或者电子版的营业执照。</p><p>2、再次提供法人身份证。</p><p>3、重点：公共事业单位账单（真实有效可查）</p><p>用大白话讲就是法人或者公司名下的水电煤网账单。</p><p>距离你提交日，90天内的账单，日期越新鲜越能证明你的地址有效。</p><p>公共事业单位指什么？水务局、供电局、天然气、国家电网、电信，这些都是，需要这些单位出具的账单+发票，欠费通知单也有通过的案例。这就是为什么物业账单不行，因为没有公信力。</p><p>彩色的，盖红色事业单位公章。这两个条件一定要同时满足。你的账单最好是有彩色水印、特定纸张的，这样不容易造假。黑白+红章几乎不过，太容易造假。</p><ol><li><p>户名：法人本人或者注册公司名下的。其他人的，要证明与法人或者是公司关系。</p></li><li><p>地址：一定要匹配后台地址，你在注册时候就会填写两个地址，一个是营业执照上的注 册地址，一个是办公地址。匹配其中一个即可。如果地址不匹配，一定不过。</p></li><li><p>什么账单不行？物业的不行，黑白的不行，超期的不行，地址、户名不匹配的不行。</p></li><li><p>发票的问题，很多人问提供水电煤缴费发票行不，目前看来只提供发票的卖家过审率低，所以我们建议以最完备的方式，水电煤网账单+水电煤发票的形式提供。</p></li><li><p>话费账单的问题，现在明确话费账单不受理，信用卡账单在二审不好用，单独提供已明确 不接受，但是作为辅助账单提供可以。</p></li><li><p>中国电信营业厅开具的宽带业务登记单或账单+缴费发票比较好开具。</p></li></ol><p>二审资料提交方式：</p><p>1、直接回复<a href="mailto:seller-performance@amazon.com">seller-performance@amazon.com</a>/co.uk/co.jp的邮件，就是给你发二审邮件的那个邮箱。</p><p>2、二审邮件中会有提交资料链接。点击后在链接内提交。</p><p>二审申诉机会：</p><p>二审一共只有3次申诉机会，第一次不过的时候，就和你的运营经理沟通（每个通过招商经理注册的卖家都有运营经理，不适用于自注册卖家）给他看下诊断下你提供的资料是否有问题。再进行第二次申诉，不要自己同样的资料重复提交，浪费申诉机会。</p><p>二审通过和不通过的标志：</p><p>过审邮件：邮件标题通常是：Your selling on Amazon account has been</p><p>不过审邮件:</p><p>“我们将不再回复您的邮件”是二审死刑的标志，没有申诉机会，准备新的一套资料重新注册吧。</p><p>@晨曦 同学说：</p><p>二审的逻辑：审核你提交的账单地址是否真实，是否和卖家后台地址一致。</p><p>水电费账单要公共事务机构发布的（中国电网，水务局，等，物业开据的不行）建议：</p><p>1、能提供营业执照上名字和地址一致的水电费账单最好。</p><p>2、不能提供营业执照上的地址的账单的话，提供实际办公地址的或者其他地址的账单也可以。但是账单的抬头（公司名）要和营业执照上的抬头一致，然后把后台的地址改成和账单一致的地址（改成一模一样的汉字）。更改方法：卖家后台-账户信息-办公地址</p><p>3、如果实在不能提交公司抬头的账单，有时候提供法人抬头的账单也可以。记得然后把后台的地址改成和账单一致的地址（改成一模一样的汉字）。提供法人水/电/网/煤账单+最好再加一个法人信用卡账单当补充材料。</p><p>4、千万不要P图。千万不要重复提交一般只有3-4次提交机会要好好把握。千万不要催促。提交后等通知，一般5个工作日内会回复。</p><p>5、如果第一次提交资料后给通知让提交更多的资料。我们建议您提交一份新的资料，例如:1) 过去连续3个月的水费、天然气/煤气费、电费或互联网服务帐单，</p><p>或2) 其他证明文件来帮助我们确认您目前的办公或居住地址与您在卖家后台提供的办公地址一致。</p><p>其他建议：从申诉成功率来看。申诉的时候，试试水/电/费账单（任选其2）+产品采购发票。附带发票可以增加一定过审几率。只能说提高，不能保证。</p><h1 id="八、KYC审核"><a href="#八、KYC审核" class="headerlink" title="八、KYC审核"></a>八、KYC审核</h1><p>@ 蜡笔小新 同学，感谢提供KYC案例</p><p>遇到KYC，账号后台如下图所示</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8738.png" alt="img"></p><p>同时，收到邮件提醒，需提供如下资料，如下图所示</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8739.png" alt="img"></p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8740.png" alt="img"></p><p>提供资料和具体要求如下：</p><p>1、公司营业执照副本的公证件和发票；</p><p>一般现在营业执照公证书是必备的，还会碰到户口本公证书，身份证公证书。</p><p>PS：一定要能提供公证处在执行营业执照公证服务时开具的增值税发票。和公证书一起拍照或者彩色扫描并接到一个PDF上传。</p><p>必须是增值税发票（划重点）。</p><p>2、公司地址验证文件；</p><p>使用法人的电信话费发票作为地址证明文件，其中这个地方有个小技巧，就是名称的地方写法人的名字，纳税人识别号填写公司税号，地址填写公司的注册地址；</p><p>@ 蜡笔小新 同学还说：</p><p>另外，有个小细节，公司地址信息填写要规范，与营业执照的地址相符。</p><p>如下是举例规范的正确的地址填写，除了数字外，其他全部是拼音；</p><p>例：广州高新技术产业开发区冬青街88号广东省电子商务产业园8号楼8888号</p><p>例： guangdongsheng guangzhoushi guangzhougaoxinjishuchanyekaifaqudongqingjie88haoguangdongshengdianzishangwuchanyeyuan8haolou8888hao</p><p>拍照要求：</p><p>1、照片拍摄要符合规范，必须横平竖直、图片中间不要有光线阴影；</p><p>2、拍摄的物品（身份证、营业执照、文件）尽可能的放大，但要露出来边；</p><p>\3. 照片最好扫描成文档发送至聊天软件，不要直接发送照片（会压缩）</p><p>KYC审核总结：</p><p>1、只要公司信息真实，遭遇KYC审核也不用慌张，按照Amazon要求规范的提供需要的证明文件即可；</p><p>2、轻易不要修改公司、法人、付款账户等相关信息，很容易触发KYC。</p><h1 id="九、信用卡返现"><a href="#九、信用卡返现" class="headerlink" title="九、信用卡返现"></a>九、信用卡返现</h1><p>@ 印象 同学，还给我们提供了不用信用卡的返现优惠。</p><p>注册信用卡时可以关注一下各银行的返现活动。以下是网友整理的返现活动。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8741.png" alt="img"></p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8742.png" alt="img"></p><p>以上信用卡返现，虽说部分有结束时间，但大多数银行的返现活动以季度为周期，一个季度活动结束后，下一个季度会继续开始，但需要重新报名。所以大家别忘记报名哦。</p><h1 id="十、店铺注册之FAQ"><a href="#十、店铺注册之FAQ" class="headerlink" title="十、店铺注册之FAQ"></a>十、店铺注册之FAQ</h1><p>@ WanTing 同学</p><p>Q：挂靠的或者其他原因不在收件地址，无法本人签收？</p><p>A:</p><p><strong>·</strong> 跟顺丰小哥说你有事不在，短期出差或者其他理由，不在那个地方，告知他签收码，让他帮你打开（虽然他极有可能不同意）</p><p><strong>·</strong> 找个人代签，可以找当地朋友或美团跑腿</p><p><strong>·</strong> 放菜鸟驿站,让菜鸟驿站帮你签收</p><p>@ 吴志清 同学</p><p>Q4: 如何修改亚马逊收款账号？</p><ul><li><p>建议授权子账号来修改，如果删除了，再操作修改一次 （客服回应）</p></li><li><p>修改银行账户之前，可以先开CASE报备一下，然后避开这个风控。亚马逊客服提示可以操作，但是不能保证100%。通过和身边朋友沟通他们有通过这个方法修改成功。</p></li><li><p>收款服务商提醒在打款日的前后三天最好不要操作修改银行账号。</p></li></ul><p>@ 东 同学</p><p>Q：注册成功后，平台什么时候开始收月租费？</p><p>A：你注册成功了，无论是否上架产品，平台马上都会扣月租费。如果短时间内没有运营，可以开CASE申请将你的月租退回来，一般都可以成功。</p><p>@ 东 同学</p><p>Q：如果账号死了，注册这个账号的公司还能用吗？如果不能用，公司怎么处理？</p><p>A：如果账号死了，那么注册这个账号的公司将无法再注册亚马逊的其他任何账号。但仍然可以做其他与亚马逊不相关的平台。如果中长期不想再使用这个公司，要么每年花钱报账养着公司，要么直接注销掉。千万不要放任不管，一旦被列为失信人名单会造成很大的麻烦。</p><p>@ 风筝 同学</p><p>Q：很多小伙伴说为什么开店只想开北美的，最后怎么全开了？</p><p>A：相信很多人是跟着肥肉丸的文章一边看一遍实操的，就一开始这里选择的时候，你如果不是想全部店铺都开，你可以选择这里的某个区域的店铺来开通（每个区域单独一个邮箱注册）：</p><p><a href="https://gs.amazon.cn/">https://gs.amazon.cn/</a></p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/03/%E5%9B%BE%E7%89%8743.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 亚马逊套利（OA）从0~1教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 亚马逊套利（OA）从0~1教程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>07-关键词的调研与布局</title>
      <link href="2022/091329194.html"/>
      <url>2022/091329194.html</url>
      
        <content type="html"><![CDATA[<h2 id="一、什么是关键词？"><a href="#一、什么是关键词？" class="headerlink" title="一、什么是关键词？"></a>一、什么是关键词？</h2><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/%E5%9B%BE%E7%89%871.jpg" alt="img"><br>关键词Search Term是我们天天会说到的，指的是买家在搜索引擎中输入的单词，来表达他们的个人需求。search term里的关键词不是给买家看的，而是给亚马逊系统来收录，给买家搜索的。</p><p><strong>也就是买家用来在亚马逊搜索产品的那些词，就是关键词</strong></p><p>比如说当我们上传产品后，系统是不知道这是一款什么样的产品，系统对产品的识别认知，比较重要的一环就是靠我们lisitng里边的关键词。</p><p>所以，我们镶入什么关键词就关系到我们的产品在亚马逊眼里就是什么样子</p><p>关键词，也可以说是我们产品在亚马逊平台的身份识别器</p><p>精准而正确的关键词会使产品有更多的曝光机会，买家搜索看到产品的几率也会增加</p><p>那么大家说一说，做个调研，关键词是站在用户的角度还是卖家的角度去写？</p><p>关键词一定要基于用户的认知和搜索思维展开，不要基于自己的产品展开。</p><p>比如我们产品的某些工艺，材质，这个我们作为卖家是非常清楚的，作为卖点也是可以，但是是否就代表这个适合作为关键词？</p><p>不一定的。</p><p>如果说这个工艺、材质等等特性恰好是买家非常在意并且会用来搜索的，那么毫无疑问作为产品关键词是OK的。</p><p>但是如果工艺是买家不会搜索的词，仅仅是我们自己对产品非常了解或者作为了卖点使用，就认为某个词也是关键词的话，那客户的点击率也就可想而知了。</p><p>比如说衣服的工艺有裁剪、缝合，我们在网上买衣服一般都不会去搜这些，而是会搜索男士外套，女士裙子等等是吧。</p><p>又比如，对我们普通人来说，我们想在买一瓶水，肯定是直接搜索纯净水或矿泉水，很少人会把“水”说成“H2O”。</p><p>另外关键词要符合外国人的语言习惯（产品特性、亮点等也一样），我们可以参考当地门户网站，模仿外国出名的购物网站产品的标题。</p><p>可以在这些网站上搜索跟自己类似的产品，看别人的标题是什么，一般都是比较符合外国人搜索习惯，同时我们也可以把买家的评论作为参考词</p><p>买家会使用的词，一般来说是比较care 的词</p><h3 id="关键词类型："><a href="#关键词类型：" class="headerlink" title="关键词类型："></a><strong>关键词类型：</strong></h3><p>关键词主要可以分为主关键词（大词），精准词以及长尾词。</p><h4 id="主关键词"><a href="#主关键词" class="headerlink" title="主关键词"></a><strong>主关键词</strong></h4><p>通常流量巨大大，但是非常泛。比如说移动电源 portable charger</p><p>· 是最能简单直接的反映出产品主要属性的名词。</p><p>· 搜索效果上一般是大词，热词，很多大卖家都会使用。</p><p>· 主关键词一般是由1-3个单词组成，一般不超过3个单词；</p><p>· 直接直观反映这个产品的单词或者词组。</p><h4 id="精准词"><a href="#精准词" class="headerlink" title="精准词"></a><strong>精准词</strong></h4><p>属于中部出单词，加了定语修饰成份。或指向特定的客户群体。</p><p>如portable charger for iphone ， watch band for men</p><h4 id="长尾关键词"><a href="#长尾关键词" class="headerlink" title="长尾关键词"></a><strong>长尾关键词</strong></h4><p>· 比精准关键词更精准的词，既符合产品特征又符合客户精确搜索习惯。</p><p>· 从长尾关键词上体现出来的信息，可以有产品的款式、颜色、材质、功能、包装、用途以及其他方面的优势。</p><p>· 长尾关键词主要是根据主要关键词延伸的长尾词，一般有3-5个单词组成。</p><p>比如，移动电源，主要关键词/核心关键词是portable charger，但25000mah Waterproof portable charger很明显就是一个比较精准的长尾关键词。</p><p>长尾关键词相对于主关键词来说，搜索量较小，但产品匹配度更高，转化率更好。</p><h2 id="二、A9算法下的关键词"><a href="#二、A9算法下的关键词" class="headerlink" title="二、A9算法下的关键词"></a><strong>二、A9算法下的关键词</strong></h2><p>我们都知道需要通过在产品listing里设置关键词， 然后Listing会被亚马逊系统收录，</p><p>当买家通过这些关键词搜索产品的时候，就会顺利的展现出来。</p><p>但我们的产品具体会出现在第几页，在什么位置，那么，就要看我们的Listing的销量和质量表现决定</p><p>亚马逊关键词优化 → 优化亚马逊Listing →更好的排序 →更多的曝光展现 → 更多转化销售</p><p>而判断亚马逊关键词优化的就是亚马逊A9算法</p><p><strong>亚马逊A9算法是什么？</strong></p><p>亚马逊搜寻引擎我感觉跟我们在淘宝搜索购物其实也是差不多的。</p><p>买家在搜索框上输入一个搜索词，就能得到一连串的结果。</p><p>一般来说，我们也大都只会点击排在最前面的几个结果，或者看前几页</p><p>而越往后，点击概率越低</p><p>我们的Listing在亚马逊排名越前面，就能卖出更多产品</p><p>反之，如果我们的排序在越后面，产品被卖出去的可能性也就越小了。</p><p>亚马逊对不同的排名是有一定的流量分配的。</p><p>亚马逊一般只给大类前20页产品曝光机会，后面基本上没有什么销量和曝光。</p><p>那么20页大家知道大概有多少个产品吗？</p><p>差不多400个产品。</p><p>一些小分类大部分产品出单都在前三页，亚马逊就是公平的给这400个产品展示的机会。400名以外的产品基本上出单就非常少了。</p><p>所以，如果我们的关键词没优化好，那将失去很多潜在商机</p><p>使用无痕模式去搜索关键词，这样结果更加精准。我们站在亚马逊的角度考虑，A9算法的目的就是获得最大销量.</p><p>因为只有销售产品了，亚马比逊才能赚拥金，FBA配送费用那些只是光光高BID去跑广告但也不出单的产品，亚马逊虽然也可以赚钱，但其实是不喜欢的这样的店铺的。</p><p><strong>有同学可能会问为什么呢？</strong></p><p>高价推广告亚马逊不是也可以赚钱嘛。但亚马逊的宗旨不是这样的。亚马逊是用户第一为原则的平台，</p><p>我们烧了广告，亚马逊起初也给了流量，但是无转化，说明用户不喜欢。所以亚马逊就会判断我们的产品为不受欢迎的产品，最后导致很多同学说的，广告花不出去的情况。</p><p>其实亚马逊的用户可以分为三大块来看：买家、卖家、平台</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/%E5%9B%BE%E7%89%872.jpg" alt="img"></p><p>买家来到亚马逊，只为了一个目的，她想要买东西！我们卖家，只想卖产品。而亚马逊平台呢，要赚钱，还有留住买家，三者结合起来的一个共同点就是：</p><p>有订单！</p><p>所以亚马逊A9算法，会根据数以亿计的大数据运算，找出「最有可能」产生订单的产品，放在第一个搜寻结果上。「第二可能」的产品放在第二个，以此类推，亚马逊是没有完整公布A9算法是如何决定搜寻关键词排序。</p><p>但我们根据运营经验，总结出几个最关键的要素，掌握这些A9算法的关键要素也可以帮助我们来提升亚马逊Listing转换率以及销售。</p><h4 id="影响关键词排名的几个因素："><a href="#影响关键词排名的几个因素：" class="headerlink" title="影响关键词排名的几个因素："></a><strong>影响关键词排名的几个因素：</strong></h4><h5 id="1-关键词相关性"><a href="#1-关键词相关性" class="headerlink" title="1. 关键词相关性"></a><strong>1. 关键词相关性</strong></h5><p>「相关性」是一个决定排序的关键因素</p><p>实际上，如果我们关键词相关设定的好，不只在亚马逊，在其他搜寻引擎像谷歌，也都能找到我们的产品</p><p>基本上，我们的产品与关键词相关性越高，我们的排序也会越高</p><p>我们一定要花点时间检查Listing标题、描述或五点，是否与我们的关键词高度相关</p><p>这些都是必须要去做的</p><h5 id="2-转化率"><a href="#2-转化率" class="headerlink" title="2. 转化率"></a><strong>2. 转化率</strong></h5><h6 id="1-销量-（销售金额出单量）"><a href="#1-销量-（销售金额出单量）" class="headerlink" title="1. 销量 （销售金额出单量）"></a>1. 销量 （销售金额出单量）</h6><p>这也是亚马逊A9算法很重要的一个排序因素，产品销售越好，说明产品是越受消费者欢迎和接受的，所以亚马逊在计算分析的时候，会结合这个数字来影响我们的搜索排名，</p><p>比如说一个关键词能出100单，肯定是比出30单的关键词排名要高的。</p><p>A9算法会跟你在同个关键词搜寻下的竞争者比较，谁的销售金额较高，谁较能帮助亚马逊平台赚钱，谁的排序就会胜出</p><h6 id="2-价格"><a href="#2-价格" class="headerlink" title="2. 价格"></a><strong>2. 价格</strong></h6><p>除了销售最热门与最相关的产品外，A9算法同时也考虑商品的价格是否合适。</p><p>但价格因素比较复杂，因为A9算法不只看你的售价是否最便宜，同时也会参考这个价格对整个Listing是否恰当</p><p>虽然以上几个因素是A9算法最重要的因素，但以下几个因素也很重要，都会间接影响到你的关键词排序</p><h6 id="3-CPC广告"><a href="#3-CPC广告" class="headerlink" title="3. CPC广告"></a><strong>3. CPC广告</strong></h6><p>销售速度是目前亚马逊A9算法最重要的排名因素</p><p>但要如何增加销售速度？</p><p>那就是透过亚马逊CPC广告</p><p>你可以持续优化广告转换效果，增加销售速度，获取最大化利润</p><h6 id="4-FBA-Fulfilled-By-Amazon"><a href="#4-FBA-Fulfilled-By-Amazon" class="headerlink" title="4. FBA(Fulfilled By Amazon)"></a><strong>4. FBA(Fulfilled By Amazon)</strong></h6><p>亚马逊FBA是卖家必须考虑的要素，这边不细谈，但当你的商品在任何一个亚马逊仓库有库存时，</p><p>你会被标记为「特色卖家」，并且让你能接触到「Prime 会员」</p><p>这同时也增加了你赢得亚马逊购物车的机会，纵合以上，使用FBA对增加你的销售金额会很有帮助。</p><p>同时使用FBA，也让亚马逊赚钱，这会帮助提升你的排序</p><h6 id="5-图片-高画质-大小与质量"><a href="#5-图片-高画质-大小与质量" class="headerlink" title="5. 图片(高画质)大小与质量"></a><strong>5. 图片(高画质)大小与质量</strong></h6><p>在一个线上销售的平台，卖的不是产品 ，而是图片。因为买家是没有办法直接体验实体商品，图片是唯一能取信他们的机会。</p><p>当然现在有品牌备案的卖家可以加上视频，那就更加直观了。</p><p>明亮、清晰、高画质的图片，加上亚马逊的图片放大功能，我们测试证明对转换率有是有非常大的帮助</p><p>尽可能上传高画质图片，从产品的每个角度拍摄</p><p>可以更有效的帮助亚马逊A9算法增加你的关键词排序</p><h6 id="6-促销"><a href="#6-促销" class="headerlink" title="6. 促销"></a><strong>6. 促销</strong></h6><p>促销是非常有效提升销售速度的方式，</p><p>就是给予产品一个无法拒绝的优惠，可以迅速提升销量，</p><p>这个可以帮助亚马逊关键词排序短暂提升，但并不是一个长期帮助改善排序的策略</p><p>当然我们也不能不考虑成本与利润一味的促销折扣，要有推广节奏</p><p>我们最好还是专注于优化listing,改善关键词相关性,准备足够的库存</p><h6 id="7-商品库存"><a href="#7-商品库存" class="headerlink" title="7. 商品库存"></a><strong>7. 商品库存</strong></h6><p>你一定听过不少培训机构跟你讲，一定要确保库存足够，有想过为什么吗？</p><p>因为这是亚马逊A9排序算法的重要因素</p><p>换句话说，如果你商品爆仓了，你永远不可能排在搜寻最前面</p><p>亚马逊不喜欢平白损失销售机会</p><p>如果你的商品没有库存，这不只让买家失望，亚马逊平台也不高兴</p><h5 id="3-客户满意度"><a href="#3-客户满意度" class="headerlink" title="3. 客户满意度"></a><strong>3. 客户满意度</strong></h5><p>我们都知道，好的商品评论与卖家反馈永远是销量的保证，超过80%消费者购买以前都会参考过往的商品评价。</p><p>我们的商品评级同样也帮助亚马逊A9算法决定这个商品的热度与满意度，所以为什么那么多人冒着高风险高价格去会去刷单，好评REVEIW，我们不建议这么干。做长期主义者，不走捷径。</p><p>像这次赫赫有名的深圳坂田五虎倒了四虎就是刷单公司信息泄漏原因，导致店铺被关，资金冻结。牵连有20万卖家。这20卖家亚马逊早晚也是要挖出来的.我们做的每一个动作亚马逊都有记录的，秋后算账，养肥了再宰是姐夫一贯作风。</p><p>如果别人都在刷单，我不刷会觉得不公平对不对，但现在这反而是给脚踏实地做产品做品牌的卖家更多更好的机会。亚马逊会把优质卖家留下来，给客户更多好的体验</p><p>其实现在购物平台，都是千人千面的，不同的ip, 买家账号，邮编，pc端，手机端等搜索结果都是有差异的。所以我们的关键词排名需要综合这些数据看。</p><p>Amazon呈现给买家的：卖的什么，有没有人看，看了有没有人买，买的人多不多，买了觉得怎么样，是否还会再买。</p><p>Amazon呈现给卖家的：卖的什么玩意自己表述清楚，自己找好位置，推你一把试试你争不争气，争气了给我好好干别断货了，价格给我搞低点，质量给我搞好点，给我搞变体搞页面让上帝多留会，给我到外面挖人，别让上帝对你不满意，更别让上帝对我不满意投诉到我这来了。</p><p>上帝不满意了上差评了，这条listing的权重同时也会下来。</p><h2 id="三、关键词的重要性"><a href="#三、关键词的重要性" class="headerlink" title="三、关键词的重要性"></a><strong>三、关键词的重要性</strong></h2><p>关键词调研是亚马逊推广环节中的重中之重，他就像是建房子一砖头样，好不好，影响整个房子的质量。</p><p>说了这么多，既然关键词这么重要 ，那么，如何调研找到对我们产品来说有用的关键词呢？</p><h2 id="四、如何调研关键词？"><a href="#四、如何调研关键词？" class="headerlink" title="四、如何调研关键词？"></a><strong>四、如何调研关键词？</strong></h2><p>首先我们要搞清楚的是，我们的产品核心关键词到底是什么？简单来说，你要卖的到底是一件什么产品呢？苹果还是桔子？搞清楚这个问题后，我们要围绕这个产品的核心关键词去做关键词挖掘</p><p>好，这里让大家一起想一想哪，我们调研关键词，从哪些维度来调研？</p><p>其实我们的嘉宾分享也有讲到几点，包括咱们圈子分享内容也有写到关键词调研。</p><h3 id="1-Amazon搜索框提示关键词"><a href="#1-Amazon搜索框提示关键词" class="headerlink" title="1. Amazon搜索框提示关键词"></a><strong>1. Amazon搜索框提示关键词</strong></h3><p>我们在亚马逊搜索框输入产品关键词，下面会自动匹配一些相关或常用搜索词，在这些词中可以选择与自己产品相关的关键词。如果自动出现的相关词较少，可以尝试输入自己的主关键字，然后键入A到Z的任意字母，看amazon会给推送什么样的关键词。</p><p>比如说我们在亚马逊前台搜索 portable charger ,搜索框会自动给出这些提示的关键词。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/%E5%9B%BE%E7%89%873.jpg" alt="img"></p><p>调研关键词的维度有很多，为什么我第一个推荐的调研维度是亚马逊的下拉框呢？其实我们要站在背后的逻辑去思考。</p><p>大家首先要有一个概念：为什么一个平台要有下拉框，为什么会有下拉框的推荐呢？为什么会有对应的建议给你呢？底层的逻辑是什么呢？</p><p>其实说到底很简单：就是提高用户的检索体验，让用户能够更快的找到自己想要的产品！</p><p>而这些搜索的下拉框为什么要作为我们重要需要搜集的关键词呢？</p><p><strong>底层逻辑是啥呢？</strong></p><p>其实本质真的很简单！这些关键词一定是用户检索最多的，数据匹配最多的关键词，因此才会被平台推荐到下拉框！</p><p>搜索量的大小，代表的就是这款产品的市场需求程度的大小。所以我会把下拉框的关键词调研放到第一步跟大家去讲！</p><p>这里大家可以把所有的核心词输入到搜索框，然后收集这些核心词的发散词，做一个表格。</p><h3 id="2-同行产品的listing页面"><a href="#2-同行产品的listing页面" class="headerlink" title="2. 同行产品的listing页面"></a><strong>2. 同行产品的listing页面</strong></h3><p>一开始我们做一个新东西的时候，不知道怎么去做，大家想想，最简直粗暴的方法是什么？</p><p>先是研究别人做的好的，然后去模仿他，最后才是超越对吧？？嗯嗯，研究、模仿、超越! 小北老师的六字真言，放四海皆通的。</p><p>优秀的竞争对手是我们最好的老师！通过拆解竞争对手的产品链接，我们可以学习到非常多的知识点和细节！</p><p>比如说：竞争对手的图片设计风格是怎样的？竞争对手的listing关键词布局是怎样的？</p><p><strong>标题是怎么写的？</strong></p><p>类目节点也是关键词之一。</p><p>这里发散一下：通常我们也会把本身的类目节点关键词布局及想要新增的类目节点词布局到listing页面，促进出单，然后去开case找客服，说看别人类似差不多的产品有在那个类目，自己的ASIN为什么不在，可以达到增加类目节点的可能性。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/%E5%9B%BE%E7%89%874.jpg" alt="img"></p><p><strong>竞争对手的review布局和QA布局到底是怎样的？</strong></p><p>从竞争对手的review和QA的痛点调研过程中，我们都能调研出非常多的关键词，而且这些关键词都是经过市场验证的关键词，是吧，非常具体参考和借鉴价值。</p><p>尤其是那些卖的特别好的BSR竞争对手，更是我们重点要去学习的对象，这样的竞争对手，核心关键词的流量布局基本上都是覆盖到了。</p><p>这个过程也是一个竞品调研的过程，我们平时在做竞品调研的时候，先确定好自己产品的类目节点，然后根据类目节点，把竞品信息收集出来，挑选BSR排名前5、排名40<del>60、排名90</del>100各一个。</p><p>从小类目竞品TOP20名的竞品，这样每个层次的竞品都有，更好的去做分析不同阶段产品的情况。把竞品信息收集下来做成excel表。</p><p>重要信息：标题、5点卖点、描述、A+、好评，差评制作成表格，进行横向比较</p><p>重点把标题的每一个词都扣出来，看词频。因为所以卖家都是把最核心的关键词放在标题里的。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/%E5%9B%BE%E7%89%875.jpg" alt="img"></p><h3 id="3-多平台去搜集关键词"><a href="#3-多平台去搜集关键词" class="headerlink" title="3.多平台去搜集关键词"></a>3.多平台去搜集关键词</h3><p>我们做市场的应该知道，肯定不会是一个平台独大。比如说我们做美国市场，依然是会的一些其他的电商平台。</p><p>比如说：ebay、wish、速卖通、沃尔玛等等</p><p>这是我打开速卖通手输入了同样的关键词portable charger,他的搜索框也是有推荐关键词的，这些都是平台过滤出来，用户常的搜索词，这些词是可以根据自己产品 属性拿来放在自己listing里边的</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/%E5%9B%BE%E7%89%876.jpg" alt="img"></p><p>而我们如果是在做亚马逊平台，同样也可以在相同市场的其他平台去做关键词的调研分析以及整理归纳，甚至可以做选品方面的调研。</p><p>通过这种跨越平台的调研，我们甚至可以发掘一些信息差，找到一些潜在的赚钱的机会！</p><h3 id="4-亚马逊的广告匹配数据"><a href="#4-亚马逊的广告匹配数据" class="headerlink" title="4. 亚马逊的广告匹配数据"></a><strong>4. 亚马逊的广告匹配数据</strong></h3><p>这个是通过广告数据进行挖掘，也是一个潜在的重要挖掘点。</p><p>我们做过广告的同学都知道，后台可以下载广告报告</p><p>我们通过自动/手动广告跑出来的一些词，很有可能是我们调研的时候都没有看到过的。因为老外的的有些习惯用词我们我们真猜不到是吧。</p><p>广告报告下载下来，</p><p>第1步全选数据，插入数据透视表 确定 生成透视表</p><p>第2步 筛选产品所在广告系列，拉汇总分析维度并求和，一般展现：点击、花费、订单量、销售额、转化率、点击率都属于我们需要分析的维度。</p><p><strong>分析思路：</strong></p><p>查看click是否集中在单个或几个搜索词，或属性上</p><p>搜索词对应的点击基数足够（70-100+)情况下，是否产品了订单，转化率有没有达到预期（3%以上）</p><p>从曝光量大小，转化率高低，也可以挖到放大或缩小投放的切入点</p><p>点击基数大，转化次数越多，词的价值越大</p><h3 id="5-BA-Brand-Analytics-品牌分析工具"><a href="#5-BA-Brand-Analytics-品牌分析工具" class="headerlink" title="5. BA (Brand Analytics)品牌分析工具"></a><strong>5. BA (Brand Analytics)品牌分析工具</strong></h3><p>这个是针对有品牌备案的卖家，输入关键词，可以看到关键词在亚马逊上面的搜索排名。</p><p>如果我们输入关键词，就会看到相关的长尾词，以及他们的热度和排名。</p><p>我们可以按日周月下载数据源筛选查看，或者同一个关键词按不同的时间段查看，也能看到这个词的趋势如何，是否是热度在上升或者是下降的词。</p><p>这里输入关键词或ASIN都是可以查到数据的。</p><p>竞品的BA源数据关键词我们导出来后，先去重，然后按搜索频率排序，就能知道哪些是流量大的关键词了。</p><p>将ASIN放入search term里，挖掘出它的主流出单核心热词。我们写文案，打广告，需要研究竞争对手的关键词的时候，这个功能可以查到asin的关键词。</p><p>这里的词比较精准，并且有一定流量的。收录了190万的词，不管是长尾也好，核心词也好，流量都不会小</p><h3 id="6-关键词查询工具。"><a href="#6-关键词查询工具。" class="headerlink" title="6. 关键词查询工具。"></a><strong>6. 关键词查询工具。</strong></h3><p>很多站外工具提供了类目关键词及反查关键词的功能，我们可以根据自已的喜好和习惯尝试选择。</p><p>比如google adwords; 谷歌关键字规划师，免费的。我们分析竞品得到一些词后，用谷歌关键字规划师来帮助找到流量最大的词和最适合我们的词，在我们不确定哪个词流量大，以及不确定目的地国家的搜索习惯时，将不同的词组成词组，用这个工具来搜索及验证。</p><p><strong>竞争对手流量入口工具：surtime。</strong></p><p>反查对手关键词工具：声纳：<a href="https://link.zhihu.com/?target=http://sonartool.com">http://sonartool.com</a>；<a href="https://link.zhihu.com/?target=http://merchantwords.com">http://merchantwords.com</a> 等</p><p>其实关键词工具有很多 ，常用的也就几个。我用H10 和Merchantwords 较多。</p><p>Merchantwords：<a href="https://link.zhihu.com/?target=https://www.merchantwords.com/">https://www.merchantwords.com/</a></p><p>Helium 10: <a href="https://members.helium10.com/">https://members.helium10.com/</a> (可先用免费版功能）</p><p>Keywordtool：<a href="https://link.zhihu.com/?target=https://keywordtool.io/">https://keywordtool.io/</a></p><p>AsinSeed ：<a href="https://www.asinseed.com/cn/">https://www.asinseed.com/cn/</a></p><p>下面用portable charger在Merhcantwords一起来操作看看~</p><p>左边那里就有很多相关的关键词可以选择</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/%E5%9B%BE%E7%89%877.jpg" alt="img"></p><p>接下来H 10同样来搜索关键词 portable charger</p><p>这里是可以用来过滤掉很多选项的啊，搜索量，销售价格，销售金额、评价、类目，最大最小排名。变体数量 、都是可以根据自己的需要选最大值与最小值</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/%E5%9B%BE%E7%89%878.jpg" alt="img"></p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/%E5%9B%BE%E7%89%879.jpg" alt="img"></p><p>五、筛选选择合适的关键词</p><p>很多人凭直觉选关键词，或者说凭自己主观臆断创造关键词，再或者，看到竞争对手用什么关键词就直接照搬过来。</p><p>大家 都知道关键词的重要性啊，选关键词不是我觉得。</p><p>调研出来的关键词我们需要去做分析、归纳整理，哪些是核心关键词，哪些是长尾关键词，哪些是我们要主打的关键词，</p><p>要有一个清晰明了的关键词调研表出来</p><h4 id="筛选关键词的三个指标："><a href="#筛选关键词的三个指标：" class="headerlink" title="筛选关键词的三个指标："></a><strong>筛选关键词的三个指标：</strong></h4><h5 id="1-search-volume搜索量"><a href="#1-search-volume搜索量" class="headerlink" title="1. search volume搜索量"></a><strong>1. search volume搜索量</strong></h5><p>找的关键词一定要有搜索量，太低（比如1000以下）就没有意义</p><h5 id="2-competition-level-竞争度"><a href="#2-competition-level-竞争度" class="headerlink" title="2. competition level 竞争度"></a><strong>2. competition level 竞争度</strong></h5><p>关键词下边竞争强度是怎么样的，自己要有判断，竞争度越强，获得关键词排名的难度越大</p><h5 id="3-relevancy-相关性"><a href="#3-relevancy-相关性" class="headerlink" title="3.relevancy 相关性"></a><strong>3.relevancy 相关性</strong></h5><p>有些卖家喜欢蹭相关的节日热点或者购物季的热点，这其实对于卖家的转化率提高帮助并不大，尤其当你的产品不是这种节假日装饰或礼物类型的产品。</p><p>我们卖家在选择关键词时，还是要坚持自己产品相关性的原则，不相关的词语或者相关度不高的词语，尽可能少用或不用。</p><p>使用不相关的关键词，反而会降低Listing 的权重。</p><p>因为当我们的产品有吸引客户的关键词却没有点击或者很少点击。点击又没有购买的情况下，亚马逊会判定这个产品并非用户所需求的，反而会降低listing 的权重，排名越靠后，listing被展示的机会越来越少，恶性循环就开始了。</p><p>所以，如果选用的词语和产品不相关，即使是热词，不仅不能给产品带来好的作用，反而会适得其反。</p><p>如果找的关键词相关性差，那你如果把这个关键词放在标题里边，RANK 排名难度会加大，这种转化率是很低的。即使广告推上去了，排名后面也会慢慢掉下来</p><p>我们一定要注意的是，无论我们通过何种方法找到了关键词，都一定要重新放到amazon的搜索框上，让真正的匹配结果来检验找到的关键词是否合适自己的产品。</p><p>而不是查到了对手的关键词就得意洋洋的直接使用，做起点击并出单的白日梦。</p><h2 id="六、关键词布局"><a href="#六、关键词布局" class="headerlink" title="六、关键词布局"></a><strong>六、关键词布局</strong></h2><p>产品页面关键词的丰富程度，布局位置，相关度和精准度是被搜索引擎展示和推荐的关键因素。</p><p>做产品上架计划的时候，我们必须确定产品的</p><p>核心关键词，主推关键词和辅助关键词，针对关键词的重要性和推广时期，有所侧重的去埋词</p><h3 id="1、标题不要重复关键词"><a href="#1、标题不要重复关键词" class="headerlink" title="1、标题不要重复关键词"></a><strong>1、标题不要重复关键词</strong></h3><p>官方有严格的说明不准，不允许堆砌。如堆窃会降权。</p><p>开始我们点评的作业里有，还有很多同学重复堆砌关键词，这个需要注意。</p><h3 id="2-新上的产品少用大词"><a href="#2-新上的产品少用大词" class="headerlink" title="2.新上的产品少用大词"></a><strong>2.新上的产品少用大词</strong></h3><p>对于刚上新的产品来说，因为Listing没有任何权重，没有review支撑，该listing一般承接不了大词流量，导致转化率很低，并且会浪费很多广告费。</p><p>所以，特别是标题上面的关键字，我们尽量选择“搜索结果/搜索次数”相对较低的词，这些数据，我们可以参考选品软件获得。</p><h3 id="3-关键词不是一尘不变的"><a href="#3-关键词不是一尘不变的" class="headerlink" title="3. 关键词不是一尘不变的"></a><strong>3. 关键词不是一尘不变的</strong></h3><p>关键词可能会随着时间的变更出现变化。</p><p>比如说手机壳，几个年前是 for iphone7，现在是for iphone12。</p><p>这些都会随着产品更新换代而出现关键词更新，我们如果做这类产品，就要随时更新自己的Listing。</p><p><strong>如何在Listing里布局关键词</strong></p><p>最好的关键词，就是竞争性相对低的关键词放在标题，（这里根据我们自己的推广计划来，前期可以放相对精准一些的词，形成出单后，慢慢可以改成核心关键词。</p><p>但是由于标题限制200个字符，就要求我们一定要做到最大限度利用好标题字符数，不要出现关键字重复堆砌。</p><p>举个例子，假如我们卖的是男士足球运动鞋，不要在标题里写</p><p>”men shoes, sports shoes, football shoes”，</p><p>而是应该写成“sport basketball sheos for women”，这样我们就可以用一个”for”换两个“shoes”的字符空间。</p><h3 id="4-埋词数量，取决于产品竞争情况。"><a href="#4-埋词数量，取决于产品竞争情况。" class="headerlink" title="4.埋词数量，取决于产品竞争情况。"></a><strong>4.埋词数量，取决于产品竞争情况。</strong></h3><p>如不写ST，甚至埋的词不多，只有一两个核心大词，你在上面的权重集权是非常大的</p><p>所以说埋词的多少是取决于我们的推广策略，还有我们产品的竞争情况。</p><h3 id="5-ST里边必须核心关键词"><a href="#5-ST里边必须核心关键词" class="headerlink" title="5. ST里边必须核心关键词"></a><strong>5. ST里边必须核心关键词</strong></h3><p>会直接的影响到广告的抓取，自动广告发散位置。如果关键词埋入的太发散，直接会影响自动广告的成本。</p><h3 id="关键词布局的原则有哪些？"><a href="#关键词布局的原则有哪些？" class="headerlink" title="关键词布局的原则有哪些？"></a><strong>关键词布局的原则有哪些？</strong></h3><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/%E5%9B%BE%E7%89%8710.jpg" alt="img"></p><p>1、关键词不能堆砌（标题、五点描述，description,search term）</p><p>标题：放2-3个关键词即可：主关键词，次关键词+产品属性</p><p>产品页: 不要超过3个关键词</p><p>内容:5-6个关键词左右，围绕一个关键词来延伸的，长尾词的延展，</p><p>合理的标题很重要！需要放关键词，开头前100个字符需要放关键词，</p><p>五点里的主题概括 需要放关键词</p><p>结尾一个关键词</p><p>图片关键词命名</p><p>2、关键词要站在用户的角度思考</p><p>3、关键词不要太宽泛，不精准的关键词转化率低</p><p>4、关键词要与所选的网站相关</p><p>5、关键词搜索次数多，尽量竞争程度小的</p><p><strong>关键词的曝光跟什么有关？主要是以下三点：</strong></p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/04/AMZ.jpg" alt="img"></p><p>1.关键词的大小</p><p>2.关键词的位置（同样的关键词越靠前越优先曝光）</p><p>3.关键词出现的频次（1个指令和4个指令的区别）</p><p>3个产品关键词必须包含在标题里。</p><p>尽可能站在卖家的立场上整理关键词。</p><p>同样的产品，但国家不同，叫法也不同。比如灯，有lamp和light两种叫法。</p><p>在节日前半个月左右，在关键词中加入相关词组，比如黑五、圣诞节等</p><p><strong>关键词确定的基本方法</strong></p><p>1、通过观察同类产品大卖家对手的详情页面，从他们的标题，描述，5点描述，Review中提炼出现频率最多的并且跟产品的相关的词组并记录下来；</p><p>尽量越多越好不要有遗漏。同时也可以参考其他平台如ebay中同款产品的相应热词。</p><p>2、把提炼出来的关键词用关键词工具scientificseller深度拓展。</p><p>3、使用其他的关键词查询拓展工具 google Adword， merchantwords， KTD等挖掘其它的与产品功能性能相关的关键词，记录下来。</p><p>4、把之前记录下来的关键词，用google Adwors上验证关键词的搜索热度，并且需要把关键词进行排序（按热度从高到低）。</p><p>5、产品依托的平台是亚马逊，亚马逊从某种意义上也是一个搜索引擎，在这个搜索引擎上针对搜索的词也有热度和相关度的排序。</p><p>因此需要把以上排序好的关键词放在亚马逊上一个一个的搜索，进行最终的关键词重要程度排序。</p><p>1、埋词。把确定好的主关键词1-3个，自然并通顺的编辑在标题，5点特征描述，详细描述，问答里边，甚至重复提到5-6次产品的主关键词或者重要的长尾关键词，让产品有更多的曝光机会。</p><p>2、可做PPC广告。从以上数据找出的词，对于后期推广也是至关重要的。找出精准关键词，能够最大程度的提高收益。</p><p><strong>SEARCH TERM哪些关键词不能写</strong></p><p><strong>1.与自己产品没有相关性的关键词</strong></p><p>尽管用到某些关键词可能会蹭到更多的爆光率，但匹配度低，并不是买家需要搜寻的产品，也不会有流量和转化率。</p><p><strong>2.别人的品牌名称</strong></p><p>有的运营为了蹭流量把别人的品牌名写进自己的Search terms里面，尤其是大牌的名称，这样是非常容易被人警告或投诉的。亚马逊也是在明文规定不可以写的</p><p>比如说，我们卖的是手表带，我们可以在标题或者描述写我们的产品fit for seiko 浪情等手表。但Search terms里面是不能直接填写手表大品牌名称。</p><p>举个栗子：以关键词 portable charger 为例。这时我用的Helium 10 免费版的功能，大家可以注册一下，也可以用其他工具。</p><p><strong>产品关键词贯穿listing文案的始终。</strong></p><p>主要用在5个位置。标题、五点、描述、searchterm以及QA评论。我的看法是长尾词及精准词优先放在标题中，</p><p>宽泛放在searchterm里面。</p><p>如果关键词多到标题中放不下的，加在五点以及描述里面。同时为了增加listing与关键词的关联度，可以在qa及评论中添加，要注意保持语句通顺。</p>]]></content>
      
      
      <categories>
          
          <category> 亚马逊新手训练营0~1教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 亚马逊新手训练营0~1教程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>06-Listing的撰写</title>
      <link href="2022/09137951.html"/>
      <url>2022/09137951.html</url>
      
        <content type="html"><![CDATA[<h1 id="06-Listing的撰写"><a href="#06-Listing的撰写" class="headerlink" title="06-Listing的撰写"></a>06-Listing的撰写</h1><p>更新于：2022-04-20 7:14:47</p><h2 id="如何写一条合格的listing什么是listing？"><a href="#如何写一条合格的listing什么是listing？" class="headerlink" title="如何写一条合格的listing什么是listing？"></a>如何写一条合格的listing什么是listing？</h2><p>在亚马逊平台listing就像是我们店铺的销售人员，Listing的颜值高不高，话术好不好，直接影响到我们产品的销量。</p><p>比如用户搜到我们的产品页面，其实就是几秒钟的时间，准确来说是7秒，我们的产品主图能不能吸引用户，标题是否吸引，价格怎么样，能不能形成订单，是很快决定的。买家觉得没有亮点马上会就转到其他产品去。</p><p>我们要做的是提升销售员listing的颜值：比如说产品图片、文字的排版啊，精练谈吐和话术，如：五点及描述的可读性，是否通顺，语法是不是符合老外习惯，还是写的我们的CHINAGILISH?用户关键词是不是埋的准确到位？</p><p>一位专业的销售人员对销售的影响巨大，同样的，Listing是亚马逊运营中最基础也是最重要的一个环节。</p><p>一句话来说，就是怎么让我们自己的listing在众多竞争对手中脱颖而出，get 到用户的需求点，让用户迅速作出购买决定。</p><h2 id="O-优质listing的一些基本原则"><a href="#O-优质listing的一些基本原则" class="headerlink" title="Ø 优质listing的一些基本原则"></a>Ø 优质listing的一些基本原则</h2><h3 id="1、什么是Listing"><a href="#1、什么是Listing" class="headerlink" title="1、什么是Listing"></a>1、什么是Listing</h3><p>Listing :亚马逊商品详情页面，是展示产品所有信息的独立商品页面</p><p>包含以下7个主要要素：标题、图片、商品要点、商品描述、搜索关键词、EBC(Enhanced Brand Content文版品牌描述）)/A+页面、分类节点；</p><p>还包含品牌名、评论、价格、配送方式等等其他要素。：产品图片、标题、五点、定价、产品描述、search term等词的后台填写。</p><p>同时，还有一项隐性工作，也是以上所有文字类工作的基础，收集整理产品关键词。关键词这块我们下一节课会详细来讲。</p><p>接下来我们就来讲这些内容。</p><h4 id="1、listing的基本要素"><a href="#1、listing的基本要素" class="headerlink" title="1、listing的基本要素"></a>1、listing的基本要素</h4><p>影响listing完整度的主要要素</p><h5 id="1）标题"><a href="#1）标题" class="headerlink" title="1）标题"></a>1）标题</h5><p><strong>如何写一个合格的标题？</strong></p><p>标题是最直接的关键词搜索来源，是买家最直观的对我们产品信息的理解和把握，帮助买家解读产品的重要属性，让买家从标题上就能知道我们产品的独特特性和差异化，和产品图片一起，最大可能的吸引客户点击欲和购买欲。</p><p><strong>标题的写法</strong></p><ol><li><p>每个字的首字母必须大写（除了a, an,and, or, for, on, the之类的词）</p></li><li><p>不能有任何特殊字符或标点符号(®, ©,™, !, $, &amp;, , etc.)</p></li><li><p>不能在中文输入法状态下输入任何内容（会变成乱码）；</p></li><li><p>如有数字描述，要用阿拉伯数字，不要使用文字，例如：要写2，不要写Two。如包含批量销售，请在商品名称后面添加（pack of X）。</p></li><li><p>标题简明扼要，不能过长、不要堆砌关键字，服装&lt;80字符，鞋包&lt;50字符，其他品类&lt;150字符（1个英文字母、1个标点或空格算作1个字符）</p></li></ol><p>不能有重复关键字或者不同单词描述同一个意思的关键字。不要出现过多的产品细节（如多型号商品，不超过三个型号）可以在描述或产品特性中补充。</p><p>不要用”关键词堆砌“我们的商品名称，这会让买家体验变差，导致转化率降低。搜索引擎也会检测到这一情况，并降低我们的排名</p><p>一般来说是80-120个字符，电子类产品140个字符左右，手机端超过140个字符权重不高的，不好展示，上完listing后大家一定要习惯用手机去亚马逊前台看自己产品展示的情况。</p><p>去看标题、图片、五点等、是不是可以很好的按自己预期的样子展示出来。大家都知道现在移动端的流量是巨大的。</p><p>6.不能有公司，促销，物流，运费或其他任何与商品本身无关的信息，</p><p>例如:</p><p>a. “Free Shipping”, “2 days express delivery”</p><p>b. “Best Seller”, “Hot Item”, “Latestdesign, New Fashion”</p><p>Money-back Satisfaction Guarantee”</p><p>d. “Customizable please email me your idea or design”,</p><p>可以使用短横线（-），斜杠和&amp;符号句号。</p><p><strong>使用变体关系的商品名称</strong></p><p>在变体关系中，仅父ASIN的商品名称显示在详情页面上，买家将ASIN加上购物车后，系统才会显示所选 的子ASIN的商品名称。所以呢，一定要在子ASIN的商品名称加上变体属性，比如尺寸，颜色什么的.</p><p>这里有个要点就是，标题里一定是放核心关键词，不是放长尾关键词。</p><p>至于是怎么埋词，需要结合我们自己的推广节奏来调整。</p><p>Tip：放核心关键词，不是放长尾词。</p><p><strong>标题的应包含的内容：</strong></p><ul><li><p>品牌名，型号，系列名称</p></li><li><p>产品名称（核心关键词）就是你要推的那个词</p></li><li><p>重要特征或亮点</p></li><li><p> 产品材质或主要成分</p></li><li><p>产品颜色、尺寸、数量</p></li></ul><p><strong>标题公式</strong></p><p>标题=品牌+核心关键词+亮点+其他关键词+次要卖点+材质+尺寸+用途+数量+颜色</p><p>标题=品牌+关键词+亮点+适用范围+产品特性（材质/尺寸/颜色等）</p><p>标题最后一部分基本是补充产品相关的材质、尺码或者颜色信息即可，丰富产品信息，从而提高买家对产品的认知度。</p><p>这里说一下，在我们品牌还是新品牌的时候，没有什么影响力，建议品牌不要放左边第一个位置，或者可以放后边。因为标题的权重是从左到右排序的，越核心重要的词要越往前边放。</p><h5 id="1）越重要的词放在越前面"><a href="#1）越重要的词放在越前面" class="headerlink" title="1）越重要的词放在越前面"></a><strong>1）越重要的词放在越前面</strong></h5><p>这是什么产品?有什么特性或与别人不同的地方?</p><p>位置越靠前的词越重要。现在移动端用户居多，在手机上能被显示的标题内容有限，再往后的位置也很少再注意看，所以需要在短短几个词之内展现产品特性，兼顾电脑端和移动端，从而达成即亲近A10算法，又照顾到顾客浏览标题体验的目的。</p><p>标题优化的注意事项不要提供不准确、具有误导性或不相关的信息，</p><p>不要提供过长的内容。堆砌关键词</p><p>不要提供其他字段（比如商品名称、作者、商品描述、要点、品牌等）中已提供的冗余信息。这不会提高您的商品在搜索结果中的排位。</p><p>不要输入仅暂时有效的陈述，如“新品”、“促销”、“有现货”等。</p><p>请勿包含具有辱骂或攻击性质的词语。</p><p>可以将缩写、别名、（书籍等的）主题和（书籍、电影等的）主要人物等用作关键词</p><p>这里给大家推荐一个字符计算工具，当然有很多工具是可以用的啊，你们有其他好的工具也是OK</p><p>字节字符计算工具：<a href="http://www.mingmu.net/zishu.html">http://www.mingmu.net/zishu.html</a></p><p>接下来，我们讲到五点描述，bullet point</p><h5 id="2）五点描述填写技巧"><a href="#2）五点描述填写技巧" class="headerlink" title="2）五点描述填写技巧"></a>2）五点描述填写技巧</h5><p>BulletPoint一般来说是买家第二个阅读的内容。</p><p>看完Bullet Point以后买家就会知道商品符不符合他们的要求。</p><p>所以我们要突出强调商品的主要功能，我们要做的是在买家在想起来疑问之前就解决了他们的问题。</p><p>我们通过测试，精细布局撰写商品要点是可以提升销量的。</p><p>买家依靠商品要点来了解重要的商品功能，因为这些要点可以突出有关商品的重要信息或特殊信息。</p><p>\1. 最重要的写在第一条</p><p>\2. 比较重要的卖点在前三条写完</p><p>\3. 每一条一个卖点</p><p>\4. 每条卖点归纳一个小标题，减少客户判断时间</p><p>这个小标题大家要注意， 我们到前台去看还是会有很多的中国卖家用中文在字符来框标题的，这个不要用啊。没什么卵用，而且还暴露了你是中国卖家.</p><p><img src="http://5coder.cn/img/1663060970_a17c89711dbbcc43300e59c4c3acc93d.jpg" alt="img"> </p><h6 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h6><p>a. 每一要点最多500个字符（含标点和空格），一般建议控制在200个字符以内，请勿包含促销和定价信息</p><p>b. 每个要点应简洁但具有描述性；些处不应使用段落</p><p>c. 如果商品是套装商品，请列出套装中包含的商品和每个商品的尺寸（如适用）</p><p>d. 使用分号分隔单个要点中的短语</p><p>e. 要点中始终使用阿拉伯数字，切勿使用拼写数字</p><p>f. 以句子形式编写要点（无标点符号）</p><p>g. 不支持Type 1 ASCII字符（R C ,TM等）或其他特殊字符</p><p><img src="http://5coder.cn/img/1663060970_a2aa9a2899852125a50c68fd83715dae.jpg" alt="img"> </p><p>编写商品要点时，需要遵守这些要求：</p><p>突出说明您希望买家注意的五项关键特点，例如尺寸、适龄性、商品的理想状况、技能水平、成分含量和原产地等。</p><p>保持顺序一致。如果您的第一个商品要点是原产地，那么请为所有商品保持相同的顺序。</p><p>重申商品名称和描述中的重要信息。</p><p>请在每条商品要点开头使用大写。</p><p>请以句段编写，不要在结尾加入标点符号。</p><p>请勿包含促销和定价信息。</p><p>我们亚马逊卖家很多是从1688、环球资源拿货，同质化严重，所以开发产品的时候就要注意，开发有亮点、有自己特色的产品。如果是拿的标品，尽量做一点差异化。产品描述这边也是。</p><h5 id="http-www-shopping-com-国外搜索购物比价网站"><a href="#http-www-shopping-com-国外搜索购物比价网站" class="headerlink" title="http://www.shopping.com/ 国外搜索购物比价网站"></a><a href="https://link.zhihu.com/?target=http://www.shopping.com/">http://www.shopping.com/</a> 国外搜索购物比价网站</h5><h5 id="3）Search-Term"><a href="#3）Search-Term" class="headerlink" title="3）Search Term"></a>3）Search Term</h5><p><img src="http://5coder.cn/img/1663060970_b825e24d5d679444731cd5df315ae9cc.jpg" alt="img"> </p><p>关键词的作用</p><p>达成产品能够被搜索到的目的；补充完善标题不能覆盖的关键词，增加搜索和曝光的可能性</p><p>关键词的写法</p><p>不能滥用知名品牌名</p><p>不能滥用不相干的关键词</p><p>不要和标题中的关键词重复使用</p><p>请使用单个空格来分隔关键词。无需输入逗号、分号或插入符号。</p><p>输入多个单词作为搜索词时，请按最符合逻辑的顺序排列它们。买家更有可能搜索大型毛绒泰迪熊玩具，而不是搜索泰迪毛绒熊玩具。请勿提供空格、标点符号、大写和复数的变体（“80GB”和“80 GB”、“computer”和“computers”等）。我们的搜索引擎将自动在搜索时包含不同的大小写形式、词形和拼写变体。</p><p>请勿包含带有主观色彩的表达，如“惊艳”、“优质”。等词语，因为大多数买家不会在查询中使用带有主观色彩的词语。</p><p>请勿在商品名称中包含常见拼写错误。亚马逊的搜索引擎会弥补常见的买家拼写错误并提供校正建议。</p><p>注意： 亚马逊保留在检索商品时不使用卖家提供的所有关键词的权利。</p><p>不使用所有关键词的原因包括但不限于：搜索运算效率、对搜索结果的潜在操纵、不相关的搜索词及攻击性或非法词语</p><h5 id="4）图片要求"><a href="#4）图片要求" class="headerlink" title="4）图片要求"></a>4）图片要求</h5><h6 id="通用图片标准："><a href="#通用图片标准：" class="headerlink" title="通用图片标准："></a>通用图片标准：</h6><p>· 图片必须准确展示商品，且仅展示待售商品。</p><p>· 商品及其所有特色都必须清晰可见。</p><p>· 主图片应该采用纯白色背景（纯白色可与亚马逊搜索和商品详情页面融为一体 - RGB 色值为 255、255、255）。</p><p>· 主图片必须是实际商品的专业照片（不得是图形、插图、实物模型或占位符），且不得展示不出售的配件、可能令买家产生困惑的支撑物、不属于商品一部分的文字，或者标志/水印/内嵌图片。</p><p>· 图片必须与商品名称相符。</p><p>· 图片的最长边不应低于 1,600 像素。满足此最小尺寸要求可在网站上实现缩放功能。事实证明，提供缩放功能可以提高销量。</p><p>· 图片最长边不得超过 10,000 像素。</p><p>· 亚马逊接受 JPEG (.jpg)、TIFF (.tif) 或 GIF (.gif) 文件格式，但首选 JPEG。</p><p>· 我们的服务器不支持 .gif 格式的动图。</p><p>· 图片不得包含裸体或有性暗示意味。</p><p>· 鞋靴主图片应采用单只鞋靴，呈 45 度角朝向左侧。</p><p>· 女装和男装主图片应采用模特照。</p><p>· 所有儿童和婴儿服装图片均应采用平放拍摄照（不借助模特）。</p><p>主图：</p><p>主图片标准中不允许出现在问题：</p><p>l 采用非纯白背景的图片（RGB低于255）</p><p>l 商品上或背景中有文字、标志、边框、色块、水印或其他图形</p><p>l 包含同一商品的多张图片</p><p>l 最长边放大到最大允许尺寸时，商品占画面不到85%</p><p>l 模糊、马赛克或锯齿边缘</p><p>l 主图片是有人/商品穿戴在模特身上（成人服装除外)</p><p>l 商品图片不能包含任何亚马逊标志或商标、亚马逊标志或商标的变体、任何容易让人混淆的与亚马逊标志或商标相似的内容。这包括但不限于任何含有AMAZON,PRIME .ALEXA或Amazon Smile设计的文字 或标志。</p><p>l 商品图片不能包含亚马逊商城使用的任何 标记、标记的变体、任何 容易让人混淆的与标记相似的内容。这包括但不限于“Amazon’s choice””优质的选择”、“Amazon Alexa”、”与Alexa合作”“畅销商品”或“热卖商品”</p><p>附图：</p><p>“主图片应配有一引起附加的图片，以从不同的其二他来展示商品，展示使用中的商品在”主图片“中没有显示的细节，请遵循上述图片标准，经保证你所有的商吕图片的质量的一致性。</p><h6 id="图片链接生成工具："><a href="#图片链接生成工具：" class="headerlink" title="图片链接生成工具："></a>图片链接生成工具：</h6><p><a href="https://github.com/">https://github.com/</a></p><p>如何用Github生成图片链接</p><p>在使用模板上传Listing的时候, 图片是需要使用链接上传的, （我之前一般都是后台直接上传图片的，上一节课有说到，因为可能当时先上产品，准备发货出去，货在路上的时候就来准备优化Listing。当然，如果提前一切准备妥当也是非常可的啊）</p><p>一般来说，很多人会使用图床去生产链接, 但是现在很多国内的图床都是要付费或者就是有图片张数限制, 而且很多图床也会将你的图片泄露出去,也有同学会用QQ空间来生成链接上传，但是如果多店铺运营的话，图片也可能会存在关联。</p><p>我亲测了一个同学推荐的Github去存储图片，非常不错的。</p><p>首次使用的需要先在网站注册一下:</p><p>填写了用户名, 邮箱和密码之后, 邮箱会收到一封Github的认证邮箱, 直接点击邮件中的”Verify Email Address”就会直接跳转到Github的网站, 如下图:</p><p><img src="http://5coder.cn/img/1663060970_6089a7db353dcf03c94f6ec10241f313.jpg" alt="img"> </p><p><img src="http://5coder.cn/img/1663060970_d65f2c8d40d0468106b9e791ab8969b0.jpg" alt="img"> </p><p>这边可以点击”Create a repository” 创建一个资料库, 在Github中是可以创建多个资料库的, 我们习惯一个父体做一个资料库, 这样方便管理. 点击了之后会来到下一个页面:</p><p>需要填写的地方只有”Repository name”, 这个可以按照产品线的名称来填写. 同时存储的图片不想被别人看到, 可以选”Private”. 填完之后点击”Create repository”, 到达下一个页面:</p><p><img src="http://5coder.cn/img/1663060970_21f5bc5723a938bc7c65b5d56b427176.jpg" alt="img"> </p><p>选择”Issues”</p><p><img src="http://5coder.cn/img/1663060970_1dd6222fa27fd77dc002942712c18e7c.jpg" alt="img"> </p><p>点击”New isues”</p><p><img src="http://5coder.cn/img/1663060970_159c95da3185d67623fbe734d067bb74.jpg" alt="img"> </p><p><img src="http://5coder.cn/img/1663060970_9d2e93fabffc422bbcce23cc23bc6597.jpg" alt="img"> </p><p><img src="http://5coder.cn/img/1663060970_42b641e7c5cf4c7537bf56744d23ed33.jpg" alt="img"> </p><p>这样生成的链接就能直接用在模板中了. 然后点击”Submit new issue”, 将这个图片保存在GitHub中, 这样如果后期需要重新上传链接, 还可以再这里找回来. 具体方法就是找到你想要的图片, 右击选择”copy link address”就可以啦。</p><h6 id="图片素材"><a href="#图片素材" class="headerlink" title="图片素材"></a>图片素材</h6><p>推荐一个制作图片的网站， 需要FQ才能上</p><p>比较好用，功能很强大，而且不收费，他们的素材模板风格都很不错，<a href="https://spark.adobe.com/">https://spark.adobe.com/</a></p><p>特色功能:</p><p>\1. 简单的拼图，有按使用场景的各类风格模板可以选择(seasonal，business，travel，food等等)</p><p>\2. 可以添加各种组件，包括文本，图标等等，他们的字体，颜色，图标库都非常丰富。</p><p>\3. 还可以添加文本生成动图保存成短小的视频或gif格式。</p><p>\4. 保存的时候可以选择尺寸，常用的Social media比如fb page cover, ad cover, ins story都有，还可以自定义尺寸，个人觉得这个功能真的很好啊，常用来做简单的banner，活动海报。</p><p>\5. 上手很简单，基本就是自己选择一个模板，他们模板库很丰富，然后替换自己的图片和内容就好了。</p><p>Pixabay是一个支持中文搜索的免费可商用图库。</p><p>网址：<a href="http://pixabay.com/">http://pixabay.com/</a></p><p>里面有很多不同类型的摄影照片，大家可以通过Pixabay去寻找自己想要的图片，简直完美解决各种场合的分辨率要求，真的是一个图片搜索神器</p><p>Gratisography</p><p>网址：<a href="http://pixabay.com/">http://pixabay.com/</a></p><p>Gratisography是一个免费高分辨率摄影图片库，所有的图片都可以用于个人或者商业用途，每周更新图片你只需要点击即可下载。</p><p>designerspics</p><p>网站：<a href="http://www.designerspics.com/">http://www.designerspics.com</a></p><p>主要是有大量免费高分辨率的生活、工作、休闲图片，关键的是可商业用途</p><p>StockSnap是一个提供可自由下载使用的高清晰摄影图片作品的素材库，所提供的资源相当实用，网站由多位摄影师组成，提供丰富的免费照片，随意使用无需经过授权。</p><p>网站：<a href="https://stocksnap.io/">https://stocksnap.io/</a></p><p>图片整体布局：</p><p>总分总结构，主图+5卖点图+包装图或场景图。</p><p>统筹规范：统一字号字体、颜色等；一图一卖点；图面整洁有序。</p><h4 id="1、主图"><a href="#1、主图" class="headerlink" title="1、主图"></a>1、主图</h4><p>主图主要功能，是负责点击，我们的主图好不好，图片</p><h5 id="1-gt-在主图的表现手法上，可以夸张一点，可以大一点。"><a href="#1-gt-在主图的表现手法上，可以夸张一点，可以大一点。" class="headerlink" title="1>在主图的表现手法上，可以夸张一点，可以大一点。"></a>1&gt;在主图的表现手法上，可以夸张一点，可以大一点。</h5><p>有些卖家的主图他是做了3D渲染的效果</p><h5 id="2-gt-如有丰富的配件，一定要把配件也放到主图上，做差异。"><a href="#2-gt-如有丰富的配件，一定要把配件也放到主图上，做差异。" class="headerlink" title="2>如有丰富的配件，一定要把配件也放到主图上，做差异。"></a>2&gt;如有丰富的配件，一定要把配件也放到主图上，做差异。</h5><h5 id="3-gt-角度差异化。"><a href="#3-gt-角度差异化。" class="headerlink" title="3>角度差异化。"></a>3&gt;角度差异化。</h5><h5 id="主图的角度千万不要千变一律的一样。"><a href="#主图的角度千万不要千变一律的一样。" class="headerlink" title="主图的角度千万不要千变一律的一样。"></a>主图的角度千万不要千变一律的一样。</h5><h5 id="只有一种情况下一样，你比他们便宜，评论比较多。"><a href="#只有一种情况下一样，你比他们便宜，评论比较多。" class="headerlink" title="只有一种情况下一样，你比他们便宜，评论比较多。"></a>只有一种情况下一样，你比他们便宜，评论比较多。</h5><h5 id="其次，你有一个配件他没有，然后这样你就一样的角度，同时把你的配件发上去，这样的主图才会比较有优势"><a href="#其次，你有一个配件他没有，然后这样你就一样的角度，同时把你的配件发上去，这样的主图才会比较有优势" class="headerlink" title="其次，你有一个配件他没有，然后这样你就一样的角度，同时把你的配件发上去，这样的主图才会比较有优势"></a>其次，你有一个配件他没有，然后这样你就一样的角度，同时把你的配件发上去，这样的主图才会比较有优势</h5><h4 id="2-第二张，第三张图是最重要的，尤其是第二张，最影响我们转换率。"><a href="#2-第二张，第三张图是最重要的，尤其是第二张，最影响我们转换率。" class="headerlink" title="2. 第二张，第三张图是最重要的，尤其是第二张，最影响我们转换率。"></a>2. 第二张，第三张图是最重要的，尤其是第二张，最影响我们转换率。</h4><p>例：如一个买家因为主图够新颖点进来，会立马看第二张，第三张图片。</p><p>如果你的第二张图片没有抓住他们注意力，很大一部分就会流失掉，就会离开。</p><p>（数据：一个美国买家在亚马逊，对一个商品做决策，离开只有7秒的时间。）</p><p>所以要放入我们的核心卖点，以及产品如有多功能，一定要放入多功能图，让他们对产品感兴趣继续看下去。</p><h4 id="3、第四，第五，第六，第七张图，尽可能的去放入场景图"><a href="#3、第四，第五，第六，第七张图，尽可能的去放入场景图" class="headerlink" title="3、第四，第五，第六，第七张图，尽可能的去放入场景图"></a>3、第四，第五，第六，第七张图，尽可能的去放入场景图</h4><p>根据我们的广告关键词去优化我们场景图。</p><p>卖家后台右上角搜索框：搜索“商品图片要求”，点</p><h5 id="5）Description-A-内容限制"><a href="#5）Description-A-内容限制" class="headerlink" title="5）Description/A+内容限制"></a>5）Description/A+内容限制</h5><h6 id="如果我们还没有品牌备案，做不了A-页面，Description一定要认真写，这点也非常重要。这里是对五点描述及卖点的补充。同样的可以进入我们的关键词，产品功能、SIZE、包装等信息"><a href="#如果我们还没有品牌备案，做不了A-页面，Description一定要认真写，这点也非常重要。这里是对五点描述及卖点的补充。同样的可以进入我们的关键词，产品功能、SIZE、包装等信息" class="headerlink" title="如果我们还没有品牌备案，做不了A+页面，Description一定要认真写，这点也非常重要。这里是对五点描述及卖点的补充。同样的可以进入我们的关键词，产品功能、SIZE、包装等信息"></a>如果我们还没有品牌备案，做不了A+页面，Description一定要认真写，这点也非常重要。这里是对五点描述及卖点的补充。同样的可以进入我们的关键词，产品功能、SIZE、包装等信息</h6><h6 id="商品详情页面"><a href="#商品详情页面" class="headerlink" title="商品详情页面"></a>商品详情页面</h6><p>可以帮助我们优化页面，增加转化率和流量，提升买家体验</p><p>帮助我们的产品提升流量与转化率</p><p>a. 具有商品名称、主图、品牌名称、要点和描述</p><p>b. 商品名称介与50-100个字符之间，不含声明，避免关键词堆砌或全用大写字母</p><p>c. 3-5个要点，每个要点在120个字符以内</p><p>d. 具有搜索词</p><p>e. 具有2-5张轮播图片，包括一张缩放图片</p><p>f. 商品描述在500字符以内</p><p>关键词搜索</p><p>关键词是指你页面中出现的字词，买家可以通过搜索引擎使用这些字词找到你的页面</p><p>要选择不超过3个关键词作为目标，包含在你详情页面的要素中</p><p>要研究买家搜索这些关键词的频率，提升排名的难度以及目前排名靠前的网页</p><p>要根据”当买家搜索这个关键词时他们想看到什么”这一思路来调整你的页面</p><p>要在“搜索词”或“通用关键词”字段中加入你的目标关键词</p><p>不要在你的页面任何部分(包括商品名称、要点、商品描述）堆砌关键词，这会影响文本的可读性；关键词堆砌(例如：餐垫用来垫杯子的垫子非常适合垫）这样会影响买家体验、买家信任并降低转化率。搜索引擎会检测到并处罚关键词滥用行为</p><h5 id="6）视频"><a href="#6）视频" class="headerlink" title="6）视频"></a>6）视频</h5><h6 id="资格："><a href="#资格：" class="headerlink" title="资格："></a>资格：</h6><p>必须拥有有效的亚马逊卖家账户，才能在卖家平台中上传和管理视频</p><p>如果销售权限被撤销，（根据亚马逊政策指南或其他规定），您将没有资格管理的上传视频。并且之前上传的视频也可能从网站上移除</p><p>美国站卖家必须是在亚马逊品牌注册上注册且在AMAZON.COM上销售商品的专业卖家，日本站无需品牌注册。</p><p>如果我们因你违反本内容政策而暂停或撤销你的视频权限，在收到我们进一步的通知之前，你没有资格上传视频，并且你的原有视频将被移除</p><p>视频必须全部采用英文形式</p><p>所有权限暂停都适用于账户持有人，任何试图通过创建其他账户或身份来规避暂停权限的行为，都将导致上述账户被永久禁用。</p><h6 id="声明："><a href="#声明：" class="headerlink" title="声明："></a>声明：</h6><p>必须支持所有明示暗示的声明</p><p>您可以提供自己的个人观点，但需要明确注明。价格可以合理解释为事实陈太的声明均必须准确且可证实</p><p>与商品特征（如安全性、绩效、技术规格、尺寸、重量等）相关的声明必须准确</p><p>提及或描述的任何奖项（例如“2017年最佳商品”）均必须得到商品详情页面上详细信息的支持。</p><p>必须是自己视频中推广的所有商品ASIN 的品牌所有者</p><h6 id="视频内容要求"><a href="#视频内容要求" class="headerlink" title="视频内容要求"></a>视频内容要求</h6><p>\1. 视频内容中不可出现第三方的广告或品牌标示</p><p>\2. 卖家应掌握视频播放版权，包括音乐播放版权等。第三方的视频如（土豆网、优酷、youtube等），即使抹去logo也不允许使用。</p><p>\3. 视频内容应围绕此产品展开，建议使用趣味性、可读性、产品介绍性强的视频内容</p><p>\4. 视频内容不可违反目标站点国家的任何法律、行政法规</p><h6 id="规则标准："><a href="#规则标准：" class="headerlink" title="规则标准："></a>规则标准：</h6><p>\1. 视频长宽比例推荐为16:9或4:3</p><p>2.每一段视频大小应该控制在50-100M以下，格式为WMV或MP4格式</p><p>3.视频画面质量需要清晰流畅，音质需要通畅稳定</p><h5 id="8）品牌旗舰店"><a href="#8）品牌旗舰店" class="headerlink" title="8）品牌旗舰店"></a>8）品牌旗舰店</h5><p>a. 讲述品牌故事并展示商品</p><p>帮助买家在亚马逊上发现商品组和和相关商品</p><p>b. 无需编码即可设计品牌旗舰店</p><p>使用可拖放的模块或预先设计好的模板即可创建自定义的多级页面品牌旗舰店，而无需编写任何代码。</p><p>c. 借助广告提升网站流量</p><p>可以通过亚马逊站内广告，结合在亚马逊之外的营销活动利用独特易读的短URL网址来吸引消费者光临品牌旗舰店</p><p><img src="http://5coder.cn/img/1663060970_52e173667112d5edd92a9e7bebcba5c6.jpg" alt="img"> </p><h5 id="9）各类风格指南"><a href="#9）各类风格指南" class="headerlink" title="9）各类风格指南"></a>9）各类风格指南</h5><p>不同的类目有不同的写法，也不同的风格。当然他的收录是有不同的规则的。</p><p>他这个风格指南有个pdf文档，就是根据第一栏的文件模板类目里面去给你做了文档汇总。</p><p><img src="http://5coder.cn/img/1663060970_56510760012d0e36748f7721eb0cb0a9.jpg" alt="img"> </p><p>右边这所有的信息就基本上涵盖了你这条listing所有要注意的细节点。</p><p>当我们的运营完成了一条listing。那该怎么去判断他写的好是合规还是不好呢？通过这个风格指南就能知道他做的怎么样。</p><p>右边所有信息涵盖了你LISTING所有要注意的细节点</p><h4 id="类目节点"><a href="#类目节点" class="headerlink" title="类目节点"></a>类目节点</h4><p>1.一定要选择一个贴合产品的类目。</p><p>2.是否品牌垄断</p><p>去这个类目里看BSR top100。BSR100里有没有大牌占比较高的，或者有没有垄断的品牌。</p><p>如一个类目里面品牌有垄断，同时有较多的大牌在里面。这种情况进入的可能性会比较低。</p><p>选择红海类目还是蓝海类目，取决于你对这个产品的把握。产品是否有核心的竞争力，以及公司的配套资源能不能匹配。</p><p>比如有一款很优势的产品，但评论前期没有多大的优势，公司也没有测评的资源。可以先从小类目数量少点类目，慢慢的去积累评论。</p><p>等评论稳定、成熟了，此时可以进入大类目去获得更多的流量。</p><h5 id="10）什么是-亚马逊-review？"><a href="#10）什么是-亚马逊-review？" class="headerlink" title="10）什么是 亚马逊 review？"></a>10）什么是 亚马逊 review？</h5><p>我们都知道,产品review非常重要,直接影响买家是否下单购买，一条新建的listing往往会因为没有review而造成订单转化率不高。</p><p>Review，也就是亚马逊平台用户给我们的产品留下的产品评价。</p><p>注册亚马逊买家账户的用户都可以对产品的listing做出评价，可以对自己感兴趣的listing发表review。（前提是该买家帐号在亚马逊平台上至少有一次的购买记录。）</p><p>review评价的内容只能针对产品本身，跟卖家的服务水平、物流时效没有关系，亚马逊平台自检系统也会随机的对产品Review做出检测，对于违规的Review，系统会自动删除。所以有一些爆粗的的评论我们是可以点击report来申诉的。也有被系统删除的机会。</p><p>Review一般来说有以四种类型：</p><ol><li>直评</li></ol><p>直评，就是买家不用购买产品，就可以直接对商品进行评论。</p><p>亚马逊规则是允许没有购买的人也可以针产品进行评价，所以跟实际情况会有一定的偏差，也就导致了有部分人直接给某商品上多条好评或差评，从而影响到部分权重，甚至影响销售。</p><p>因为乱刷直评的现象越来越严重，亚马逊平台就把直评的权重降低了。导致现在直评对卖家的店铺星级、产品转化率起不了大作用。。</p><ol start="3"><li>VP评论</li></ol><p>VP评论，就是亚马逊买家购买产品后，留下的最真实的评论，当产品评价被标示为Verified Purchase，标示着撰写该产品评价的顾客在亚马逊上购买了该产品。</p><p>只有确认在亚马逊购买该产品的顾客才能在评价加上此标签，所以它的可信度更高、更富有说服力，占有超级高的权重，VP评论经常排在前面。</p><p>当然如果评价没有被标注为Verified Purchase，也并不代表评论者没有使用过该产品，仅代表亚马逊无法确定该订单是在亚马逊上完成的。</p><p>大家一起来聊一聊，评价的权重 是怎么样的？</p><p>文字评论、图片评论、视频评论？哪个权重最大？</p><p>权重大小依次是视频评论&gt;图片评论&gt;文字评论；</p><ol start="4"><li>Vn绿标评论</li></ol><p>Vn绿标评论在亚马逊Review中占有最高的权重，也更不容易被删除，优质的Vine Review可以让卖家快速建立起产品可信度和品牌声誉。</p><p>Vn绿标评论的来源可追溯至亚马逊推出的一个组织——Vine Voice！受邀参加Amazon Vine项目的产品，将由供应商提供给亚马逊，然后再由Amazon官方将产品免费送给Vine评论员，要求他们撰写评论。这类评论就是带有Vn小绿标的评论。</p><p>Vn绿标评论的权重更高但想获得这类评论，首先得有优秀的review ranker，这是加入Amazon Vine项目的基础。</p><p>这个VINE功能我们之前有说过，也是需要品牌卖家才能解锁的。</p><p>最近亚马逊平台变动，就是对最近的评价权重会更高了，说明平台更注重评价的时效性。</p><h5 id="11-QA是什么"><a href="#11-QA是什么" class="headerlink" title="11)QA是什么"></a>11)QA是什么</h5><p>Q&amp;A即Customer Questions &amp; Answers（客户的问题和答案），这个版块主要的目的是为用户提供一个sellers（卖家）与buyers（买家）、buyers与buyers之间交流产品特性、功能、质量品质等问题的区域，主要以问答的模式进行。</p><p>QA是我们对产品的的补充。在在产品页面的顶部，而且在转化中也发挥比较重要作用，我们适当的布局能极大影响转换率。</p><p>很多同学认为QA就是买家来问的。</p><p>其实我们自己也是可以上的。目前来说，找服务商上QA还是相对安全，而且也非常便宜。5-6RMB一Q一A。</p><p>QA相关注意事项</p><p>1.可以适当的插入关键词，但是不能堆砌关键词。</p><p>2.可以找买家账号来进行回复，提升可信度。</p><p>3.不要发广告内容，也不要在QA中推销产品。</p><p>4.不可以自问自答，也就是说卖家们是不能进行自己提问的，需要买家的账号来进行提问，卖家们只拥有回答的权限，当然如果卖家用自己的买家号来进行提问，就需要注意电脑使用的IP问题。</p><p>5.12个月内物满50美元的买家就能进行提问，在亚马逊调整了QA的提问要求后，现在能够留QA的买家是需要在过去12个月内购买超过50美金并不包含折扣金额的买家。</p><p>6.禁止如下信息:垃圾信息，包括广告、竞赛、其他公司的网站推荐信息等为推销产品的重复性信息。不能很好解决买家疑惑，反而是困扰、窘迫买家的信息。</p><p>鼓动买家去做非法、危险行为的信息。</p><p>侵犯他人隐私的信息、诋毁活供给他人的信息。</p><p>那QA我们应该怎么上呢，哪里来？</p><ol><li>竞争对手的好评</li></ol><p>把整个品类或者说竞争对手QA里面评论最多的去搬运过来，这些也是用户关心的点，同时把自己的关键词埋进去</p><ol start="2"><li>竞争对手的差评</li></ol><p>竞争对手的差评，也就是产品的痛点。这个是买家比较关心的点。</p><p>我们可以把痛点排序，然后针对最重要的安排至少两个问题，而且要把这个问题顶置在第一第二的位置，彻底解决客户的担忧疑虑。</p><p>回复的时候也是要正面积极回复。还有一个重点就是针对产品无法改变的缺陷，一定要安排有QA，这样会减少往后的投诉问题</p><p>竞争对手那里出现了差评痛点，就比如说，我们对标餐垫竞争对手里的差评说，这个餐垫洗了烘干后会起球，或者变形等等，我们就可以在QA提问：这个餐垫可以洗吗？洗后会变形起球吗？我在品牌买的洗过之后就影响美观了</p><p>我们可以安排上ANSWER,（我们自己的品牌）还有（上面问题提到的品牌我都买过，这个洗完后完全没问题。好用得很balabala~~`</p><p>卖家是可以回复A的，但是我们可以换个思路，王婆卖瓜，自卖自夸是可以的，但是自已夸一万遍都不如别人夸一遍是吧。</p><ol start="3"><li>产品使用功能及性能提问</li></ol><p>针对产品使用问题提问，注意埋词；针对产品缺陷提问，注意埋词。</p><p>再说一下评论，之前我们卖家是可以直接后台订单管理地方，可以向卖家邀评的，最近很多小伙伴收到邮件通知说可能会关毕</p><p>还有一项，我们卖家原本可以在评论下面回复的功能也关闭了。所以呢，养优质买家账号来给自己评论或上QA也是有必要的。</p><p>listing 的所有要素讲完了，这里想做个小调查，亚马逊平台上这些要素的权重 ，先后顺序是怎么样的？</p><p>权重 Tittle &gt; Search Term &gt; Bullet Point&gt; Description</p><p>以前是标题的权重大于5点描述大于长描述大于search term，但现在是标题的权重还是最大。其次是search term的权重，第三是5点描述的权重。第四是description的权重。</p><p>所以大家在埋入关键词的时，可以根据自己的一些决策去埋关键词。因为自动广告抓取标题和search term，所以这两块的关键词埋入一定要非常注意。</p><p>同时要注意的是，重复的埋入相同的关键词是不会对你的一个listing排名有帮助的，同时也会给一定的降权，因为这是属于作弊的行为。</p>]]></content>
      
      
      <categories>
          
          <category> 亚马逊新手训练营0~1教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 亚马逊新手训练营0~1教程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【第一课】公开课：独立站运营系统解析与训练营介绍</title>
      <link href="2022/091326252.html"/>
      <url>2022/091326252.html</url>
      
        <content type="html"><![CDATA[<h1 id="【第一课】公开课：独立站运营系统解析与训练营介绍"><a href="#【第一课】公开课：独立站运营系统解析与训练营介绍" class="headerlink" title="【第一课】公开课：独立站运营系统解析与训练营介绍"></a>【第一课】公开课：独立站运营系统解析与训练营介绍</h1><p>更新于：2022-04-20 4:00:22</p><p>在讲到独立站之前，想先和大家一起讨论下关于“赚钱的本质”的问题。关于这个问题，小北老师之前有一篇文章进行了非常深入和直白的探讨（<a href="http://guxiaobei.com/the-nature-of-making-money.html">http://guxiaobei.com/the-nature-of-making-money.html</a>） 核心观点我们可以这样总结，“生意的本质其实就四个字：低买高卖“，我想大家可以仔细思考下，是不是大部分的商业行为都可以用这个四个字来理解。</p><p>在我们了解赚钱的本质以后，我们就要了解赚钱的模式是什么，如果用四点来总结，那就是产品、渠道、运营、供应链，如果范围再缩小一点，其实就围绕下面三大点来展开，即产品、流量和变现。想要赚钱，围绕这套模式，所有的方法，策略，万变不离其宗！</p><p>从本质上来讲，平台和独立站对我们来说只是两个不同形式的销售渠道，不是非此即彼的关系，相反，二者各有所长，相互补充。独立站的意义在于可以帮我们更简单更直接地触及这个世界上可触及的所有流量，而不是局限在某个平台里。从当前的发展趋势来说，独立站是平台卖家从单纯的销售产品转型品牌化路线的必由之路。</p><p>目前在平台和独立站上，都有很多优秀的大卖出现，比如：一个是以SHEIN所代表的独立站玩家，另外一个是以Anker所代表的倚借成熟平台运作的品牌出海玩家，形成了两种不同的路径，且同样在今年2020年同样的迎来了各自的高光时刻。</p><p>公开数据显示，安克创新2020年8月25日登陆深交所创业板，当下市值已突破750亿元；SHEIN2020年6月销售额已超过400亿，全年有望迎来千亿规模。</p><h3 id="1-什么是独立站"><a href="#1-什么是独立站" class="headerlink" title="1.什么是独立站"></a><strong>1.什么是独立站</strong></h3><h4 id="1-1独立站是怎样运行的"><a href="#1-1独立站是怎样运行的" class="headerlink" title="1.1独立站是怎样运行的"></a><strong>1.1独立站是怎样运行的</strong></h4><p>简单来说，独立站就是让我们脱离第三方平台束缚的独立自主的网站，是与传统电商平台相对应的一种网站形式。对跨境电商来说，独立站指的是有独立网站域名、服务器和网站程序，并能通过线上方式面向用户展示产品、选购和支付下单，由网站管理者完全独立运营，不受平台限制而实现跨国交易的网站。</p><p>我们来举例说明，如果我想把西湖龙井卖到美国，我要怎么通过独立站来实现呢？首先，我需要先购买一个域名，假如这个域名是longjing.com，然后我通过建站平台，使用模板直接搭建一个网站，然后绑定我的域名，再绑定一个收款的工具，比如Paypal（Paypal就像是我们国内的支付宝一样）</p><p>接着我在Facebook和谷歌上开始打广告，让潜在的消费者看到我的广告，他们通过点击广告链接进入我的网站longjing.com，发现我的产品不错，就直接下单购买，我收到订单以后，通过国际物流把茶叶快递给客户，这就完成了一个交易过程。</p><h4 id="1-2独立站与平台的区别"><a href="#1-2独立站与平台的区别" class="headerlink" title="1.2独立站与平台的区别"></a><strong>1.2独立站与平台的区别</strong></h4><p>独立站与2C电商平台的有三个本质区别：</p><p>1、流量获取灵活性及所有权。在2C平台上销售，流量是平台先获取，进到平台里就属于平台所有。平台制定规则和流量分配机制，无论是排名、权重、谁能卖（多少）谁不能卖（多少）、具体怎么卖、和谁一起卖，都是平台说了算。</p><p>而独立站则是先创建自己的电商网站，然后建立自己的营销渠道并引流到网站，是拥有100%自主权的，可以随意支配，不受限制，还可以反复、随时触及。同时，还可以通过后台对不同的流量渠道和管理营销数据进行管理和分析。</p><p>所以平台是分配给你流量，而独立站是你自己要去找流量</p><p>2、顾客体验可控性及所有权。</p><p>也就是你的品牌和商品以什么样的方式展示给顾客，还有整个浏览体验和购物流程的设计。这些东西在2C平台上全部都是由平台控制的，比如你的店铺什么样子、产品信息格式、图片规格、整个购物车到支付的流程等等。</p><p>而且平台设计这一系列体验的目的并不是为了凸显某个第三方卖家的品牌，而是为了让消费者有最多最好的选择，还可以从这些选择里更快速的找到自己要什么。这也就决定了商家为什么要去和“跟卖”死磕，不停地改Listing，甚至采取“刷单”的动作，因为只有这些东西是商家可控可看到的。</p><p>而在自己的电商独立网站上，商家可以自己决定如何最贴切的展示自己的品牌和商品，自己控制购物流程，包括整个浏览转化过程的数据。一切的一切都是为了在自己的地盘更好地凸显自己的特点，为品牌提升销售转化。</p><p>所以平台是把产品的展示结构都给固化了，而独立站的产品展示可以更丰富，更灵活，在数据的把控上可以追踪更多的信息。</p><p>3、最简单的也是最重要的，客户所有权。</p><p>2C平台的流量是平台的，转化成了客户，客户也是平台的，和平台上的卖家没关系，只是以订单的方式告诉你要发货了。商家很难有与客户直接互动的可能，也无法获得第一手客户数据。这最直接影响的就是需求分析和客户留存。</p><p>商家需要不断透过“平台需求“这个棱镜尝试判断”客户需求“，也要想方设法地跳过、跳出平台吸引客户复购。这些与独立站的模式都是相反的，独立站不仅使我们能获得全部的数据和信息，还能通过各种工具让我们更好地分析客户需求，与客户联动。</p><p>诸如亚马逊，你产品卖的再好，但是你不知道客户的信息，没有客户的邮箱，地址，电话，那么你就不能二次利用客户，长久来说，这并不是一个可以“让你很踏实”的生意，但是独立站不是，独立站的用户，信息，电话，如果他们在你平台上有成交，你都是可以获取的，那么这样的信息就非常有价值了。</p><p>综上所述：</p><p>平台的优势在于它们拥有现成的流量资源，第三方卖家可以借助平台流量来实现自己的销售目标。但是受限于平台的规则，第三方卖家并不能真正的掌握客户数据，也就无法和客户建立比较紧密的联系；</p><p>运营独立站虽然需要一定的推广能力为我们的网站带来流量，但是相比较于平台的条条框框，独立站的灵活性更高，我们所能掌握和控制的流程和客户数据也更加完整，而这些流程和数据可以帮你为客户提供更具个性的服务，提升客户体验和溢价能力的同时，树立更加鲜明的品牌形象，培养客户的忠诚度。</p><h4 id="1-3独立站运营有哪些难点"><a href="#1-3独立站运营有哪些难点" class="headerlink" title="1.3独立站运营有哪些难点"></a><strong>1.3独立站运营有哪些难点</strong></h4><p>当然，如果独立站这么好，大家都去做独立站了，没有人会选择平台，那么独立站有哪些难点呢？</p><p>首先，独立站还是有一定的入门门槛，需要基本的建站和运营能力。虽然说随着类似Shopify这样的第三方 SAAS 建站工具的普及，创建自己的独立站再也不像以前需要有技术前端后端做开发，但基本的网站的用户体验，购物流程的设置，网站的产品详情页等等还是需要一些基础的。</p><p>对于一些有专人操作的公司，很容易就能在一周内建立网站，并且开始一天十几单。但对于那些没有专门的人来负责独立站的小团队和小公司来说，往往自己尝试几次受阻之后，独立站跨境电商这个事情就搁置了。</p><p>其次，独立站最大的问题是没有直接的自然流量。需要自己搭建网站的引流渠道，也需要做用户的运营来最大化前期引流回来的用户留存，转化和价值挖掘。</p><p>不同于亚马逊、eBay这一类平台像一个大市场一样在每个页面展示众多卖家的产品信息，独立站是我们拥有的一个专业的属于商家自己的独立电商网站，每一个独立站都有一个商家自己选择的品牌域名，用户要点击访问域名才能浏览到我们在售的商品。</p><p>因此，网站上线之后需要我们通过SEO，社交网络，红人推广，视频营销，付费广告等等营销推广方式主动的将我们的品牌和商品推送展示给潜在客户。除非我们的品牌已经有一定知名度，否则我们开了店什么都不做，是很难有自然流量的，更不要说销量。</p><h4 id="1-4独立站有哪些建站方式"><a href="#1-4独立站有哪些建站方式" class="headerlink" title="1.4独立站有哪些建站方式"></a><strong>1.4独立站有哪些建站方式</strong></h4><p>电商独立站建站主要有两种方式，一种是Saas建站方式，例如Shopify，另一种是开源建站方式，例如Wordpress+Woocommerce。</p><p>我们可以这样理解，对于Shopify这种Saas系统来说，它就是已经建好的简装商品房，房子的选址、建设、装修工作都由Shopify来完成，我们缴纳租金租赁，就可以拥有一个功能齐全的房子，重要的是这个房子还有Shopify的保安每天帮我们巡逻，我们也不用担心安全问题。</p><p>如果我们想给这个房子搞装修，在不损坏房子架构的基础上，利用官方或者第三方主题和插件去进行升级改造即可，我们也不需要自己去写代码或者一砖一瓦的配置。只要我们按时缴纳租金，遵守Shopify的规定，我们就可以持续经营。</p><p>而Wordpress+Woocommerce就像是自建房，我们要自己租赁服务器，配置服务器，然后再盖房子，当然，这个盖房子也无须一砖一瓦的写代码，而是利用Wordpress工具框架去实现即可，同样利用主题和插件来进行装修和功能的完善。房子建好以后，我们还要多做两步工作，一个是建立自己的安防系统，避免有人恶意来破坏我们的房子；另一个是对服务器进行日常维护。</p><p>在实际操作上，使用开源程序建站，我们要解决的建站技术问题会比较多，如购买服务器，域名的解析配置，服务器环境配置，网站程序的配置，前台页面显示效果的实现，支付通道集成，风险的控制，网站备份，以及后期的技术维护，这些都需要比较专业的技术知识。</p><p>而且我们也要做好随时解决问题的准备，或者说你可以托付给可以信任的专业团队来代为维护外围工作。Wordpress的好处在于，它才能算是真正意义上的自建站，不会遇到类似于Shopify的封店等问题。对于做ToB的用户来说，Wordpress在定制化、灵活性和SEO上的巨大优势绝对是Shopify难以企及的。</p><p>但是，对于大多数中小卖家来讲，我们要优先解决的，是生存问题，而对于独立站卖家来讲，要解决生存问题的第一要务，是解决流量问题。因此，在Shopify已经可以很好的解决99%的技术问题的前提下，暂时没有必要花太多的时间精力去研究建站技术问题，而应该集中精力研究如何为我们的网站带来更多更精准的流量资源。</p><p>另外，单从技术上来讲，我们网站最核心的价值在域名上，而不在我们使用了什么建站程序，无论何时，我们都可以把你的网站数据从Magento或者WooCommerce迁移到Shopify，当然，也是可以随时把网站数据从Shopify迁移到WooCommerce或者Magento的。</p><p>总体上来看，Shopify 较 WordPress 和 Wix 这类的纯网站建站工具来说要相对更适合电商用户，和Magento、Woocommerce 类的开源电商系统相比在使用上又比较轻便。不需要懂代码，不需要懂服务器，不需要额外的聘请专业的建站技术团队，只需要在 Shopify 网站上注册账号完成基本设置，就可以很快很轻的开始。</p><p>Shopify 和同类型的其他云端建站工具或平台相比，产品体验更棒，更安全，平台的生态系统也更加的完善可靠，还有非常多活跃的服务商和开发者。大家去Google，YouTube或者Facebook搜索可以找到海量的有关 Shopify 的内容，很全面。</p><p>因此本次训练营课程中，我们也将使用Shopify作为我们的建站工具，来演示独立站的建设过程，但是原理是相通的，后期如果我们想使用Wordpress来建站，也可以参考本次课程的理论和内容。</p><h4 id="1-5运营一个独立站需要哪些资源"><a href="#1-5运营一个独立站需要哪些资源" class="headerlink" title="1.5运营一个独立站需要哪些资源"></a><strong>1.5运营一个独立站需要哪些资源</strong></h4><p>回到我们开头讲的内容，独立站的资源和其他平台所需要的资源，如果从大方向来说，都是一样的，那就是：产品、渠道、运营、供应链。具体到建站的准备资料和关键设置信息，我们可以参考下表。</p><p>但是参与训练营的同学无须提前准备下述内容，因为每一项资料和设置我们都要讲解其原理、操作方法和注意事项，自行操作可能会踩很多坑，而且最后发现是无用功。</p><table><thead><tr><th>序号</th><th>内容</th><th>要求</th><th>是否必须</th></tr></thead><tbody><tr><td>1</td><td>网站域名</td><td>符合产品特性和品牌要求</td><td>是</td></tr><tr><td>2</td><td>电子邮箱</td><td>推荐国外常用邮箱gmail或outlook，或者企业邮箱</td><td>是</td></tr><tr><td>3</td><td>客服号码</td><td>显示在网站页面的客服电话，可购买Google Voice</td><td>建议</td></tr><tr><td>4</td><td>实际地址</td><td>用于店铺注册和发货设置，可以验证的实际地址</td><td>是</td></tr><tr><td>5</td><td>支付方式</td><td>信用卡或Paypal,用于Shopify月租及其他费用支付</td><td>是</td></tr><tr><td>6</td><td>收单工具</td><td>例如Paypal、Stripe等，用于收取客户支付的货款</td><td>是</td></tr><tr><td>7</td><td>竞品网站</td><td>找到适合的竞品网站，用于参考模仿</td><td>建议</td></tr><tr><td>8</td><td>主题选择</td><td>Shopify官方主题或者第三方主题</td><td>是</td></tr><tr><td>9</td><td>Logo</td><td>Png格式的Logo及Favicon</td><td>是</td></tr><tr><td>10</td><td>主题颜色和字体</td><td>网站主要颜色和强调颜色，字体</td><td>是</td></tr><tr><td>11</td><td>Facebook账号</td><td>建立Facebook page，开通Facebook shop</td><td>可选</td></tr><tr><td>12</td><td>Insgram账号</td><td>如需使用Ins Shop，或进行社交展示</td><td>可选</td></tr><tr><td>13</td><td>Google Analystic</td><td>绑定GA，用于对网站流量及数据进行分析</td><td>建议</td></tr><tr><td>14</td><td>货币和计量单位</td><td>如美元、澳元，lb或kg，用于系统对产品的计量</td><td>是</td></tr><tr><td>15</td><td>店铺时区</td><td>设置与发货地或广告、GA一致的时区</td><td>是</td></tr><tr><td>16</td><td>税收政策</td><td>是否对产品征税，税率是多少</td><td>是</td></tr><tr><td>17</td><td>退换货政策</td><td>是否接受退换货，接受多少天内退换货</td><td>是</td></tr><tr><td>18</td><td>发货时间</td><td>产品发货时间和预计运输时间</td><td>是</td></tr><tr><td>19</td><td>运费政策</td><td>运费收费标准及免邮条件</td><td>是</td></tr><tr><td>20</td><td>产品类目</td><td>产品类目设置</td><td>是</td></tr><tr><td>21</td><td>菜单</td><td>Header Menu内容和Footer Menu</td><td>是</td></tr><tr><td>22</td><td>筛选tag</td><td>客户根据哪些内容进行筛选，例如类目、价格、颜色</td><td>可选</td></tr><tr><td>23</td><td>产品评论</td><td></td><td>建议</td></tr></tbody></table><h4 id="1-6运营独立站需要多少费用"><a href="#1-6运营独立站需要多少费用" class="headerlink" title="1.6运营独立站需要多少费用"></a><strong>1.6运营独立站需要多少费用</strong></h4><p>第一阶段:筹备</p><p>这里我们考虑以个人为主体来运营独立站</p><p><strong>1、Shopify模板费用</strong></p><p>有免费版本和付费版本，初始阶段可以先用免费模板，所以前期你的模板费用可以是0元；如果是付费模板，Shopify官方价格在120-180美元，第三方如Themeforest，一般在59-99美元，模板都是一次付费，终生免费更新使用的</p><p><strong>2、Shopify月租费用</strong></p><p>对于初入Shopify来说，基础版29美元/月的套餐已经可以满足大部分需求</p><p><strong>3、域名费用</strong></p><p>以新注册.com域名来计算，国内外域名服务商价格相差不大，一般是每年60人民币左右</p><p><strong>4. 接入支付通道</strong></p><p>PayPal是免费开通，所以无接入费用；信用卡支付渠道差异比较大，如果是2checkout和Stripe这样的渠道，而且资料齐全的话，可以计算为免费，其他国内渠道一般费用在3000以上，价格不等。</p><p>如果我们以最低配置来计算，那么必要的筹备费用就是每月29美元月租+60元/年的域名费用。</p><p>第二阶段：运营</p><p>这里涉及到广告账户开户等行为，因此我们以公司或个体户为主体来计算。</p><p>1.、公司注册费用</p><p>如采用云上注册，有些园区可提供免费注册，每年代理记账的费用一般在2500元以内；注册个体工商户同样可行，可以直接网上免费注册，费用可计算为0，代理记账一般在几百元即可</p><p>2、广告费用</p><p>目前国内Facebook开户预存费用一般是500美元起步，广告投放费用则根据产品和投放策略差异巨大，从每天数十美元到数千美元不等。</p><p>3、采购及物流</p><p>如果我们是小型创业团队，前期可以采用dropshipping一件代发模式。这样我们没有垫付资金，可以默认采购成本、物流成本、包装成本为0 。</p><p>如果是亚马逊转型独立站的，调用的也是已有的资源，这一项的成本只有在产生销售的时候才会出现。所以，对于转型的亚马逊卖家来说前期成本依旧为0。</p><p>4、交易费用</p><p>交易费用分几个部分，第一个部分是Shopify的交易费用，以29美元的基础套餐来计算，这个费用是销售金额的2%；第二个部分是收单工具手续费，例如Paypal初阶费率为4.4%+$0.3</p><p>第三个部分是国内结汇汇损，例如Payoneer新账户为1.2%，如果我们产品的售价为100美元，那么中间产生的费用总计4.7美金(PayPal费用)+2美金(Shopify交易费)+1.12美金(汇损)=7.82美金，也就是7.8%左右。当然我们使用不同的收单工具和不同的结汇方式，这个费率都是不同的，如果使用Shopify Payment，一般可以降低到4.5%左右。</p><p>Shopify的营销渠道广泛，因而随着我们营销策略的变化将会产生各种营销费用，这个无法详细计算，因而不再赘述。</p><p>上述费用都可以看作我们运营Shopify必须支出的运营费用，而这些费用是跟我们的销售额相关的，销售额越高，支付的费用也就越高。当然销售额越高，我们也可以向我们的收单渠道申请更低的费率。</p><p>要不要做独立站</p><h4 id="2-1独立站新卖家可能想了解的内容"><a href="#2-1独立站新卖家可能想了解的内容" class="headerlink" title="2.1独立站新卖家可能想了解的内容"></a><strong>2.1独立站新卖家可能想了解的内容</strong></h4><p>“我们不是亚马逊的竞争对手”，Shopify的创始人Lütke说，”当你在亚马逊上买完所有必需品后，会期待看到让你眼前一亮的商品。这是你来到 Shopify 的原因”。</p><p>其实关于能不能做，要不要做，我们还是要回到前面关于赚钱的本质问题，我们的业务不应该是基于Shopify或者是基于Amazon的，而是基于我们的产品或者服务，基于我们的客户的，无论是Shopify还是Amazon，都只是我们将产品或者服务送达到客户手里的一个销售渠道罢了。你要评估的，是就你自己现在所掌握的资源，你自己的优势，以及独立站和平台各自的特点来讲，哪条路更容易成功。</p><p>小北老师说过，创业=长期主义+专业主义，我们做事情一定要做能够沉淀的，没有沉淀，做事是没有未来的！你去看跨境电商中的很多人，其实早就赚钱了，但是根本没有任何用户，没有品牌。所以很多人，因为没有沉淀，你会发现他们每做一件事，都要重新再开始，这样是非常的累，至少在我看来是这样的。</p><p>沉淀是非常重要的，今天可能你跑的比别人慢，但是一件事如果有沉淀，那么你未来一定要远远胜过你周围的很多人!所以，为什么跨境电商中的很多大卖，是边赚钱边焦虑。钱是赚了很多，但是心里是虚的的，因为你都不知道你现在做的这个事，未来会如何。</p><p>如果你没做好这种长期的准备，那么你可能现在还不适合做独立站。</p><p>很多人可能会问，老外是傻么，独立站这么贵也买，为什么不从亚马逊上买？不要以为亚马逊非常火，全部老外都跑到亚马逊上去购买东西了。这么说吧，老外在开始做一个产品的时候。</p><p>首先必须，一定要把自己的官网，博客都搭建起来的，在国外用户对独立站的认知度是非常高的。国内基本很少人玩论坛，博客了，都把时间花在自媒体上，但是老外不同，论坛，博客，独立站一样非常火热！</p><p>所以不要用低价思维去思考很多事情，你把好的东西，有价值的东西传递给别人，别人是愿意付这个钱的，如果以我们自己低价的思维去做市场，那市场不用做了，会让你觉得每个人可能都没钱吧。</p><p>所以独立站，不是你能不能做的问题，也不是有没有利润的问题，是你想不想去做的问题！</p><h4 id="2-2亚马逊等平台卖家可能想了解的内容"><a href="#2-2亚马逊等平台卖家可能想了解的内容" class="headerlink" title="2.2亚马逊等平台卖家可能想了解的内容"></a><strong>2.2亚马逊等平台卖家可能想了解的内容</strong></h4><p>亚马逊和独立站（以Shopify为例）多维度对比：</p><p>（1）启动资金</p><p>首先，在初期费用上，Amazon开店月租为39.99美金，Shopify开店的月租为29.9美金。在交易费用上，亚马逊的交易费用在15%左右，Shopify的交易费用在2%以下（对整体业务来讲，加上收款渠道的费用，真实的交易费用在5-8%左右）。</p><p>不过这个都是表面上我们能看到的，在我们实际运营过程中，Amazon你可能还需要先备一些货，甚至先发一些货到FBA的仓库或者海外仓里面，以保证能够拿到亚马逊的优质流量，满足Amazon对商家绩效的要求，而备货，发海外仓，以及这些货如果因为卖不出去成为了积压的库存所产生的边际成本和滞仓费用，也都是我们需要考虑到初期费用上的；</p><p>Shopify在前期可以不备货（Dropshipping的模式去做，或者有订单了再采购），不过为了保证客户的用户体验，提前备货甚至发海外仓会更好一些。Shopify在前期的主要费用来自于推广的费用。这个费用灵活，因人而异。如果你有广告推广经验，这个费用不叫做费用，而叫做投资。</p><p>如果你没有广告推广经验，而是一个完完全全的小白，前期的推广费用可能更多的是在交学费。所以在推广费用上，是可大可小的，你一定要按照你自己或者你们公司的实际情况，设置好预算，然后采取对应的策略。这个我们后面再展开详细说明。</p><p>（2）开户难易程度</p><p>在账户开通的难易程度上，Amazon相比较于Shopify来讲，卖家数量多很多，因此流程上要相对复杂一些，而且受平台政策影响相对要大一些，账户注册下来之后，也并不意味着你就高枕无忧了，后续还会因为经营绩效，以及平台政策的原因收到账户审查的通知。</p><p>而Shopify在账户开通上就要简单很多，只需要准备一张支持美金付款的信用卡或者一个绑定了你的借记卡或者信用卡的PayPal账户，一个邮箱，花2-3分钟注册账户，就可以开通你的Shopify账户了，相比较于Amazon，Shopify的经营方式，策略和理念是不同的，因此，你可以理解为Shopify对于商家的管理要更加的佛系和开放，不会轻易的关闭你的账户，但是Shopify也有它不能触犯的底线。</p><p>具体你可以查看Shopify的Terms of Service来详细了解。当然，网上也流传有很多关于Shopify封号的消息，你可以查看这篇文章来详细了解封号的原因和规避封号的风险，在我看来，这些封号都不是真正意义上的封号。只要你不触犯Shopify的底线，那你的账户就是始终安全的。</p><p>（3）流量资源</p><p>在流量资源上，对我们中小卖家来说，Amazon有着巨大的诱惑力。Amazon凭借它多年的苦心经营，建立起了今天我们看的到的商业帝国，亚马逊的创始人杰夫也一度登上世界首富的宝座。</p><p>根据eMarketer的数据（<a href="https://www.emarketer.com/content/more-than-half-of-us-households-will-be-amazon-prime-members-in-2019">https://www.emarketer.com/content/more-than-half-of-us-households-will-be-amazon-prime-members-in-2019</a>），超过半数的美国家庭是Amazon的Prime会员，而另外一个网站提供的数据则为82%的美国家庭是Amazon的Prime会员（<a href="https://www.digitalcommerce360.com/2019/07/11/82-of-us-households-have-a-amazon-prime-membership/">https://www.digitalcommerce360.com/2019/07/11/82-of-us-households-have-a-amazon-prime-membership/</a>）这个数字还是相当恐怖的 – Prime意味着更优质的买家资源，更强的购买力。</p><p>亚马逊开店相当于亚马逊将这些优质的流量资源共享给了全球卖家，卖家们站在巨人的肩膀上起舞，能不能借亚马逊的资源发展壮大自己，就要看你的舞步是否足够精彩漂亮了。</p><p>Shopify的经营模式决定了它没有办法给它的用户提供像亚马逊那样的流量资源，这样就对Shopify的卖家朋友们提出了更高的要求，不管是资金上的，还是流量运营上的。Shopify卖家需要各显神通，想尽办法获取更多更优质的流量资源。不管流量渠道是FB广告，还是Google Shopping，是SEO，还是红人，视频，社媒运营。</p><p>（4）竞争环境</p><p>Amazon和Shopify在流量上的不同特征，也影响着各自业务的竞争环境的差异。亚马逊的竞争环境相比较要更加的直接和残酷一些。亚马逊的第三方中小卖家要面对的，除了牛皮癣一样的跟卖，还有来自于大卖家以及亚马逊自营这个超级大卖家的围剿。</p><p>Shopify的竞争环境则要更加的宽泛和复杂一些。Shopify卖家要抢夺的，是Facebook的广告位资源，是搜索引擎SERP页面的展示资源，是各个圈子里面的流量资源，战场更加的分散一些。不过相同的是，Shopify卖家同样也要正面面对着来自于亚马逊这个超级巨头，以及Ebay，速卖通，Wish等等巨头带来的在争夺流量资源上所给予的竞争压力。</p><p>（5）选品方法</p><p>竞争无论如何肯定是存在的，因此，无论对于Amazon卖家还是对于Shopify卖家来讲，尤其是Amazon或者Shopify的中小卖家来讲，选品是通往成功这条路上至关重要的一环。在选品方法策略上，无论你的主战场是Amazon，还是Shopify，是没有太大的差别的。</p><p>你可以把亚马逊的那一套选品策略直接用到Shopify独立站的选品上，无非调研的网站做一些调整。你也可以把你用在独立站上选品方法扩展到亚马逊的选品上。不过有一点我比较建议的选品方向是，在某个垂直方向上精细化运营，而不是无止境的选品铺货，尤其在当前独立站大规模爆发的情况下。</p><p>（6）资金周转</p><p>在资金的周转上，Shopify的周转周期，相比较于亚马逊来讲，要快很多。因为Shopify的收款是通过PayPal，信用卡通道收款的，绝大多数情况下，只要客户付款，钱是马上到达你的PayPal账户和信用卡收款账户里面的，你也可以随时将资金提现到你的人民币账户，通常7天以内就可以到账。而亚马逊则有14天的放款周期。资金周转快，也就意味着资金的使用效率更高，单位货币可以给你带来更多的利润，从而实现业务更加快速的扩展。</p><p>（7）客户资源</p><p>在客户资源上，Shopify要比Amazon有着明显的优势。近两年国内流行的私域流量的概念，反映在我们跨境电商行业，就是我们辛苦经营沉淀在手里的客户信息资源，尤其是邮箱信息。这些客户信息资源可以用来干嘛？你可以看看亚马逊以及行业里面的独立站大卖们是怎么使用这些资源的。</p><p>为了更好的说明问题，我们暂且片面的举例为，Business #1(Amazon)通过借助平台的流量资源，而Business #2(独立站)通过猛打Facebook广告，在第一个月M1都达到了50000美金的销售额。</p><p>在第二个月，Business #1和Business #2都在失去获取新的流量来源的情况下，比方说，Business #1(Amazon)的账户被封，因为没有办法再获取新的流量，而导致销售额马上变成了0；Business #2（独立站）的FB广告被封，虽然和Business #1（Amazon）面临同样的窘境，但是Business #2凭借它在M1沉淀下来的客户信息资源，使用邮件营销也可以让第二个月有很好的销售额。</p><p>要知道，<a href="https://www.waimaob2c.com/tag/emailmarketing">邮件营销</a>的成本是要远远低于FB的广告成本的，M2的销售额可能是M1的销售额的一半，但是在利润层面上，M2却有可能是远远高于M1的。</p><p>因此，我说，客户信息资源，尤其是邮箱资源，是我们建立更加稳固的流量矩阵和更有竞争力更坚固长久的业务，提供更好的客户体验和服务，建立品牌和品牌忠诚度的基石，应该不会有人反对吧？</p><p>（8）业务模式</p><p>Shopify 能颠覆亚马逊吗？著名互联网分析师 Ben Thompson 认为，‘这是对付像亚马逊这种“聚合者”（Aggregator）的唯一方法’。在他看来，亚马逊是具有控制权的中介。而 Shopify 是一个平台，‘平台之所以强大，是因为它们促进了第三方供应商和最终用户之间的关系’，平台关心互利。</p><p>亚马逊到现在总共建立 300 多个物流中心和比这更多的分销和分拣中心，除了自营，这家电商巨头从 2006 年就开始让第三方卖家涌入亚马逊的网站。但是，这些网站使用亚马逊的物流中心的同时，也被套上了那个画着微笑符号的盒子。</p><p>这意味着，品牌自身的形象并不完全是鲜明的，它们只是亚马逊货架上的一员，与站内竞品打着价格战。而Shopify在做的，是去激励各个环节的最优部分，主动协调。商户、开发者、设计师、第三方物流供应商也因此被调动了起来。他们和 Shopify 一样，正在慢慢做大自己的蛋糕。</p><p>不管独立站，还是亚马逊，对于品牌来讲，都只是一个销售渠道而已。客户在独立站上下单，那你就能拿到客户的电话邮箱信息，就可以以极其最低廉的成本，以各种渠道方式，无限次的和客户沟通来实现返单，提高客户对品牌的忠诚度，保证业务的稳定增长。如果客户在亚马逊上下单，从本质上讲，这个客户不是你的，而是亚马逊的。</p><p>要不要做独立站，不是选择的问题，而是时机的问题。</p><h3 id="3-如何做独立站"><a href="#3-如何做独立站" class="headerlink" title="3.如何做独立站"></a><strong>3.如何做独立站</strong></h3><h4 id="3-1运营独立站的系统思维"><a href="#3-1运营独立站的系统思维" class="headerlink" title="3.1运营独立站的系统思维"></a><strong>3.1运营独立站的系统思维</strong></h4><p>独立站的基本运营流程包括搭建网站、引流、优化。</p><p>第一步：搭建网站</p><p>这一步很简单，注册登录Shopify以后，把各个部分设置，添加插件以补充各种功能，就可以搭建一个很漂亮的网站。</p><p>第二步：引流</p><p>流量有免费的和付费的。一般而言，我们想要快速获得结果的话，就要做广告获取流量，主流一般是Facebook广告和谷歌广告。要获取免费流量就需要做SEO，这个见效相对较慢。</p><p>第三步：优化</p><p>优化这一步是为了提升复购率。当你的网站有了流量有了订单以后，你就要思考如何才能进一步提高转化率、提高利润，不断优化用户体验，拓展有效的流量渠道。</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/af547ffa1984449f8454e802fdadf2341800.png" alt="img"></p><p>系统化的Shopify运营思维流程图</p><p>对这张图做一个简单的解释：</p><p>我们做独立站这件事情第一件事情，就是建站，建站可以使用<a href="https://www.waimaob2c.com/shopify.html">Shopify</a>，<a href="https://www.waimaob2c.com/woocommerce.html">Woocommerce</a>，Magento，或者Bigcommerce来实现，但是建站的过程本质上就是我们图中倒三角“销售漏斗Sales Funnel”建立的过程，那这个销售漏斗任务是什么？</p><p>将流量变现。这个流量可以是用广告的方式买来的，也可以是红人，视频，SEO等等其他方式带来的。流量变现的载体就是我们提供(大部分卖家在做的)实物商品 Physical Product 或者 (部分卖家在做的) 虚拟商品/服务 Virtual Products/Serivice (选品方向参考)。</p><p>我们导入到销售漏斗里面的流量有两种选择，一种是流失掉，一种是不断向下最终转化为订单和客户。对于流失的流量，在不同的漏斗层级需要使用不同的再营销手段或者挽救策略将他们(Warm Traffic)再次导入到我们的销售漏斗中转化为订单和客户。我们独立站的终极目标是销售，赚更多的钱，因此根据公式</p><p>当我们不断有更多新的流量进入销售漏斗，有更高水平的CR和AOC，也就意味着拥有更多的订单，客户资源以及更高的销售额。因此，在我们的工作中就有了新的目标 – 追求更高的客户终身价值 (Customer Lifetime Value)，这也是提高广义上AOV的重要策略之一。</p><p>这一新的目标最直接的体现在我们通过邮件营销，Messenger营销等等方式维系客户关系，从老客户手中挖掘出更高的价值。间接的还体现在，我们可以通过口碑营销，类似受众等等方式裂变出更多高质量精准流量/客户。</p><p>我们说了 $=V x CR x AOV: 更多的流量，更高的转化率，更高的客单价，一定是更高的销售额。但是更高的销售额就一定等于更高的利润吗？</p><p>肯定不是的吧！因此，我们还要将RoAS (Return on Ad Spend)，ROI (Return on Investment)纳入到日常运营过程中必须关注的两个指标。ROAS更多关注的是销售额和推广费用之间的关系，ROI更多关注的是销售额和整个运营投入(推广成本，产品成本，运输成本，仓储成本等等)之间的关系。</p><p>我们做独立站就是为了赚钱，就是追求更高的ROI，ROAS，追求更高的V，CR，以及AOV，追求更高的客户终身价值。有目标追求是好的，但是总会遇到瓶颈的，比方说，独立站的CR从2%提高到5%可能相对比较简单，但是从5%提高到8%就要困难很多很多了。那么下一步呢？</p><p>你可以持续投入更多的时间精力去提高各项指标，又或者，你可以花相对更少的时间精力直接复制上面成功的运营模型，开始走批量路线。</p><h4 id="3-2什么是Dropshipping"><a href="#3-2什么是Dropshipping" class="headerlink" title="3.2什么是Dropshipping"></a><strong>3.2什么是Dropshipping</strong></h4><p>在一项交易的环节中，其实分别存在三种不同的角色：</p><p>◎ 供应商</p><p>◎ 零售商</p><p>◎ 客户</p><p>这个道理很简单，零售商从供应商这里拿货，然后通过一定的渠道销售给客户，这是我们很常见的售卖模式，无论你是做ebay，还是亚马逊，还是速卖通，都是遵循这套模式。</p><p>而Dropshipping其实也是遵循这套模式，但是这个过程他更轻便，零售商现在</p><p>◎ 不需要自己拿货</p><p>◎ 没有库存</p><p>◎ 没有大量的资金投入（主要费用在引流成本上）</p><p>◎ 不需要客服</p><p>◎ 不需要自己打包发货</p><p>那dropshipping他的整个流程是怎么样的呢？</p><p>第一阶段：零售商将支持一代发业务的供应商提供的产品信息放到自己的网站上</p><p>第二阶段：买家到零售商的网站上下单购物，零售商将买家的订单信息以及订货成本和运费费用发给支持一件代发业务的供应商</p><p>第三阶段：零售商赚取的是“买家的付款-供应商的货款-运费”之后的差价。</p><p>各位可以看到：</p><p>在第一阶段，零售商把产品放在网上销售，很多时候就是利用独立站来搭建的</p><p>在第二阶段：零售商把买家的订单信息发给供应商，这个就是倒买倒卖的模式（很多时候是利用插件来的）</p><p>在第三阶段：零售商赚取的就是差价</p><p>下面这张图很好的解释了dropshipping的整个流程！</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/d639c48f3ab44f01bed8c70b51c30d131800.png" alt="img"></p><p>我们来做个比较：</p><p>传统方法：</p><p>传统的方法，你首先需要一定的创业资金对不对，假设你的启动资本是10W人民币。然后呢，你再开一个店，这个时候你可能要去alibaba.com上进货，拿货的成本有多有少，假设这个成本在4w人民币，剩下的6w还有各种各样的费用支出，那么用在广告推广上的钱就没多少了。而且更为重要的是，你囤的这些货，可不是一天两天能卖的出去的。</p><p>如果加上你选品错误，那么这个过程可能会存在滞销，库存压力，广告转化不行，那么货就变成库存，你的压力就摆着呢。</p><p>Dropshipping模式：</p><p>而利用Dropshipping就没有这种问题了，在Dropshipping业务模式中，卖家成功的将库存风险转移到了供应商那里，也把订单的打包发货外包给了供应商，自己只需要专注于网站的运营推广。</p><p>在这种方式下没有库存，也不要处理发货，打包的事，你只是需要把时间放在营销上，获取更多的流量上，或者你可以有更充足的时间来测试产品。</p><p>那么在这个过程也就意味着有更多的预算可以投入到广告推广上，同样的创业成本，在Dropshipping模式下，可以至少可以用8成的费用来推广。</p><p>所以从这个角度来看dropshipping的优势非常明显！而且通常老外的做法是，推某一款产品，如果连续推一周都不出单或者出单比较少，就会直接换产品。如果手里有大量库存，就没有这么轻松了。</p><p>我们使用独立站来实现Dropshipping也无须手动处理上述流转的过程，Shopify有一个免费但是非常好用的一件代发工具：Oberlo，可以帮你打通Shopify和速卖通这两个平台。通过Oberlo，你点几下鼠标就可以轻松的将速卖通的产品信息和产品图片导入到Shopify网站里面，实时同步速卖通的产品库存信息到Shopify。同样的。在你的Shopify产生订单之后，点几下鼠标就可以将订单下到速卖通，完成Dropshipping所需要的所有操作。</p><h4 id="3-3什么是POD"><a href="#3-3什么是POD" class="headerlink" title="3.3什么是POD"></a><strong>3.3什么是POD</strong></h4><p>POD就是Print On Demand，也就是定制服务。由你自己（或找设计师）设计图案，然后把图案印在衣服、杯子等产品上。POD的运作流程是这样的：</p><p>第一步：你要有设计图</p><p>第二步：把你的设计与产品结合，并把产品上传到店铺</p><p>第三步：你的店铺会把订单信息通过app发给服务商</p><p>第四步：服务商开始生产你的产品，打包，然后发邮件告诉客户已发货，并告诉客户物流信息</p><p>这种模式可以通过Shopify的插件实现，比如printful, customcat，ViralStyle，和dropshipping一样，这种模式不需要囤货。费用可能花在设计图案上的要多一些。但是，这种定制产品和普货不同，有独特的设计，也能卖得起价格。</p><h4 id="3-4免费产品-付运费模式"><a href="#3-4免费产品-付运费模式" class="headerlink" title="3.4免费产品+付运费模式"></a><strong>3.4免费产品+付运费模式</strong></h4><p>免费产品+付运费的模式就是：产品为0美金，客户只需要付运费就可以购买产品。</p><p>比如，一个店铺打算卖5美金的产品，收运费2.5美金。如果用免费产品+付运费的模式，那么产品价格就是0，而运费会涨到7.5美金。这种模式对顾客来说会更有吸引力，毕竟大家都喜欢免费的东西。</p><p>有一点要注意：免费产品+付运费的模式并不适合所有产品。你想想看，如果你是卖相机的，你设置成免费，然后运费要收100美金，这种情况的话，客户就可能对你的产品和店铺产生质疑。</p><p>所以，我个人建议，如果你要用这种模式，那么产品成本价要尽量保持在10美金以下，这样你还能留一点利润空间给自己。</p><h4 id="3-5该选择General杂货店还是Niche利基店"><a href="#3-5该选择General杂货店还是Niche利基店" class="headerlink" title="3.5该选择General杂货店还是Niche利基店"></a><strong>3.5该选择General杂货店还是Niche利基店</strong></h4><p>Shopify 本身，在商家不违背服务协议（Shopify.com/legal/aup）的基础上，对所谓”铺货模式“没有限制，有些品牌的商店SKU数量也是可以达到几十上百万。但是针对这个问题背后的逻辑，“深耕痛点、聚焦需求、关注品质、积累口碑”是亘古不变的成功企业的商业逻辑。</p><p>在 Shopify 上也适用，尤其适用。因为使用 Shopify 搭建自己的独立品牌是真真正正的创业过程。大家常说的铺货模式其实是由2C平台时代的多店铺多SKU所养成的习惯，一个为了实现短期流量最大化的有效手段。但是在多元化电商时代的今天，简单粗暴的铺货带来的也许只会有短期红利，往往还会因为供需关系失衡，带来一系列问题。我还是建议大家尽快从流量思维升级成如何更好地服务用户需求的用户思维，做好品牌积累，可持续发展。</p><p>Shopify 不同于亚马逊，eBay这些平台，并不是说我们上传的产品越多，出单的几率就越大。所以一味的添加SKU或者做站群其实意义不大，反而可能添加不必要的运营成本和风险。</p><p>我们所尝试过的“铺货”模式其实是一种运用Shopify + 广告的形式进行选品测试的方法，这个方法可以做为初期选品的一个过渡阶段。但是即使是这种模式，也不是说漫无目的的进行选品和测试，而是要有一个成体系的从选品到网站优化，到推广再到售后服务的方式方法。</p><p>此外大家在测试时一定要注意对供应链端的把控，因为很容易造成出单没货或者发货出问题的情况，对你品牌初期的口碑带来当头一棒，也容易被广告平台或者支付渠道采取处罚措施。说到底，还是要把服务好你的顾客作为底线。</p><p>我们来详细解释下杂货店和利基店的优劣势：</p><p>利基店的目标受众是一群对某个点很有热气的用户。比如，你针对猫咪爱好者建一个店铺，那么这群受众对猫咪是很有热情的。所以呢，一个Niche的店铺，其优势在于</p><p><strong>1).可以集中为某类顾客解决问题，迅速打开品牌知名度</strong></p><p>利基店能吸引重复购买客户，他们的购物行为是非常疯狂的。在利基店里，他们会认为你的品牌了解他们，你的品牌是他们这个群体中的一份子。你想想看，如果是杂货店，客户到杂货店看到了一双猫咪袜子，还看到了手机充电器、手机壳等和猫咪毫不相关的产品。</p><p>那么客户就不会觉得和你的品牌有什么连结，他们购买猫咪袜子仅仅只是因为喜欢这双袜子而已，而不太可能成为重复购买者。</p><p><strong>2).可以精准定位受众，广告费用更划算，同时客户的忠诚价值会更高</strong></p><p>因为客户对这个利基有激情，所以你可以不断地销售利基产品给他们。而且，建立售后跟进邮件也更容易。你可以发通用的推荐产品邮件给客户，而不用像杂货店那样需要根据用户购买的不同产品来设置不同的邮件。</p><p><strong>3).利基店可以轻松积累客户群</strong></p><p>客户对这个利基抱有激情，所以会不断从你这里购买产品。如果你能提供相关产品给喜欢某个利基的受众，那么你的赚钱之路是会持续不断的。</p><p><strong>4).选品更容易</strong></p><p>因为基于利基来选品的话，产品数量不会很多。所以，你选品的时候就没有那么多选择，就会更加容易。如果你是做杂货店，因为品类不限，选品就会要花很长时间。</p><p>利基店的劣势在于：</p><p><strong>1).利基店很难规模化，因为你的受众太过精准</strong></p><p>假如你开了一个店铺，卖的产品是有大象元素的。那么，你的产品只能吸引到那些喜欢大象的受众。而这些喜欢大象的受众不一定对有大象元素的产品有激情而产生购买。假设你的受众是100万左右，而会产生购买的受众不会太多。</p><p>在产生购买的受众里面，可能他们会购买2-3次，客户的终生价值确实增加了，但是你能提供的产品是有限的，所以针对这群受众，最终你可能会面临无产品可卖的情况。</p><p><strong>2).利基店很难跨类目经营</strong></p><p>比如，如果你是卖有大象元素的产品，那么利基店就很难去卖有猫咪元素的产品，因为你的域名可能就是elepphantlovers.com，和猫咪完全不沾边。</p><p>如果你是卖鞋带的，但是又想卖宠物用品，那么你就要重新开一个店。</p><p><strong>3).成本高</strong></p><p>因为利基店的受众是有激情的，所以利基店能赚钱。但是，你想想，如果你的店铺是卖大象元素产品的，那么可能需要一个人专门管理你的店铺。</p><p>如果你开了一个狗用品店，就要另外一个人来打理店铺，重新购买域名、插件等，成本就会增加。</p><p><strong>4).你很难测品</strong></p><p>大家都知道选品是非常难的，那么你在调研一个niche的时候，其实是花了很多的时间，但是大家有没有想过，你花了很多时间，你怎么能保证你所选的产品到时候会成功？</p><p>也就是说，你很可能一开始选Niche，专注在一个垂直领域来做，花了很多时间，但是反而在后面营销的时候，你会发现，这个产品不受用户的喜欢，或者广告成本非常大</p><p>这个时候Niche的局限性就来了，而General的店铺就不存在这个问题，那个产品测试不行，那就换，直到选出Winning ads，并在此基础上扩量</p><p>下面再来看看杂货店的优劣势</p><p>杂货店的优势</p><p><strong>1).杂货店不限品类</strong></p><p>杂货店就是不限品类，什么都可以卖，比如你可以卖印有猫咪图案的袜子，你可以卖带大象图案的T恤，还可以卖手机支架</p><p><strong>2).杂货店很容易规模化</strong></p><p>你的产品是不受限制的，不用担心要迎合某类受众或利基的口味，因为你的受众是所有人。当然，杂货店在无形中降低了你的品牌价值。</p><p>我的意思是杂货店会对转化率有影响，根据我的经验，利基店的转化率普遍比杂货店的要高出1%-5%，因为对某个事物有激情的受众更倾向于从利基店里购买产品。不过，杂货店确实流量会比较大。</p><p><strong>3).成本低</strong></p><p>因为你不用为不同领域的产品创建新店铺，也就不需要雇佣别人打理不同店铺了。而利基店就需要创建不同的店铺售卖不同利基的产品。</p><p><strong>4).在建店铺的过程中就能获得订单</strong></p><p>你可以上传很多产品到杂货店里，然后开始做广告。所以在你不断上传产品的过程中，广告为你店铺带来订单。</p><p>订单带来的收入又可以重新投入到广告中。而且，因为你的产品很多，所以你测试的空间很大，比如你可以测试不同的受众。</p><p>但是如果做的是利基店，假设你做的是有关大象元素产品的利基店，你可能会发现根本赚不到钱，那么你之前所有的投入与努力几乎都白费了。</p><p>那么就要重新开一个店去尝试别的产品。</p><p><strong>5).很方便跨类目经营</strong></p><p>杂货店里可以卖利基产品，但是利基店里不能把产品卖杂。你可以测试不同的受众，看看哪个效果最好。</p><p>可能很多大卖都没有说过这样一件事：我们会有杂货店，通过杂货店来测试看哪些产品赚钱。</p><p>如果测试结束以后，有些产品赚了足够多的钱，我们就会把这些产品转移到利基店里去卖，以提高转化率。</p><p><strong>杂货店的劣势</strong></p><p><strong>1).很难建立客户忠诚度</strong></p><p>如果你什么都卖，那么客户会很难忠诚于你的店铺。用户更倾向于被利基店吸引。</p><p>如果你的目标受众是喜欢大象的受众，你的店铺地址是：</p><p>elephantlovers.com,你卖的是有大象元素的产品，那么会有更多买家购买你的产品，因为他们会认为你的品牌就是他们这个群体的一份子。</p><p><strong>2).杂货店的转化率更低</strong></p><p>如果你的Ins或FB页面不是针对某个具体利基的，那么杂货店的转化率一般都比利基店的转化率要低。</p><p>什么意思呢？打个比方，假设你的店铺名称是cool store, 那么你的广告就不要在facebook上的cool store主页了，而要在比如cat store这个主页上做广告，用户在cat store主页上点击了你的广告以后，就会打开你coolstore.com的店铺网站了。</p><p>也就是说，你的店铺可以是杂货店，但是你的facebook主页必须要针对具体利基。</p><p><strong>3).杂货店很难建立售后跟进邮件</strong></p><p>如果客户购买了猫咪袜子，那就不能在售后跟进邮件里面推荐手机支架等不相关产品，因为这样对客户来说毫无意义。所以对杂货店来说就要做得更细致一点。</p><p>比如，我们可以在sendlane里面设置产品标签，如果有人购买了猫咪袜子，如果你设置了猫咪标签，那么客户会收到有关猫咪产品的邮件。</p><p>如果客户购买了有关苹果手机的产品，那么客户会收到有关苹果手机其他产品的邮件。但是利基店不一样，建立售后跟进邮件就很简单。</p><p>比如，你的店铺是卖大象元素的产品，那么你的邮件里面自然推荐的就是相关的产品。所以就不需要针对不同用户群体设置不同的跟进邮件。</p><p>所以，就这一点而言，利基店能节约很多时间，而且利润也高。你要知道，大概30%-40%的利润都将来自于邮件营销，所以邮件营销非常重要。</p><p>综合以上分析，我们可以用一句话来总结店铺选择的原则，即用General选品，用Niche深耕。</p><h3 id="4-独立站选品策略及方法"><a href="#4-独立站选品策略及方法" class="headerlink" title="4.独立站选品策略及方法"></a><strong>4.独立站选品策略及方法</strong></h3><p>我们之所以将选品章节放到第一课，是希望大家整个训练营课程都是有目标的，先完成初次的选品，后期我们所有的学习都是围绕如何建立符合我们这个产品特点的网站，如何针对产品进行后台设置，以及针对产品进行营销。</p><p>即便到最后我们发现可能最初的选品是失败的，但我们的学习过程不会是失败的，只要我们重新选品，利用训练营学到的东西我们就可以迅速从头再来。而如果我们一开始就只学习技术，那么我们是无法深刻理解独立站的运营模式的，那么我们的学习都只会浮于表面。因此，我们也要求，所有参与本次训练营的同学，在开课之前必须完成选品工作。</p><h4 id="4-1独立站的选品逻辑"><a href="#4-1独立站的选品逻辑" class="headerlink" title="4.1独立站的选品逻辑"></a><strong>4.1独立站的选品逻辑</strong></h4><p>独立站存在的意义是可以让我们更简单更直接地触及这个世界上所有可触及的流量，而不是局限在某一个平台里。所以对于独立站，选品逻辑就要拓展成“你的目标市场或群体的具体消费需求是什么”，因为世界太大了，哪里都会有需求，但是要实际获取需求就必须要找准你的具体目标，清楚理解他们要什么。</p><p>另外一点要注意的是，在2C平台上卖货，顾客是由平台直接服务的。卖家要做的无非三件事：找货源、上产品、拉流量。你的角色可以被理解为“帮平台供货”，所以知晓“平台上什么最好卖“基本就是你要问的全部问题。但是独立站的模式决定了你不再是为平台打工，而是为自己创业，要切切实实地服务好你自己的顾客。这个时候“什么最好卖”已经不足够了，还要弄清楚“什么样的需求我们可以服务得最好”。</p><p>比如如果我本身都不了解宠物用品，能不能很好的回答顾客对我商品的问题？而独立站要做的就是，无论你想卖什么，都能助力你更快开始，更好地服务你的客户。</p><p>除了一些基本的选品方法，如从自己感兴趣的领域入手挖掘产品，关注竞争对手，关注当下的流行趋势，分析不同平台数据，现有供应商新品推荐等等方法，选品更要从用户的需求出发。</p><p>例如很多亚马逊卖家在使用的新品开发方法：通过搜集研究竞品在亚马逊以及社交媒体以及专业论坛上的客户反馈，总结出客户群体在使用该款产品时还有哪些痛点亟待解决，以解决这些痛点为目标对产品进行升级改造，从而成功打造出属于品牌自己的爆品。</p><p><strong>独立站选品的七大价值逻辑：</strong></p><ul><li>视觉价值 Visual Value</li><li>实用价值 Practical Value</li><li>认知价值 Percieved Value</li><li>情感价值 Emotion Value</li><li>利基价值 Niche Value</li><li>趋势价值 Trend Value</li><li>热点价值 Hotspot Value</li></ul><p>参考链接<a href="http://guxiaobei.com/2019-hot-style-selection-case.html">http://guxiaobei.com/2019-hot-style-selection-case.html</a></p><h4 id="4-2Shopify-选品的短线操作与长线思维"><a href="#4-2Shopify-选品的短线操作与长线思维" class="headerlink" title="4.2Shopify 选品的短线操作与长线思维"></a><strong>4.2Shopify 选品的短线操作与长线思维</strong></h4><p>短线操作就是在短期内赚快钱，我们理解为两层意思：</p><p><strong>第一：跟风追热点，赶潮流，赚一波是一波</strong></p><p>比如之前的指尖陀螺。如果你赶上了风口，那就能轻松赚快钱。如果风头已经过去了，卖不出去的只能长期压仓库。</p><p><strong>第二：季节性/节假日产品</strong></p><p>也就是只能能满足某个季节或节假日需求的产品，比如圣诞帽，几乎只能在圣诞季才卖得动。</p><p>我们所说的长线思维是指：找到常年需求的产品，可以说是刚需产品，用户全年都能用得到的产品，不受季节影响不受潮流影响。</p><p><strong>选品常见的几个误区</strong></p><p><strong>第一：凭感觉选品</strong></p><p>完全根据自己想当然的想法来选品，自认为什么好卖就卖什么产品。</p><p><strong>第二：跟风，不进行调研</strong></p><p>看到市场上火什么就卖什么。跟风产品会面临激烈的竞争，就算你卖爆款也不一定有销量，还有可能遇到侵权问题。</p><p><strong>第三：以为冷门产品就是蓝海</strong></p><p>有些卖家会避开热销产品选择冷门产品，但是冷门并不一定就是蓝海，可能是市场容量太有限，你推起来也会没什么销量。</p><p>第四：产品选好准备躺赢。毋庸置疑，选好产品超级无敌重要。但是，七分产品三分运营，千万不要忽略了运营的作用。</p><h4 id="4-3独立站竞争分析及选品工具"><a href="#4-3独立站竞争分析及选品工具" class="headerlink" title="4.3独立站竞争分析及选品工具"></a><strong>4.3独立站竞争分析及选品工具</strong></h4><p>选品有几个基本原则：利润高，重量轻，不易碎，非危险品。</p><p>一般来说，选品的时候，我们可以按照以下思路来思考：</p><p><strong>第一：充分利用社交网站</strong></p><p>比如Pinterest, Instagram, Youtube等。看看这些平台有哪些流行趋势产品。</p><p>第二：电商平台</p><p>这个就不用赘述了，速卖通、Ebay、亚马逊等，看它们有哪些热卖品。这样的产品是已经被证明有销售市场的。</p><p><strong>第三：论坛社区</strong></p><p>比如Reddit, quora等，看用户在讨论什么，关心什么，推荐什么。</p><p>第四：关注杂志与博客网站</p><p>比如trendhunter, trend watching, spingwise等。</p><p><strong>第五：利用选品工具</strong></p><p>比如google trends, productFinder.co</p><p><strong>第六：关注利基市场中的网红</strong></p><p>网红就意味着有一大推追随者，他们在社交媒体上推荐的产品，往往都可能成为热门产品。</p><p>无论你用哪种方法选品，总结下来就是要多看多思考，不要凭感觉选。</p><p>1）要做Dropshipping，如何选品？<a href="http://guxiaobei.com/dropshipping-choose-products.html">http://guxiaobei.com/dropshipping-choose-products.html</a></p><p>2）如何有效进行选品？<a href="http://guxiaobei.com/how-to-select-products-effectively.html">http://guxiaobei.com/how-to-select-products-effectively.html</a></p><p>3）直播课：如何借力，并寻找机会产品</p><p>——小北老师直播《如何判断和选择一个市场值不值得做》</p><p><img src="https://guxiaobei.oss-cn-shenzhen.aliyuncs.com/wp-content/uploads/2022/06/93a170e5722b403b99ab767e6874aa171800.png" alt="img"></p><ol><li>1）<a href="https://nichescraper.com/scraper/">https://nichescraper.com/scraper/</a><ol><li>2）<a href="https://dropship-spy.com/">https://dropship-spy.com/</a><ol><li>Adspy<ol><li>Bigspy</li><li>Facebook选品</li><li>监测竞争对手选品</li><li>谷歌趋势</li></ol></li></ol></li></ol></li></ol><p>通过谷歌趋势来了解某个行业或产品的历史数据，看看产品的整体趋势。比如新潮产品就有很明显的上升期和跌落期。如果你能在趋势早期介入这个产品，那么就正好可以借势打造品牌。所以，通过谷歌趋势来找准时机很重要。</p><p>如果你选择的是常年需求比较稳定的产品，那么竞争可能会比较大，一般不会像新潮产品那样大起大落，有利于建立长久的品牌形象。</p><p>8、productfinder.co</p><p><a href="https://www.productfinder.co/%EF%BC%8C%E8%BF%99%E9%87%8C%E9%9D%A2%E7%9A%84%E4%BA%A7%E5%93%81%E5%87%A0%E4%B9%8E%E9%83%BD%E6%98%AFShopify%E5%BA%97%E9%93%BA%E7%9A%84%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%A0%B9%E6%8D%AE%E6%97%B6%E9%97%B4%E3%80%81%E5%B8%81%E7%A7%8D%E3%80%81%E4%BB%B7%E6%A0%BC%E8%8C%83%E5%9B%B4%E3%80%81%E4%BB%A5%E5%8F%8A%E6%9C%80%E6%96%B0%E5%8F%91%E5%B8%83%E5%92%8C%E4%BB%B7%E6%A0%BC%E7%94%B1%E9%AB%98%E5%88%B0%E4%BD%8E%E6%88%96%E7%94%B1%E4%BD%8E%E5%88%B0%E9%AB%98%E6%9D%A5%E8%BF%87%E6%BB%A4%E7%BB%93%E6%9E%9C%E3%80%82">https://www.productfinder.co/，这里面的产品几乎都是Shopify店铺的，我们可以根据时间、币种、价格范围、以及最新发布和价格由高到低或由低到高来过滤结果。</a></p><p>点击产品进入他们的店铺以后，如果他们店铺里没有Best Seller这个按钮选择，那么我们可以通过在域名后面加上 /collections/all?sort_by=best-selling 来查看这个潜在竞争对手的热销产品。</p><p>我们要查看竞品的款式及竞争对手店铺的流量来源（可以用similarweb查），这样我们就知道需要用什么样的产品从哪些渠道引流了。</p><p>这个工具是免费的，可以作为选品的入门级工具使用。</p><p>选品的时候，我们可以想想自己有什么兴趣爱好，你身边在流行什么，把任何想到的东西都写下来；还有利用上面所说的选品方法来选品。</p><p>这个时候不用纠结产品好不好卖，唯一要做的就是做好记录。</p><p>然后，等你有了足够多的选品想法后，就要开始进行筛选了。我们的目标是找细分市场，像哪些明显已经饱和市场，就不要再进入了。</p><p>这个阶段要结果谷歌趋势查看产品处于上升期还是跌落期，同时，可以把产品拿到Instagram , Youtube等平台上验证一下，看看有没有人在这些平台分享产品图片或视频，如果有，看用户评价怎么样，用户有没有提出一些问题等。</p><p><strong>课程大纲与逻辑</strong></p><p>本次训练营课程共9课，以产品为主线和目标来讲解独立站建设、优化与运营的整体思路，而不是简单的教大家建站的技术。课程分为四个部分和三个阶段：</p><p>第一部分——公开课，讲解独立站运营系统解析，介绍本期训练营安排，共1课时。</p><p>第二部分前期工作——网站后台操作与设置，主要讲解[Shopify开店准备、实操，介绍](<a href="https://kdocs.cn/l/cj999DJwolp0">https://kdocs.cn/l/cj999DJwolp0</a> [金山文档] 【第二课】基础入门：Shopify开店详解教程.docx)网站后台操作与设置，产品管理与Listing打造，共3课时。</p><p>第三部分中期工作——网站设计、建设与优化，讲解网站设计思路与网站结构剖析，网站设计流程与主题建站实操，网站速度性能优化与上线测试，共3课时。</p><p>第四部分后期工作——网站营销与售后管理，讲解独立站营销渠道与引流思路，订单处理与网站数据分析，共2课时。</p><p>具体课程大纲近300个细目，请大家参考详细文件。经过对第一期训练营的经验总结和课程的打磨，我们认为这个内容应该是较为适合新手的系统化的流程，有序且环环相扣。</p><p><strong>本期训练营规则</strong></p><p>本期训练营招生规则：采用筛选机制加学费制度，主要考察报名人员的目的性、准备程度、时间是否充裕，且必须在开课前完成选品。</p><p>本期训练营考核规则：每节课均设置作业，共8次，缺交一次，训练营积分赛-10积分，缺交两次，降为旁听生，学费不退。</p><p>本次训练营激励规则：本期训练营全部学费收入都将用于出海天团奖励和学员激励，出海天团根据表现获得助力评级奖励，学员评选设置积分榜和精华榜，积分榜分为个人积分榜与小组积分榜，优秀学员与优秀领航小组都将获得专属奖励。未上榜学员也可使用积分兑换权益和奖励。</p><p>本期训练营其他特色：每周作业批阅与点评、积分榜&amp;精华榜每周更新、学员选举小组长、小组PK赛、每周课后问答帖及值班船助答疑</p><p>最后，分享一篇小北老师博客的文章给到大家（<a href="http://guxiaobei.com/start-oberlo-store-profitable-plan.html">http://guxiaobei.com/start-oberlo-store-profitable-plan.html</a>),</p><p>文章主要是讲国外小白博主是如何进入独立站，并且开始自己的电商事业的故事。对于他的经历、思考方式、操作方式，包括踩过的坑都有可能都会是我们后续将会讲到或者遇到的，读完这篇文章，我想我们大家可以更加深刻的理解独立站的运行机制和运营过程。</p><p>如果在听完本堂课，同时阅读完上述文章后，大家依然坚定方向，认为独立站是适合的方向，且现在有足够的精力能在接下来的课程中顺利完成学习，请积极踊跃报名新手训练营第二期，我们会根据报名情况进行匹配，并认真筛选出新一期的学员。</p>]]></content>
      
      
      <categories>
          
          <category> 顾小北-Shopify从0-1 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 独立站 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python爬取壁纸</title>
      <link href="2022/082829206.html"/>
      <url>2022/082829206.html</url>
      
        <content type="html"><![CDATA[<p>受害者网站：<a href="https://wallhaven.cc/">https://wallhaven.cc/</a> （是一个图片质量非常高的网站）</p><p><img src="http://5coder.cn/img/1661665879_396422930e186e951632717cc73066c7.png"></p><p>直接上代码，复制粘贴就能用：</p><p>图片爬取</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> os<span class="token keyword">import</span> threading<span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getImg</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> th<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'线程:'</span><span class="token punctuation">,</span> th<span class="token punctuation">,</span> <span class="token string">'----&gt;第'</span><span class="token punctuation">,</span> page<span class="token punctuation">,</span> <span class="token string">'页'</span><span class="token punctuation">)</span>        url <span class="token operator">=</span> <span class="token string">'https://wallhaven.cc/toplist?page={}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span>        headers <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36'</span>        <span class="token punctuation">}</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>        urls <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'&lt;a class="preview" href="(.*?)"'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span>        <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'page_urls.txt'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'a+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> urls<span class="token punctuation">:</span>            response_2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>i<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>            img_url <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'&lt;img id="wallpaper" src="(.*?)"'</span><span class="token punctuation">,</span> response_2<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            title <span class="token operator">=</span> img_url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>            download<span class="token punctuation">(</span>title<span class="token punctuation">,</span> img_url<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>img_url<span class="token punctuation">)</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'img_urls.txt'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'a+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>img_url<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>getImg<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>getImg<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    t3 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>getImg<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    t3<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>图片按照横版和竖版区分（将以下代码放在需要分隔的图片文件夹中运行）：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 横图竖图划分.py</span><span class="token keyword">import</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">as</span> cf<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token keyword">import</span> shutil<span class="token keyword">import</span> time<span class="token keyword">import</span> os<span class="token keyword">import</span> re<span class="token keyword">class</span> <span class="token class-name">ImageClassfy</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 初始化</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        root <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取当前路径</span>        self<span class="token punctuation">.</span>root <span class="token operator">=</span> root        self<span class="token punctuation">.</span>names <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>root<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>widthImage <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">'widthImage'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>heightImage <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">'heightImage'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>        self<span class="token punctuation">.</span>pret<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 新建长图和宽度的保存文件夹</span>    <span class="token keyword">def</span> <span class="token function">pret</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>names<span class="token punctuation">:</span>            pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'(.png|.jpg)$'</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>names<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>i<span class="token punctuation">)</span>        self<span class="token punctuation">.</span><span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>names<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>widthImage<span class="token punctuation">)</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>self<span class="token punctuation">.</span>widthImage<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>heightImage<span class="token punctuation">)</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>self<span class="token punctuation">.</span>heightImage<span class="token punctuation">)</span>    <span class="token comment"># 移动图片到对应的文件夹</span>    <span class="token keyword">def</span> <span class="token function">move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>        src <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> name<span class="token punctuation">)</span>        img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span>        w<span class="token punctuation">,</span> h <span class="token operator">=</span> img<span class="token punctuation">.</span>size        img<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> w <span class="token operator">&gt;=</span> h<span class="token punctuation">:</span>            shutil<span class="token punctuation">.</span>move<span class="token punctuation">(</span>src<span class="token punctuation">,</span> self<span class="token punctuation">.</span>widthImage<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            shutil<span class="token punctuation">.</span>move<span class="token punctuation">(</span>src<span class="token punctuation">,</span> self<span class="token punctuation">.</span>heightImage<span class="token punctuation">)</span>    <span class="token comment"># 打印进度条</span>    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num<span class="token punctuation">,</span> _sum<span class="token punctuation">,</span> runTime<span class="token punctuation">)</span><span class="token punctuation">:</span>        barLen <span class="token operator">=</span> <span class="token number">20</span>  <span class="token comment"># 进度条的长度</span>        perFin <span class="token operator">=</span> num <span class="token operator">/</span> _sum        numFin <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span>barLen <span class="token operator">*</span> perFin<span class="token punctuation">)</span>        numNon <span class="token operator">=</span> barLen <span class="token operator">-</span> numFin        leftTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> perFin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>runTime <span class="token operator">/</span> perFin<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>            <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>num<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>_sum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>_sum<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>            <span class="token string-interpolation"><span class="token string">f"|</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'█'</span> <span class="token operator">*</span> numFin<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">' '</span> <span class="token operator">*</span> numNon<span class="token punctuation">}</span></span><span class="token string">|"</span></span><span class="token punctuation">,</span>            <span class="token string-interpolation"><span class="token string">f"任务进度: </span><span class="token interpolation"><span class="token punctuation">{</span>perFin <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%"</span></span><span class="token punctuation">,</span>            <span class="token string-interpolation"><span class="token string">f"已用时间: </span><span class="token interpolation"><span class="token punctuation">{</span>runTime<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">S"</span></span><span class="token punctuation">,</span>            <span class="token string-interpolation"><span class="token string">f"剩余时间: </span><span class="token interpolation"><span class="token punctuation">{</span>leftTime<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">S"</span></span><span class="token punctuation">,</span>            end<span class="token operator">=</span><span class="token string">'\r'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> num <span class="token operator">==</span> _sum<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 主函数</span>    <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        tp <span class="token operator">=</span> cf<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>  <span class="token comment"># 多进程实现，指定进程数为32</span>        futures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        t1 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> name <span class="token keyword">in</span> self<span class="token punctuation">.</span>names<span class="token punctuation">:</span>            future <span class="token operator">=</span> tp<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>self<span class="token punctuation">.</span>move<span class="token punctuation">,</span> name<span class="token punctuation">)</span>            futures<span class="token punctuation">.</span>append<span class="token punctuation">(</span>future<span class="token punctuation">)</span>        <span class="token keyword">for</span> future <span class="token keyword">in</span> cf<span class="token punctuation">.</span>as_completed<span class="token punctuation">(</span>futures<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>            t2 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>            runTime <span class="token operator">=</span> t2 <span class="token operator">-</span> t1            self<span class="token punctuation">.</span>show<span class="token punctuation">(</span>self<span class="token punctuation">.</span>count<span class="token punctuation">,</span> self<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">,</span> runTime<span class="token punctuation">)</span>        tp<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    ImageClassfy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 爬虫 </tag>
            
            <tag> 工具类 </tag>
            
            <tag> 壁纸 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试题分享2</title>
      <link href="2022/082418074.html"/>
      <url>2022/082418074.html</url>
      
        <content type="html"><![CDATA[<h1 id="面试题-1"><a href="#面试题-1" class="headerlink" title="面试题-1"></a>面试题-1</h1><p><strong>一、请说出下列最终的执行结果，并解释为什么。</strong></p><pre class="line-numbers language-none"><code class="language-none">var a = [];for (var i = 0; i &lt; 10; i++) {    a[i] = function() {        console.log(i)    }}a[6]()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>答：结果是10。因为for循环里的i是全局变量，for循环执行完之后，i已经变成了10，所以之后无论调用a几，输出的都是10。</p><hr><p><strong>二、请说出下列最终的执行结果，并解释为什么。</strong></p><pre class="line-numbers language-none"><code class="language-none">var tmp = 123;if (true) {    console.log(tmp)    let tmp}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>答：结果报错，cannot access ‘tmp’ before initialization<br>     原因：let 会形成块级作用域和封闭作用域，所以 tmp 无法拿到外层 var 声明的值，只能在块级作用域中查找。let 不会导致变量提升，因此<code>console.log(tmp)</code>无法找到声明，出现暂时性死区。</p><hr><p><strong>三、结合ES6新语法，用最简单的方法找出数组中的最小值。</strong></p><pre class="line-numbers language-none"><code class="language-none">var arr = [12, 34, 32, 89, 4]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>答：</p><pre class="line-numbers language-none"><code class="language-none">arr.sort((a, b) =&gt; a-b)[0]arr.reduce((min,num)=&gt;min&lt;num?min:num)Math.min(...arr)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><p><strong>四、请详细说明 var，let，const 三种声明变量方式之间的具体差别。</strong></p><table><thead><tr><th></th><th>var</th><th>let</th><th>const</th></tr></thead><tbody><tr><td>提升</td><td>声明提升，使用undefined初始化</td><td>不存在变量提升</td><td>不存在变量提升</td></tr><tr><td>作用域</td><td>全局</td><td>块级</td><td>块级</td></tr><tr><td>初始化</td><td>可以仅声明不初始化</td><td>可以仅声明不初始化</td><td>必须在声明时初始化</td></tr><tr><td>重复定义</td><td>可以</td><td>不可以</td><td>不可以</td></tr><tr><td>多次赋值</td><td>可以</td><td>可以</td><td>基本数据类型不可以，引用数据类型仅可改变值</td></tr><tr><td>声明前访问</td><td>可以</td><td>不可以</td><td>不可以</td></tr></tbody></table><hr><p><strong>五、请说出下列代码最终输出的结果，并解释为什么。</strong></p><pre class="line-numbers language-none"><code class="language-none">var a = 10;var obj = {    a: 20,    fn () {        setTimeout(() =&gt; {            console.log(this.a)        })    }}obj.fn()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>答：打印20。因为setTimeout是箭头函数，里面的this指向没有改变和fn函数里的this是一致的都指向obj，所以会输出20</p><hr><p><strong>六、简述Symbol类型的用途。</strong></p><p>答：</p><ul><li>作为对象的属性，可以作为对象的私有属性，</li><li>阻止对象上属性名的冲突，每个 Symbol 都独一无二的，可以保证不与其他属性名产生冲突，</li><li>使用Symbol来替代常量</li></ul><hr><p><strong>七、说说什么是浅拷贝，什么是深拷贝。</strong></p><p>答：</p><ul><li>浅拷贝：针对 Object,Array 这种复杂数据类型，浅拷贝复制一层对象的属性，属性中的值是基本数据类型直接复制值，如果是引用类型复制内存地址的指针，所以在修改复制后的变量里引用类型的里面的值时，会导致原始数据也被修改</li><li>深拷贝：针对 Object,Array 这种复杂数据类型，深复制递归复制了所有的层级，新数据和原始数据不存在联系，因此在修改复制后的变量里引用类型的里面的值时，不会导致原始数据也被修改</li></ul><hr><p><strong>八、简述TypeScript和JavaScript之间的关系。</strong></p><p>答：TypeScript 并不是一个完全新的语言, 它是 JavaScript 的超集，为 JavaScript 的生态增加了类型机制，并最终将代码编译为纯粹的 JavaScript 代码。</p><table><thead><tr><th>TypeScript</th><th>JavaScript</th></tr></thead><tbody><tr><td>JavaScript 的超集用于解决大型项目的代码复杂性</td><td>一种脚本语言，用于创建动态网页。</td></tr><tr><td>可以在编译期间发现并纠正错误</td><td>作为一种解释型语言，只能在运行时发现错误</td></tr><tr><td>强类型，支持静态和动态类型</td><td>弱类型，没有静态类型选项</td></tr><tr><td>最终被编译成 JavaScript 代码，使浏览器可以理解</td><td>可以直接在浏览器中使用</td></tr><tr><td>支持模块、泛型和接口</td><td>不支持模块，泛型或接口</td></tr><tr><td>支持 ES3，ES4，ES5 和 ES6 等</td><td>不支持编译其他 ES3，ES4，ES5 或 ES6 功能</td></tr><tr><td>社区的支持仍在增长，而且还不是很大</td><td>大量的社区支持以及大量文档和解决问题的支持</td></tr></tbody></table><hr><p><strong>九、请你谈谈你所认为的TypeScript优缺点。</strong></p><p>优点：</p><ul><li>任何一种 javascript 运行环境都支持</li><li>功能更为强大，生态更健全、更完善</li><li>TypeScript 属于渐进式的</li><li>增强代码的可读性和可维护性，增强了编译器和 IDE 的功能，定义可以作为文文档</li><li>在编译阶段就可以发现大部分大错误，不需要在运行时才发现</li></ul><p>缺点：</p><ul><li>语言本身多了很多概率，提高学习成本</li><li>项目初期，TypeScript 增加开发成本</li><li>集成到构建流程需要一些工足量</li><li>可能和一些库结合不完美，需要单独添加一些声明，不过大部分的库都支持了 TypeScript</li></ul><hr><p><strong>十、描述引用计数的工作原理和优缺点。</strong></p><p>工作原理：设置引用数,判断当前引用数是否为 0，引用关系改变时修改引用数字</p><p>优点：</p><ol><li>发现垃圾时立即回收</li><li>最大限度减少程序暂停（保证空间不会被占满）</li></ol><p>缺点：</p><ol><li>无法回收循环引用的对象</li><li>时间开销大（监控对象，维护引用数）</li></ol><hr><p><strong>十一、描述标记整理算法的工作流程。</strong></p><ol><li><p>遍历所有对象找标记活动对象</p></li><li><p>清除阶段会先执行整理，移动对象位置，将活动对象放在一起</p></li><li><p>清除没有标记的对象，同时把第一次遍历所做的标记抹掉</p></li><li><p>把回收的空间放到空闲列表上面，方便后续程序申请空间使用</p><p>优点： 减少了内存空间的碎片化，缺点： 不能立即回收对象</p></li></ol><hr><p><strong>十二、描述V8中新生代存储区垃圾回收的流程。</strong></p><ol><li>回收过程采用复制算法+标记整理算法</li><li>新生代分为 from-to 两个等大空间 32M(32 位为 16M)</li><li>使用空间为 from 内存区，空闲空间为 to 内存区，当 from 空间应用一定大小会触发标记整理</li><li>当发生标记整理后，复制活动对象到 to 内存区，然后 From 空间进行内存释放。</li><li>如果拷贝时出现晋升，将新生代活动对象移入老生代</li><li>当 To 空间的使用率达到 25%时，将新生代活动对象移入老生代</li><li>当一轮 GC 执行完毕后还存活的新生代测需要晋级</li><li>当一次 GC 操作后，From 和 to 需要进行置换</li></ol><hr><p><strong>十三、描述增量标记算法在何时使用及工作原理。</strong></p><p>答： 使用时机：会穿插在程序的运行中执行。</p><p>​         工作原理： 对象存在直接可达和间接可达，将遍历对象标记，拆分成多个小步骤，先标记直接可达对象。间接可达的标记与程序执行交替执行，最终完成清除。</p>]]></content>
      
      
      <categories>
          
          <category> 前端面试题 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue基础难点总结</title>
      <link href="2022/082411622.html"/>
      <url>2022/082411622.html</url>
      
        <content type="html"><![CDATA[<p>vue各种各样的命令和语法的格式容易记混</p><h2 id="vue指令-v-model修饰符"><a href="#vue指令-v-model修饰符" class="headerlink" title="vue指令-v-model修饰符"></a>vue指令-v-model修饰符</h2><ul><li>语法:<ul><li>v-model.修饰符=”vue数据变量”<ul><li>.number  以parseFloat转成数字类型</li><li>.trim      去除首尾空白字符</li><li>.lazy      在失去焦点时触发更改而非inupt时</li></ul></li></ul></li></ul><h2 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h2><ul><li>计算属性有<strong>缓存</strong>，提高渲染性能。</li><li>如果在页面上需要用到 对现有的数据进行加工得到新数据，则时要<strong>使用计算属性</strong></li></ul><p>普通写法</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">computed<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token comment">//属性名字（计算属性名称）</span>        <span class="token comment">//属性的值（计算属性处理函数）</span>        <span class="token function">计算属性名1</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// 对依赖的数据进行处理，且进行return</span>            <span class="token keyword">return</span>         <span class="token punctuation">}</span>，<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>完整写法</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token string">"属性名"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token function">set</span><span class="token punctuation">(</span>值<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"值"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="vue监听器"><a href="#vue监听器" class="headerlink" title="vue监听器"></a>vue监听器</h2><p>可以监听数据（data/computed等）的值的改变。 数据的值有类型：基本数据类型，引用数据类型</p><p>深度监听</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">watch<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token string">"要监听的属性名"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        immediate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 立即执行</span>        deep<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 深度监听复杂类型内变化</span>        <span class="token function">handler</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="scoped实现组件的私有样式"><a href="#scoped实现组件的私有样式" class="headerlink" title="scoped实现组件的私有样式"></a>scoped实现组件的私有样式</h2><pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">&lt;stype scoped&gt;  h2</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 样式只会在当前组件内生效</span>&lt;<span class="token operator">/</span>style&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="父传子"><a href="#父传子" class="headerlink" title="父传子"></a>父传子</h2><p><img src="http://5coder.cn/img/1661313207_d8e38c1c528cbcacd00579c29eee379b.webp" alt="父传子"></p><h2 id="子传父"><a href="#子传父" class="headerlink" title="子传父"></a>子传父</h2><p><img src="http://5coder.cn/img/1661313261_15b15e7d7e4427173e8387baae153a62.webp" alt="子传父"></p><h2 id="vue组件生命周期"><a href="#vue组件生命周期" class="headerlink" title="vue组件生命周期"></a>vue组件生命周期</h2><p>四个阶段:</p><ul><li>初始化 =&gt; 创建组件  =&gt; beforeCreate created</li><li>挂载 =&gt; 渲染显示组件 =&gt;  beforeMount mouted</li><li>更新 =&gt; 修改了变量 =&gt; 触发视图刷新 =&gt; beforeUpdate updated</li><li>销毁 =&gt; 切换页面 =&gt; 会把组件对象从内存删除 =&gt; beforeDestory destoryed</li></ul><p><img src="http://5coder.cn/img/1661313275_e9b1668396ec2dd5780265c08374f798.webp" alt="vue组件生命周期"></p><h2 id="组件进阶-props校验"><a href="#组件进阶-props校验" class="headerlink" title="组件进阶-props校验"></a>组件进阶-props校验</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">props<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">// 基础的类型检查 (`null` 和 `undefined` 会通过任何类型验证)</span>    propA<span class="token operator">:</span> Number<span class="token punctuation">,</span>    <span class="token comment">// 多个可能的类型</span>    propB<span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> Number<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">// 必填的字符串</span>    propC<span class="token operator">:</span> <span class="token punctuation">{</span>      type<span class="token operator">:</span> String<span class="token punctuation">,</span>      required<span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 带有默认值的数字</span>    propD<span class="token operator">:</span> <span class="token punctuation">{</span>      type<span class="token operator">:</span> Number<span class="token punctuation">,</span>      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">100</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 带有默认值的对象</span>    propE<span class="token operator">:</span> <span class="token punctuation">{</span>      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>      <span class="token comment">// 对象或数组默认值必须从一个工厂函数获取</span>      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 自定义验证函数</span>    propF<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 这个值必须匹配下列字符串中的一个</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="组件进阶-动态组件"><a href="#组件进阶-动态组件" class="headerlink" title="组件进阶 - 动态组件"></a>组件进阶 - 动态组件</h2><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby"><span class="token operator">&lt;</span>component <span class="token symbol">:is</span><span class="token operator">=</span><span class="token string">"comName"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>component<span class="token operator">&gt;</span> <span class="token operator">/</span><span class="token operator">/</span>comName是变量<span class="token punctuation">,</span>值为需要切换的几个组件名复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="组件进阶-keep-alive组件"><a href="#组件进阶-keep-alive组件" class="headerlink" title="组件进阶-keep-alive组件"></a>组件进阶-keep-alive组件</h2><p>用keep-alive内置的vue组件, 让动态组件缓存而不是销毁</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- vue内置的组件component, 可以动态显示组件 --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comName<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="组件进阶-keep-alive组件-指定缓存"><a href="#组件进阶-keep-alive组件-指定缓存" class="headerlink" title="组件进阶-keep-alive组件-指定缓存"></a>组件进阶-keep-alive组件-指定缓存</h3><p>语法</p><ol><li><code>include="组件名1,组件名2..."</code></li><li><code>:include="['组件名1'， '组件名2']"</code></li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name1,name2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- vue内置的组件component, 可以动态显示组件 --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comName<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="组件进阶-具名插槽"><a href="#组件进阶-具名插槽" class="headerlink" title="组件进阶-具名插槽"></a>组件进阶-具名插槽</h2><h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><p>定义： <slot name="xxx"></slot></p><p>使用：</p><ul><li><p>&lt;template #xxx&gt;;</p></li><li><p><template v-slot:xxx=""></template></p></li></ul><p><img src="http://5coder.cn/img/1661313294_0411914e8106c0a45b673de173c48bb6.webp" alt="组件进阶-具名插槽"></p><h2 id="自定义指令-基本使用"><a href="#自定义指令-基本使用" class="headerlink" title="自定义指令-基本使用"></a>自定义指令-基本使用</h2><pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token punctuation">{</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token selector">,  methods: </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token selector">,  directives: </span><span class="token punctuation">{</span>    <span class="token selector">focus: </span><span class="token punctuation">{</span> <span class="token comment">// 自定义指令名</span>        <span class="token function">inserted</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 固定配置项 - 当指令插入到标签自动触发此函数</span>            el.<span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span>复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="自定义指令-传值和更新"><a href="#自定义指令-传值和更新" class="headerlink" title="自定义指令-传值和更新"></a>自定义指令-传值和更新</h2><p>目标: 使用自定义指令, 传入一个值</p><p>需求: 定义color指令-传入一个颜色, 给标签设置文字颜色</p><p>main.js定义处修改一下</p><pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token selector">directives: </span><span class="token punctuation">{</span>  <span class="token selector">"color":</span><span class="token punctuation">{</span>    <span class="token function">inserted</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 插入时触发此函数</span>      el.style.color = binding.value<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">update</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 更新绑定的变量时触发此函数=》手动更新</span>      el.style.color = binding.value<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Direct.vue处更改一下</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>theColor<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>changeColor<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>使用v-color指令控制颜色, 点击变蓝<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>  data() {    return {      theColor: "red",    };  },  methods: {    changeColor() {      this.theColor = 'blue';    },  },<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>总结: v-xxx, 自定义指令, 获取原生DOM, 自定义操作</p><h2 id="axios请求"><a href="#axios请求" class="headerlink" title="axios请求"></a>axios请求</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">const</span> res<span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"http://......."</span><span class="token punctuation">)</span>     <span class="token comment">//  console.log(data);</span>   <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>作者：单身不是也挺好的嘛<br>链接：<a href="https://juejin.cn/post/7095724314876051492">https://juejin.cn/post/7095724314876051492</a><br>来源：稀土掘金<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript-堆栈分析</title>
      <link href="2022/082336194.html"/>
      <url>2022/082336194.html</url>
      
        <content type="html"><![CDATA[<h2 id="JavaScript-堆栈分析"><a href="#JavaScript-堆栈分析" class="headerlink" title="JavaScript-堆栈分析"></a>JavaScript-堆栈分析</h2><h3 id="1-堆栈处理"><a href="#1-堆栈处理" class="headerlink" title="1.堆栈处理"></a>1.堆栈处理</h3><p>堆栈准备</p><ul><li>JavaScript执行环境</li><li>执行环境栈（ECStack，execution context stack）</li><li>全局执行环境栈（EC(G)）</li><li>执行上下文</li><li>VO(g)：Variable Object(Global)，全局变量对象</li><li>GO:Global Object，全局对象类似于window</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">100</span><span class="token keyword">var</span> y <span class="token operator">=</span> xy <span class="token operator">=</span> <span class="token number">200</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment">/*1.基本数据类型是按照值进行操作2.基本数据类型的值是存放在栈区的，复杂数据类型是存放在堆区的3.无论栈内存还是后续引用数据类型会使用到的堆内存，都属于计算机内存4.GO(全局对象)*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661234581_5e00a465c2d6a28f3c8669b5a70056fc.png" alt="堆栈处理"></p><h3 id="2-引用类型堆栈处理"><a href="#2-引用类型堆栈处理" class="headerlink" title="2.引用类型堆栈处理"></a>2.引用类型堆栈处理</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>x <span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token keyword">var</span> obj2 <span class="token operator">=</span> obj1obj2<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">// 如下图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661235391_ffc9609fac409a687893b24ef4c30549.png" alt="引用类型堆栈"></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>x <span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token keyword">var</span> obj2 <span class="token operator">=</span> obj1obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>    name<span class="token operator">:</span> <span class="token string">'alishi'</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">// 如下图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661242580_485c5e2b87f35ad431a0a9cbf1ec1932.png" alt="引用类型堆栈2"></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token keyword">var</span> obj2 <span class="token operator">=</span> obj1obj1<span class="token punctuation">.</span>y <span class="token operator">=</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">}</span><span class="token comment">// 类似</span><span class="token comment">// obj1.y = {x: 200}</span><span class="token comment">// obj1 = {x: 200}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span>  <span class="token comment">// { x: 200 }</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>y<span class="token punctuation">)</span>  <span class="token comment">// undefined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span>  <span class="token comment">// { x: 100, y: { x: 200 } }</span><span class="token comment">// 如下图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661243538_5c7becdef671a6df9df32643e6b4d711.png" alt="引用类型堆栈3"></p><h3 id="3-函数堆栈处理"><a href="#3-函数堆栈处理" class="headerlink" title="3.函数堆栈处理"></a>3.函数堆栈处理</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'5coder'</span><span class="token punctuation">,</span> <span class="token string">'leo'</span><span class="token punctuation">]</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  obj<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'zoe'</span>  obj <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'拉钩教育'</span><span class="token punctuation">]</span>  obj<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'大前端'</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">foo</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token comment">/** * 01 函数创建 * -- 可以将函数名称看做是变量，存放在 VO 当中 ，同时它的值就是当前函数对应的内存地址 * -- 函数本身也是一个对象，创建时会有一个内存地址，空间内存放的就是函数体代码（字符串形式的） * 02 函数执行 * -- 函数执行时会形成一个全新私有上下文，它里面有一个AO 用于管理这个上下文当中的变量 * -- 步骤： *  01 作用域链 &lt;当前执行上下文， 上级作用域所在的执行上下文&gt; *  02 确定 this *  03 初始化 arguments （对象） *  04 形参赋值：它就相当于是变量声明，然后将声明的变量放置于 AO *  05 变量提升 *  06 代码执行 */</span><span class="token comment">// 如下图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661245987_0d4232baf1231cc6f55c4fcd8b9b01bf.png" alt="函数堆栈执行"></p><h3 id="4-闭包堆栈处理"><a href="#4-闭包堆栈处理" class="headerlink" title="4.闭包堆栈处理"></a>4.闭包堆栈处理</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c <span class="token operator">+</span> b<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token comment">/** 1.闭包：是一种机制*   保护：当前上下文当中的变量与其他的上下文中变量互不干扰*   保存：当前上下文中的数据（对地址）被当前上下文以外的上下文忠的变量引用，这个数据就保存下来* 2.闭包：*   函数调用想成了一个全新的私有上下文，在函数调用之后当前上下文不被释放就是闭包（临时不被释放）** */</span><span class="token comment">// 如下图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661246438_d9698b81f9e56f58defa6f26c9f7569e.png" alt="04-闭包与堆栈执行"></p><h3 id="5-闭包与垃圾回收"><a href="#5-闭包与垃圾回收" class="headerlink" title="5.闭包与垃圾回收"></a>5.闭包与垃圾回收</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment">// 如下图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661246446_efad8315a80a738cc9a9b099dff2eaf2.png" alt="05-闭包与GC"></p><h3 id="6-循环添加事件"><a href="#6-循环添加事件" class="headerlink" title="6.循环添加事件"></a>6.循环添加事件</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span>        <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>循环添加事件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>按钮1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>按钮2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>按钮3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">var</span> aButtons <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aButtons<span class="token punctuation">)</span>  <span class="token comment">/*  * 基础  for (var i = 0; i &lt; aButtons.length; i++) {    aButtons[i].onclick = function () {      console.log(`当前的索引值为${i}`)    }  }   */</span>  <span class="token comment">/*  for (var i = 0; i &lt; aButtons.length; i++) {      (function (i) {        aButtons[i].onclick = function () {          console.log(`当前的索引值为${i}`)        }      })(i)    }*/</span>  <span class="token comment">/*  for (var i = 0; i &lt; aButtons.length; i++) {      aButtons[i].onclick = (function (i) {        return function () {          console.log(`当前的索引值为${i}`)        }      })(i)    }*/</span>  <span class="token comment">/*  for (let i = 0; i &lt; aButtons.length; i++) {      aButtons[i].onclick = function () {        console.log(`当前的索引值为${i}`)      }    }*/</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> aButtons<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    aButtons<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>myIndex <span class="token operator">=</span> i    aButtons<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前的索引值为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>myIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>循环添加事件-底层执行分析</p><p><img src="http://5coder.cn/img/1661246456_b113bf25d47870695d5a1d730966c7fd.png" alt="循环添加事件"></p><h3 id="8-循环添加事件-事件委托方法实现"><a href="#8-循环添加事件-事件委托方法实现" class="headerlink" title="8.循环添加事件-事件委托方法实现"></a>8.循环添加事件-事件委托方法实现</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span>        <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>按钮1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>按钮2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>按钮3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> target <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span>      targetDom <span class="token operator">=</span> target<span class="token punctuation">.</span>tagName    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetDom <span class="token operator">===</span> <span class="token string">'BUTTON'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> index <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前点击的是第</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">个按钮</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--如下图--&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661307355_b8f4f25c38bc099ea4aea74e6f3a538c.png" alt="事件委托"></p><h3 id="9-变量局部化"><a href="#9-变量局部化" class="headerlink" title="9.变量局部化"></a>9.变量局部化</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 变量局部化（全局、局部）</span><span class="token comment">// 这样可以提高代码的执行效率（减少了数据访问时需要查找的路径）</span><span class="token comment">// 数据的存储和读取</span><span class="token keyword">var</span> i<span class="token punctuation">,</span> str <span class="token operator">=</span> <span class="token string">""</span><span class="token comment">// function packageDom() {</span><span class="token comment">//   for (var i = 0; i &lt; 1000; i++) {</span><span class="token comment">//     str += i</span><span class="token comment">//   }</span><span class="token comment">// }</span><span class="token comment">// packageDom()</span><span class="token keyword">function</span> <span class="token function">packageDom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    str <span class="token operator">+=</span> i  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">packageDom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// jsBench测试结果如下图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661321607_fde7f67fd0417f1288947a1d269e2cb4.png" alt="jsBench测试结果"></p><p><strong>减少访问层</strong></p><p>底层分析（**减少了数据访问时需要查找的路径-ec(page)到EC(G)**）：</p><p><img src="http://5coder.cn/img/1661321648_181b4e8c1f47d498cc08b24520160a53.png" alt="数据存取"></p><h3 id="10-缓存数据"><a href="#10-缓存数据" class="headerlink" title="10.缓存数据"></a>10.缓存数据</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>减少数据读取次数<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skip<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skip<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">            <span class="token keyword">var</span> oBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'skip'</span><span class="token punctuation">)</span>    <span class="token keyword">function</span> <span class="token function">hasEle</span><span class="token punctuation">(</span><span class="token parameter">ele<span class="token punctuation">,</span> cls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ele<span class="token punctuation">.</span>className<span class="token punctuation">)</span>      <span class="token keyword">return</span> ele<span class="token punctuation">.</span>className <span class="token operator">===</span> cls    <span class="token punctuation">}</span>    <span class="token comment">// 空间上多一些占用</span>    <span class="token keyword">function</span> <span class="token function">hasEle</span><span class="token punctuation">(</span><span class="token parameter">ele<span class="token punctuation">,</span> cls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> className <span class="token operator">=</span> ele<span class="token punctuation">.</span>className      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span>      <span class="token keyword">return</span> className <span class="token operator">===</span> cls    <span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hasEle</span><span class="token punctuation">(</span>oBox<span class="token punctuation">,</span> <span class="token string">'skip'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/53YtRCWn2o1jsaT.png"></p><h3 id="11-减少访问层数"><a href="#11-减少访问层数" class="headerlink" title="11.减少访问层数"></a>11.减少访问层数</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 减少访问层级</span><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'5coder'</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">}</span><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'5coder'</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">28</span>  <span class="token comment">// 增加访问层数</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getAge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661323050_f4fde3c4a6c357d42eb4f0143901daf9.png" alt="减少访问层数"></p><h3 id="12-防抖与节流"><a href="#12-防抖与节流" class="headerlink" title="12.防抖与节流"></a>12.防抖与节流</h3><blockquote><ul><li>为什么需要防抖和节流：</li></ul><p>在一些高频率事件触发的场景下我们不希望对应的事件处理函数多次执行场景:</p><ul><li>滚动事件</li><li>输入的模糊匹配</li><li>轮播图切换</li><li>点击操作….</li></ul><p>浏览器默认情况下都会有自己的监听事件间隔（ 4~6ms)，如果检测到多次事件的监听执行，那么就会造成不必要的资源浪费。</p><p>前置的场景： 界面上有一个按钮，我们可以连续多次点击</p><p>防抖：对于这个高频的操作来说，我们只希望识别一次点击，可以人为是第一次或者是最后一次<br>节流：对于高频操作，我们可以自己来设置频率，让本来会执行很多次的事件触发，按着我们定义的频率减少触发的次数</p></blockquote><ul><li><h4 id="防抖函数实现"><a href="#防抖函数实现" class="headerlink" title="防抖函数实现"></a><strong>防抖函数实现</strong></h4></li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>防抖函数实现<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>点击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">var</span> oBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>    <span class="token comment">// oBtn.onclick = function () {</span>    <span class="token comment">//   console.log('点击了')</span>    <span class="token comment">// }</span>    <span class="token comment">/**      * handle 最终需要执行的事件监听     * wait 事件触发之后多久开始执行     * immediate 控制执行第一次还是最后一次，false 执行最后一次    */</span>    <span class="token keyword">function</span> <span class="token function">myDebounce</span><span class="token punctuation">(</span><span class="token parameter">handle<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> immediate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 参数类型判断及默认值处理</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> handle <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'handle must be an function'</span><span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> wait <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> wait <span class="token operator">=</span> <span class="token number">300</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> wait <span class="token operator">===</span> <span class="token string">'boolean'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        immediate <span class="token operator">=</span> wait        wait <span class="token operator">=</span> <span class="token number">300</span>      <span class="token punctuation">}</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> immediate <span class="token operator">!==</span> <span class="token string">'boolean'</span><span class="token punctuation">)</span> immediate <span class="token operator">=</span> <span class="token boolean">false</span>      <span class="token comment">// 所谓的防抖效果我们想要实现的就是有一个 ”人“ 可以管理 handle 的执行次数</span>      <span class="token comment">// 如果我们想要执行最后一次，那就意味着无论我们当前点击了多少次，前面的N-1次都无用</span>      <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span>          init <span class="token operator">=</span> immediate <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>timer        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          timer <span class="token operator">=</span> <span class="token keyword">null</span>          <span class="token operator">!</span>immediate <span class="token operator">?</span> <span class="token function">handle</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>        <span class="token comment">// 如果当前传递进来的是 true 就表示我们需要立即执行</span>        <span class="token comment">// 如果想要实现只在第一次执行，那么可以添加上 timer 为 null 做为判断</span>        <span class="token comment">// 因为只要 timer 为 Null 就意味着没有第二次....点击</span>        init <span class="token operator">?</span> <span class="token function">handle</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// 定义事件执行函数</span>    <span class="token keyword">function</span> <span class="token function">btnClick</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击了1111'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> ev<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 当我们执行了按钮点击之后就会执行...返回的 proxy</span>    oBtn<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token function">myDebounce</span><span class="token punctuation">(</span>btnClick<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token comment">// oBtn.onclick = btnClick()  // this ev</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><h4 id="节流函数实现"><a href="#节流函数实现" class="headerlink" title="节流函数实现"></a><strong>节流函数实现</strong></h4></li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>节流函数实现<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">    <span class="token selector">body</span> <span class="token punctuation">{</span>      <span class="token property">height</span><span class="token punctuation">:</span> 5000px<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token comment">// 节流：我们这里的节流指的就是在自定义的一段时间内让事件进行触发</span>    <span class="token keyword">function</span> <span class="token function">myThrottle</span><span class="token punctuation">(</span><span class="token parameter">handle<span class="token punctuation">,</span> wait</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> handle <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'handle must be an function'</span><span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> wait <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> wait <span class="token operator">=</span> <span class="token number">400</span>      <span class="token keyword">let</span> previous <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">// 定义变量记录上一次执行时的时间</span>      <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token comment">// 用它来管理定时器</span>      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 定义变量记录当前次执行的时刻时间点</span>        <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span>        <span class="token keyword">let</span> interval <span class="token operator">=</span> wait <span class="token operator">-</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> previous<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>interval <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">// 此时就说明是一个非高频次操作，可以执行 handle</span>          <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>          timer <span class="token operator">=</span> <span class="token keyword">null</span>          <span class="token function">handle</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>          previous <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">// 当我们发现当前系统中有一个定时器了，就意味着我们不需要再开启定时器</span>          <span class="token comment">// 此时就说明这次的操作发生在了我们定义的频次时间范围内，那就不应该执行 handle</span>          <span class="token comment">// 这个时候我们就可以自定义一个定时器，让 handle 在 interval 之后去执行</span>          timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token comment">// 这个操作只是将系统中的定时器清除了，但是 timer 中的值还在</span>            timer <span class="token operator">=</span> <span class="token keyword">null</span>            <span class="token function">handle</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>            previous <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// 定义滚动事件监听</span>    <span class="token keyword">function</span> <span class="token function">scrollFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'滚动了'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// window.onscroll = scrollFn</span>    window<span class="token punctuation">.</span>onscroll <span class="token operator">=</span> <span class="token function">myThrottle</span><span class="token punctuation">(</span>scrollFn<span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 性能优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-theme-matery主题使用</title>
      <link href="2022/082310663.html"/>
      <url>2022/082310663.html</url>
      
        <content type="html"><![CDATA[<h1 id="hexo-theme-matery主题使用"><a href="#hexo-theme-matery主题使用" class="headerlink" title="hexo-theme-matery主题使用"></a>hexo-theme-matery主题使用</h1><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul><li>简单漂亮，文章内容美观易读</li><li><a href="https://material.io/">Material Design</a> 设计</li><li>响应式设计，博客在桌面端、平板、手机等设备上均能很好的展现</li><li>首页轮播文章及每天动态切换 <code>Banner</code> 图片</li><li>瀑布流式的博客文章列表（文章无特色图片时会有 <code>24</code> 张漂亮的图片代替）</li><li>时间轴式的归档页</li><li><strong>词云</strong>的标签页和<strong>雷达图</strong>的分类页</li><li>丰富的关于我页面（包括关于我、文章统计图、我的项目、我的技能、相册等）</li><li>可自定义的数据的友情链接页面</li><li>支持文章置顶和文章打赏</li><li>支持 <code>MathJax</code></li><li><code>TOC</code> 目录</li><li>可设置复制文章内容时追加版权信息</li><li>可设置阅读文章时做密码验证</li><li><a href="https://gitalk.github.io/">Gitalk</a>、<a href="https://imsun.github.io/gitment/">Gitment</a>、<a href="https://valine.js.org/">Valine</a> 和 <a href="https://disqus.com/">Disqus</a> 评论模块（推荐使用 <code>Gitalk</code>）</li><li>集成了<a href="http://busuanzi.ibruce.info/">不蒜子统计</a>、谷歌分析（<code>Google Analytics</code>）和文章字数统计等功能</li><li>支持在首页的音乐播放和视频播放功能</li><li>支持<code>emoji</code>表情，用<code>markdown emoji</code>语法书写直接生成对应的能<strong>跳跃</strong>的表情。</li><li>支持 <a href="http://www.daovoice.io/">DaoVoice</a>、<a href="https://www.tidio.com/">Tidio</a> 在线聊天功能。</li></ul><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>本主题<strong>推荐你使用 Hexo 5.0.0 及以上的版本</strong>。如果，你已经有一个自己的 <a href="https://hexo.io/zh-cn/">Hexo</a> 博客了，建议你将 Hexo 升级到最新稳定的版本。</p><p>点击 <a href="https://codeload.github.com/blinkfox/hexo-theme-matery/zip/master">这里</a> 下载 <code>master</code> 分支的最新稳定版的代码，解压缩后，将 <code>hexo-theme-matery</code> 的文件夹复制到你 Hexo 的 <code>themes</code> 文件夹中即可。</p><p>当然你也可以在你的 <code>themes</code> 文件夹下使用 <code>git clone</code> 命令来下载:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/blinkfox/hexo-theme-matery.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="切换主题"><a href="#切换主题" class="headerlink" title="切换主题"></a>切换主题</h3><p>修改 Hexo 根目录下的 <code>_config.yml</code> 的  <code>theme</code> 的值：<code>theme: hexo-theme-matery</code></p><h4 id="config-yml-文件的其它修改建议"><a href="#config-yml-文件的其它修改建议" class="headerlink" title="_config.yml 文件的其它修改建议:"></a><code>_config.yml</code> 文件的其它修改建议:</h4><ul><li>请修改 <code>_config.yml</code> 的 <code>url</code> 的值为你的网站主 <code>URL</code>（如：<code>http://xxx.github.io</code>）。</li><li>建议修改两个 <code>per_page</code> 的分页条数值为 <code>6</code> 的倍数，如：<code>12</code>、<code>18</code> 等，这样文章列表在各个屏幕下都能较好的显示。</li><li>如果你是中文用户，则建议修改 <code>language</code> 的值为 <code>zh-CN</code>。</li></ul><h3 id="新建分类-categories-页"><a href="#新建分类-categories-页" class="headerlink" title="新建分类 categories 页"></a>新建分类 categories 页</h3><p><code>categories</code> 页是用来展示所有分类的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>categories/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"categories"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑你刚刚新建的页面文件 <code>/source/categories/index.md</code>，至少需要以下内容：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> categories<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 17:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"categories"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"categories"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="新建标签-tags-页"><a href="#新建标签-tags-页" class="headerlink" title="新建标签 tags 页"></a>新建标签 tags 页</h3><p><code>tags</code> 页是用来展示所有标签的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>tags/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"tags"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑你刚刚新建的页面文件 <code>/source/tags/index.md</code>，至少需要以下内容：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> tags<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 18:23:38</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"tags"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"tags"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="新建关于我-about-页"><a href="#新建关于我-about-页" class="headerlink" title="新建关于我 about 页"></a>新建关于我 about 页</h3><p><code>about</code> 页是用来展示<strong>关于我和我的博客</strong>信息的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>about/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"about"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑你刚刚新建的页面文件 <code>/source/about/index.md</code>，至少需要以下内容：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> about<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 17:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"about"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"about"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="新建留言板-contact-页（可选的）"><a href="#新建留言板-contact-页（可选的）" class="headerlink" title="新建留言板 contact 页（可选的）"></a>新建留言板 contact 页（可选的）</h3><p><code>contact</code> 页是用来展示<strong>留言板</strong>信息的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>contact/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"contact"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑你刚刚新建的页面文件 <code>/source/contact/index.md</code>，至少需要以下内容：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> contact<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 17:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"contact"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"contact"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：本留言板功能依赖于第三方评论系统，请<strong>激活</strong>你的评论系统才有效果。并且在主题的 <code>_config.yml</code> 文件中，第 <code>19</code> 至 <code>21</code> 行的“<strong>菜单</strong>”配置，取消关于留言板的注释即可。</p></blockquote><h3 id="新建友情链接-friends-页（可选的）"><a href="#新建友情链接-friends-页（可选的）" class="headerlink" title="新建友情链接 friends 页（可选的）"></a>新建友情链接 friends 页（可选的）</h3><p><code>friends</code> 页是用来展示<strong>友情链接</strong>信息的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>friends/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"friends"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑你刚刚新建的页面文件 <code>/source/friends/index.md</code>，至少需要以下内容：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> friends<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-12-12 21:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"friends"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"friends"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同时，在你的博客 <code>source</code> 目录下新建 <code>_data</code> 目录，在 <code>_data</code> 目录中新建 <code>friends.json</code> 文件，文件内容如下所示：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span><span class="token punctuation">{</span>    <span class="token property">"avatar"</span><span class="token operator">:</span> <span class="token string">"http://image.luokangyuan.com/1_qq_27922023.jpg"</span><span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"码酱"</span><span class="token punctuation">,</span>    <span class="token property">"introduction"</span><span class="token operator">:</span> <span class="token string">"我不是大佬，只是在追寻大佬的脚步"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://luokangyuan.com/"</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前去学习"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token property">"avatar"</span><span class="token operator">:</span> <span class="token string">"http://image.luokangyuan.com/4027734.jpeg"</span><span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"闪烁之狐"</span><span class="token punctuation">,</span>    <span class="token property">"introduction"</span><span class="token operator">:</span> <span class="token string">"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://blinkfox.github.io/"</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前去学习"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token property">"avatar"</span><span class="token operator">:</span> <span class="token string">"http://image.luokangyuan.com/avatar.jpg"</span><span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ja_rome"</span><span class="token punctuation">,</span>    <span class="token property">"introduction"</span><span class="token operator">:</span> <span class="token string">"平凡的脚步也可以走出伟大的行程"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://me.csdn.net/jlh912008548"</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前去学习"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="新建-404-页"><a href="#新建-404-页" class="headerlink" title="新建 404 页"></a>新建 404 页</h3><p>如果在你的博客 <code>source</code> 目录下还没有 <code>404.md</code> 文件，那么你就需要新建一个</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token number">404</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑你刚刚新建的页面文件 <code>/source/404/index.md</code>，至少需要以下内容：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token number">404</span><span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 17:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"404"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"404"</span><span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Oops～，我崩溃了！找不到你想要的页面 :("</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="菜单导航配置"><a href="#菜单导航配置" class="headerlink" title="菜单导航配置"></a>菜单导航配置</h3><h4 id="配置基本菜单导航的名称、路径url和图标icon"><a href="#配置基本菜单导航的名称、路径url和图标icon" class="headerlink" title="配置基本菜单导航的名称、路径url和图标icon."></a>配置基本菜单导航的名称、路径url和图标icon.</h4><p>1.菜单导航名称可以是中文也可以是英文(如：<code>Index</code>或<code>主页</code>)<br>2.图标icon 可以在<a href="https://fontawesome.com/icons">Font Awesome</a> 中查找   </p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">menu</span><span class="token punctuation">:</span>  <span class="token key atrule">Index</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>home  <span class="token key atrule">Tags</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /tags    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>tags  <span class="token key atrule">Categories</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /categories    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>bookmark  <span class="token key atrule">Archives</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /archives    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>archive  <span class="token key atrule">About</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /about    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>user<span class="token punctuation">-</span>circle  <span class="token key atrule">Friends</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /friends    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>address<span class="token punctuation">-</span>book<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="二级菜单配置方法"><a href="#二级菜单配置方法" class="headerlink" title="二级菜单配置方法"></a>二级菜单配置方法</h4><p>如果你需要二级菜单则可以在原基本菜单导航的基础上如下操作</p><ol><li>在需要添加二级菜单的一级菜单下添加<code>children</code>关键字(如:<code>About</code>菜单下添加<code>children</code>)     </li><li>在<code>children</code>下创建二级菜单的 名称name,路径url和图标icon.      </li><li>注意每个二级菜单模块前要加 <code>-</code>.     </li><li>注意缩进格式  </li></ol><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">menu</span><span class="token punctuation">:</span>  <span class="token key atrule">Index</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>home  <span class="token key atrule">Tags</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /tags    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>tags  <span class="token key atrule">Categories</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /categories    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>bookmark  <span class="token key atrule">Archives</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /archives    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>archive  <span class="token key atrule">About</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /about    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>user<span class="token punctuation">-</span>circle<span class="token punctuation">-</span>o  <span class="token key atrule">Friends</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /friends    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>address<span class="token punctuation">-</span>book  <span class="token key atrule">Medias</span><span class="token punctuation">:</span>    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>list    <span class="token key atrule">children</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Music        <span class="token key atrule">url</span><span class="token punctuation">:</span> /music        <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>music      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Movies        <span class="token key atrule">url</span><span class="token punctuation">:</span> /movies        <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>film      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Books        <span class="token key atrule">url</span><span class="token punctuation">:</span> /books        <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>book      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Galleries        <span class="token key atrule">url</span><span class="token punctuation">:</span> /galleries        <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>image<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行 <code>hexo clean &amp;&amp; hexo g</code> 重新生成博客文件，然后就可以在文章中对应位置看到你用<code>emoji</code>语法写的表情了。</p><h3 id="代码高亮"><a href="#代码高亮" class="headerlink" title="代码高亮"></a>代码高亮</h3><p>从 Hexo5.0 版本开始自带了 <code>prismjs</code> 代码语法高亮的支持，本主题对此进行了改造支持。</p><p>如果你的博客中曾经安装过 <code>hexo-prism-plugin</code> 的插件，那么你须要执行 <code>npm uninstall hexo-prism-plugin</code> 来卸载掉它，否则生成的代码中会有 <code>&amp;#123;</code> 和 <code>&amp;#125;</code> 的转义字符。</p><p>然后，修改 Hexo 根目录下 <code>_config.yml</code> 文件中 <code>highlight.enable</code> 的值为 <code>false</code>，并将 <code>prismjs.enable</code> 的值设置为 <code>true</code>，主要配置如下：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">highlight</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">line_number</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">auto_detect</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">tab_replace</span><span class="token punctuation">:</span> <span class="token string">''</span>  <span class="token key atrule">wrap</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">hljs</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">prismjs</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">preprocess</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">line_number</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">tab_replace</span><span class="token punctuation">:</span> <span class="token string">''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>主题中默认的 <code>prismjs</code> 主题是 <code>Tomorrow Night</code>，如果你想定制自己的主题，可以前往 <a href="https://prismjs.com/download.html">prismjs 下载页面</a> 定制下载自己喜欢的主题 <code>css</code> 文件，然后将此 css 主题文件取名为 <code>prism.css</code>，替换掉 <code>hexo-theme-matery</code> 主题文件夹中的 <code>source/libs/prism/prism.css</code> 文件即可。</p><h3 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h3><p>本主题中还使用到了 <a href="https://github.com/wzpan/hexo-generator-search">hexo-generator-search</a> 的 Hexo 插件来做内容搜索，安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-generator-search --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">search</span><span class="token punctuation">:</span>  <span class="token key atrule">path</span><span class="token punctuation">:</span> search.xml  <span class="token key atrule">field</span><span class="token punctuation">:</span> post<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="中文链接转拼音（建议安装）"><a href="#中文链接转拼音（建议安装）" class="headerlink" title="中文链接转拼音（建议安装）"></a>中文链接转拼音（建议安装）</h3><p>如果你的文章名称是中文的，那么 Hexo 默认生成的永久链接也会有中文，这样不利于 <code>SEO</code>，且 <code>gitment</code> 评论对中文链接也不支持。我们可以用 <a href="https://github.com/viko16/hexo-permalink-pinyin">hexo-permalink-pinyin</a> Hexo 插件使在生成文章时生成中文拼音的永久链接。</p><p>安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i hexo-permalink-pinyin --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">permalink_pinyin</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">separator</span><span class="token punctuation">:</span> <span class="token string">'-'</span> <span class="token comment"># default: '-'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：除了此插件外，<a href="https://github.com/rozbo/hexo-abbrlink">hexo-abbrlink</a> 插件也可以生成非中文的链接。</p></blockquote><h3 id="文章字数统计插件（建议安装）"><a href="#文章字数统计插件（建议安装）" class="headerlink" title="文章字数统计插件（建议安装）"></a>文章字数统计插件（建议安装）</h3><p>如果你想要在文章中显示文章字数、阅读时长信息，可以安装 <a href="https://github.com/willin/hexo-wordcount">hexo-wordcount</a>插件。</p><p>安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i --save hexo-wordcount<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后只需在本主题下的 <code>_config.yml</code> 文件中，将各个文章字数相关的配置激活即可：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">postInfo</span><span class="token punctuation">:</span>  <span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">update</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">wordCount</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 设置文章字数统计为 true.</span>  <span class="token key atrule">totalCount</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 设置站点文章总字数统计为 true.</span>  <span class="token key atrule">min2read</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 阅读时长.</span>  <span class="token key atrule">readCount</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 阅读次数.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="添加emoji表情支持（可选的）"><a href="#添加emoji表情支持（可选的）" class="headerlink" title="添加emoji表情支持（可选的）"></a>添加emoji表情支持（可选的）</h3><p>本主题新增了对<code>emoji</code>表情的支持，使用到了 <a href="https://npm.taobao.org/package/hexo-filter-github-emojis">hexo-filter-github-emojis</a> 的 Hexo 插件来支持 <code>emoji</code>表情的生成，把对应的<code>markdown emoji</code>语法（<code>::</code>,例如：<code>:smile:</code>）转变成会跳跃的<code>emoji</code>表情，安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-filter-github-emojis --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">githubEmojis</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">className</span><span class="token punctuation">:</span> github<span class="token punctuation">-</span>emoji  <span class="token key atrule">inject</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">styles</span><span class="token punctuation">:</span>  customEmojis<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="添加-RSS-订阅支持（可选的）"><a href="#添加-RSS-订阅支持（可选的）" class="headerlink" title="添加 RSS 订阅支持（可选的）"></a>添加 RSS 订阅支持（可选的）</h3><p>本主题中还使用到了 <a href="https://github.com/hexojs/hexo-generator-feed">hexo-generator-feed</a> 的 Hexo 插件来做 <code>RSS</code>，安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-generator-feed --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">feed</span><span class="token punctuation">:</span>  <span class="token key atrule">type</span><span class="token punctuation">:</span> atom  <span class="token key atrule">path</span><span class="token punctuation">:</span> atom.xml  <span class="token key atrule">limit</span><span class="token punctuation">:</span> <span class="token number">20</span>  <span class="token key atrule">hub</span><span class="token punctuation">:</span>  <span class="token key atrule">content</span><span class="token punctuation">:</span>  <span class="token key atrule">content_limit</span><span class="token punctuation">:</span> <span class="token number">140</span>  <span class="token key atrule">content_limit_delim</span><span class="token punctuation">:</span> <span class="token string">' '</span>  <span class="token key atrule">order_by</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>date<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行 <code>hexo clean &amp;&amp; hexo g</code> 重新生成博客文件，然后在 <code>public</code> 文件夹中即可看到 <code>atom.xml</code> 文件，说明你已经安装成功了。</p><h3 id="添加-DaoVoice-在线聊天功能（可选的）"><a href="#添加-DaoVoice-在线聊天功能（可选的）" class="headerlink" title="添加 DaoVoice 在线聊天功能（可选的）"></a>添加 <a href="http://www.daovoice.io/">DaoVoice</a> 在线聊天功能（可选的）</h3><p>前往 <a href="http://www.daovoice.io/">DaoVoice</a> 官网注册并且获取 <code>app_id</code>，并将 <code>app_id</code> 填入主题的 <code>_config.yml</code> 文件中。</p><h3 id="添加-Tidio-在线聊天功能（可选的）"><a href="#添加-Tidio-在线聊天功能（可选的）" class="headerlink" title="添加 Tidio 在线聊天功能（可选的）"></a>添加 <a href="https://www.tidio.com/">Tidio</a> 在线聊天功能（可选的）</h3><p>前往 <a href="https://www.tidio.com/">Tidio</a> 官网注册并且获取 <code>Public Key</code>，并将 <code>Public Key</code> 填入主题的 <code>_config.yml</code> 文件中。</p><h3 id="修改页脚"><a href="#修改页脚" class="headerlink" title="修改页脚"></a>修改页脚</h3><p>页脚信息可能需要做定制化修改，而且它不便于做成配置信息，所以可能需要你自己去再修改和加工。修改的地方在主题文件的 <code>/layout/_partial/footer.ejs</code> 文件中，包括站点、使用的主题、访问量等。</p><h3 id="修改社交链接"><a href="#修改社交链接" class="headerlink" title="修改社交链接"></a>修改社交链接</h3><p>在主题的 <code>_config.yml</code> 文件中，默认支持 <code>QQ</code>、<code>GitHub</code> 和邮箱等的配置，你可以在主题文件的 <code>/layout/_partial/social-link.ejs</code> 文件中，新增、修改你需要的社交链接地址，增加链接可参考如下代码：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">&lt;% if (theme.socialLink.github) { %&gt;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;%= theme.socialLink.github %&gt;<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tooltipped<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">data-tooltip</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>访问我的GitHub<span class="token punctuation">"</span></span> <span class="token attr-name">data-position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>top<span class="token punctuation">"</span></span> <span class="token attr-name">data-delay</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fab fa-github<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>&lt;% } %&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中，社交图标（如：<code>fa-github</code>）你可以在 <a href="https://fontawesome.com/icons">Font Awesome</a> 中搜索找到。以下是常用社交图标的标识，供你参考：</p><ul><li>Facebook: <code>fab fa-facebook</code></li><li>Twitter: <code>fab fa-twitter</code></li><li>Google-plus: <code>fab fa-google-plus</code></li><li>Linkedin: <code>fab fa-linkedin</code></li><li>Tumblr: <code>fab fa-tumblr</code></li><li>Medium: <code>fab fa-medium</code></li><li>Slack: <code>fab fa-slack</code></li><li>Sina Weibo: <code>fab fa-weibo</code></li><li>Wechat: <code>fab fa-weixin</code></li><li>QQ: <code>fab fa-qq</code></li><li>Zhihu: <code>fab fa-zhihu</code></li></ul><blockquote><p><strong>注意</strong>: 本主题中使用的 <code>Font Awesome</code> 版本为 <code>5.11.0</code>。</p></blockquote><h3 id="修改打赏的二维码图片"><a href="#修改打赏的二维码图片" class="headerlink" title="修改打赏的二维码图片"></a>修改打赏的二维码图片</h3><p>在主题文件的 <code>source/medias/reward</code> 文件中，你可以替换成你的的微信和支付宝的打赏二维码图片。</p><h3 id="配置音乐播放器（可选的）"><a href="#配置音乐播放器（可选的）" class="headerlink" title="配置音乐播放器（可选的）"></a>配置音乐播放器（可选的）</h3><p>要支持音乐播放，在主题的 <code>_config.yml</code> 配置文件中激活music配置即可：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 是否在首页显示音乐</span><span class="token key atrule">music</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">title</span><span class="token punctuation">:</span>         <span class="token comment"># 非吸底模式有效</span>    <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">show</span><span class="token punctuation">:</span> 听听音乐  <span class="token key atrule">server</span><span class="token punctuation">:</span> netease   <span class="token comment"># require music platform: netease, tencent, kugou, xiami, baidu</span>  <span class="token key atrule">type</span><span class="token punctuation">:</span> playlist    <span class="token comment"># require song, playlist, album, search, artist</span>  <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">503838841</span>     <span class="token comment"># require song id / playlist id / album id / search keyword</span>  <span class="token key atrule">fixed</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>      <span class="token comment"># 开启吸底模式</span>  <span class="token key atrule">autoplay</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>   <span class="token comment"># 是否自动播放</span>  <span class="token key atrule">theme</span><span class="token punctuation">:</span> <span class="token string">'#42b983'</span>  <span class="token key atrule">loop</span><span class="token punctuation">:</span> <span class="token string">'all'</span>       <span class="token comment"># 音频循环播放, 可选值: 'all', 'one', 'none'</span>  <span class="token key atrule">order</span><span class="token punctuation">:</span> <span class="token string">'random'</span>   <span class="token comment"># 音频循环顺序, 可选值: 'list', 'random'</span>  <span class="token key atrule">preload</span><span class="token punctuation">:</span> <span class="token string">'auto'</span>   <span class="token comment"># 预加载，可选值: 'none', 'metadata', 'auto'</span>  <span class="token key atrule">volume</span><span class="token punctuation">:</span> <span class="token number">0.7</span>       <span class="token comment"># 默认音量，请注意播放器会记忆用户设置，用户手动设置音量后默认音量即失效</span>  <span class="token key atrule">listFolded</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># 列表默认折叠</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>server</code>可选<code>netease</code>（网易云音乐），<code>tencent</code>（QQ音乐），<code>kugou</code>（酷狗音乐），<code>xiami</code>（虾米音乐），</p><p><code>baidu</code>（百度音乐）。</p><p><code>type</code>可选<code>song</code>（歌曲），<code>playlist</code>（歌单），<code>album</code>（专辑），<code>search</code>（搜索关键字），<code>artist</code>（歌手）</p><p><code>id</code>获取方法示例: 浏览器打开网易云音乐，点击我喜欢的音乐歌单，浏览器地址栏后面会有一串数字，<code>playlist</code>的<code>id</code></p><p>即为这串数字。</p></blockquote><h2 id="文章-Front-matter-介绍"><a href="#文章-Front-matter-介绍" class="headerlink" title="文章 Front-matter 介绍"></a>文章 Front-matter 介绍</h2><h3 id="Front-matter-选项详解"><a href="#Front-matter-选项详解" class="headerlink" title="Front-matter 选项详解"></a>Front-matter 选项详解</h3><p><code>Front-matter</code> 选项中的所有内容均为<strong>非必填</strong>的。但我仍然建议至少填写 <code>title</code> 和 <code>date</code> 的值。</p><table><thead><tr><th>配置选项</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>title</td><td><code>Markdown</code> 的文件标题</td><td>文章标题，强烈建议填写此选项</td></tr><tr><td>date</td><td>文件创建时的日期时间</td><td>发布时间，强烈建议填写此选项，且最好保证全局唯一</td></tr><tr><td>author</td><td>根 <code>_config.yml</code> 中的 <code>author</code></td><td>文章作者</td></tr><tr><td>img</td><td><code>featureImages</code> 中的某个值</td><td>文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: <code>http://xxx.com/xxx.jpg</code></td></tr><tr><td>top</td><td><code>true</code></td><td>推荐文章（文章是否置顶），如果 <code>top</code> 值为 <code>true</code>，则会作为首页推荐文章</td></tr><tr><td>cover</td><td><code>false</code></td><td><code>v1.0.2</code>版本新增，表示该文章是否需要加入到首页轮播封面中</td></tr><tr><td>coverImg</td><td>无</td><td><code>v1.0.2</code>版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片</td></tr><tr><td>password</td><td>无</td><td>文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 <code>password</code> 的值，该值必须是用 <code>SHA256</code> 加密后的密码，防止被他人识破。前提是在主题的 <code>config.yml</code> 中激活了 <code>verifyPassword</code> 选项</td></tr><tr><td>toc</td><td><code>true</code></td><td>是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 <code>config.yml</code> 中激活了 <code>toc</code> 选项</td></tr><tr><td>mathjax</td><td><code>false</code></td><td>是否开启数学公式支持 ，本文章是否开启 <code>mathjax</code>，且需要在主题的 <code>_config.yml</code> 文件中也需要开启才行</td></tr><tr><td>summary</td><td>无</td><td>文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要</td></tr><tr><td>categories</td><td>无</td><td>文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类</td></tr><tr><td>tags</td><td>无</td><td>文章标签，一篇文章可以多个标签</td></tr><tr><td>keywords</td><td>文章标题</td><td>文章关键字，SEO 时需要</td></tr><tr><td>reprintPolicy</td><td>cc_by</td><td>文章转载规则， 可以是 cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint 或 pay 中的一个</td></tr></tbody></table><blockquote><p><strong>注意</strong>:</p><ol><li>如果 <code>img</code> 属性不填写的话，文章特色图会根据文章标题的 <code>hashcode</code> 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章的特色图<strong>各有特色</strong>。</li><li><code>date</code> 的值尽量保证每篇文章是唯一的，因为本主题中 <code>Gitalk</code> 和 <code>Gitment</code> 识别 <code>id</code> 是通过 <code>date</code> 的值来作为唯一标识的。</li><li>如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 <code>_config.yml</code> 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：<a href="http://tool.oschina.net/encrypt?type=2">开源中国在线工具</a>、<a href="http://encode.chahuo.com/">chahuo</a>、<a href="http://tool.chinaz.com/tools/hash.aspx">站长工具</a>。</li><li>您可以在文章md文件的 front-matter 中指定 reprintPolicy 来给单个文章配置转载规则</li></ol></blockquote><p>以下为文章的 <code>Front-matter</code> 示例。</p><h3 id="最简示例"><a href="#最简示例" class="headerlink" title="最简示例"></a>最简示例</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> typora<span class="token punctuation">-</span>vue<span class="token punctuation">-</span>theme主题介绍<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-07 09:25:00</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="最全示例"><a href="#最全示例" class="headerlink" title="最全示例"></a>最全示例</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> typora<span class="token punctuation">-</span>vue<span class="token punctuation">-</span>theme主题介绍<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-07 09:25:00</span><span class="token key atrule">author</span><span class="token punctuation">:</span> 赵奇<span class="token key atrule">img</span><span class="token punctuation">:</span> /source/images/xxx.jpg<span class="token key atrule">top</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">cover</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">coverImg</span><span class="token punctuation">:</span> /images/1.jpg<span class="token key atrule">password</span><span class="token punctuation">:</span> 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92<span class="token key atrule">toc</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">mathjax</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">summary</span><span class="token punctuation">:</span> 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要<span class="token key atrule">categories</span><span class="token punctuation">:</span> Markdown<span class="token key atrule">tags</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> Typora  <span class="token punctuation">-</span> Markdown<span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="效果截图"><a href="#效果截图" class="headerlink" title="效果截图"></a>效果截图</h2><p><img src="http://static.blinkfox.com/matery-20181202-1.png" alt="首页"></p><p><img src="http://static.blinkfox.com/matery-20181202-2.png" alt="首页推荐文章"></p><p><img src="http://static.blinkfox.com/matery-20181202-3.png" alt="首页文章列表"></p><p><img src="http://static.blinkfox.com/matery-20181202-7.png" alt="首页文章列表"></p><p><img src="http://static.blinkfox.com/matery-20181202-8.png" alt="首页文章列表"></p><h2 id="自定制修改"><a href="#自定制修改" class="headerlink" title="自定制修改"></a>自定制修改</h2><p>在本主题的 <code>_config.yml</code> 中可以修改部分自定义信息，有以下几个部分：</p><ul><li>菜单</li><li>我的梦想</li><li>首页的音乐播放器和视频播放器配置</li><li>是否显示推荐文章名称和按钮配置</li><li><code>favicon</code> 和 <code>Logo</code></li><li>个人信息</li><li>TOC 目录</li><li>文章打赏信息</li><li>复制文章内容时追加版权信息</li><li>MathJax</li><li>文章字数统计、阅读时长</li><li>点击页面的’爱心’效果</li><li>我的项目</li><li>我的技能</li><li>我的相册</li><li><code>Gitalk</code>、<code>Gitment</code>、<code>Valine</code> 和 <code>disqus</code> 评论配置</li><li><a href="http://busuanzi.ibruce.info/">不蒜子统计</a>和谷歌分析（<code>Google Analytics</code>）</li><li>默认特色图的集合。当文章没有设置特色图时，本主题会根据文章标题的 <code>hashcode</code> 值取余，来选择展示对应的特色图</li></ul><p><strong>我认为个人博客应该都有自己的风格和特色</strong>。如果本主题中的诸多功能和主题色彩你不满意，可以在主题中自定义修改，很多更自由的功能和细节点的修改难以在主题的 <code>_config.yml</code> 中完成，需要修改源代码才来完成。以下列出了可能对你有用的地方：</p><h3 id="修改主题颜色"><a href="#修改主题颜色" class="headerlink" title="修改主题颜色"></a>修改主题颜色</h3><p>在主题文件的 <code>/source/css/matery.css</code> 文件中，搜索 <code>.bg-color</code> 来修改背景颜色：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* 整体背景颜色，包括导航、移动端的导航、页尾、标签页等的背景颜色. */</span><span class="token selector">.bg-color</span> <span class="token punctuation">{</span>    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> #4cbf30 0%<span class="token punctuation">,</span> #0f9d58 100%<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token atrule"><span class="token rule">@-webkit-keyframes</span> rainbow</span> <span class="token punctuation">{</span>   <span class="token comment">/* 动态切换背景颜色. */</span><span class="token punctuation">}</span><span class="token atrule"><span class="token rule">@keyframes</span> rainbow</span> <span class="token punctuation">{</span>    <span class="token comment">/* 动态切换背景颜色. */</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="修改-banner-图和文章特色图"><a href="#修改-banner-图和文章特色图" class="headerlink" title="修改 banner 图和文章特色图"></a>修改 banner 图和文章特色图</h3><p>你可以直接在 <code>/source/medias/banner</code> 文件夹中更换你喜欢的 <code>banner</code> 图片，主题代码中是每天动态切换一张，只需 <code>7</code> 张即可。如果你会 <code>JavaScript</code> 代码，可以修改成你自己喜欢切换逻辑，如：随机切换等，<code>banner</code> 切换的代码位置在 <code>/layout/_partial/bg-cover-content.ejs</code> 文件的 <code>&lt;script&gt;&lt;/script&gt;</code> 代码中：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.bg-cover'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'background-image'</span><span class="token punctuation">,</span> <span class="token string">'url(/medias/banner/'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.jpg)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 <code>/source/medias/featureimages</code> 文件夹中默认有 24 张特色图片，你可以再增加或者减少，并需要在 <code>_config.yml</code> 做同步修改。</p>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo-theme-matery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>函数式编程-review</title>
      <link href="2022/081427799.html"/>
      <url>2022/081427799.html</url>
      
        <content type="html"><![CDATA[<h1 id="一、函数式编程"><a href="#一、函数式编程" class="headerlink" title="一、函数式编程"></a>一、函数式编程</h1><ul><li><p>函数式编程是一种编程范式，和面向对象编程是并列关系（编程范式：思想 + 实现的方式）</p><ul><li>面向对象编程：对现实世界中的事物的抽象，抽象出对象以及对象和对象之间的关系</li><li>函数式编程：把现实世界的事物和事物之间的<strong>联系</strong>抽象到程序世界（对运算过程进行抽象）</li></ul><p>重点掌握：</p><ul><li><p>纯函数</p><p><a href="https://zh.wikipedia.org/wiki/%E7%BA%AF%E5%87%BD%E6%95%B0">https://zh.wikipedia.org/wiki/%E7%BA%AF%E5%87%BD%E6%95%B0</a></p><p>在程序设计中，若一个函数符合以下要求，则它可能被认为是<strong>纯函数</strong>：</p><ul><li>此函数在<strong>相同的输入</strong>值时，需<strong>产生相同的输出</strong>。函数的输出和输入值以外的其他隐藏信息或<a href="https://zh.wikipedia.org/w/index.php?title=%E7%A8%8B%E5%BC%8F%E7%8B%80%E6%85%8B&amp;action=edit&amp;redlink=1">状态</a>无关，也和由I/O设备产生的外部输出无关。</li></ul></li></ul><ul><li>该函数<strong>不能有</strong>语义上可观察的函数<strong>副作用</strong>，诸如“触发事件”，使输出设备输出，或更改输出值以外物件的内容等。(如果参数是引用传递，对参数的更改会影响函数以外的数据，因此不是纯函数)</li></ul><ul><li><p>柯里化</p></li><li><p>函数组合  lodash/fp   compose(fn, n1)  —&gt; flowRight</p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">}</span><span class="token keyword">const</span> f <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> add<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>函子暂时可以作为了解  <code>Array.of()</code>    <code>arr.map()</code></li></ul></li><li><p>柯里化概念意义和用法</p><ul><li><p>柯里化：把多个参数的函数转换可以具有任意个参数的函数，可以给函数组合提供细粒度的函数</p></li><li><p>应用：</p><ul><li><p>Vue.js 源码中使用柯里化的位置</p><ul><li>src/platform/web/patch.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// patch(obj, vdom1, vdom2)</span><span class="token keyword">function</span> <span class="token function">createPatch</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> <span class="token operator">...</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">vdom1<span class="token punctuation">,</span> vdom2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">createPatch</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token function">patch</span><span class="token punctuation">(</span>vdom1<span class="token punctuation">,</span> vdom2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul></li><li><p>固定不常变化的参数</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 方法1</span><span class="token keyword">function</span> <span class="token function">isType</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[object </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> isObject <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'Object'</span><span class="token punctuation">)</span><span class="token keyword">const</span> isArray <span class="token operator">=</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token string">'Array'</span><span class="token punctuation">)</span><span class="token comment">// 方法2</span><span class="token keyword">function</span> <span class="token function">isType</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[object </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token keyword">let</span> isTypeCurried <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>isType<span class="token punctuation">)</span><span class="token keyword">const</span> isObject <span class="token operator">=</span> <span class="token function">isTypeCurried</span><span class="token punctuation">(</span><span class="token string">'Object'</span><span class="token punctuation">)</span><span class="token comment">// isObject(obj)</span><span class="token comment">// 柯里化通用函数</span><span class="token keyword">function</span> <span class="token function">curry</span> <span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">curriedFn</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 判断实参和形参的个数</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> func<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">curriedFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// 实参和形参个数相同，调用 func，返回结果</span>    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">getSum</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">}</span><span class="token keyword">let</span> curried <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>getSum<span class="token punctuation">)</span><span class="token function">curried</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token function">curried</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token function">curried</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>延迟执行(模拟 bind 方法)</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">fn</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">// rest 参数</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">mybind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>rest</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">t</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">}</span>t<span class="token punctuation">.</span><span class="token function">mybind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> sumFn <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">mybind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token function">sumFn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><ul><li>函子在开发中的实际使用场景<ul><li>作用是控制副作用 (IO)、异常处理 (Either)、异步任务 (Task)</li></ul></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Functor</span> <span class="token punctuation">{</span>  <span class="token keyword">static</span> <span class="token keyword">of</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Functor</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token punctuation">}</span>    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> value  <span class="token punctuation">}</span>  <span class="token function">map</span> <span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Functor</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">value</span> <span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">toRMB</span> <span class="token operator">=</span> <span class="token parameter">money</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Functor</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>parseFloat<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token string">'¥'</span> <span class="token operator">+</span> v<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toRMB</span><span class="token punctuation">(</span><span class="token string">'$299.9'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>folktale<ul><li><a href="https://folktale.origamitower.com/">https://folktale.origamitower.com/</a></li></ul></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> MayBe <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'folktale/maybe'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">toRMB</span> <span class="token operator">=</span> <span class="token parameter">m</span> <span class="token operator">=&gt;</span> MayBe<span class="token punctuation">.</span><span class="token function">fromNullable</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>parseFloat<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token string">'¥'</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token comment">// .unsafeGet()</span>  <span class="token punctuation">.</span><span class="token function">getOrElse</span><span class="token punctuation">(</span><span class="token string">'noting'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toRMB</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>组合函数参数交换</p><p>const split = <em>.curry((sep, str) =&gt;</em> .split(str, sep))</p><p>const join = <em>.curry((sep, array) =&gt;</em> .join(array, sep)) </p><p>const map = <em>.curry((fn, array) =&gt;</em> .map(array, fn))</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token comment">// 非柯里化 数据优先 迭代置后</span><span class="token comment">// _.split(str, sep)</span><span class="token comment">// _.join(array, sep)</span><span class="token comment">// _.map(array, fn)</span><span class="token comment">// const f = _.flowRight(_.join(...), _.map(...), _.split)</span><span class="token comment">// console.log(f('NEVER SAY DIE', ' '))</span><span class="token keyword">const</span> split <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sep<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> sep<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> join <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sep<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> sep<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> map <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> f <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toLower<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token string">'NEVER SAY DIE'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span><span class="token comment">// 自动柯里化 数据置后 迭代优先</span>fp<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>sep<span class="token punctuation">)</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>fp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>sep<span class="token punctuation">,</span> array<span class="token punctuation">)</span>fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> array<span class="token punctuation">)</span><span class="token keyword">const</span> f <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>toLower<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>柯里化实现原理</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">curry</span> <span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">curriedFn</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 判断实参和形参的个数</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> func<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">curriedFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// 实参和形参个数相同，调用 func，返回结果</span>    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">getSum</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">}</span><span class="token keyword">let</span> curried <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>getSum<span class="token punctuation">)</span><span class="token function">curried</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token function">curried</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token function">curried</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h1 id="二、函数的执行上下文和闭包"><a href="#二、函数的执行上下文和闭包" class="headerlink" title="二、函数的执行上下文和闭包"></a>二、函数的执行上下文和闭包</h1><h2 id="1-函数的执行上下文"><a href="#1-函数的执行上下文" class="headerlink" title="1.函数的执行上下文"></a>1.函数的执行上下文</h2><ul><li><p>执行上下文（Execution Context）</p><ul><li>全局执行上下文</li><li>函数级执行上下文</li><li>eval 执行上下文</li></ul></li><li><p>函数执行的阶段可以分文两个：函数建立阶段、函数执行阶段</p><ul><li><p>函数建立阶段：当调用函数时，还没有执行函数内部的代码</p><ul><li><p>创建执行上下文对象</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">fn<span class="token punctuation">.</span>ExecutionContext <span class="token operator">=</span> <span class="token punctuation">{</span>  variableObject<span class="token operator">:</span>  <span class="token comment">// 函数中的 arguments、参数、局部成员</span>  scopeChains<span class="token operator">:</span>  <span class="token comment">// 当前函数所在的父级作用域中的活动对象</span>  <span class="token keyword">this</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// 当前函数内部的 this 指向</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>function fn() {}</p><ul><li>this 指向复习<ul><li>fn() 直接调用，如果是非严格模式  this 指向 window，如果是严格模式this指向 undefined</li><li>obj.fn()  如果是函数调用，谁调用this指向谁</li><li>构造函数中的 this ，指向的是当前创建的对象</li><li>箭头函数中的this 指向父级作用域 中的this</li><li>改变this的情况。。bind  call  apply</li></ul></li></ul></li><li><p>函数执行阶段</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 把变量对象转换为活动对象</span>fn<span class="token punctuation">.</span>ExecutionContext <span class="token operator">=</span> <span class="token punctuation">{</span>  activationObject<span class="token operator">:</span>  <span class="token comment">// 函数中的 arguments、参数、局部成员</span>  scopeChains<span class="token operator">:</span>  <span class="token comment">// 当前函数所在的父级作用域中的活动对象</span>  <span class="token keyword">this</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// 当前函数内部的 this 指向</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>[[Scopes]] 作用域链，函数在创建时就会生成该属性，js 引擎才可以访问。这个属性中存储的是所有父级中的活动对象</p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">fn</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">function</span> <span class="token function">inner</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>inner<span class="token punctuation">)</span>  <span class="token comment">// return inner</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-闭包"><a href="#2-闭包" class="headerlink" title="2.闭包"></a>2.<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures">闭包</a></h2><ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures</a></p></li><li><p>发生闭包的两个必要条件</p><ol><li>外部对一个函数 makeFn 内部有引用</li><li>在另一个作用域能够访问到 makeFn 作用域内部的局部成员</li></ol><blockquote><p>使用闭包可以突破变量作用域的限制，原来只能从一个作用域访问外部作用域的成员</p><p>有了闭包之后，可以在外部作用域访问一个内部作用域的成员</p><p>可以缓存参数</p><p>根据不同参数生成不同功能的函数</p></blockquote></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">makeFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'MDN'</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">inner</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token function">makeFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>fn <span class="token operator">=</span> <span class="token keyword">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>缓存参数</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createPatch</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">vdom1<span class="token punctuation">,</span> vdom2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">createPatch</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>                                        <span class="token keyword">function</span> <span class="token function">makeAdder</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> add5 <span class="token operator">=</span> <span class="token function">makeAdder</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> add10 <span class="token operator">=</span> <span class="token function">makeAdder</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add5</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 7</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add10</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Web Review </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nuxt.js 综合案例</title>
      <link href="2021/072632945.html"/>
      <url>2021/072632945.html</url>
      
        <content type="html"><![CDATA[<h2 id="Nuxt-js-综合案例"><a href="#Nuxt-js-综合案例" class="headerlink" title="Nuxt.js 综合案例"></a>Nuxt.js 综合案例</h2><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul><li>GitHub仓库：<a href="https://github.com/gothinkster/realworld">https://github.com/gothinkster/realworld</a></li><li>在线示例：<a href="https://demo.realworld.io/#/">https://demo.realworld.io/#/</a></li><li>接口文档：<a href="https://github.com/gothinkster/realworld/tree/master/api">https://github.com/gothinkster/realworld/tree/master/api</a></li><li>页面模板：<a href="https://github.com/gothinkster/realworld-starter-kit/blob/master/FRONTEND_INSTRUCTIONS.md">https://github.com/gothinkster/realworld-starter-kit/blob/master/FRONTEND_INSTRUCTIONS.md</a></li></ul><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建项目目录</span><span class="token function">mkdir</span> realworld-nuxtjs<span class="token comment"># 进入项目目录</span><span class="token builtin class-name">cd</span> realworld-nuxtjs<span class="token comment"># 生成 package.json 文件</span><span class="token function">npm</span> init -y<span class="token comment"># 安装 nuxt 依赖</span><span class="token function">npm</span> <span class="token function">install</span> nuxt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 <code>package.json</code> 中添加启动脚本：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"nuxt"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>创建 <code>pages/index.vue</code> ：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Home Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'HomePage'</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="导入样式资源"><a href="#导入样式资源" class="headerlink" title="导入样式资源"></a>导入样式资源</h2><p>当前目录结构：</p><p><img src="http://5coder.cn/img/1627261549024.png" alt="1627261549024"></p><p><code>app.html</code>：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">{{</span> <span class="token attr-name">HTML_ATTRS</span> <span class="token attr-name">}}</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span> <span class="token attr-name">{{</span> <span class="token attr-name">HEAD_ATTRS</span> <span class="token attr-name">}}</span><span class="token punctuation">&gt;</span></span>  {{ HEAD }}  <span class="token comment">&lt;!-- Import Ionicon icons &amp; Google Fonts our Bootstrap theme relies on --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/ionicons@2.0.1/css/ionicons.min.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>    <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//fonts.googleapis.com/css?family=Titillium+Web:700|Source+Serif+Pro:400,700|Merriweather+Sans:400,700|Source+Sans+Pro:400,300,600,700,300italic,400italic,600italic,700italic<span class="token punctuation">"</span></span>    <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- Import the custom Bootstrap 4 theme from our hosted CDN --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/index.css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">{{</span> <span class="token attr-name">BODY_ATTRS</span> <span class="token attr-name">}}</span><span class="token punctuation">&gt;</span></span>{{ APP }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="配置布局组件"><a href="#配置布局组件" class="headerlink" title="配置布局组件"></a>配置布局组件</h2><p><code>pages/layout/index.vue</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--  header --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>navbar navbar-light<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>navbar-brand<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index.html<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>conduit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav navbar-nav pull-xs-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- Add "active" class when you're on that page" --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link active<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-compose<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&nbsp;">&amp;nbsp;</span>New Post            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-gear-a<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&nbsp;">&amp;nbsp;</span>Settings            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sign up<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--  header --&gt;</span>    <span class="token comment">&lt;!--    子路由  --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-child</span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!--    footer  --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo-font<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>conduit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>attribution<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          An interactive learning project from <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://thinkster.io<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Thinkster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>. Code <span class="token entity named-entity" title="&amp;">&amp;amp;</span> design licensed under MIT.        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--    footer  --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"LayoutIndex"</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>添加<code>nuxt.config.js</code>配置文件，配置自定义路由表</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** Nuxt.js配置文件* */</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  router<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">// 自定义路由表规则</span>    <span class="token function">extendRoutes</span><span class="token punctuation">(</span><span class="token parameter">routes<span class="token punctuation">,</span> resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 首先清空数组，清空nuxt默认生成的路由表</span>      routes<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>      routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span>        <span class="token punctuation">{</span>          path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>          component<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'pages/layout'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          children<span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>              path<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 默认子路由</span>              name<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>              component<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'pages/home'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>          <span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>添加<code>pages/home/index.vue</code>，并配置默认子路由</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>home-page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>banner<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo-font<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>conduit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>A place to share your knowledge.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-md-9<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>feed-toggle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav nav-pills outline-active<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link disabled<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Your Feed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link active<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Global Feed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-preview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-meta<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>profile.html<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://i.imgur.com/Qr71crq.jpg<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Eric Simons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>January 20th<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-outline-primary btn-sm pull-xs-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-heart<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> 29              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preview-link<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>How to build webapps that scale<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This is the description for the post.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>Read more...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-preview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-meta<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>profile.html<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://i.imgur.com/N4VcUeJ.jpg<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Albert Pai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>January 20th<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-outline-primary btn-sm pull-xs-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-heart<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> 32              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preview-link<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>The song you won't ever stop singing. No matter how hard you try.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This is the description for the post.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>Read more...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-md-3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sidebar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Popular Tags<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>programming<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>javascript<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>emberjs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>angularjs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>react<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>mean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>node<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>rails<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"HomeIndex"</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当前效果：</p><p><img src="http://5coder.cn/img/1627262711486.png"></p><p>访问localhost:3000时，首先加载pages/index.vue组件，在nuxt-child中加载子路由，子路由path为空字符串‘’，因此访问localhost:3000时会同时加载<code>pages/index.vue</code>、<code>pages/layout/index.vue</code>、<code>pages/home/index.vue</code>三个组件</p><h2 id="登录注册"><a href="#登录注册" class="headerlink" title="登录注册"></a>登录注册</h2><p>在模板网址中找到登录模板，由于当前项目登录/注册业务不复杂，所以使用同一个组件模板，利用<code>this.$route.name</code>将其处理为动态组件。其中需要处理文字显示、按钮显示、路有指向，代码如下：</p><p><code>pages/login/index.vue</code></p><ul><li>整体：</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auth-page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-md-6 offset-md-3 col-xs-12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ isLogin ? 'Sign in' : 'Sign up' }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isLogin<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/register<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Need an account?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">v-else</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Have an account?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error-messages<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>That email is already taken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>!isLogin<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Your Name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-lg btn-primary pull-xs-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              {{ isLogin ? 'Sign in' : 'Sign up' }}            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"LoginIndex"</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'login'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>动态部分：</p><p>动态控制</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">computed<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'login'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>文字显示</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ isLogin ? 'Sign in' : 'Sign up' }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isLogin<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/register<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Need an account?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">v-else</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Have an account?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>输入框</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>!isLogin<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Your Name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>按钮</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-lg btn-primary pull-xs-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  {{ isLogin ? 'Sign in' : 'Sign up' }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h2 id="导入剩余页面"><a href="#导入剩余页面" class="headerlink" title="导入剩余页面"></a>导入剩余页面</h2><table><thead><tr><th>路径</th><th>页面</th></tr></thead><tbody><tr><td><code>/</code></td><td>首页</td></tr><tr><td><code>/login</code></td><td>登录</td></tr><tr><td><code>/register</code></td><td>注册</td></tr><tr><td><code>/settings</code></td><td>用户设置</td></tr><tr><td><code>/editor</code></td><td>发布文章</td></tr><tr><td><code>/editor/:slug</code></td><td>编辑文章</td></tr><tr><td><code>/profile/:username</code></td><td>文章详情</td></tr><tr><td><code>/profile/:username/favorites</code></td><td>用户页面/喜欢的文章</td></tr></tbody></table><h3 id="用户页面"><a href="#用户页面" class="headerlink" title="用户页面"></a>用户页面</h3><p>pages/profile/index.vue</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>profile-page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user-info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-xs-12 col-md-10 offset-md-1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://i.imgur.com/Qr71crq.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user-img<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>Eric Simons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>              Cofounder @GoThinkster, lived in Aol's HQ for a few months, kinda looks like Peeta from the Hunger Games            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-sm btn-outline-secondary action-btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-plus-round<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>              <span class="token entity named-entity" title="&nbsp;">&amp;nbsp;</span>              Follow Eric Simons            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-xs-12 col-md-10 offset-md-1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>articles-toggle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav nav-pills outline-active<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link active<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>My Articles<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Favorited Articles<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-preview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-meta<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://i.imgur.com/Qr71crq.jpg<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Eric Simons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>January 20th<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-outline-primary btn-sm pull-xs-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-heart<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> 29              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preview-link<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>How to build webapps that scale<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This is the description for the post.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>Read more...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-preview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-meta<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://i.imgur.com/N4VcUeJ.jpg<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Albert Pai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>January 20th<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-outline-primary btn-sm pull-xs-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-heart<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> 32              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preview-link<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>The song you won't ever stop singing. No matter how hard you try.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This is the description for the post.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>Read more...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-default tag-pill tag-outline<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Music<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-default tag-pill tag-outline<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Song<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"UserProfile"</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="用户设置"><a href="#用户设置" class="headerlink" title="用户设置"></a>用户设置</h3><p><code>pages/settings</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>settings-page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-md-6 offset-md-3 col-xs-12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Your Settings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>URL of profile picture<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Your Name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Short bio about you<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-lg btn-primary pull-xs-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                Update Settings              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"SettingsIndex"</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="创建文章"><a href="#创建文章" class="headerlink" title="创建文章"></a>创建文章</h3><p><code>editor/inde.vue</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>editor-page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-md-10 offset-md-1 col-xs-12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Article Title<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>What<span class="token punctuation">'</span>s this article about?<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Write your article (in markdown)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Enter tags<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-lg pull-xs-right btn-primary<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                Publish Article              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"EditorIndex"</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="文章详情"><a href="#文章详情" class="headerlink" title="文章详情"></a>文章详情</h3><p><code>pages/editor</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>editor-page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-md-10 offset-md-1 col-xs-12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Article Title<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>What<span class="token punctuation">'</span>s this article about?<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Write your article (in markdown)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Enter tags<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-lg pull-xs-right btn-primary<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                Publish Article              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"EditorIndex"</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="处理顶部导航链接"><a href="#处理顶部导航链接" class="headerlink" title="处理顶部导航链接"></a>处理顶部导航链接</h2><p>将模板中的<code>a</code>链接全部替换为<code>nuxt-link</code></p><p><code>pages/layout/index.vue</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--  header --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>navbar navbar-light<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>navbar-brand<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav navbar-nav pull-xs-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- Add "active" class when you're on that page" --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">exact</span><span class="token punctuation">&gt;</span></span>              Home            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/editor<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-compose<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&nbsp;">&amp;nbsp;</span>New Post            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/settings<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-gear-a<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&nbsp;">&amp;nbsp;</span>Settings            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/register<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sign up<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sign in<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/profile/123<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user-pic<span class="token punctuation">"</span></span>                   <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://pic1.zhimg.com/80/v2-3358e380b520aaa16d4c16bbacb7dab9_720w.jpg?source=1940ef5c<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              5coder            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--  header --&gt;</span>    <span class="token comment">&lt;!--    子路由  --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-child</span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!--    footer  --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo-font<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>conduit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>attribution<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          An interactive learning project from <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://thinkster.io<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Thinkster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>. Code <span class="token entity named-entity" title="&amp;">&amp;amp;</span> design licensed under MIT.        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--    footer  --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"LayoutIndex"</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1627269694843.png"></p><h2 id="处理导航链接高亮"><a href="#处理导航链接高亮" class="headerlink" title="处理导航链接高亮"></a>处理导航链接高亮</h2><ul><li><p>修改nuxt.js提供的路有导航高亮，默认值为<code>nuxt-link-active</code>，修改为模板中定义的<code>active</code>（<a href="https://zh.nuxtjs.org/docs/2.x/configuration-glossary/configuration-router#linkactiveclass">官方文档</a>）</p><p><code>vue.config.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  router<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">// 自定义路由表规则</span>    <span class="token function">extendRoutes</span><span class="token punctuation">(</span><span class="token parameter">routes<span class="token punctuation">,</span> resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 首先清空数组，清空nuxt默认生成的路由表</span>      routes<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>      routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span>        <span class="token punctuation">{</span>          path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>          component<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'pages/layout'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          children<span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>              path<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 默认子路由</span>              name<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>              component<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'pages/home/'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span>              path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>              name<span class="token operator">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>              component<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'pages/login/'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span>              path<span class="token operator">:</span> <span class="token string">'/register'</span><span class="token punctuation">,</span>              name<span class="token operator">:</span> <span class="token string">'register'</span><span class="token punctuation">,</span>              component<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'pages/login/'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span>              path<span class="token operator">:</span> <span class="token string">'/profile/:username'</span><span class="token punctuation">,</span>              name<span class="token operator">:</span> <span class="token string">'profile'</span><span class="token punctuation">,</span>              component<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'pages/profile/'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span>              path<span class="token operator">:</span> <span class="token string">'/settings/'</span><span class="token punctuation">,</span>              name<span class="token operator">:</span> <span class="token string">'settings'</span><span class="token punctuation">,</span>              component<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'pages/settings/'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span>              path<span class="token operator">:</span> <span class="token string">'/editor/'</span><span class="token punctuation">,</span>              name<span class="token operator">:</span> <span class="token string">'editor'</span><span class="token punctuation">,</span>              component<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'pages/editor/'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span>              path<span class="token operator">:</span> <span class="token string">'/article/:slug'</span><span class="token punctuation">,</span>              name<span class="token operator">:</span> <span class="token string">'article'</span><span class="token punctuation">,</span>              component<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'pages/article/'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span>        <span class="token punctuation">}</span>      <span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    linkActiveClass<span class="token operator">:</span> <span class="token string">'active'</span>  <span class="token comment">// default nav-link-active</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>修改精确匹配，当<code>Home</code>中的路由为/时，默认会适用<code>active</code>，需要将其修改为精确匹配，这样在子组件激活时，<code>Home</code>不会高亮激活。（<a href="https://zh.nuxtjs.org/docs/2.x/configuration-glossary/configuration-router#linkexactactiveclass">官方文档</a>）</p><p><code>pages/layout/index.vue</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- Add "active" class when you're on that page" --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">exact</span><span class="token punctuation">&gt;</span></span>    Home  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当前目录结构：</p><p><img src="http://5coder.cn/img/1627270097786.png"></p></li></ul><h2 id="封装请求模块"><a href="#封装请求模块" class="headerlink" title="封装请求模块"></a>封装请求模块</h2><ul><li><p>使用<code>axios</code>封装请求模块</p></li><li><p>安装axios：<code>yarn add axios</code></p></li><li><p>创建目录及文件<code>utils/request.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  baseURL<span class="token operator">:</span> <span class="token string">'https://conduit.productionready.io'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> request<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="登录注册-1"><a href="#登录注册-1" class="headerlink" title="登录注册"></a>登录注册</h2><h3 id="实现基本登录功能"><a href="#实现基本登录功能" class="headerlink" title="实现基本登录功能"></a>实现基本登录功能</h3><ul><li><p>登录接口</p><p><img src="http://5coder.cn/img/1627279394859.png"></p></li></ul><p><code>pages/login/index.vue</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auth-page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container page<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-md-6 offset-md-3 col-xs-12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ isLogin ? 'Sign in' : 'Sign up' }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isLogin<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/register<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Need an account?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">v-else</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Have an account?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error-messages<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>That email is already taken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">&lt;!--添加submit提交事件，并使用prevent取消默认提交事件--&gt;</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">@submit.prevent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onSubmit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>!isLogin<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Your Name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--使用v-model绑定数据--&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user.email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span>                     <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user.password<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-lg btn-primary pull-xs-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              {{ isLogin ? 'Sign in' : 'Sign up' }}            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"LoginIndex"</span><span class="token punctuation">,</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      user<span class="token operator">:</span> <span class="token punctuation">{</span>        email<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        password<span class="token operator">:</span> <span class="token string">''</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'login'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token keyword">async</span> <span class="token function">onSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 提交表单请求登录</span>      <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>        url<span class="token operator">:</span> <span class="token string">'/api/users/login'</span><span class="token punctuation">,</span>        data<span class="token operator">:</span> <span class="token punctuation">{</span>          user<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>      <span class="token comment">// TODO 保存用户登录状态</span>      <span class="token comment">// 跳转到首页</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="封装请求方法"><a href="#封装请求方法" class="headerlink" title="封装请求方法"></a>封装请求方法</h3><p>为了维护方便，将请求单独再封装</p><p>创建目录及文件<code>api/user.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">"@/utils/request"</span><span class="token punctuation">;</span><span class="token comment">// 用户登录</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>    url<span class="token operator">:</span> <span class="token string">'/api/users/login'</span><span class="token punctuation">,</span>    data  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 用户注册</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>    url<span class="token operator">:</span> <span class="token string">'/api/users'</span><span class="token punctuation">,</span>    data  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>修改<code>login.vue</code>中使用的登录请求</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"LoginIndex"</span><span class="token punctuation">,</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      user<span class="token operator">:</span> <span class="token punctuation">{</span>        email<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        password<span class="token operator">:</span> <span class="token string">''</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'login'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token keyword">async</span> <span class="token function">onSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 提交表单请求登录,使用刚才封装好的user.js</span>      <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        user<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user      <span class="token punctuation">}</span><span class="token punctuation">)</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>      <span class="token comment">// TODO 保存用户登录状态</span>      <span class="token comment">// 跳转到首页</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a>表单验证</h3><p>使用HTML原始的验证，分别在<code>input</code>中添加<code>required</code>和修改<code>type="emial"</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--使用v-model绑定数据--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user.email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span>         <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user.password<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><ul><li><p>此处处理用户登录错误时的显示内容</p></li><li><p>未处理时，登录请求错误会出现如下页面：</p><p><img src="http://5coder.cn/img/1627282436215.png"></p></li><li><p>错误信息如下：</p><ul><li><img src="http://5coder.cn/img/1627282574328.png"></li></ul></li><li><p>使用<code>try {} catch {err}</code>捕获异常</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">try</span> <span class="token punctuation">{</span>  <span class="token comment">// 提交表单请求登录</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    user<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user  <span class="token punctuation">}</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment">// TODO 保存用户登录状态</span>  <span class="token comment">// 跳转到首页</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 请求失败</span>  console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>errors <span class="token operator">=</span> err<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errors<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>在data中定义errors数据：<code>errors:{}</code>初始化为空对象</p></li><li><p>在html模板中遍历出该错误信息</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error-messages<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(messages, field) of errors<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(message,index) in messages<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ field }} {{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>处理完错误后页面如下：</p><p><img src="http://5coder.cn/img/1627282636518.png"></p></li></ul><h3 id="用户注册"><a href="#用户注册" class="headerlink" title="用户注册"></a>用户注册</h3><p>由于注册需要提供用户名，所以在data中的user中添加username，并使用v-model绑定到input框中。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    user<span class="token operator">:</span> <span class="token punctuation">{</span>      username<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>      email<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>      password<span class="token operator">:</span> <span class="token string">''</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    errors<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// 错误信息</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注册和登录的逻辑相似，因此只需要在调用login和register时做判断即可,同时发现注册时，用户提供的密码在后端做了验证，必须大于等于8为，因此在前端也进行验证。在password字段中添加<code>minlength='8'</code>：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control form-control-lg<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">minlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user.password<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">async</span> <span class="token function">onSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">try</span> <span class="token punctuation">{</span>    <span class="token comment">// 提交表单请求登录</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isLogin <span class="token operator">?</span> <span class="token keyword">await</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      user<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">await</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      user<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user    <span class="token punctuation">}</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token comment">// TODO 保存用户登录状态</span>    <span class="token comment">// 跳转到首页</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 请求失败</span>    console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>errors <span class="token operator">=</span> err<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errors  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="存储用户登录状态"><a href="#存储用户登录状态" class="headerlink" title="存储用户登录状态"></a>存储用户登录状态</h3><h4 id="1-初始化容器数据"><a href="#1-初始化容器数据" class="headerlink" title="(1)初始化容器数据"></a>(1)初始化容器数据</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 在服务端渲染期间，运行的都是同一个实例，为了防止数据冲突，务必将state定义为一个函数，返回数据对象</span><span class="token comment">// 确保每次创建实例时，state都要通过一个函数动态的创建一个对象，这样数据就不会冲突和污染</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">state</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    <span class="token comment">// 当前登录用户的登录状态数据</span>    user<span class="token operator">:</span> <span class="token keyword">null</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token function">setUser</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    state<span class="token punctuation">.</span>user <span class="token operator">=</span> data  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-登陆成功，将用户信息存入容器"><a href="#2-登陆成功，将用户信息存入容器" class="headerlink" title="(2)登陆成功，将用户信息存入容器"></a>(2)登陆成功，将用户信息存入容器</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setUser'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-将登陆状态持久化道Cookie中"><a href="#3-将登陆状态持久化道Cookie中" class="headerlink" title="(3)将登陆状态持久化道Cookie中"></a>(3)将登陆状态持久化道Cookie中</h4><p>安装<code>js-cookie</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> js-cookie<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用<code>js-cookie</code>将<code>data.user</code>数据存储到<code>cookie</code>中（31行）：<code>Cookie.set('user', data.user)</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"LoginIndex"</span><span class="token punctuation">,</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      user<span class="token operator">:</span> <span class="token punctuation">{</span>        username<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        email<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        password<span class="token operator">:</span> <span class="token string">''</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      errors<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// 错误信息</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'login'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token keyword">async</span> <span class="token function">onSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token comment">// 提交表单请求登录</span>        <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isLogin <span class="token operator">?</span> <span class="token keyword">await</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          user<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">await</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          user<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token comment">// 保存用户登录状态到容器</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setUser'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>user<span class="token punctuation">)</span>        <span class="token comment">// 为了防止刷新页面数据丢失，需要将数据持久化,存到cookie中</span>        Cookie<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>user<span class="token punctuation">)</span>        <span class="token comment">// 跳转到首页</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 请求失败</span>        console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>errors <span class="token operator">=</span> err<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errors      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-从Cookie中获取并初始化用户登录状态"><a href="#4-从Cookie中获取并初始化用户登录状态" class="headerlink" title="(4)从Cookie中获取并初始化用户登录状态"></a>(4)从Cookie中获取并初始化用户登录状态</h4><p>安装<code>cookieparser</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> cookieparser<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用<code>nuxtServerInit</code>在服务端渲染期间，从<code>cookie</code>中获取<code>user</code>数据，保存到<code>state</code>中的<code>user</code>对象中</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> cookieparser <span class="token keyword">from</span> <span class="token string">'cookieparser'</span><span class="token comment">// 在服务端渲染期间，运行的都是同一个实例，为了防止数据冲突，务必将state定义为一个函数，返回数据对象</span><span class="token comment">// 确保每次创建实例时，state都要通过一个函数动态的创建一个对象，这样数据就不会冲突和污染</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">state</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    <span class="token comment">// 当前登录用户的登录状态数据</span>    user<span class="token operator">:</span> <span class="token keyword">null</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token function">setUser</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    state<span class="token punctuation">.</span>user <span class="token operator">=</span> data  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// nuxtServerInit是一个特殊的action方法，尽在服务端渲染期间调用</span>  <span class="token comment">// 初始化容器数据，从cookie中取出来放到state中</span>  <span class="token function">nuxtServerInit</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>commit<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>req<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">null</span>    <span class="token comment">// 如果请求头中有Cookie</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 使用cookieparser结构成对象</span>      <span class="token keyword">const</span> parsed <span class="token operator">=</span> cookieparser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span>      <span class="token keyword">try</span><span class="token punctuation">{</span>        user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>parsed<span class="token punctuation">.</span>user<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// No Valid cookie found</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// 提交mutation修改state状态</span>    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setUser'</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>整体逻辑为：使用<code>mapState</code>将<code>store</code>中的<code>state.user</code>映射到<code>layout.vue</code>中，在模板中判断是否存在<code>user</code>，当存在时，展示<strong>Home、New Post、Settings、用户头像信息</strong>，当不存在时，只展示<strong>Home、Sign In、Sign Up</strong></li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/editor<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-compose<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&nbsp;">&amp;nbsp;</span>New Post    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/settings<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-gear-a<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&nbsp;">&amp;nbsp;</span>Settings    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/profile/123<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user-pic<span class="token punctuation">"</span></span>           <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user.image<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      {{ user.username }}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sign in<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/register<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sign up<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>mapState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"LayoutIndex"</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="处理页面访问权限"><a href="#处理页面访问权限" class="headerlink" title="处理页面访问权限"></a>处理页面访问权限</h3><p>当前处理逻辑只是将登陆与否过程中是否渲染了Editor等路由，然而当用户直接在url访问localhost:3000/editor等路由时，依然可以访问页面，这时就需要使用<strong>拦截器</strong>来拦截这部分请求。</p><h4 id="路由中间件"><a href="#路由中间件" class="headerlink" title="路由中间件"></a>路由中间件</h4><blockquote><p>中间件允许你定义一个自定义函数运行在一个页面或一组页面渲染之前。</p><p>您可以通过在 middleware/ 目录中创建一个文件来创建命名中间件，文件名将是中间件名称。</p></blockquote><p><img src="http://5coder.cn/img/image-20210726221657192.png"></p><p><code>middleware/authenticated.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>store<span class="token punctuation">,</span> redirect<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 如果用户没有登录</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在需要判断登录权限的页面中配置使用中间件。</li></ul><p><code>editor.vue</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token comment">// 在路由匹配组件之前会先执行中间件处理</span>  middleware<span class="token operator">:</span> <span class="token string">'authenticated'</span><span class="token punctuation">,</span>  name<span class="token operator">:</span> <span class="token string">"EditorIndex"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同理，在settings、profile等页面也设置同样的中间件。</p><ul><li>在登录后，不允许用户重复登录注册，同样设置中间件<code>not-authenticated.js</code>，禁止用户在登录后再次访问登录、注册页面。</li></ul><p><code>middleware/not-authenticated.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>store<span class="token punctuation">,</span> redirect<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 如果用户没有登录</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在登陆注册页面加入<code>not-authenticated</code>中间件。</li></ul><h2 id="首页模块"><a href="#首页模块" class="headerlink" title="首页模块"></a>首页模块</h2><h3 id="展示公共文章列表"><a href="#展示公共文章列表" class="headerlink" title="展示公共文章列表"></a>展示公共文章列表</h3><p>封装请求方法：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">"@/utils/request"</span><span class="token punctuation">;</span><span class="token comment">// 获取公共的文章列表</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getArticles</span> <span class="token operator">=</span> <span class="token parameter">params</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>    url<span class="token operator">:</span> <span class="token string">'/api/articles'</span><span class="token punctuation">,</span>    params  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>home/index.vue获取数据，由于需要进行SEO优化，这里使用asyncData方法获取数据：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>getArticles<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/article"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"HomeIndex"</span><span class="token punctuation">,</span>  <span class="token comment">// 有利于SEO</span>  <span class="token keyword">async</span> <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getArticles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      articles<span class="token operator">:</span> data<span class="token punctuation">.</span>articles<span class="token punctuation">,</span>      articlesCount<span class="token operator">:</span> data<span class="token punctuation">.</span>articlesCount    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>模板绑定：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-preview<span class="token punctuation">"</span></span>    <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article in articles<span class="token punctuation">"</span></span>    <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article.slug<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-meta<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{      name: <span class="token punctuation">'</span>profile<span class="token punctuation">'</span>,      params: {        username: article.author.username      }    }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article.author.image<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{      name: <span class="token punctuation">'</span>profile<span class="token punctuation">'</span>,      params: {        username: article.author.username      }    }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ article.author.username }}      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ article.createAt }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-outline-primary btn-sm pull-xs-right<span class="token punctuation">"</span></span>            <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{      active: article.favorited    }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-heart<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>      {{ article.favoritesCount }}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span>      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preview-link<span class="token punctuation">"</span></span>      <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{        name: <span class="token punctuation">'</span>article<span class="token punctuation">'</span>,        params: {          slug: article.slug        }      }<span class="token punctuation">"</span></span>  <span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{ article.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ article.description }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>Read more...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="分页处理"><a href="#分页处理" class="headerlink" title="分页处理"></a>分页处理</h3><h4 id="处理分页参数"><a href="#处理分页参数" class="headerlink" title="处理分页参数"></a>处理分页参数</h4><p>首先定义page和limit，然后计算要请求的文章数量以及从哪一条文章开始取</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"HomeIndex"</span><span class="token punctuation">,</span>  <span class="token comment">// 有利于SEO</span>  <span class="token keyword">async</span> <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">const</span> limit <span class="token operator">=</span> <span class="token number">20</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getArticles</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      limit<span class="token punctuation">,</span>      offset<span class="token operator">:</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> limit    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      articles<span class="token operator">:</span> data<span class="token punctuation">.</span>articles<span class="token punctuation">,</span>      articlesCount<span class="token operator">:</span> data<span class="token punctuation">.</span>articlesCount    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="页码处理"><a href="#页码处理" class="headerlink" title="页码处理"></a>页码处理</h4><p>分页模板：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pagination<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--使用计算属性计算出totalPage，遍历循环出页面，并且绑定动态样式active--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page-item<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in totalPage<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span>        <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{                active: item === page                }<span class="token punctuation">"</span></span>        <span class="token punctuation">&gt;</span></span>      <span class="token comment">&lt;!--绑定to属性，动态传递page参数--&gt;</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page-link<span class="token punctuation">"</span></span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{                                        name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span>,                                        query: {                                        page: item                                        }                                        }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ item }}      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>使用计算属性计算总页码</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">computed<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token function">totalPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>articlesCount <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>limit<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>遍历生成页码列表、设置导航链接</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pagination<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--使用计算属性计算出totalPage，遍历循环出页面，并且绑定动态样式active--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page-item<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in totalPage<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span>        <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{                active: item === page                }<span class="token punctuation">"</span></span>        <span class="token punctuation">&gt;</span></span>      <span class="token comment">&lt;!--绑定to属性，动态传递page参数--&gt;</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page-link<span class="token punctuation">"</span></span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{                                        name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span>,                                        query: {                                        page: item                                        }                                        }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ item }}      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>相应query参数变化</p></li></ul><p><img src="http://5coder.cn/img/image-20210726230706868.png"></p><p><img src="http://5coder.cn/img/image-20210726230718855.png"></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">watchQuery<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="获取标签列表（Popular-Tags）"><a href="#获取标签列表（Popular-Tags）" class="headerlink" title="获取标签列表（Popular Tags）"></a>获取标签列表（Popular Tags）</h3><ul><li>封装请求方法<code>api/tag.js</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">"@/utils/request"</span><span class="token punctuation">;</span><span class="token comment">// 获取文章标签列表</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getTags</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>    url<span class="token operator">:</span> <span class="token string">'/api/tags'</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在<code>home/index.vue</code>中获取数据</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"HomeIndex"</span><span class="token punctuation">,</span>  <span class="token comment">// 有利于SEO</span>  watchQuery<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token keyword">async</span> <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 从url中获取页码：localhost:3000?page=3</span>    <span class="token keyword">const</span> page <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>page <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> limit <span class="token operator">=</span> <span class="token number">20</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getArticles</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      limit<span class="token punctuation">,</span>      offset<span class="token operator">:</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> limit    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token operator">:</span> tagData<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 获取tags数据</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      articles<span class="token operator">:</span> data<span class="token punctuation">.</span>articles<span class="token punctuation">,</span>      articlesCount<span class="token operator">:</span> data<span class="token punctuation">.</span>articlesCount<span class="token punctuation">,</span>      limit<span class="token punctuation">,</span>      page<span class="token punctuation">,</span>      tags<span class="token operator">:</span> tagData<span class="token punctuation">.</span>tags  <span class="token comment">// 返回tags数据给页面模板</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">totalPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>articlesCount <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>limit<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>遍历获取到的tags，渲染到页面</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in tags<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ item }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="优化数据请求"><a href="#优化数据请求" class="headerlink" title="优化数据请求"></a>优化数据请求</h4><p>前面请求的文章列表数据和标签列表数据在业务上并<strong>没有互相依赖</strong>的关系，因此可以将其从<strong>串行执行请求数据</strong>优化为<strong>并行执行请求数据</strong>，通过并行可以提高请求加载的速度。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">async</span> <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 从url中获取页码：localhost:3000?page=3</span>  <span class="token keyword">const</span> page <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>page <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> limit <span class="token operator">=</span> <span class="token number">20</span>  <span class="token comment">// 获取返回结果并解构 Promise.all 方法返回值未数组</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>articlesResponse<span class="token punctuation">,</span> tagResponse<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token function">getArticles</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      limit<span class="token punctuation">,</span>      offset<span class="token operator">:</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> limit    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 解构结果值</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span>articles<span class="token punctuation">,</span> articlesCount<span class="token punctuation">}</span> <span class="token operator">=</span> articlesResponse<span class="token punctuation">.</span>data  <span class="token keyword">const</span> <span class="token punctuation">{</span>tags<span class="token punctuation">}</span> <span class="token operator">=</span> tagResponse<span class="token punctuation">.</span>data  <span class="token keyword">return</span> <span class="token punctuation">{</span>    articles<span class="token punctuation">,</span>    articlesCount<span class="token punctuation">,</span>    limit<span class="token punctuation">,</span>    page<span class="token punctuation">,</span>    tags  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="标签列表链接和数据"><a href="#标签列表链接和数据" class="headerlink" title="标签列表链接和数据"></a>标签列表链接和数据</h4><ul><li><p>处理标签列表链接，类似于分页页码的处理；在标签上绑定查询参数<code>?tag='something'</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{      name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span>,      query: {        tag: item      }  }<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in tags<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ item }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>搭配<code>?page=3?tag=‘something’</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page-link<span class="token punctuation">"</span></span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{    name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span>,    query: {      page: item,      tag: $route.query.tag    }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ item }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="标签高亮及链接（Tab）"><a href="#标签高亮及链接（Tab）" class="headerlink" title="标签高亮及链接（Tab）"></a>标签高亮及链接（Tab）</h4><ul><li><p>业务逻辑：当用户登录后，显示<strong>Your Feed</strong>， 否则不显示<strong>Your Feed</strong>，只显示<strong>Global Feed</strong>。</p><ul><li><p>获取user，判断user，是否展示Your Feed</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>Your Feed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>业务逻辑：点击右侧<strong>Popular Tag</strong>时，动态显示<code>#{{ tag }}</code>的<strong>tab</strong>导航栏</p><ul><li><p>判断当前url中是否有<strong>tag</strong>，如果有则动态的渲染<strong>tab</strong>导航栏</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><p>在asyncData中需要返回tag属性</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">async</span> <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 从url中获取页码：localhost:3000?page=3</span>  <span class="token keyword">const</span> page <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>page <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> limit <span class="token operator">=</span> <span class="token number">20</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span>tag<span class="token punctuation">}</span> <span class="token operator">=</span> query  <span class="token keyword">const</span> <span class="token punctuation">[</span>articlesResponse<span class="token punctuation">,</span> tagResponse<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token function">getArticles</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      limit<span class="token punctuation">,</span>      offset<span class="token operator">:</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> limit<span class="token punctuation">,</span>      tag  <span class="token comment">// 查询tag</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span>articles<span class="token punctuation">,</span> articlesCount<span class="token punctuation">}</span> <span class="token operator">=</span> articlesResponse<span class="token punctuation">.</span>data  <span class="token keyword">const</span> <span class="token punctuation">{</span>tags<span class="token punctuation">}</span> <span class="token operator">=</span> tagResponse<span class="token punctuation">.</span>data  <span class="token keyword">return</span> <span class="token punctuation">{</span>    articles<span class="token punctuation">,</span>    articlesCount<span class="token punctuation">,</span>    limit<span class="token punctuation">,</span>    page<span class="token punctuation">,</span>    tags<span class="token punctuation">,</span>    tag<span class="token punctuation">,</span>  <span class="token comment">// 返回tag</span>    tab<span class="token operator">:</span> query<span class="token punctuation">.</span>tab <span class="token operator">||</span> <span class="token string">'global_feed'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><strong>Popular Tag</strong> <code>query</code>查询参数中添加tag属性</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{        name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span>,        query: {          tag: item,  // 添加tag查询参数          tab: <span class="token punctuation">'</span>tag<span class="token punctuation">'</span>        }      }<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag-pill tag-default<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in tags<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ item }}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>动态绑定Your Feed、Global Feed、#tag的active样式</p><ul><li><p>给tab栏添加查询参数<code>tab: 'your_feed'</code>、<code>tab: 'global_feed'</code>、<code>tab: tag</code></p></li><li><p>精确匹配<code>exact</code>，<code>watchQueryt</code>中添加<code>tab</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span>             <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{  active: tab === <span class="token punctuation">'</span>your_feed<span class="token punctuation">'</span>}<span class="token punctuation">"</span></span>             <span class="token attr-name">exact</span>             <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{  name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span>,  query: {    tab: <span class="token punctuation">'</span>your_feed<span class="token punctuation">'</span>  }}<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Your Feed  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span>      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span>      <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{        active: tab === <span class="token punctuation">'</span>global_feed<span class="token punctuation">'</span>      }<span class="token punctuation">"</span></span>      <span class="token attr-name">exact</span>      <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{        name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span>,        query: {          tab: <span class="token punctuation">'</span>global_feed<span class="token punctuation">'</span>        }      }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Global Feed  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span>      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span>      <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{        active: tab === <span class="token punctuation">'</span>tag<span class="token punctuation">'</span>      }<span class="token punctuation">"</span></span>      <span class="token attr-name">exact</span>      <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{        name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span>,        query: {          tab: <span class="token punctuation">'</span>tag<span class="token punctuation">'</span>,          tag: tag        }      }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>#{{ tag }}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js">watchQuery<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">,</span> <span class="token string">'tag'</span><span class="token punctuation">,</span> <span class="token string">'tab'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>在热门标签Popular Tags中，选择页码，发现Tab并没有被激活，所以需要在页码中家也如查询参数query，<code>tab:tab</code></li></ul></li></ul></li></ul><h3 id="展示关注文章列表"><a href="#展示关注文章列表" class="headerlink" title="展示关注文章列表"></a>展示关注文章列表</h3><p>将<strong>Your Feed</strong>中的数据渲染到该<strong>Tab</strong>中</p><ul><li>首先在<code>asyncData</code>中解构出<code>store</code>对象，从<code>store</code>对象中获取<code>user</code>，用于传递到接口服务器，在接口中先手动写入用户<code>token</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 获取关注的的文章列表</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getFeedArticles</span> <span class="token operator">=</span> <span class="token parameter">params</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>    url<span class="token operator">:</span> <span class="token string">'/api/articles/feed'</span><span class="token punctuation">,</span>    <span class="token comment">// 注意数据格式</span>    headers<span class="token operator">:</span> <span class="token punctuation">{</span>      Authorization<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Token eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6MTkwMzIyLCJ1c2VybmFtZSI6IjVjb2RlciIsImV4cCI6MTYzMjUzNTA0NH0.i0tpsAKIB-462Vg_dOyCABZNcFwNMqRtvQ-jzoDTY6k</span><span class="token template-punctuation string">`</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    params  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>根据用户登录状态、tab是否为your_feed两个条件决定加载全部文章或者关注的文章</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>getArticles<span class="token punctuation">,</span> getFeedArticles<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/article"</span><span class="token punctuation">;</span><span class="token operator">...</span><span class="token keyword">async</span> <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>query<span class="token punctuation">,</span> store<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 从url中获取页码：localhost:3000?page=3</span>  <span class="token keyword">const</span> page <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>page <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> limit <span class="token operator">=</span> <span class="token number">20</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span>tag<span class="token punctuation">}</span> <span class="token operator">=</span> query  <span class="token keyword">const</span> tab <span class="token operator">=</span> query<span class="token punctuation">.</span>tab <span class="token operator">||</span> <span class="token string">'global_feed'</span>  <span class="token comment">// 判断加载全部文章或者关注文章</span>  <span class="token keyword">const</span> loadArticles <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user <span class="token operator">&amp;&amp;</span> tab <span class="token operator">===</span> <span class="token string">'your_feed'</span>      <span class="token operator">?</span> getFeedArticles      <span class="token operator">:</span> getArticles  <span class="token keyword">const</span> <span class="token punctuation">[</span>articlesResponse<span class="token punctuation">,</span> tagResponse<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token function">loadArticles</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      limit<span class="token punctuation">,</span>      offset<span class="token operator">:</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> limit<span class="token punctuation">,</span>      tag<span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span>articles<span class="token punctuation">,</span> articlesCount<span class="token punctuation">}</span> <span class="token operator">=</span> articlesResponse<span class="token punctuation">.</span>data  <span class="token keyword">const</span> <span class="token punctuation">{</span>tags<span class="token punctuation">}</span> <span class="token operator">=</span> tagResponse<span class="token punctuation">.</span>data  <span class="token keyword">return</span> <span class="token punctuation">{</span>    articles<span class="token punctuation">,</span>    articlesCount<span class="token punctuation">,</span>    limit<span class="token punctuation">,</span>    page<span class="token punctuation">,</span>    tags<span class="token punctuation">,</span>    tag<span class="token punctuation">,</span>    tab<span class="token operator">:</span> query<span class="token punctuation">.</span>tab <span class="token operator">||</span> <span class="token string">'global_feed'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="统一添加数据token"><a href="#统一添加数据token" class="headerlink" title="统一添加数据token"></a>统一添加数据token</h3><p>在上一步中，我们手动设置的用户的token值，但是在实际的业务中需要动态的添加token值。也就是说需要在store中获取到<code>state.user.token</code>。但是在request.js中我们无法获取到store上下文对象。Nuxt.js为我们提供了一个插件机制，插件机制可以让我们在真正请求之前拦截到请求，并在请求中可以获取上下文对象（query、params、req、res、app、store…）</p><p>插件机制使用如下：</p><p>在项目根目录创建目录<code>plugins</code>以及文件<code>request.js</code>，导出默认成员，代码如下：</p><p><code>plugins/request.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** 基于 axios 封装的请求模块* */</span><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token comment">// 创建请求对象</span><span class="token keyword">export</span> <span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  baseURL<span class="token operator">:</span> <span class="token string">'https://conduit.productionready.io'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 插件导出函数必须作为default成员，而default成员只有一个</span><span class="token comment">// 通过插件机制获取到上下文对象（query、params、req、res、app、store...）</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>  <span class="token comment">// 请求拦截器</span>  <span class="token comment">// 任何请求都要经过请求拦截器</span>  <span class="token comment">// 我们可以在请求拦截器中做一些公共的业务处理，例如设置token</span>  request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 请求就会经过这里</span>    <span class="token comment">// 拿到用户的token</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>user<span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span>state    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>      config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>Authorization <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Token </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>    <span class="token punctuation">}</span>    <span class="token comment">// 返回config请求配置对象</span>    <span class="token keyword">return</span> config  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果请求失败（此时请求还没有发出去）就会进入这里</span>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此外，当需要使用插件时，还需要在nuxt.config.js中进行注册插件，代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  router<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 注册插件</span>  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">'~/plugins/request.js'</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>export default</code>导出默认成员时，可以使用对象解构，只解构出我们需要的<code>store</code>对象，然后在判断user以及user.token，当条件成立后，在config中配置headers，按照API文档就进行设置。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>user<span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>  config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>Authorization <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Token </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>此时，我们就不需要再使用<code>utils/request.js</code>中的方法了，需要在<code>api</code>中的所有文件(<code>articles.js</code>、<code>tag.js</code>、<code>user.js</code>)中替换导入</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> request <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/plugins/request"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时，在我们<code>home/index.vue</code>中的所有请求都会使用<code>plugins/request.js</code>，所有请求也会经过拦截器，进而统一设置用户<code>token</code>。</p><h3 id="日期格式处理"><a href="#日期格式处理" class="headerlink" title="日期格式处理"></a>日期格式处理</h3><p>在线demo中，日期的展现形式是：简写月份 日期, 年份，所以我们需要将获取到的articles中的createAt字段改变为此格式。这里推荐一个类似于<strong>moment.js</strong>的插件<a href="https://github.com/iamkun/dayjs/blob/dev/docs/zh-cn/README.zh-CN.md"><strong>dayjs.js</strong>（Github）</a>、<a href="https://dayjs.gitee.io/zh-CN/">官方文档</a></p><blockquote><p><code>Day.js</code> 是一个轻量的处理时间和日期的 JavaScript 库，和 Moment.js 的 API 设计保持完全一样. 如果您曾经用过 Moment.js, 那么您已经知道如何使用 <code>Day.js</code></p></blockquote><p>使用Vue中的<strong>全局过滤器</strong>，将日期格式化，这样可以更大限度的重用代码。同样需要在plugins目录中新建dayjs.js文件（文件名随意），代码如下：</p><p><code>plugins/dayjs.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> dayjs <span class="token keyword">from</span> <span class="token string">'dayjs'</span><span class="token comment">// {{ 表达式 | 过滤器 }}</span><span class="token comment">// filter第一个参数为过滤器名称</span><span class="token comment">// filter第二个参数为函数，函数中的value为表达式返回的值</span>Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>value<span class="token punctuation">,</span> format <span class="token operator">=</span> <span class="token string">'YYYY-MM-DD HH:mm:ss'</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">dayjs</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在pages/home/index.vue中使用管道附链接，并传入参数：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ article.createAt | date('MMM DD, YYYY') }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="文章点赞"><a href="#文章点赞" class="headerlink" title="文章点赞"></a>文章点赞</h3><p>接下来处理文章点赞功能，业务逻辑：</p><ul><li>未点赞状态下，点击为点赞，数量加1</li><li>点赞状态下，点击为取消点赞，数量减1</li></ul><p><strong>整体流程</strong>：</p><ul><li>新增两个数据接口</li></ul><p><code>api/articles.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 添加点赞</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">addFavorite</span> <span class="token operator">=</span> <span class="token parameter">slug</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>    url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">api/articles/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>slug<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/favorite</span><span class="token template-punctuation string">`</span></span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 取消点赞</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">deleteFavorite</span> <span class="token operator">=</span> <span class="token parameter">slug</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    method<span class="token operator">:</span> <span class="token string">'DELETE'</span><span class="token punctuation">,</span>    url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">api/articles/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>slug<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/favorite</span><span class="token template-punctuation string">`</span></span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在<code>pages/home/index.vue</code>中的点赞按钮中绑定事件</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-outline-primary btn-sm pull-xs-right<span class="token punctuation">"</span></span>        <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{                active: article.favorited                }<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onFavorite(article)<span class="token punctuation">"</span></span>                             <span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在<code>vm</code>实例中添加<code>methods</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token keyword">async</span> <span class="token function">onFavorite</span><span class="token punctuation">(</span><span class="token parameter">article</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果已经点赞了，则取消点赞，否则则添加点赞</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>article<span class="token punctuation">.</span>favorited<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">await</span> <span class="token function">deleteFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>      <span class="token comment">// 处理视图</span>      article<span class="token punctuation">.</span>favorited <span class="token operator">=</span> <span class="token boolean">false</span>      <span class="token comment">// 数量减1</span>      article<span class="token punctuation">.</span>favoritesCount <span class="token operator">+=</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">await</span> <span class="token function">addFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>      article<span class="token punctuation">.</span>favorited <span class="token operator">=</span> <span class="token boolean">true</span>      <span class="token comment">// 数量加1</span>      article<span class="token punctuation">.</span>favoritesCount <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>处理在点赞和取消点赞过程中的<code>pedding</code>状态，防止用户快速点击按钮，实现思路为动态更改<code>button</code>的<code>disabled</code>属性</p><ul><li><p>动态的在接收返回的<code>articles</code>数据中新增<code>favoriteDisabled</code>属性</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">articles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">articles</span> <span class="token operator">=&gt;</span> articles<span class="token punctuation">.</span>favoriteDisabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li></ul><p><code>pages/home/index.vue</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"btn btn-outline-primary btn-sm pull-xs-right"</span>        <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span>"<span class="token punctuation">{</span>          active<span class="token operator">:</span> article<span class="token punctuation">.</span>favorited        <span class="token punctuation">}</span><span class="token string">" @click="</span><span class="token function">onFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span>"        <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"article.favoriteDisabled"</span><span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"ion-heart"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span>  <span class="token punctuation">{</span><span class="token punctuation">{</span> article<span class="token punctuation">.</span>favoritesCount <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>点赞过程中动态的绑定<code>disabled</code>属性</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token keyword">async</span> <span class="token function">onFavorite</span><span class="token punctuation">(</span><span class="token parameter">article</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// disabled为true</span>    article<span class="token punctuation">.</span>favoriteDisabled <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token comment">// 如果已经点赞了，则取消点赞，否则则添加点赞</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>article<span class="token punctuation">.</span>favorited<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">await</span> <span class="token function">deleteFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>      <span class="token comment">// 处理视图</span>      article<span class="token punctuation">.</span>favorited <span class="token operator">=</span> <span class="token boolean">false</span>      article<span class="token punctuation">.</span>favoritesCount <span class="token operator">+=</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">await</span> <span class="token function">addFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>      article<span class="token punctuation">.</span>favorited <span class="token operator">=</span> <span class="token boolean">true</span>      article<span class="token punctuation">.</span>favoritesCount <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token punctuation">}</span>    <span class="token comment">// disabled为false</span>    article<span class="token punctuation">.</span>favoriteDisabled <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="文章详情-1"><a href="#文章详情-1" class="headerlink" title="文章详情"></a>文章详情</h2><blockquote><p>业务介绍：</p><ol><li>展示文章详情内容<ol><li>文章标题</li><li>作者信息</li><li>点赞</li><li>正文</li></ol></li><li>文章评论功能<ol><li>发布评论</li></ol></li></ol></blockquote><ul><li><p>文章详情数据接口封装</p><p><code>api/articles.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 获取文章详情</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getArticle</span> <span class="token operator">=</span> <span class="token parameter">slug</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>    url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/articles/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>slug<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>获取数据</p><p><code>pages/article/index.vue</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>getArticle<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/article"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"ArticleIndex"</span><span class="token punctuation">,</span>  <span class="token comment">// 通过对象结构，拿出params，进而拿到params.slug，即文章id</span>  <span class="token keyword">async</span> <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>params<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getArticle</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      article<span class="token operator">:</span> data<span class="token punctuation">.</span>article    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>动态渲染文章数据</p><p>这里先只渲染文章<code>title</code>和文章<code>body</code>，并且文章<code>body</code>不进行<strong>markdown</strong>转换</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{ article.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row article-content<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-md-12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    {{ article.body }}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="把Markdown转为HTMl"><a href="#把Markdown转为HTMl" class="headerlink" title="把Markdown转为HTMl"></a>把Markdown转为HTMl</h3><p><img src="http://5coder.cn/img/image-20210727221929254.png"></p><p>使用第三方插件<a href="https://markdown-it.docschina.org/">markdown-it</a>，该插件可以将<code>markdown</code>语法转换为<code>HTML</code>。在获取到<code>article.body</code>后，使用该插件方法将其转为<code>HTML</code>。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>getArticle<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/article"</span><span class="token punctuation">;</span><span class="token keyword">import</span> MarkdownIt <span class="token keyword">from</span> <span class="token string">'markdown-it'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"ArticleIndex"</span><span class="token punctuation">,</span>  <span class="token keyword">async</span> <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>params<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getArticle</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>article<span class="token punctuation">}</span> <span class="token operator">=</span> data    <span class="token keyword">const</span> md <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MarkdownIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    article<span class="token punctuation">.</span>body <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>body<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      article    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在模板中，使用<code>v-html</code>指令填充<code>article.body</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-md-12<span class="token punctuation">"</span></span> <span class="token attr-name">v-html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article.body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="展示文章作者相关信息"><a href="#展示文章作者相关信息" class="headerlink" title="展示文章作者相关信息"></a>展示文章作者相关信息</h3><p><img src="http://5coder.cn/img/image-20210727222805705.png"></p><p><img src="http://5coder.cn/img/image-20210727222834093.png"></p><p>文章详情页面中有两部分功能相似：</p><blockquote><p>文章作者信息、关注按钮、点赞按钮</p></blockquote><ul><li>首先封装组件</li></ul><p><code>pages/article/components/article-meta.vue</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article-meta<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{        name: <span class="token punctuation">'</span>profile<span class="token punctuation">'</span>,        params: {          username: article.author.username        }      }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      }      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article.author.image<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{        name: <span class="token punctuation">'</span>profile<span class="token punctuation">'</span>,        params: {          username: article.author.username        }      }<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ article.author.username }}      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ article.createdAt | date('MMM DD, YYYY') }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-sm btn-outline-secondary<span class="token punctuation">"</span></span>        <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{          active: article.author.following        }<span class="token punctuation">"</span></span>    <span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-plus-round<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>      Follow Eric Simons <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>counter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>({{ article.followCount }})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-sm btn-outline-primary<span class="token punctuation">"</span></span>        <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{          active: article.favorited        }<span class="token punctuation">"</span></span>        <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onFavorite(article)<span class="token punctuation">"</span></span>    <span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-heart<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>      Favorite Post <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>counter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>({{ article.favoritesCount }})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>addFavorite<span class="token punctuation">,</span> deleteFavorite<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/article"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"ArticleMeta"</span><span class="token punctuation">,</span>  props<span class="token operator">:</span> <span class="token punctuation">{</span>    article<span class="token operator">:</span> <span class="token punctuation">{</span>      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>      required<span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token keyword">async</span> <span class="token function">onFavorite</span><span class="token punctuation">(</span><span class="token parameter">article</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      article<span class="token punctuation">.</span>favoriteDisabled <span class="token operator">=</span> <span class="token boolean">true</span>      <span class="token comment">// 如果已经点赞了，则取消点赞，否则则添加点赞</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>article<span class="token punctuation">.</span>favorited<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">await</span> <span class="token function">deleteFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>        <span class="token comment">// 处理视图</span>        article<span class="token punctuation">.</span>favorited <span class="token operator">=</span> <span class="token boolean">false</span>        article<span class="token punctuation">.</span>favoritesCount <span class="token operator">+=</span> <span class="token operator">-</span><span class="token number">1</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">await</span> <span class="token function">addFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>        article<span class="token punctuation">.</span>favorited <span class="token operator">=</span> <span class="token boolean">true</span>        article<span class="token punctuation">.</span>favoritesCount <span class="token operator">+=</span> <span class="token number">1</span>      <span class="token punctuation">}</span>      article<span class="token punctuation">.</span>favoriteDisabled <span class="token operator">=</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在<code>article/index.vue</code>中的<strong>两个地方</strong>使用组件，并且传递<code>article</code>到<code>article-meta.vue</code>中，<code>article-meta.vue</code>使用<code>props</code>接受<code>article</code>数据，如上方代码</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article-meta</span> <span class="token attr-name">:article</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>动态遍历渲染<code>article</code>以及作者相关信息，如封装组件中的代码</li><li>动态绑定点赞按钮事件，与之前的<code>home/index.vue</code>中的用法相同</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-sm btn-outline-primary<span class="token punctuation">"</span></span>    <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{      active: article.favorited    }<span class="token punctuation">"</span></span>    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onFavorite(article)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ion-heart<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>  Favorite Post <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>counter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>({{ article.favoritesCount }})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token keyword">async</span> <span class="token function">onFavorite</span><span class="token punctuation">(</span><span class="token parameter">article</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    article<span class="token punctuation">.</span>favoriteDisabled <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token comment">// 如果已经点赞了，则取消点赞，否则则添加点赞</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>article<span class="token punctuation">.</span>favorited<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">await</span> <span class="token function">deleteFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>      <span class="token comment">// 处理视图</span>      article<span class="token punctuation">.</span>favorited <span class="token operator">=</span> <span class="token boolean">false</span>      article<span class="token punctuation">.</span>favoritesCount <span class="token operator">+=</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">await</span> <span class="token function">addFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>      article<span class="token punctuation">.</span>favorited <span class="token operator">=</span> <span class="token boolean">true</span>      article<span class="token punctuation">.</span>favoritesCount <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token punctuation">}</span>    article<span class="token punctuation">.</span>favoriteDisabled <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>TODO 关注按钮事件，其原理与点赞按钮相同，封装API请求，点击按钮，判断当前状态，更改数据</p><h3 id="设置页面meta优化SEO"><a href="#设置页面meta优化SEO" class="headerlink" title="设置页面meta优化SEO"></a>设置页面meta优化SEO</h3><ul><li><p>修改页面标题，希望在页面标题中出现文章的标题</p><p><img src="http://5coder.cn/img/image-20210727225038839.png"></p><p><img src="http://5coder.cn/img/image-20210727225100076.png"></p></li></ul><p><a href="https://www.nuxtjs.cn/api/pages-head">特定页面的Meta标签用法</a></p><blockquote><p>Nuxt.js 使用了 <a href="https://github.com/nuxt/vue-meta"><code>vue-meta</code></a> 更新应用的 <code>头部标签(Head)</code> 和 <code>html 属性</code>。</p><ul><li><strong>类型：</strong> <code>Object</code> 或 <code>Function</code></li></ul><p>使用 <code>head</code> 方法设置当前页面的头部标签。</p><p>在 <code>head</code> 方法里可通过 <code>this</code> 关键字来获取组件的数据，你可以利用页面组件的数据来设置个性化的 <code>meta</code> 标签。</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        title<span class="token operator">:</span> <span class="token string">'Hello World!'</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        title<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>        meta<span class="token operator">:</span> <span class="token punctuation">[</span>          <span class="token punctuation">{</span>            hid<span class="token operator">:</span> <span class="token string">'description'</span><span class="token punctuation">,</span>            name<span class="token operator">:</span> <span class="token string">'description'</span><span class="token punctuation">,</span>            content<span class="token operator">:</span> <span class="token string">'My custom description'</span>          <span class="token punctuation">}</span>        <span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>注意：为了避免子组件中的 meta 标签不能正确覆盖父组件中相同的标签而产生重复的现象，建议利用 <code>hid</code> 键为 <code>meta</code> 标签配一个唯一的标识编号。</p></blockquote><p><code>article/index.vue</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>addFavorite<span class="token punctuation">,</span> deleteFavorite<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/article"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"ArticleMeta"</span><span class="token punctuation">,</span>  props<span class="token operator">:</span> <span class="token punctuation">{</span>    article<span class="token operator">:</span> <span class="token punctuation">{</span>      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>      required<span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token keyword">async</span> <span class="token function">onFavorite</span><span class="token punctuation">(</span><span class="token parameter">article</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      article<span class="token punctuation">.</span>favoriteDisabled <span class="token operator">=</span> <span class="token boolean">true</span>      <span class="token comment">// 如果已经点赞了，则取消点赞，否则则添加点赞</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>article<span class="token punctuation">.</span>favorited<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">await</span> <span class="token function">deleteFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>        <span class="token comment">// 处理视图</span>        article<span class="token punctuation">.</span>favorited <span class="token operator">=</span> <span class="token boolean">false</span>        article<span class="token punctuation">.</span>favoritesCount <span class="token operator">+=</span> <span class="token operator">-</span><span class="token number">1</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">await</span> <span class="token function">addFavorite</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>        article<span class="token punctuation">.</span>favorited <span class="token operator">=</span> <span class="token boolean">true</span>        article<span class="token punctuation">.</span>favoritesCount <span class="token operator">+=</span> <span class="token number">1</span>      <span class="token punctuation">}</span>      article<span class="token punctuation">.</span>favoriteDisabled <span class="token operator">=</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      title<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>article<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - RealWorld</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>      meta<span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>          hid<span class="token operator">:</span> <span class="token string">'description'</span><span class="token punctuation">,</span>          name<span class="token operator">:</span> <span class="token string">'description'</span><span class="token punctuation">,</span>          content<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>article<span class="token punctuation">.</span>description        <span class="token punctuation">}</span>      <span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>显示效果</p><p><img src="http://5coder.cn/img/image-20210727225840268.png"></p><h3 id="文章评论"><a href="#文章评论" class="headerlink" title="文章评论"></a>文章评论</h3><ul><li>首先封装组件<code>article-comments.vue</code>，将评论部分抽离出来单独获取数据。</li><li>使用Vue生命周期函数mounted（此部分不需要SEO优化，因此采用客户端渲染）加载数据</li><li>使用封装好的组件，传递相关的文章对象<code>article</code></li><li>渲染遍历数据</li></ul><p><code>article-comments.vue</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card comment-form<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card-block<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Write a comment...<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card-footer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://i.imgur.com/Qr71crq.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-author-img<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-sm btn-primary<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          Post Comment        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card<span class="token punctuation">"</span></span>         <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment in comments<span class="token punctuation">"</span></span>         <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment.id<span class="token punctuation">"</span></span>    <span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card-block<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card-text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ comment.body }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card-footer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span>            <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{              name: <span class="token punctuation">'</span>profile<span class="token punctuation">'</span>,              params: {                username: comment.author.username              }            }<span class="token punctuation">"</span></span>            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-author<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment.author.image<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-author-img<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>        <span class="token entity named-entity" title="&nbsp;">&amp;nbsp;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span>            <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{              name: <span class="token punctuation">'</span>profile<span class="token punctuation">'</span>,              params: {                username: comment.author.username              }            }<span class="token punctuation">"</span></span>            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-author<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ comment.author.username }}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>date-posted<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ comment.createdAt | date('MMM DD, YYYY') }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>getComments<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/article"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"ArticleComments"</span><span class="token punctuation">,</span>  props<span class="token operator">:</span> <span class="token punctuation">{</span>    article<span class="token operator">:</span> <span class="token punctuation">{</span>      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>      required<span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      comments<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// 文章列表评论</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token keyword">async</span> <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getComments</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>article<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>comments <span class="token operator">=</span> data<span class="token punctuation">.</span>comments  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="发布部署"><a href="#发布部署" class="headerlink" title="发布部署"></a>发布部署</h2><h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3><h3 id="最简单的部署方式"><a href="#最简单的部署方式" class="headerlink" title="最简单的部署方式"></a>最简单的部署方式</h3><h3 id="使用PM2启动Node服务"><a href="#使用PM2启动Node服务" class="headerlink" title="使用PM2启动Node服务"></a>使用PM2启动Node服务</h3><h3 id="自定化部署介绍"><a href="#自定化部署介绍" class="headerlink" title="自定化部署介绍"></a>自定化部署介绍</h3><h3 id="准备自动部署内容"><a href="#准备自动部署内容" class="headerlink" title="准备自动部署内容"></a>准备自动部署内容</h3><h3 id="自动部署完成"><a href="#自动部署完成" class="headerlink" title="自动部署完成"></a>自动部署完成</h3>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nuxt.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nuxt.js基础</title>
      <link href="2021/072225880.html"/>
      <url>2021/072225880.html</url>
      
        <content type="html"><![CDATA[<h2 id="Nuxt-js基础"><a href="#Nuxt-js基础" class="headerlink" title="Nuxt.js基础"></a>Nuxt.js基础</h2><h2 id="Nuxt-js介绍"><a href="#Nuxt-js介绍" class="headerlink" title="Nuxt.js介绍"></a>Nuxt.js介绍</h2><h3 id="Nuxt-js是什么？"><a href="#Nuxt-js是什么？" class="headerlink" title="Nuxt.js是什么？"></a>Nuxt.js是什么？</h3><ul><li><a href="https://zh.nuxtjs.org/">官网</a></li><li><a href="https://github.com/nuxt/nuxt.js">GitHub仓库</a></li></ul><blockquote><p>官网介绍</p><p><code>Nuxt.js</code> 是一个基于 <code>Vue.js</code> 的服务端渲染应用框架，它可以帮我们轻松的实现同构应用。</p><p>通过对客户端/服务端基础架构的抽象组织，<code>Nuxt.js</code> 主要关注的是应用的 <strong>UI渲染</strong>。</p><p>我们的目标是创建一个灵活的应用框架，你可以基于它初始化新项目的基础结构代码，或者在已有Node.js 项目中使用 Nuxt.js。</p><p><code>Nuxt.js</code> 预设了利用 <code>Vue.js</code> 开发<strong>服务端渲染</strong>的应用所需要的各种配置。</p><p>除此之外，我们还提供了一种命令叫： <code>nuxt generate</code> ，为基于 <code>Vue.js</code> 的应用提供生成对应的静态站点的功能。</p><p>我们相信这个命令所提供的功能，是向开发集成各种微服务（<strong>Microservices</strong>）的 Web 应用迈开的新一步。</p><p>作为框架，<code>Nuxt.js</code> 为 <strong>客户端/服务端</strong> 这种典型的应用架构模式提供了许多有用的特性，例如<strong>异步数据加载、中间件支持、布局支持</strong>等非常实用的功能。</p></blockquote><h3 id="Nuxt-js框架是如何运作的？"><a href="#Nuxt-js框架是如何运作的？" class="headerlink" title="Nuxt.js框架是如何运作的？"></a>Nuxt.js框架是如何运作的？</h3><p><img src="http://5coder.cn/img/image-20210722221056696.png"></p><p>Nuxt.js集成了以下组件/框架，用于开发完整而强大的Web应用：</p><ul><li>Vue.js</li><li>Vue Router</li><li>Vuex（当配置了<strong>Vuex状态树配置项</strong>时才会引入）</li><li>Vue Server Renderer（排除使用<code>mode:'spa'</code>）</li><li>Vue-Meta</li></ul><p>压缩并gzip后，总代吗大小为：<strong>57kb</strong>（如果使用了Vuex特性的话为<strong>60kb</strong>）</p><p>另外，Nuxt.js使用<a href="https://github.com/webpack/webpack">Webpack</a>和<a href="https://github.com/vuejs/vue-loader">vue-router</a>、<a href="https://github.com/babel/babel-loader">babel-loader</a>来处理代码的自动构建工作（如打包、代码分层、压缩等）</p><h3 id="Nuxt-js特性"><a href="#Nuxt-js特性" class="headerlink" title="Nuxt.js特性"></a>Nuxt.js特性</h3><ul><li>基于Vue.js<ul><li>Vue、Vue Router、Vuex、Vue SSR</li></ul></li><li>自动代码分层</li><li>服务端渲染</li><li>强大的路由功能，支持异步数据</li><li>静态文件服务</li><li>ES2015+语法支持</li><li>打包和压缩js和css</li><li>HTML头部标签管理</li><li>本地开发支持热加载</li><li>集成ESLint</li><li>支持各种样式预处理器：SASS、LESS、Stylus</li><li>支持HTTP/2推送</li></ul><h3 id="Nuxt-js渲染方式"><a href="#Nuxt-js渲染方式" class="headerlink" title="Nuxt.js渲染方式"></a>Nuxt.js渲染方式</h3><h4 id="服务器端渲染站点和静态站点"><a href="#服务器端渲染站点和静态站点" class="headerlink" title="服务器端渲染站点和静态站点"></a>服务器端渲染站点和静态站点</h4><blockquote><p>服务器端呈现的站点在用户每次请求页面时都呈现在服务器上，因此服务器需要能够在每次请求时为页面提供服务。</p><p>静态站点与服务器端呈现的应用程序非常相似，主要区别在于静态站点是在构建时呈现的，因此不需要服务器。 从一个页面导航到另一个页面是在客户端。  </p><p><code>nuxt.config.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>ssr<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// default value</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></blockquote><h4 id="仅客户端渲染"><a href="#仅客户端渲染" class="headerlink" title="仅客户端渲染"></a>仅客户端渲染</h4><blockquote><p>只有客户端呈现，就没有服务器端呈现。 客户端呈现是指使用JavaScript在浏览器中呈现内容。 我们没有从HTML中获取所有内容，而是获得一个带有JavaScript文件的基本HTML文档，然后使用浏览器呈现站点的其余部分。 对于客户端渲染设置ssr为<code>false</code>。  </p><p><code>nuxt.config.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>ssr<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></blockquote><h3 id="Nuxt-js的使用方式"><a href="#Nuxt-js的使用方式" class="headerlink" title="Nuxt.js的使用方式"></a>Nuxt.js的使用方式</h3><ul><li>初始项目</li><li>已有的Node.js服务端项目<ul><li>直接把Nuxt当做一个<strong>中间件</strong>集成到<strong>Node Web Server</strong>中</li></ul></li><li>现有的Vue.js项目<ul><li><u>非常熟系Nuxt.js</u></li><li><u>至少百分之十的代码改动</u></li></ul></li></ul><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><h3 id="使用create-nuxt-app创建项目"><a href="#使用create-nuxt-app创建项目" class="headerlink" title="使用create-nuxt-app创建项目"></a>使用create-nuxt-app创建项目</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> create nuxt-app <span class="token operator">&lt;</span>project-name<span class="token operator">&gt;</span><span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>project-name<span class="token operator">&gt;</span><span class="token function">yarn</span> dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="从零开始创建项目"><a href="#从零开始创建项目" class="headerlink" title="从零开始创建项目"></a>从零开始创建项目</h3><h4 id="（1）准备"><a href="#（1）准备" class="headerlink" title="（1）准备"></a>（1）准备</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建示例项目</span><span class="token function">mkdir</span> nuxt-app-demo<span class="token comment"># 进入示例项目目录中</span><span class="token builtin class-name">cd</span> nuxt-app-demo<span class="token comment"># 初始化package.json文件</span><span class="token function">yarn</span> init -y<span class="token comment"># 安装nuxt</span><span class="token function">yarn</span> <span class="token function">add</span> nuxt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在<code>package.json</code>文件的<code>scripts</code>中新增：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"nuxt"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>上面的配置使得我们可以通过运行<code>yarn dev</code>来运行<code>Nuxt</code></p><h4 id="（2）创建页面并启动项目"><a href="#（2）创建页面并启动项目" class="headerlink" title="（2）创建页面并启动项目"></a>（2）创建页面并启动项目</h4><p>创建<code>pages</code>目录</p><pre class="line-numbers language-none"><code class="language-none">mkdir pages<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建第一个页面pages/index.vue：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后启动项目：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在应用运行在<a href="http://localhost:3000上。">http://localhost:3000上。</a></p><blockquote><p>注意：Nuxt.js会监听<code>pages</code>目录中的文件更改，因此在添加新页面时无需重新启动应用程序。</p></blockquote><h2 id="Nuxt路由"><a href="#Nuxt路由" class="headerlink" title="Nuxt路由"></a>Nuxt路由</h2><p>Nuxt.js 依据 <code>pages</code> 目录结构自动生成 vue-router 模块的路由配置。</p><h3 id="基础路由"><a href="#基础路由" class="headerlink" title="基础路由"></a>基础路由</h3><p>假设pages的目录结构如下：</p><p><img src="http://5coder.cn/img/image-20210722223136076.png"></p><p>那么Nuxt.js自动生成的路由配置如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">router<span class="token operator">:</span> <span class="token punctuation">{</span>  routes<span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      name<span class="token operator">:</span> 'index'<span class="token punctuation">,</span>      path<span class="token operator">:</span> '/'<span class="token punctuation">,</span>      component<span class="token operator">:</span> 'pages/index.vue'    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>      name<span class="token operator">:</span> 'user'<span class="token punctuation">,</span>      path<span class="token operator">:</span> '/user'<span class="token punctuation">,</span>      component<span class="token operator">:</span> 'pages/user/index.vue'    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>      name<span class="token operator">:</span> 'user-one'<span class="token punctuation">,</span>      path<span class="token operator">:</span> '/user/one'<span class="token punctuation">,</span>      component<span class="token operator">:</span> 'pages/user/one.vue'    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>自动生成的<code>.nuxt/router.js</code></p><p><img src="http://5coder.cn/img/image-20210722230731656.png"></p><h3 id="路由导航"><a href="#路由导航" class="headerlink" title="路由导航"></a><a href="https://router.vuejs.org/zh/guide/">路由导航</a></h3><ul><li>a 标签<ul><li>它会刷新整个页面，不要使用</li></ul></li><li><code>&lt;nuxt-link&gt;</code> 组件</li><li>编程式导航</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>About Nuxt.js<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--    整个页面刷新，走服务端渲染--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>a链接<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- router-link导航链接组件 --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>router-link<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--    编程式导航--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>编程式导航<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onClick<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">"about"</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><ul><li><p><a href="https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html">Vue Router动态路由匹配</a></p><ul><li>我们经常需要把某种模式匹配到的所有路由，全都映射到同个组件。例如，我们有一个 <code>User</code> 组件，对于所有 ID 各不相同的用户，都要使用这个组件来渲染。那么，我们可以在 <code>vue-router</code> 的路由路径中使用“动态路径参数”(dynamic segment) 来达到这个效果：</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">{</span>  template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;User&lt;/div&gt;'</span><span class="token punctuation">}</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  routes<span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token comment">// 动态路径参数 以冒号开头</span>    <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/user/:id'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> User <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在呢，像 <code>/user/foo</code> 和 <code>/user/bar</code> 都将映射到相同的路由。</p><p>一个“路径参数”使用冒号 <code>:</code> 标记。当匹配到一个路由时，参数值会被设置到 <code>this.$route.params</code>，可以在每个组件内使用。于是，我们可以更新 <code>User</code> 的模板，输出当前用户的 ID：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">{</span>  template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;User {{ $route.params.id }}&lt;/div&gt;'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><a href="https://www.nuxtjs.cn/guides/features/file-system-routing#dynamic-routes">Nuxt.js动态路由</a></p><ul><li>有时不可能知道路由的名称，比如当我们调用一个api来获取用户列表或博客文章时。 我们称之为动态路由。 要创建动态路由，需要在.vue文件名之前或目录名称之前添加下划线。 您可以任意命名文件或目录，但必须使用下划线作为前缀。</li></ul><p>目录结构：</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">pages/--| _slug/-----| comments.vue-----| index.vue--| users/-----| _id.vue--| index.vue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Nuxt.js生成对应的路由配置表</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">router<span class="token operator">:</span> <span class="token punctuation">{</span>  routes<span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      name<span class="token operator">:</span> 'index'<span class="token punctuation">,</span>      path<span class="token operator">:</span> '/'<span class="token punctuation">,</span>      component<span class="token operator">:</span> 'pages/index.vue'    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>      name<span class="token operator">:</span> 'users-id'<span class="token punctuation">,</span>      path<span class="token operator">:</span> '/users/<span class="token operator">:</span>id?'<span class="token punctuation">,</span>      component<span class="token operator">:</span> 'pages/users/_id.vue'    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>      name<span class="token operator">:</span> 'slug'<span class="token punctuation">,</span>      path<span class="token operator">:</span> '/<span class="token operator">:</span>slug'<span class="token punctuation">,</span>      component<span class="token operator">:</span> 'pages/_slug/index.vue'    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>      name<span class="token operator">:</span> 'slug-comments'<span class="token punctuation">,</span>      path<span class="token operator">:</span> '/<span class="token operator">:</span>slug/comments'<span class="token punctuation">,</span>      component<span class="token operator">:</span> 'pages/_slug/comments.vue'    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>如您所见，名为 users-id 的路由的路径为 :id?这使它成为可选的，如果你想使它成为必需的，请在 users/_id 目录中创建一个 index.vue 文件。</p></blockquote></li></ul><blockquote><p>从Nuxt &gt;= v2.13开始，已经安装了一个爬虫程序，它将抓取你的链接标签并基于这些链接生成动态路由。 但是，如果您有没有链接到的页面，比如秘密页面，那么您将需要手动生成这些动态路由。  </p></blockquote><p>拿到当前匹配的路由对象的参数</p><blockquote><p>You can access the current route parameters within your local page or component by referencing <code>this.$route.params.{parameterName}</code>. For example, if you had a dynamic users page (<code>users\_id.vue</code>) and wanted to access the <code>id</code> parameter to load the user or process information, you could access the variable like this: <code>this.$route.params.id</code>.</p></blockquote><p><img src="http://5coder.cn/img/image-20210723061713653.png"></p><p><img src="http://5coder.cn/img/image-20210723061749059.png"></p><h3 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h3><ul><li><p><a href="https://router.vuejs.org/zh/guide/essentials/nested-routes.html">Vue Router嵌套路由</a></p><p>实际生活中的应用界面，通常由多层嵌套的组件组合而成。同样地，URL 中各段动态路径也按某种结构对应嵌套的各层组件，例如：</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">/user/foo/profile                     /user/foo/posts+------------------+                  +-----------------+| User             |                  | User            || +--------------+ |                  | +-------------+ || | Profile      | |  +------------&gt;  | | Posts       | || |              | |                  | |             | || +--------------+ |                  | +-------------+ |+------------------+                  +-----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>借助 <code>vue-router</code>，使用嵌套路由配置，就可以很简单地表达这种关系。</p><p>接着上节创建的 app：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">{</span>  template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;User {{ $route.params.id }}&lt;/div&gt;'</span><span class="token punctuation">}</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  routes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/user/:id'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> User <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的 <code>&lt;router-view&gt;</code> 是最顶层的出口，渲染最高级路由匹配到的组件。同样地，一个被渲染组件同样可以包含自己的嵌套 <code>&lt;router-view&gt;</code>。例如，在 <code>User</code> 组件的模板添加一个 <code>&lt;router-view&gt;</code>：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">{</span>  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    &lt;div class="user"&gt;      &lt;h2&gt;User {{ $route.params.id }}&lt;/h2&gt;      &lt;router-view&gt;&lt;/router-view&gt;    &lt;/div&gt;  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>要在嵌套的出口中渲染组件，需要在 <code>VueRouter</code> 的参数中使用 <code>children</code> 配置：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  routes<span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      path<span class="token operator">:</span> <span class="token string">'/user/:id'</span><span class="token punctuation">,</span>      component<span class="token operator">:</span> User<span class="token punctuation">,</span>      children<span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>          <span class="token comment">// 当 /user/:id/profile 匹配成功，</span>          <span class="token comment">// UserProfile 会被渲染在 User 的 &lt;router-view&gt; 中</span>          path<span class="token operator">:</span> <span class="token string">'profile'</span><span class="token punctuation">,</span>          component<span class="token operator">:</span> UserProfile        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>          <span class="token comment">// 当 /user/:id/posts 匹配成功</span>          <span class="token comment">// UserPosts 会被渲染在 User 的 &lt;router-view&gt; 中</span>          path<span class="token operator">:</span> <span class="token string">'posts'</span><span class="token punctuation">,</span>          component<span class="token operator">:</span> UserPosts        <span class="token punctuation">}</span>      <span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>要注意，以 <code>/</code> 开头的嵌套路径会被当作根路径。 这让你充分的使用嵌套组件而无须设置嵌套的路径。</strong></p><p>你会发现，<code>children</code> 配置就是像 <code>routes</code> 配置一样的路由配置数组，所以呢，你可以嵌套多层路由。</p><p>此时，基于上面的配置，当你访问 <code>/user/foo</code> 时，<code>User</code> 的出口是不会渲染任何东西，这是因为没有匹配到合适的子路由。如果你想要渲染点什么，可以提供一个 空的 子路由：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  routes<span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      path<span class="token operator">:</span> <span class="token string">'/user/:id'</span><span class="token punctuation">,</span>      component<span class="token operator">:</span> User<span class="token punctuation">,</span>      children<span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token comment">// 当 /user/:id 匹配成功，</span>        <span class="token comment">// UserHome 会被渲染在 User 的 &lt;router-view&gt; 中</span>        <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> component<span class="token operator">:</span> UserHome <span class="token punctuation">}</span>        <span class="token comment">// ...其他子路由</span>      <span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="https://www.nuxtjs.cn/guides/features/file-system-routing#nested-routes">Nuxt.js嵌套路由</a></p></li></ul><p>你可以通过 vue-router 的子路由创建 Nuxt.js 应用的嵌套路由。<br>创建内嵌子路由，你需要添加一个 Vue 文件，同时添加一个与<strong>该文件同名的目录</strong>用来存放子视图组件。</p><blockquote><p>Warning: 别忘了在父组件( .vue 文件) 内增加 <nuxt-child> 用于显示子视图内容。</nuxt-child></p></blockquote><p>假设文件结构如：</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">pages/--| users/-----| _id.vue-----| index.vue--| users.vue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Nuxt.js 自动生成的路由配置如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">router<span class="token operator">:</span> <span class="token punctuation">{</span>  routes<span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      path<span class="token operator">:</span> '/users'<span class="token punctuation">,</span>      component<span class="token operator">:</span> 'pages/users.vue'<span class="token punctuation">,</span>      children<span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>          path<span class="token operator">:</span> ''<span class="token punctuation">,</span>          component<span class="token operator">:</span> 'pages/users/index.vue'<span class="token punctuation">,</span>          name<span class="token operator">:</span> 'users'        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>          path<span class="token operator">:</span> '<span class="token operator">:</span>id'<span class="token punctuation">,</span>          component<span class="token operator">:</span> 'pages/users/_id.vue'<span class="token punctuation">,</span>          name<span class="token operator">:</span> 'users-id'        <span class="token punctuation">}</span>      <span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/image-20210723063147108.png"></p><p><img src="http://5coder.cn/img/image-20210723063221316.png"></p><p><img src="http://5coder.cn/img/image-20210723063237799.png"></p>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nuxt.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>服务端渲染基础</title>
      <link href="2021/07224909.html"/>
      <url>2021/07224909.html</url>
      
        <content type="html"><![CDATA[<h2 id="服务端渲染基础"><a href="#服务端渲染基础" class="headerlink" title="服务端渲染基础"></a>服务端渲染基础</h2><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>随着前端技术栈和工具链的迭代成熟，前端工程化、模块化也已成为了当下的主流技术方案，在这波前端技术浪潮中，涌现了诸如 <strong>React、Vue、Angular</strong> 等基于客户端渲染的前端框架，这类框架所构建的单页应用（<strong>SPA</strong>）具有用户体验好、渲染性能好、可维护性高等优点。但也也有一些很大的缺陷，其中主要涉及到以下两点：</p><p>（1）首屏加载时间过长</p><p>与传统服务端渲染直接获取服务端渲染好的 <strong>HTML</strong> 不同，单页应用使用 JavaScript 在客户端生成 HTML来呈现内容，用户需要等待客户端 JS 解析执行完成才能看到页面，这就使得首屏加载时间变长，从而影响用户体验。</p><p>（2）不利于 SEO</p><p>当搜索引擎爬取网站 HTML 文件时，单页应用的 <strong>HTML</strong> 没有内容，因为他它需要通过客户端 <strong>JavaScript</strong>解析执行才能生成网页内容，而目前的主流的搜索引擎对于这一部分内容的抓取还不是很好。</p><p>为了解决这两个缺陷，业界借鉴了传统的服务端直出 <strong>HTML</strong> 方案，提出在服务器端执行前端框架（<strong>React/Vue/Angular</strong>）代码生成网页内容，然后将渲染好的网页内容返回给客户端，客户端只需要负责展示就可以了；</p><p><img src="http://5coder.cn/img/image-20210722054438075.png"></p><p>当然不仅仅如此，为了获得更好的用户体验，同时会在客户端将来自服务端渲染的内容激活为一个 <strong>SPA</strong>应用，也就是说之后的页面内容交互都是通过客户端渲染处理。</p><p><img src="http://5coder.cn/img/image-20210722054511593.png"></p><p>这种方式简而言之就是：</p><ul><li>通过服务端渲染首屏直出，解决首屏渲染慢以及不利于 <strong>SEO</strong> 问题</li><li>通过客户端渲染接管页面内容交互得到更好的用户体验</li></ul><p>这种方式我们通常称之为<strong>现代化的服务端渲染</strong>，也叫<strong>同构渲染</strong>，所谓的同构指的就是<strong>服务端构建渲染 +客户端构建渲染</strong>。同理，这种方式构建的应用称之为<strong>服务端渲染应用</strong>或者是<strong>同构应用</strong>。</p><p>为了让大家更好的理解服务端渲染应用，我们这里需要了解一些渲染相关概念，这些概念主要涉及到以下几点：</p><ul><li>什么是渲染</li><li>传统的服务端渲染</li><li>客户端渲染</li><li>现代化的服务端渲染（同构渲染）</li></ul><h2 id="什么是渲染"><a href="#什么是渲染" class="headerlink" title="什么是渲染"></a>什么是渲染</h2><p>我们这里所说的渲染指的是<strong>把（数据 + 模板）拼接到一起</strong>的这个事儿。<br>例如对于我们前端开发者来说最常见的一种场景就是：请求后端接口数据，然后将数据通过模板绑定语法绑定到页面中，最终呈现给用户。这个过程就是我们这里所指的渲染。</p><p><strong>渲染本质其实就是字符串的解析替换</strong>，实现方式有很多种；但是我们这里要关注的并不是如何渲染，而是<strong>在哪里渲染</strong>的问题？</p><h2 id="传统的服务端渲染"><a href="#传统的服务端渲染" class="headerlink" title="传统的服务端渲染"></a>传统的服务端渲染</h2><p>最早期，Web 页面渲染都是在服务端完成的，即服务端运行过程中将所需的数据结合页面模板渲染为HTML，响应给客户端浏览器。所以浏览器呈现出来的是直接包含内容的页面。</p><p>工作流程：</p><p><img src="http://5coder.cn/img/image-20210722054849960.png"></p><p>这种方式的代表性技术有：<strong>ASP、PHP、JSP</strong>，再到后来的一些相对高级一点的服务端框架配合一些模板引擎。</p><p>无论如何这种方式对于没有玩儿过后端开发的同学来说可能会比较陌生，所以下面通过我们前端同学比较熟悉的 <code>Node.js</code> 来了解一下这种方式。</p><p>安装依赖：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建 http 服务</span><span class="token function">npm</span> i express<span class="token comment"># 服务端模板引擎</span><span class="token function">npm</span> i art-template express-art-template<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>服务端代码：</p><ul><li>基本的Web服务</li><li>使用模板引擎</li><li>渲染一个页面</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 1. 获取页面模板</span>  <span class="token keyword">const</span> templateStr <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>  <span class="token comment">// 2. 获取数据</span>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 3. 渲染：数据 + 模板 = 最终结果</span>  <span class="token keyword">const</span> html <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>templateStr<span class="token punctuation">,</span> data<span class="token punctuation">)</span>  <span class="token comment">// 4. 把渲染结果发送给客户端</span>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./about.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'running...'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>客户端代码：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>传统的服务端渲染<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>传统的服务端渲染<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>    {{ each posts }}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>{{ $value.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>    {{ /each }}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这也就是最早的网页渲染方式，也就是动态网站的核心工作步骤。在这样的一个工作过程中，因为页面中的内容不是固定的，它有一些动态的内容。</p><p>在今天看来，这种渲染模式是不合理或者说不先进的。因为在当下这种网页越来越复杂的情况下，这种模式存在很多明显的不足：</p><ul><li>应用的前后端部分完全耦合在一起，在前后端协同开发方面会有非常大的阻力；</li><li>前端没有足够的发挥空间，无法充分利用现在前端生态下的一些更优秀的方案；</li><li>由于内容都是在服务端动态生成的，所以服务端的压力较大；</li><li>相比目前流行的 SPA 应用来说，用户体验一般；</li></ul><p><strong>但是不得不说，在网页应用并不复杂的情况下，这种方式也是可取的。</strong></p><h2 id="客户端渲染"><a href="#客户端渲染" class="headerlink" title="客户端渲染"></a>客户端渲染</h2><p>传统的服务端渲染有很多问题，但是这些问题随着客户端 <code>Ajax</code> 技术的普及得到了有效的解决，<code>Ajax</code> 技术可以使得客户端动态获取数据变为可能，也就是说原本服务端渲染这件事儿也可以拿到客户端做了。</p><p>下面是基于客户端渲染的 <code>SPA</code> 应用的基本工作流程。</p><p><img src="http://5coder.cn/img/image-20210722055247274.png"></p><p>下面我们以一个 <code>Vue.js</code> 创建的单页面应用为例来了解一下这种方式的渲染过程。</p><p>通过这个示例可以了解到我们就可以把【数据处理】和【页码渲染】这两件事儿分开了，也就是【后端】负责数据处理，【前端】负责页面渲染，这种分离模式极大的提高了开发效率和可维护性。</p><p>而且这样一来，【前端】更为独立，也不再受限制于【后端】，它可以选择任意的技术方案或框架来处理页面渲染。</p><p>但是这种模式下，也会存在一些明显的不足，其中最主要的就是：</p><ul><li>首屏渲染慢：因为 <strong>HTML</strong> 中没有内容，必须等到 <strong>JavaScript</strong> 加载并执行完成才能呈现页面内容。</li><li><strong>SEO</strong> 问题：同样因为 <strong>HTML</strong> 中没有内容，所以对于目前的搜索引擎爬虫来说，页面中没有任何有用的信息，自然无法提取关键词，进行索引了。</li></ul><p>对于客户端渲染的 SPA 应用的问题有没有解决方案呢？</p><ul><li>服务端渲染，严格来说是<strong>现代化的服务端渲染</strong>，也叫<strong>同构渲染</strong></li></ul><h2 id="现代化的服务端渲染"><a href="#现代化的服务端渲染" class="headerlink" title="现代化的服务端渲染"></a>现代化的服务端渲染</h2><p>我们在上一小节了解到 <strong>SPA</strong> 应用有两个非常明显的问题：</p><ul><li>首屏渲染慢</li><li>不利于 <strong>SEO</strong></li></ul><p>我们只是把问题抛出来了，那有没有解决办法呢？</p><p>答案就是：服务端渲染。</p><p>也就是将客户端渲染的工作放到服务端渲染，这个问题不就解决了吗？</p><p>但是有的同学肯定会想要问，是再让我们回到传统的服务端渲染吗？</p><p>不不不，本质上确实是需要使用到传统的服务端渲染，但是严格来讲应该叫现代化的服务端渲染，也叫同构渲染，也就是<strong>【服务端渲染】 + 【客户端渲染】</strong>。可能听起来有点晕，这个概念我们待会儿就会了解到。</p><p>接下来我要通过一个开箱即用的解决方案来带领大家了解一下什么是现代化的服务端渲染，或者说同构渲染。</p><p><code>Nuxt.js</code> 是一个基于 <code>Vue.js</code> 生态开发的一个第三方服务端渲染框架，通过它我们可以轻松构建现代化的服务端渲染应用。</p><p><strong>isomorphic web apps</strong>（同构应用）：<strong>isomorphic/universal</strong>，基于 <code>react</code>、<code>vue</code> 框架，<strong>客户端渲染和服务器端渲染的结合，在服务器端执行一次，用于实现服务器端渲染（首屏直出），在客户端再执行一次，用于接管页面交互，核心解决 SEO 和首屏渲染慢的问题。</strong></p><p><img src="http://5coder.cn/img/image-20210722055605590.png"></p><ol><li>客户端发起请求</li><li>服务端渲染首屏内容 + 生成客户端 SPA 相关资源</li><li>服务端将生成的首屏资源发送给客户端</li><li>客户端直接展示服务端渲染好的首屏内容</li><li>首屏中的 SPA 相关资源执行之后会<strong>激活客户端 Vue</strong></li><li>之后客户端所有的交互都由客户端 SPA 处理</li></ol><p>先来看一个例子：</p><p>交互流程解析：</p><p>分析优缺点：</p><ul><li>优点：首屏渲染速度快、有利于 <strong>SEO</strong></li><li>缺点：<ul><li>开发成本高。</li><li>涉及构建设置和部署的更多要求。与可以部署在任何静态文件服务器上的完全静态单页面应用程序 (<strong>SPA</strong>) 不同，服务器渲染应用程序，需要处于 <strong>Node.js server 运行环境</strong>。</li><li>更多的服务器端负载。在 Node.js 中渲染完整的应用程序，显然会比仅仅提供静态文件的server 更加大量占用 <strong>CPU 资源 (CPU-intensive - CPU 密集)<strong>，因此如果你预料在</strong>高流量环境(high traffic)</strong> 下使用，<strong>请准备相应的服务器负载，并明智地采用缓存策略</strong></li></ul></li></ul><p><img src="http://5coder.cn/img/image-20210722055819198.png"></p><p><strong>相关技术：</strong></p><ul><li>React 生态中的 <code>Next.js</code></li><li>Vue 生态中的 <code>Nuxt.js</code></li><li>Angular 生态中的 <code>Angular Universal</code></li></ul><p><strong>实现原理：</strong></p><p><img src="http://5coder.cn/img/image-20210722055925933.png"></p><p><strong>服务端渲染的问题：</strong></p><ul><li>开发条件所限。浏览器特定的代码，只能在某些<strong>生命周期钩子函数 (lifecycle hook)</strong> 中使用；一些<strong>外部扩展库 (external library)</strong> 可能需要特殊处理，才能在服务器渲染应用程序中运行。</li><li>涉及构建设置和部署的更多要求。与可以部署在任何静态文件服务器上的完全静态单页面应用程序(SPA) 不同，服务器渲染应用程序，需要处于 <strong>Node.js server 运行环境</strong>。</li><li>更多的服务器端负载。在 Node.js 中渲染完整的应用程序，显然会比仅仅提供静态文件的 server更加大量占用 CPU 资源 (CPU-intensive - CPU 密集)，因此如果你预料在高流量环境 (high traffic)下使用，<strong>请准备相应的服务器负载，并明智地采用缓存策略</strong>。</li></ul><p>在对你的应用程序使用<strong>服务器端渲染 (SSR)</strong> 之前，你应该问的第一个问题是，是否真的需要它。这主要取决于<strong>内容到达时间</strong> (time-to-content) 对应用程序的重要程度。例如，如果你正在构建一个内部仪表盘，初始加载时的额外几百毫秒并不重要，这种情况下去使用服务器端渲染 (SSR) 将是一个小题大作之举。然而，内容到达时间 (time-to-content) 要求是绝对关键的指标，在这种情况下，服务器端渲染(SSR) 可以帮助你实现最佳的初始加载性能。</p><p>事实上，很多网站是出于效益的考虑才启用服务端渲染，性能倒是在其次。 假设 A 网站页面中有一个关键字叫“前端性能优化”，这个关键字是 JS 代码跑过一遍后添加到 HTML 页面中的。那么客户端渲染模式下，我们在搜索引擎搜索这个关键字，是找不到 A 网站的——搜索引擎只会查找现成的内容，不会帮你跑 JS 代码。A 网站的运营方见此情形，感到很头大：搜索引擎搜不出来，用户找不到我们，谁还会用我的网站呢？为了把“现成的内容”拿给搜索引擎看，A 网站不得不启用服务端渲染。 但性能在其次，不代表性能不重要。</p><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p>项目结构：</p><p><img src="http://5coder.cn/img/image-20210722220302857.png"></p><p><code>pages/index.vue</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span>        <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in posts<span class="token punctuation">"</span></span>        <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.id<span class="token punctuation">"</span></span>      <span class="token punctuation">&gt;</span></span>{{ item.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'HomePage'</span><span class="token punctuation">,</span>  components<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// Nuxt 中特殊提供的一个钩子函数，专门用于获取页面服务端渲染的数据</span>  <span class="token keyword">async</span> <span class="token function">asyncData</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>      url<span class="token operator">:</span> <span class="token string">'http://localhost:3000/data.json'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// 这里返回的数据会和 data () {} 中的数据合并到一起给页面使用</span>    <span class="token keyword">return</span> data  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>pages/about.vue</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'AboutPage'</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>layouts/default.vue</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- 路由出口 --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- 类似于 router-link，用于单页面应用导航 --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- 子页面出口 --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt</span> <span class="token punctuation">/&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nuxt.js </tag>
            
            <tag> 服务端渲染 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vuex 状态管理</title>
      <link href="2021/071931096.html"/>
      <url>2021/071931096.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vuex状态管理"><a href="#Vuex状态管理" class="headerlink" title="Vuex状态管理"></a>Vuex状态管理</h1><h2 id="课程目标"><a href="#课程目标" class="headerlink" title="课程目标"></a>课程目标</h2><ul><li>组件通信方式回顾</li><li>Vuex核心概念和基本使用</li><li>购物车案例</li><li>模拟实现Vuex</li></ul><h2 id="组件内的状态管理流程"><a href="#组件内的状态管理流程" class="headerlink" title="组件内的状态管理流程"></a>组件内的状态管理流程</h2><p>Vue最核心的两个功能：数据驱动和组件化</p><p>组件化开发给我们带来了：</p><ul><li>更快的开发效率</li><li>更好的可维护性</li></ul><p>每个组件都有自己的状态、视图和行为等组成部分</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">// state</span>  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      count<span class="token operator">:</span> <span class="token number">0</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// view</span>  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;{{ count }}&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token comment">// actions</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">increment</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>状态管理包含一下几部分：</p><ul><li><strong>state</strong>，驱动应用的数据源</li><li><strong>view</strong>，以声明方式将state映射到视图</li><li><strong>actions</strong>，响应在view上的用户输入导致的状态变化</li></ul><p><img src="http://5coder.cn/img/image-20210719213045881.png"></p><h2 id="组件间通信方式回顾"><a href="#组件间通信方式回顾" class="headerlink" title="组件间通信方式回顾"></a>组件间通信方式回顾</h2><p>大多数场景下的组件都并不是独立存在的，而是相互协作共同构成了一个复杂的业务功能。在 Vue 中为不同的组件关系提供了不同的通信规则。</p><p><img src="http://5coder.cn/img/image-20210719213508962.png"></p><h3 id="父传子：Props-Down"><a href="#父传子：Props-Down" class="headerlink" title="父传子：Props Down"></a><a href="https://cn.vuejs.org/v2/guide/components.html#%E9%80%9A%E8%BF%87-Prop-%E5%90%91%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE">父传子：Props Down</a></h3><ul><li>子组件中通过props接受数据</li><li>父组件中给子组件通过相应属性传值</li></ul><blockquote><p><strong>Props</strong></p><p><a href="https://cn.vuejs.org/v2/guide/components-props.html#Prop-%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%86%99-camelCase-vs-kebab-case">Prop 的大小写 (camelCase vs kebab-case)</a></p><p>HTML 中的 attribute 名是大小写不敏感的，所以浏览器会把所有大写字符解释为小写字符。这意味着当你使用 DOM 中的模板时，camelCase (驼峰命名法) 的 prop 名需要使用其等价的 kebab-case (短横线分隔命名) 命名：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'blog-post'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token comment">// 在 JavaScript 中是 camelCase 的</span>props<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'postTitle'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>template<span class="token operator">:</span> <span class="token string">'&lt;h3&gt;{{ postTitle }}&lt;/h3&gt;'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- 在 HTML 中是 kebab-case 的 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>blog-post</span> <span class="token attr-name">post-title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello!<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>blog-post</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>重申一次，如果你使用字符串模板，那么这个限制就不存在了。</p><p><a href="https://cn.vuejs.org/v2/guide/components-props.html#Prop-%E7%B1%BB%E5%9E%8B">Prop 类型</a></p><p>到这里，我们只看到了以字符串数组形式列出的 prop：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">props<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'likes'</span><span class="token punctuation">,</span> <span class="token string">'isPublished'</span><span class="token punctuation">,</span> <span class="token string">'commentIds'</span><span class="token punctuation">,</span> <span class="token string">'author'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是，通常你希望每个 prop 都有指定的值类型。这时，你可以以对象形式列出 prop，这些 property 的名称和值分别是 prop 各自的名称和类型：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">props<span class="token operator">:</span> <span class="token punctuation">{</span>  title<span class="token operator">:</span> String<span class="token punctuation">,</span>  likes<span class="token operator">:</span> Number<span class="token punctuation">,</span>  isPublished<span class="token operator">:</span> Boolean<span class="token punctuation">,</span>  commentIds<span class="token operator">:</span> Array<span class="token punctuation">,</span>  author<span class="token operator">:</span> Object<span class="token punctuation">,</span>  callback<span class="token operator">:</span> Function<span class="token punctuation">,</span>  contactsPromise<span class="token operator">:</span> Promise <span class="token comment">// or any other constructor</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这不仅为你的组件提供了文档，还会在它们遇到错误的类型时从浏览器的 JavaScript 控制台提示用户。你会在这个页面接下来的部分看到<a href="https://cn.vuejs.org/v2/guide/components-props.html#Prop-%E9%AA%8C%E8%AF%81">类型检查和其它 prop 验证</a>。</p></blockquote><p><img src="http://5coder.cn/img/image-20210719213708568.png"></p><p><img src="http://5coder.cn/img/image-20210719213815350.png"></p><h3 id="子传父：Event-Up"><a href="#子传父：Event-Up" class="headerlink" title="子传父：Event Up"></a><a href="https://cn.vuejs.org/v2/guide/components.html#%E7%9B%91%E5%90%AC%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BA%8B%E4%BB%B6">子传父：Event Up</a></h3><p><img src="http://5coder.cn/img/image-20210720054418797.png"></p><p><img src="http://5coder.cn/img/image-20210720054522110.png"></p><h3 id="非父子组件：Event-Bus"><a href="#非父子组件：Event-Bus" class="headerlink" title="非父子组件：Event Bus"></a><a href="https://cn.vuejs.org/v2/guide/migration.html#dispatch-%E5%92%8C-broadcast-%E6%9B%BF%E6%8D%A2">非父子组件：Event Bus</a></h3><p>我们可以使用一个非常简单的Event Bus来解决这个问题：</p><p>eventbus.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后在需要通信的两端：</p><p>使用<code>$on</code>订阅：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 没有参数</span>bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'自定义事件名称'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 执行操作</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 有参数</span>bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'自定义事件名称'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 执行操作</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用<code>$emit</code>发布：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 没有自定义传参</span>bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'自定义事件名称'</span><span class="token punctuation">)</span><span class="token comment">// 有自定义传参</span>bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'自定义事件名称'</span><span class="token punctuation">,</span> 参数数据<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="父直接访问子组件：通过ref获取子组件"><a href="#父直接访问子组件：通过ref获取子组件" class="headerlink" title="父直接访问子组件：通过ref获取子组件"></a><a href="https://cn.vuejs.org/v2/guide/components-edge-cases.html#%E8%AE%BF%E9%97%AE%E5%AD%90%E7%BB%84%E4%BB%B6%E5%AE%9E%E4%BE%8B%E6%88%96%E5%AD%90%E5%85%83%E7%B4%A0">父直接访问子组件：通过ref获取子组件</a></h3><p><code>ref</code>有两个作用：</p><ul><li>如果把它作用到<strong>普通HTML标签上，则获取的是DOM</strong></li><li>如果把它作用到<strong>组件标签上，则获取到的是组件实例</strong></li></ul><p>创建<code>base-input</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>ref Child<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在使用子组件的时候，添加<code>ref</code>属性：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base-input</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>usernameInput<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>base-input</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后在父组件等渲染完毕后使用<code>$refs</code>访问：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>usernameInput<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p><code>$refs</code>只会在组件渲染完成之后生效，并且它们不是响应式的。这仅作为一个用于直接操作子组件的“逃生舱”——你应该避免在模板或计算属性中访问<code>$refs</code></p></blockquote><h2 id="简易的状态管理方案"><a href="#简易的状态管理方案" class="headerlink" title="简易的状态管理方案"></a>简易的状态管理方案</h2><p>如果多个组件之间要共享状态（数据），使用上面的方式虽然可以实现，但是比较麻烦，而且多个组件之间互相传值很难跟踪数据的变化，如果出现问题很难定位问题。</p><p>当遇到多个组件需要共享状态的时候，典型的场景：购物车。我们如果使用上述的方案都不合适，会遇到以下问题：</p><ul><li>多个视图依赖同一状态</li><li>来自不同视图的行为需要变更同一状态</li></ul><p>对于问题一，传参的方法对于多层嵌套的组件将会非常繁琐，并且对于兄弟组件间的状态传递无能为力。</p><p>对于问题二，我们经常会采用父子组件直接引用或者通过事件来变更和同步状态的多份拷贝。以上的这些模式非常脆弱，通常会导致无法维护的代码。</p><p>因此，我们为什么不把组件的共享状态抽取出来，以一个全局单例模式管理呢？在这种模式下，我们的组件树构成了一个巨大的“视图”，不管在树的哪个位置，任何组件都能获取状态或者触发行为！</p><p>通过定义和隔离状态管理中的各种概念并通过强制规则维持视图和状态间的独立性，我们的代码将会变得更结构化且易维护。</p><p>我们可以把多个组件的状态，或者整个程序的状态放到一个集中的位置存储，并且可以检测到数据的更改。你可能已经想到了 <code>Vuex</code>。</p><p>这里我们先以一种简单的方式来实现</p><ul><li>首先创建一个共享的仓库 <code>store</code> 对象</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  debug<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  state<span class="token operator">:</span> <span class="token punctuation">{</span>    user<span class="token operator">:</span> <span class="token punctuation">{</span>      name<span class="token operator">:</span> <span class="token string">'xiaomao'</span><span class="token punctuation">,</span>      age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>      sex<span class="token operator">:</span> <span class="token string">'男'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">setUserNameAction</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setUserNameAction triggered：'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name <span class="token operator">=</span> name  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>把共享的仓库 <code>store</code> 对象，存储到需要共享状态的组件的 <code>data</code> 中</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>componentA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>    user name: {{ sharedState.user.name }}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>change<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Change Info<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">change</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      store<span class="token punctuation">.</span><span class="token function">setUserNameAction</span><span class="token punctuation">(</span><span class="token string">'componentA'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      privateState<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      sharedState<span class="token operator">:</span> store<span class="token punctuation">.</span>state    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接着我们继续延伸约定，组件不允许直接变更属于 <code>store</code> 对象的 <code>state</code>，而应执行 <code>action</code> 来分发(<code>dispatch</code>) 事件通知 <code>store</code> 去改变，这样最终的样子跟 <code>Vuex</code> 的结构就类似了。这样约定的好处是，我们能够记录所有 <code>store</code> 中发生的 <code>state</code> 变更，同时实现能做到记录变更、保存状态快照、历史回滚/时光旅行的先进的调试工具。</p><h2 id="Vuex回顾"><a href="#Vuex回顾" class="headerlink" title="Vuex回顾"></a>Vuex回顾</h2><h3 id="什么是Vuex"><a href="#什么是Vuex" class="headerlink" title="什么是Vuex"></a><a href="https://vuex.vuejs.org/zh/">什么是Vuex</a></h3><blockquote><p><a href="https://vuex.vuejs.org/zh/">Vuex</a> 是一个专为 Vue.js 应用程序开发的<strong>状态管理模式</strong>。它采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。Vuex 也集成到 Vue 的官方调试工具 <a href="https://github.com/vuejs/devtools">devtools extension</a>，提供了诸如零配置的 <code>time-travel</code> 调试、状态快照导入导出等高级调试功能。</p></blockquote><ul><li>Vuex 是专门为 Vue.js 设计的状态管理库</li><li>它采用集中式的方式存储需要共享的数据</li><li>从使用角度，它就是一个 JavaScript 库</li><li>它的作用是进行状态管理，解决复杂组件通信，数据共享</li></ul><h3 id="什么情况下使用Vuex"><a href="#什么情况下使用Vuex" class="headerlink" title="什么情况下使用Vuex"></a>什么情况下使用Vuex</h3><blockquote><p>官方文档：</p><p>Vuex 可以帮助我们管理共享状态，并附带了更多的概念和框架。这需要对短期和长期效益进行权衡。</p><p>如果您不打算开发大型单页应用，使用 Vuex 可能是繁琐冗余的。确实是如此——如果您的应用够简单，您最好不要使用 Vuex。一个简单的 <a href="https://cn.vuejs.org/v2/guide/state-management.html#%E7%AE%80%E5%8D%95%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E8%B5%B7%E6%AD%A5%E4%BD%BF%E7%94%A8">store</a> 模式就足够您所需了。但是，如果您需要构建一个中大型单页应用，您很可能会考虑如何更好地在组件外部管理状态，Vuex 将会成为自然而然的选择。引用 Redux 的作者 Dan Abramov 的话说就是：Flux 架构就像眼镜：您自会知道什么时候需要它。</p></blockquote><p>当你的应用中具有以下需求场景的时候：</p><ul><li>多个视图依赖于同一状态</li><li>来自不同视图的行为需要变更同一状态</li></ul><p>建议符合这种场景的业务使用 Vuex 来进行数据管理，例如非常典型的场景：购物车。</p><p><strong>注意：Vuex 不要滥用，不符合以上需求的业务不要使用，反而会让你的应用变得更麻烦。</strong></p><h3 id="核心概念回顾"><a href="#核心概念回顾" class="headerlink" title="核心概念回顾"></a>核心概念回顾</h3><p><img src="http://5coder.cn/img/vuex.png"></p><ul><li><code>Store</code>:仓库，<code>store</code>是使用<code>Vuex</code>应用程序的核心，每一个应用仅有一个<code>store</code>。<code>store</code>是一个容器，包含应用中的大部分状态，当然我们不能直接改变<code>store</code>中的应用状态，我们需要通过提交<code>mutation</code>的方式改变状态。</li><li><code>State</code>：就是状态，保存在store中。因为<code>store</code>是唯一的，所以<code>state</code>状态也是惟一的，称为单一状态树。但是所有的状态都保存在<code>state</code>中的话，会让程序难以维护，可以通过后续的模块解决该问题。<ul><li>注意：这里的<code>state</code>状态是响应式的</li></ul></li><li><code>Getter</code>：<code>getter</code>就像是<code>Vuex</code>中的计算属性，方便从一个属性派生出其他的值，它内部可以对计算的结果进行缓存，只有当内部依赖的<code>state</code>状态发生改变时才会重新计算。</li><li><code>Mutation</code>：<code>state</code>状态的变化必须要通过提交<code>mutation</code>来完成</li><li><code>Action</code>：<code>action</code>和<code>mutation</code>类似，不同的是<code>action</code>可以进行异步的操作，内部改变状态的时候都需要提交<code>mutation</code></li><li><code>Module</code>：由于使用单一状态树，应用的所有状态会集中到一个比较大的对象上来，当应用变得十分复杂时，，<code>store</code>对象就有可能编的相当臃肿。为了解决以上问题，<code>Vuex</code>允许我们将<code>store</code>分隔成模块，每个模块拥有自己的<code>state</code>、<code>mutation</code>、<code>action</code>、<code>getter</code>甚至是嵌套的子模块</li></ul><h4 id="示例演示"><a href="#示例演示" class="headerlink" title="示例演示"></a>示例演示</h4><p>使用<code>vue create vuex-demo</code>创建包含router和vuex的空项目</p><h4 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h4><p><code>src/store/index.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token comment">// 1.导入Vuex</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token comment">// 2.注册Vuex</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  state<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  actions<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  modules<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>src/main.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  store<span class="token punctuation">,</span>  <span class="token comment">// 3.注入$store到Vue实例</span>  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="State"><a href="#State" class="headerlink" title="State"></a><a href="https://vuex.vuejs.org/zh/guide/state.html#state">State</a></h4><p><code>Vuex</code>使用单一状态树，用一个对象就包含了全部的应用层级状态。</p><p>使用<code>mapState</code>简化<code>State</code>在视图中的使用，<a href="https://vuex.vuejs.org/zh/guide/state.html#mapstate-%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0">mapState</a>返回计算属性</p><p><code>mapState</code>有两种使用方式：</p><ul><li><p><strong>接收数组参数</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 该方式是Vuex提供的，所以使用前需要先导入</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token comment">// mapState返回名称为count和msg的计算属性</span><span class="token comment">// 在模板中直接使用count和msg</span>computed<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token operator">...</span><span class="token function">mspState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用数组参数</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Vuex - Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--    count: {{ $store.state.count }}&lt;br&gt;--&gt;</span><span class="token comment">&lt;!--    msg: {{ $store.state.msg }}--&gt;</span>count: {{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>msg: {{ msg }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>接受对象参数</strong></p><p>如果当前视图中已经有了<code>count</code>和<code>msg</code>，如果使用上述方式的话会有命名冲突，解决的方式：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>mapState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">// count: state =&gt; state.count</span>    <span class="token comment">// ...mapState(['count', 'msg'])</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>num<span class="token operator">:</span> <span class="token string">'count'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'msg'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// 当store中存在count和msg时，使用对象参数重命名count和msg</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用对象参数</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Vuex - Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>count: {{ num }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>msg: {{ message }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a><a href="https://vuex.vuejs.org/zh/guide/getters.html#getter">Getter</a></h4><p><code>Getter</code>就是<code>store</code>中的计算属性，使用<a href="https://vuex.vuejs.org/zh/guide/getters.html#mapgetters-%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0">mapGetter</a>简化视图中的使用</p><p><code>App.vue</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>mapGetters<span class="token punctuation">,</span> mapState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">// count: state =&gt; state.count</span>    <span class="token comment">// ...mapState(['count', 'msg'])</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>num<span class="token operator">:</span> <span class="token string">'count'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'msg'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'reverseMsg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Getter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--    reverseMsg: {{ $store.getters.reverseMsg }}--&gt;</span>reverseMsg: {{ reverseMsg }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>src/store/index.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    state<span class="token operator">:</span> <span class="token punctuation">{</span>        count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        msg<span class="token operator">:</span> <span class="token string">'Hello Vuex'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    getters<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token function">reverseMsg</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> state<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    mutations<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    actions<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    modules<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Mutation"><a href="#Mutation" class="headerlink" title="Mutation"></a><a href="https://vuex.vuejs.org/zh/guide/mutations.html#mutation">Mutation</a></h4><p>更改<code>Vuex</code>的<code>store</code>中的状态的唯一方法是提交<code>mutation</code>。<code>Vuex</code>中的<code>mutation</code>非常类似于事件：每个<code>mutation</code>都有一个<strong>字符串的事件类型（type）</strong>和<strong>一个回调函数（handler）</strong>。这个回调函数就是我们实际进行状态更改的地方，并且它会接受<code>state</code>作为第一个参数。</p><p>使用<code>Mutation</code>改变状态的好处是：集中的一个位置对状态修改，不管在什么地方修改，都可以追踪到状态的修改。可以实现高级的<strong>time-travel</strong>调试功能</p><p><code>App.vue</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>mapGetters<span class="token punctuation">,</span> mapMutations<span class="token punctuation">,</span> mapState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">// count: state =&gt; state.count</span>    <span class="token comment">// ...mapState(['count', 'msg'])</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>num<span class="token operator">:</span> <span class="token string">'count'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'msg'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'reverseMsg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'increate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Mutation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--    &lt;button @click="$store.commit('increate', 2)"&gt;Mutation&lt;/button&gt;--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>increate(3)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Mutation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>src/store/index.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    state<span class="token operator">:</span> <span class="token punctuation">{</span>        count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        msg<span class="token operator">:</span> <span class="token string">'Hello Vuex'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    getters<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token function">reverseMsg</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> state<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    mutations<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token function">increate</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            state<span class="token punctuation">.</span>count <span class="token operator">+=</span> payload        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    actions<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    modules<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/vuex.gif" alt="vuex"></p><h4 id="Action"><a href="#Action" class="headerlink" title="Action"></a><a href="https://vuex.vuejs.org/zh/guide/actions.html#action">Action</a></h4><p><code>Action</code>类似于<code>mutation</code>，不同在于：</p><ul><li><code>Action</code>提交的是<code>mutation</code>，而不是直接变更状态</li><li><code>Action</code>可以包含任意异步操作</li></ul><p><code>App.vue</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>mapActions<span class="token punctuation">,</span> mapGetters<span class="token punctuation">,</span> mapMutations<span class="token punctuation">,</span> mapState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">// count: state =&gt; state.count</span>    <span class="token comment">// ...mapState(['count', 'msg'])</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>num<span class="token operator">:</span> <span class="token string">'count'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'msg'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'reverseMsg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'increate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'increateAsync'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Action<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--    &lt;button @click="$store.dispatch('increateAsync', 5)"&gt;Action&lt;/button&gt;--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>increateAsync(5,1)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Action<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>src/store/index.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    state<span class="token operator">:</span> <span class="token punctuation">{</span>        count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        msg<span class="token operator">:</span> <span class="token string">'Hello Vuex'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    getters<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token function">reverseMsg</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> state<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    mutations<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token function">increate</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            state<span class="token punctuation">.</span>count <span class="token operator">+=</span> payload        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    actions<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token function">increateAsync</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increate'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    modules<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h4><p>由于使用单一状态树，应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，store 对象就有可能变得相当臃肿。</p><p>为了解决以上问题，Vuex 允许我们将 store 分割成模块（module）。每个模块拥有自己的 state、mutation、action、getter、甚至是嵌套子模块。在案例中体会 Module 的使用。</p><p>目录结构：</p><p><img src="http://5coder.cn/img/image-20210720231254540.png"></p><p><img src="http://5coder.cn/img/image-20210720231711492.png"></p><h4 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a>严格模式</h4><p>之前在介绍核心概念时说过，所有的状态变更必须通过提交<code>mutation</code>，但是这仅仅是一个<strong>约定</strong>。如果你想的话，可以在组建中随时获取<code>$store.state.msg</code>，对它进行修改。从语法层面来说，这是没有问题的，但是这样操作破坏了<code>Vuex</code>的约定。如果在组件中直接修改<code>state</code>，那在<code>dev-tools</code>中无法追踪状态的变更。开启严格模式之后，如果在组件中直接修改<code>state</code>状态，会抛出错误。演示如下：</p><p><code>store/index.js</code>中添加<code>strict: true</code></p><p><img src="http://5coder.cn/img/image-20210721055156446.png"></p><p>在<code>App.vue</code>中添加如下代码，点击按钮直接修改<code>store</code>中<code>state.msg</code>的值</p><p><img src="http://5coder.cn/img/image-20210721055240615.png" alt="image-20210721055240615"></p><p>打开浏览器进行测试，发现$store.state.msg的值确实被修改了，但是console中会抛出异常。</p><p><img src="http://5coder.cn/img/image-20210721055417299.png"></p><p>需要注意的是：不要再生产模式下开启严格模式，严格模式会深度检查状态树，来检查不合规的状态改变，会影响性能。可以再开发环境中启用严格模式，在生产模式下关闭严格模式。调整后的代码：</p><ul><li>当<code>npm run serve</code>时，<code>process.env.NODE_ENV</code>为<code>development</code>开发环境；</li><li>当<code>npm run build</code>时，<code>process.env.NODE_ENV</code>是<code>production</code>。这样就可以根据环境来动态的设置严格模式。</li></ul><p><img src="http://5coder.cn/img/image-20210721055707152.png"></p><h2 id="购物车案例"><a href="#购物车案例" class="headerlink" title="购物车案例"></a>购物车案例</h2><p>接下来我们通过一个购物车案例来演示 Vuex 在项目中的使用方式，首先把购物车的项目模板下载下来。</p><p><a href="https://github.com/goddlts/vuex-cart-demo-template.git">模板地址</a></p><p>案例演示</p><p><img src="http://5coder.cn/img/cart.gif" alt="cart"></p><p>server.js，在访问数据时，必须先使用<code>node server.js</code>启动server接口</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span><span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span><span class="token keyword">const</span> _products <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'iPad Pro'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">500.01</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'H&amp;M T-Shirt White'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">10.99</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'Charli XCX - Sucker CD'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">19.99</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/products'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>_products<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/checkout'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    success<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server is running at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="功能列表"><a href="#功能列表" class="headerlink" title="功能列表"></a>功能列表</h3><ul><li>商品列表组件</li><li>商品列表中弹出框组件（购物车弹出框）</li><li>购物车列表组件</li></ul><h3 id="商品列表"><a href="#商品列表" class="headerlink" title="商品列表"></a>商品列表</h3><h4 id="商品列表功能"><a href="#商品列表功能" class="headerlink" title="商品列表功能"></a>商品列表功能</h4><ul><li><p>Vuex中创建两个模块，分别用来记录商品列表和购物车的状态，<code>stroe</code>的结构：</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">store--modulescart.jsproducts.jsindex.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>products</code>模块，<code>store/modules/products.js</code></p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>  products<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">const</span> getters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">async</span> <span class="token function">getProducts</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>      url<span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3000/products'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setProducts'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  namespaced<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  state<span class="token punctuation">,</span>  getters<span class="token punctuation">,</span>  mutations<span class="token punctuation">,</span>  actions<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>store/index.js</code>中注册<code>products.js</code>模块</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">import</span> products <span class="token keyword">from</span> <span class="token string">'./modules/products'</span><span class="token keyword">import</span> cart <span class="token keyword">from</span> <span class="token string">'./modules/cart'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token parameter">store</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'cart/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'cart-products'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span>cartProducts<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  state<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  actions<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  modules<span class="token operator">:</span> <span class="token punctuation">{</span>    products<span class="token punctuation">,</span>    cart  <span class="token punctuation">}</span><span class="token punctuation">,</span>  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>views/products.vue</code>中实现商品列表的功能</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-breadcrumb</span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-breadcrumb-item</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-breadcrumb-item</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-breadcrumb-item</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>商品列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-breadcrumb-item</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-breadcrumb</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span>      <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>products<span class="token punctuation">"</span></span>      <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span>        <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span>        <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>商品<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span>        <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>price<span class="token punctuation">"</span></span>        <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>价格<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span>        <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>address<span class="token punctuation">"</span></span>        <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>操作<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- &lt;template slot-scope="scope"&gt; --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addToCart(scope.row)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>加入购物车<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span> mapActions<span class="token punctuation">,</span> mapMutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'ProductList'</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">'products'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'products'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token string">'products'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'getProducts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="添加购物车"><a href="#添加购物车" class="headerlink" title="添加购物车"></a>添加购物车</h4><ul><li><code>cart</code> 模块实现添加购物车功能，<code>store/modules/cart.js</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token function">addToCart</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> product</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 1. cartProducts 中没有该商品，把该商品添加到数组，并增加 count，isChecked，totalPrice</span>    <span class="token comment">// 2. cartProducts 有该商品，让商品的数量加1，选中，计算小计</span>    <span class="token keyword">const</span> prod <span class="token operator">=</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> product<span class="token punctuation">.</span>id<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>prod<span class="token punctuation">)</span> <span class="token punctuation">{</span>      prod<span class="token punctuation">.</span>count<span class="token operator">++</span>      prod<span class="token punctuation">.</span>isChecked <span class="token operator">=</span> <span class="token boolean">true</span>      prod<span class="token punctuation">.</span>totalPrice <span class="token operator">=</span> prod<span class="token punctuation">.</span>count <span class="token operator">*</span> prod<span class="token punctuation">.</span>price    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token operator">...</span>product<span class="token punctuation">,</span>        count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        isChecked<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        totalPrice<span class="token operator">:</span> product<span class="token punctuation">.</span>price      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>store/index.js</code> 中注册 <code>cart</code> 模块</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">import</span> products <span class="token keyword">from</span> <span class="token string">'./modules/products'</span><span class="token keyword">import</span> cart <span class="token keyword">from</span> <span class="token string">'./modules/cart'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token parameter">store</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'cart/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'cart-products'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span>cartProducts<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  state<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  actions<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  modules<span class="token operator">:</span> <span class="token punctuation">{</span>    products<span class="token punctuation">,</span>    cart  <span class="token punctuation">}</span><span class="token punctuation">,</span>  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>view/products.vue</code> 中实现添加购物车功能</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'addToCart'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>测试，通过 vue-devtools 观察数据的变化</li></ul><h3 id="商品列表-弹出购物车窗口"><a href="#商品列表-弹出购物车窗口" class="headerlink" title="商品列表-弹出购物车窗口"></a>商品列表-弹出购物车窗口</h3><h4 id="购物车列表"><a href="#购物车列表" class="headerlink" title="购物车列表"></a>购物车列表</h4><ul><li><code>components/pop-cart.vue</code>中展示购物车列表</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-popover</span>    <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>350<span class="token punctuation">"</span></span>    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hover<span class="token punctuation">"</span></span>  <span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cartProducts<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>130<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>商品<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>price<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>价格<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>count<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>数量<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>操作<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteFromCart(scope.row.id)<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>共 {{ totalCount }} 件商品 共计¥{{ totalPrice }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>danger<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$router.push({ name: <span class="token punctuation">'</span>cart<span class="token punctuation">'</span> })<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>去购物车<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-badge</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>totalCount<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reference<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>我的购物车<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-badge</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-popover</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span> mapGetters<span class="token punctuation">,</span> mapMutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'PopCart'</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'cartProducts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'totalCount'</span><span class="token punctuation">,</span> <span class="token string">'totalPrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'deleteFromCart'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><ul><li><code>cart</code> 模块实现从购物车删除的功能，<code>store/modules/cart.js</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">deleteFromCart</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> prodId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> index <span class="token operator">=</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> prodId<span class="token punctuation">)</span>  index <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>components/pop-cart.vue</code> 中实现删除功能</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>操作<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteFromCart(scope.row.id)<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'deleteFromCart'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="小计"><a href="#小计" class="headerlink" title="小计"></a>小计</h4><ul><li><code>cart</code> 模块实现统计总数和总价，<code>store/modules/cart.js</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> getters <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token function">totalCount</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> prod</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> count <span class="token operator">+</span> prod<span class="token punctuation">.</span>count    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">totalPrice</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> prod</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> count <span class="token operator">+</span> prod<span class="token punctuation">.</span>totalPrice    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>components/pop-cart.vue</code> 中显示徽章和小计</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>共 {{ totalCount }} 件商品 共计¥{{ totalPrice }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>danger<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$router.push({ name: <span class="token punctuation">'</span>cart<span class="token punctuation">'</span> })<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>去购物车<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-badge</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>totalCount<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reference<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>我的购物车<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-badge</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js">computed<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'cartProducts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'totalCount'</span><span class="token punctuation">,</span> <span class="token string">'totalPrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h3><h4 id="购物车列表-1"><a href="#购物车列表-1" class="headerlink" title="购物车列表"></a>购物车列表</h4><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-popover</span>    <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>350<span class="token punctuation">"</span></span>    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hover<span class="token punctuation">"</span></span>  <span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cartProducts<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>130<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>商品<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>price<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>价格<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>count<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>数量<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>操作<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteFromCart(scope.row.id)<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>共 {{ totalCount }} 件商品 共计¥{{ totalPrice }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>danger<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$router.push({ name: <span class="token punctuation">'</span>cart<span class="token punctuation">'</span> })<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>去购物车<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-badge</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>totalCount<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reference<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>我的购物车<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-badge</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-popover</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span> mapGetters<span class="token punctuation">,</span> mapMutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'PopCart'</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'cartProducts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'totalCount'</span><span class="token punctuation">,</span> <span class="token string">'totalPrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'deleteFromCart'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="全选功能"><a href="#全选功能" class="headerlink" title="全选功能"></a>全选功能</h4><ul><li><code>cart</code> 模块实现更新商品的选中状态，<code>store/modules/cart.js</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> product</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 1. cartProducts 中没有该商品，把该商品添加到数组，并增加 count，isChecked，totalPrice</span>    <span class="token comment">// 2. cartProducts 有该商品，让商品的数量加1，选中，计算小计</span>    <span class="token keyword">const</span> prod <span class="token operator">=</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> product<span class="token punctuation">.</span>id<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>prod<span class="token punctuation">)</span> <span class="token punctuation">{</span>      prod<span class="token punctuation">.</span>count<span class="token operator">++</span>      prod<span class="token punctuation">.</span>isChecked <span class="token operator">=</span> <span class="token boolean">true</span>      prod<span class="token punctuation">.</span>totalPrice <span class="token operator">=</span> prod<span class="token punctuation">.</span>count <span class="token operator">*</span> prod<span class="token punctuation">.</span>price    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token operator">...</span>product<span class="token punctuation">,</span>        count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        isChecked<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        totalPrice<span class="token operator">:</span> product<span class="token punctuation">.</span>price      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">deleteFromCart</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> prodId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> index <span class="token operator">=</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> prodId<span class="token punctuation">)</span>    index <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">updateAllProductChecked</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> checked</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">prod</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    prod<span class="token punctuation">.</span>isChecked <span class="token operator">=</span> checked  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">updateProductChecked</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span>  checked<span class="token punctuation">,</span>  prodId<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> prod <span class="token operator">=</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">prod</span> <span class="token operator">=&gt;</span> prod<span class="token punctuation">.</span>id <span class="token operator">===</span> prodId<span class="token punctuation">)</span>  prod <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>prod<span class="token punctuation">.</span>isChecked <span class="token operator">=</span> checked<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">updateProduct</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span>    prodId<span class="token punctuation">,</span>    count  <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> prod <span class="token operator">=</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">prod</span> <span class="token operator">=&gt;</span> prod<span class="token punctuation">.</span>id <span class="token operator">===</span> prodId<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>prod<span class="token punctuation">)</span> <span class="token punctuation">{</span>      prod<span class="token punctuation">.</span>count <span class="token operator">=</span> count      prod<span class="token punctuation">.</span>totalPrice <span class="token operator">=</span> count <span class="token operator">*</span> prod<span class="token punctuation">.</span>price    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>views/cart.vue</code>，实现全选功能<ul><li><a href="https://cn.vuejs.org/v2/guide/components.html#%E4%BD%BF%E7%94%A8%E4%BA%8B%E4%BB%B6%E6%8A%9B%E5%87%BA%E4%B8%80%E4%B8%AA%E5%80%BC">使用事件抛出一个值</a></li></ul></li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span>  <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>55<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>header</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-checkbox</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkedAll<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-checkbox</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--    @change="updateProductChecked"  默认参数：更新后的值    @change="updateProductChecked(productId, $event)"  123, 原来那个默认参数      当你传递了自定义参数的时候，还想得到原来那个默认参数，就手动传递一个 $event   --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-checkbox</span>      <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>      <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scope.row.isChecked<span class="token punctuation">"</span></span>      <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateProductChecked({        prodId: scope.row.id,        checked: $event      })<span class="token punctuation">"</span></span>    <span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-checkbox</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'Cart'</span><span class="token punctuation">,</span>  computed<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'cartProducts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'checkedCount'</span><span class="token punctuation">,</span> <span class="token string">'checkedPrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    checkedAll<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">prod</span> <span class="token operator">=&gt;</span> prod<span class="token punctuation">.</span>isChecked<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">set</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateAllProductChecked</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      <span class="token string">'updateAllProductChecked'</span><span class="token punctuation">,</span>      <span class="token string">'updateProductChecked'</span><span class="token punctuation">,</span>      <span class="token string">'updateProduct'</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="数组文本框"><a href="#数组文本框" class="headerlink" title="数组文本框"></a>数组文本框</h4><ul><li><code>cart</code> 模块实现更新商品数量，<code>store/modules/cart.js</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">updateProduct</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span>    prodId<span class="token punctuation">,</span>    count  <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> prod <span class="token operator">=</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">prod</span> <span class="token operator">=&gt;</span> prod<span class="token punctuation">.</span>id <span class="token operator">===</span> prodId<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>prod<span class="token punctuation">)</span> <span class="token punctuation">{</span>      prod<span class="token punctuation">.</span>count <span class="token operator">=</span> count      prod<span class="token punctuation">.</span>totalPrice <span class="token operator">=</span> count <span class="token operator">*</span> prod<span class="token punctuation">.</span>price    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>views/cart.vue</code>，实现数字文本框功能</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input-number</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scope.row.count<span class="token punctuation">"</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateProduct({            prodId: scope.row.id,            count: $event          })<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input-number</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>    <span class="token string">'updateAllProductChecked'</span><span class="token punctuation">,</span>    <span class="token string">'updateProductChecked'</span><span class="token punctuation">,</span>    <span class="token string">'updateProduct'</span>  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h4><h4 id="小计-1"><a href="#小计-1" class="headerlink" title="小计"></a>小计</h4><ul><li><code>cart</code> 模块实现统计选中商品价格和数量，<code>store/modules/cart.js</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">checkedCount</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> prod</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>prod<span class="token punctuation">.</span>isChecked<span class="token punctuation">)</span> <span class="token punctuation">{</span>      sum <span class="token operator">+=</span> prod<span class="token punctuation">.</span>count    <span class="token punctuation">}</span>    <span class="token keyword">return</span> sum  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">checkedPrice</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> state<span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> prod</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>prod<span class="token punctuation">.</span>isChecked<span class="token punctuation">)</span> <span class="token punctuation">{</span>      sum <span class="token operator">+=</span> prod<span class="token punctuation">.</span>totalPrice    <span class="token punctuation">}</span>    <span class="token keyword">return</span> sum  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>views/cart.vue</code>，实现小计</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>已选 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ checkedCount }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> 件商品，总价：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ checkedPrice }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>danger<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>结算<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js">computed<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'cartProducts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">'cart'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'checkedCount'</span><span class="token punctuation">,</span> <span class="token string">'checkedPrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  checkedAll<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cartProducts<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">prod</span> <span class="token operator">=&gt;</span> prod<span class="token punctuation">.</span>isChecked<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateAllProductChecked</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="本地存储"><a href="#本地存储" class="headerlink" title="本地存储"></a>本地存储</h3><h4 id="Vuex插件"><a href="#Vuex插件" class="headerlink" title="Vuex插件"></a>Vuex插件</h4><ul><li><code>Vuex</code>的插件就是一个函数</li><li>这个函数接受一个<code>store</code>的参数</li><li>这个函数内可以注册一个函数，让它可以在<code>mutaions</code>之后再执行</li><li>就像在<code>axios</code>中的过滤器，在所有请求之后统一完成一件事</li></ul><p><img src="http://5coder.cn/img/image-20210721221103084.png"></p><ul><li><code>mutation</code>的结构<ul><li>如果想在<code>cart</code>模块中的<code>mutation</code>之行结束之后再来调用调用，<code>product</code>模块中不需要，可以使用<code>mutation</code></li></ul></li></ul><p><img src="http://5coder.cn/img/image-20210721221642267.png"></p><ul><li>注册插件</li></ul><p><img src="http://5coder.cn/img/image-20210721221144978.png" alt="image-20210721221144978"></p><ul><li><p>最终实现</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">import</span> products <span class="token keyword">from</span> <span class="token string">'./modules/products'</span><span class="token keyword">import</span> cart <span class="token keyword">from</span> <span class="token string">'./modules/cart'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token parameter">store</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 当store初始化后调用</span>  <span class="token comment">// subscribe的作用是用来订阅store中的mutation，会在每个mutation完成之后调用</span>  <span class="token comment">// 参数：mutation、state</span>  <span class="token comment">// 如果想在cart模块中的mutation之行结束之后再来调用调用，product模块中不需要，可以使用mutation</span>  store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 每次调用mutation之后调用</span>    <span class="token comment">// mutation的格式为 { type, payload }</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'cart/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">//记录到localStorage</span>      window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'cart-products'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span>cartProducts<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  state<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  mutations<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  actions<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  modules<span class="token operator">:</span> <span class="token punctuation">{</span>    cart<span class="token punctuation">,</span>    products  <span class="token punctuation">}</span><span class="token punctuation">,</span>  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="Vuex模拟实现"><a href="#Vuex模拟实现" class="headerlink" title="Vuex模拟实现"></a>Vuex模拟实现</h2><p>回顾基础示例，自己模拟实现一个<code>Vuex</code>实现同样的功能</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  state<span class="token operator">:</span> <span class="token punctuation">{</span>    count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    msg<span class="token operator">:</span> <span class="token string">'Hello World'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  getters<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">reverseMsg</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> state<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">increate</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      state<span class="token punctuation">.</span>count <span class="token operator">+=</span> payload<span class="token punctuation">.</span>num    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  actions<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">increate</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increate'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>num<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><ul><li>实现<code>install</code>方法<ul><li><code>Vuex</code>是<code>Vue</code>的一个插件，所以和模拟<code>VueRouter</code>类似，县实现<code>Vue</code>插件约定的<code>install</code>方法</li></ul></li><li>实现<code>Store</code>类<ul><li>实现构造函数，接受<code>options</code>对象参数</li><li><code>state</code>的响应式处理</li><li><code>getter</code>的实现</li><li><code>commit</code>、<code>dispatch</code>方法</li></ul></li></ul><h3 id="install方法"><a href="#install方法" class="headerlink" title="install方法"></a>install方法</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> _Vue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">function</span> <span class="token function">install</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  _Vue <span class="token operator">=</span> Vue  _Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token function">beforeCreate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>store<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$store <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>store      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Store类"><a href="#Store类" class="headerlink" title="Store类"></a>Store类</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> _Vue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">class</span> <span class="token class-name">Store</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>      state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      getters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      mutations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      actions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token operator">=</span> options    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> _Vue<span class="token punctuation">.</span><span class="token function">observable</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>    <span class="token comment">// 此处不直接 this.getters = getters，是因为下面的代码中要方法 getters 中的 key</span>    <span class="token comment">// 如果这么写的话，会导致 this.getters 和 getters 指向同一个对象</span>    <span class="token comment">// 当访问 getters 的 key 的时候，实际上就是访问 this.getters 的 key 会触发 key 属性的getter</span>    <span class="token comment">// 会产生死递归</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>getters <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>getters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> getters<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>_mutations <span class="token operator">=</span> mutations    <span class="token keyword">this</span><span class="token punctuation">.</span>_actions <span class="token operator">=</span> actions  <span class="token punctuation">}</span>  <span class="token function">commit</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>_mutations<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>_actions<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// install方法可以接受两个参数，一个是Vue构造函数，另外一个是额外的选项，这里只需要Vue构造函数</span><span class="token keyword">function</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  _Vue <span class="token operator">=</span> Vue  _Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 首先判断当前Vue实例的$options中是否有store，如果是组件实例的话没有store选项，就不需要做这件事</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>store<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 这里注册插件的时候会混入beforeCreate，当创建根实例的时候就会把$store注入到Vue实例上</span>        <span class="token class-name">_Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$store <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>store      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  Store<span class="token punctuation">,</span>  install<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="使用自己实现的Vuex"><a href="#使用自己实现的Vuex" class="headerlink" title="使用自己实现的Vuex"></a>使用自己实现的Vuex</h3><p><code>src/store/index.js</code> 中修改导入 <code>Vuex</code> 的路径，测试</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'../myvuex'</span><span class="token comment">// 注册插件</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vuex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.js 源码剖析-响应式原理、虚拟 DOM、模板编译和组件化</title>
      <link href="2021/071840057.html"/>
      <url>2021/071840057.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-请简述Vue首次渲染过程"><a href="#1-请简述Vue首次渲染过程" class="headerlink" title="1.请简述Vue首次渲染过程"></a>1.请简述Vue首次渲染过程</h2><h3 id="1-实例创建完成后，调用-mount-方法"><a href="#1-实例创建完成后，调用-mount-方法" class="headerlink" title="1.实例创建完成后，调用$mount()方法"></a>1.实例创建完成后，调用<code>$mount()</code>方法</h3><p>完整版中会先调用<code>src/platforms/web/entry-runtime-with-compiler.js</code>中重写的<code>$mount()</code>(即进行模板编译)，其中：</p><ul><li>先判断<code>options</code>中是否有<code>render</code>，如果没有传递<code>render</code>，调用<code>compileToFunctions()</code>，生成render()函数</li><li>然后设置<code>options.render = render</code></li></ul><p>然后调用原来的<code>$mount()</code>（在<code>src/platform/web/runtime/index.js</code>中定义），其中会调用<code>mountComponent(this, el, hydrating)</code></p><h3 id="2-mountComponent-this-el-hydrating"><a href="#2-mountComponent-this-el-hydrating" class="headerlink" title="2.mountComponent(this, el, hydrating)"></a>2.mountComponent(this, el, hydrating)</h3><ul><li>触发<code>beforeMount：callHook</code>(vm, ‘beforeMount’)`</li><li>定义函数<code>updateComponent = () =&gt; { vm._update(vm._render(), hydrating) }</code><ul><li><code>vm._render()</code>生成虚拟DOM（<code>vm._render()</code>定义在<code>src/core/instance/render.js</code>中）</li><li><code>vm._update()</code>将虚拟DOM转换成真是DOM(<code>vm._update()</code>定义在<code>src/core/instance/lifecycle.js</code>中)</li></ul></li><li>创建<code>Watcher</code>实例，把<code>updateComponent</code>传递进去，<code>updateComponent</code>是在<code>Watcher</code>中通过<code>Watcher</code>的<code>get()</code>实例方法执行的</li><li>触发<code>mounted</code>；返回实例<code>return vm</code></li></ul><h3 id="3-watcher-get"><a href="#3-watcher-get" class="headerlink" title="3.watcher.get()"></a>3.watcher.get()</h3><p>首次渲染创建的是渲染<code>Watcher</code>，创建完<code>Watcher</code>实例后会调用一个get()方法，<code>get()</code>中会调用<code>updateComponent()</code>，<code>updateComponent()</code>中会调用<code>vm._update(VNode. hydrating)</code>，而其中的<code>VNode</code>是调用<code>vm._render()</code>创建<code>VNode</code></p><p><code>vm._render()</code>的执行过程：</p><ul><li>获取创建实例时存放在<code>options</code>中的<code>render</code>函数：<code>const { render, _parentVnode } = vm.$options</code></li><li>调用<code>render.call(vm.renderProxy, vm.$createElement)</code>（这个<code>render</code>是创建实例<code>new Vue()</code>时传入的<code>render()</code>，或者是编译<code>template</code>生成的<code>render()</code>），最后返回<code>VNode</code></li></ul><p>然后执行<code>vm._update(VNode, hydrating)</code>，其中：</p><ul><li>调用<code>vm.__patch__(vm.$el, vnode)</code>挂载真实<code>DOM</code></li><li>将<code>vm.__patch__</code>的返回值记录在<code>vm.$el</code>中</li></ul><hr><h2 id="2-请简述-Vue-响应式原理"><a href="#2-请简述-Vue-响应式原理" class="headerlink" title="2.请简述 Vue 响应式原理"></a>2.请简述 Vue 响应式原理</h2><p>Vue使用观察者模式来对其数据进行响应式处理，过程如下：</p><h3 id="创建观察者"><a href="#创建观察者" class="headerlink" title="创建观察者"></a>创建观察者</h3><ul><li><p>在创建 <code>Vue</code> 实例时，调用的 <code>this._init(options)</code> 中会执行 <code>initInjections(vm)</code>、<code>initState(vm)</code>，这两个方法中分别会对 <code>inject</code> 的成员、本实例的 <code>props</code> 和 <code>data</code> 进行响应式处理</p></li><li><p><code>initInjections(vm)</code> 中会遍历 <code>inject</code> 的成员，通过 <code>defineReactive(vm, key, result[key])</code> 将每个成员转换成响应式属性（即劫持 <code>getter/setter</code>）</p></li><li><p><code>initState(vm)</code> 中调用 <code>initProps(vm, opts.props)</code>，其中编辑 <code>props</code> 属性，通过 <code>defineReactive(props, key, value)</code> 将属性转换成<code>getter</code>、<code>setter</code>，然后存入 <code>props</code>（也是 <code>vm._props</code>）中</p></li><li><p><code>initState(vm)</code> 中调用 <code>initData(vm, opts.props)</code>，其中调用 <code>observe(data, true /* asRootData */)</code> 对 <code>data</code> 进行响应式处理</p></li><li><p><code>defineReactive(obj, key, val, customSetter?, shallow?)</code></p><ul><li>会将传入的 <code>key</code> 换成响应式属性，即其劫持 <code>getter/setter</code> （ <code>Object.defineProperty( obj, key, { ..., get(){...}, set(){...} } )</code> ）</li><li>为每个属性 <code>key</code> 生成一个 <code>Dep</code> 对象 <code>dep</code>（<code>const dep = new Dep()</code>）；<code>dep</code> 会在 <code>getter</code> 中收集依赖（即相应属性的 <code>Watcher</code> 对象），在 <code>setter</code> 中调用 <code>dep.notify()</code> 派发更新；</li><li>在需要递归观察子对象时，会调用 <code>observe(val)</code>（<code>let childOb = !shallow &amp;&amp; observe(val)</code>），若 <code>val</code> 是个对象，则会为这个对象创建一个 <code>Observer</code> 对象，并返回。</li></ul></li><li><p><code>observe (value, asRootData?)</code></p><ul><li>判断 <code>value</code> 是否是对象，不是对象就返回</li><li>是对象，则这个对象可称之为 观测对象 ，然后为这个对象创建一个 <code>Observer</code> 对象 ：<code>ob = new Observer(value)</code>，并返回 <code>ob</code>（在 <code>defineReactive</code> 中，这个返回的 <code>ob</code> 会在 <code>getter</code> 中收集依赖相应的依赖）</li><li><code>Observer</code> 构造函数中，会新建一个 <code>Dep</code> 对象 <code>dep</code>，这里的 <code>dep</code> 是为传入的 观测对象（进行响应式处理的对象）收集依赖（<code>Watcher</code>）；与 <code>defineReactive</code> 中的 <code>dep</code> 不一样</li><li>将 <code>Observer</code> 实例挂载到 观测对象 的 <code>__ob__</code> 属性：<code>def(value, '__ob__', this)</code></li><li>若 <code>value</code> 不是数组，则执行 <code>this.walk(value)</code> 方法，遍历 <code>value</code> 中的每一个属性，然后调用 <code>defineReactive(obj, keys[i])</code></li><li>若 <code>value</code> 是数组<ul><li><code>Vue</code> 并没有对数组对象的索引调用 <code>defineReactive</code> 来生成 <code>getter/setter</code>，而是重写了原生数组中会更改原数组的方法，调用这些新方法后，数组对象对应的 <code>dep</code> 对象会调用 dep.notify 方法来驱动视图的更新</li><li>重写的数组方法：<code>'push'， 'pop', 'shift', 'unshift', 'splice', 'sort', 'reverse'</code></li><li>重写数组方法后，调用 <code>this.observeArray(value)</code>，作用是当数组中的元素存在对象时，为数组中的每一个对象创建一个 <code>observer</code> 实例</li></ul></li></ul></li></ul><p>至此，创建观察者结束</p><h3 id="依赖的收集"><a href="#依赖的收集" class="headerlink" title="依赖的收集"></a>依赖的收集</h3><ul><li>在进行挂载时（ 调用 <code>$mount()</code> ），会执行 <code>mountComponent</code> 方法，其中会创建一个渲染 <code>Watcher</code> 对象</li><li>渲染 <code>Watcher</code> 对象构造函数的最后会执行 <code>get()</code> 方法，<code>get()</code> 中会先执行 <code>pushTarget(this)</code>，<code>pushTarget</code> 中则会将 Dep.target 设置为该 <code>watcher</code>（<code>Dep.target = target</code>）</li><li>然后调用 <code>this.getter.call(vm, vm)</code>，即执行了 <code>vm._update(vm._render(), hydrating)</code>，而 <code>vm._render()</code> 中执行 <code>render.call(vm._renderProxy, vm.$createElement)</code> 以生成 <code>vnode</code>，这个生成 <code>VNode</code> 的过程中，会触发 相应的响应式数据的 <code>getter</code> ，然后其中的 <code>dep.depend()</code> 则会收集当前实例 <code>watcher</code></li></ul><p>当生成完 <code>VNode</code> 后，就完成了响应式数据的的依赖收集</p><h3 id="通知的发送"><a href="#通知的发送" class="headerlink" title="通知的发送"></a>通知的发送</h3><p>但修改某个响应式数据时，会触发该数据的 <code>setter</code></p><ul><li>如果新值是对象，且需要递归观察子对象时执行 <code>childOb = !shallow &amp;&amp; observe(newVal)</code>，将新增也进行响应式处理</li><li>调用 <code>dep.notify()</code> 派发更新，<code>notify</code> 会调用每个订阅者（<code>watcher</code>）的 <code>update</code> 方法实现更新</li><li><code>watcher</code> 的 <code>update</code> 中使用 <code>queueWatcher()</code> 判断 <code>watcher</code> 是否被处理，若没有，则把 <code>watcher</code> 添加进 <code>queue</code> 队列中，并调用 <code>flushSchedulerQueue()</code></li><li><code>flushSchedulerQueue()</code> 中先触发 <code>beforeUpdate</code> 钩子函数，然后调用 <code>watcher.run()</code></li><li><code>watcher.run()</code> 中会调用 <code>get()</code> 方法，<code>get</code> 中执行 <code>getter</code>，而 <code>getter</code> 就是传入的 <code>updateComponent</code> 方法，<code>updateComponent</code> 中执行 <code>vm._update(vm._render(), hydrating)</code>，如此就完成了视图的更新</li><li>然后 <code>flushSchedulerQueue()</code> 后续代码中 还原更新步骤的初始状态、触发 <code>actived</code> 钩子函数、触发 <code>updated</code> 钩子函数</li></ul><hr><h2 id="3-请简述虚拟-DOM-中-Key-的作用和好处"><a href="#3-请简述虚拟-DOM-中-Key-的作用和好处" class="headerlink" title="3.请简述虚拟 DOM 中 Key 的作用和好处"></a>3.请简述虚拟 DOM 中 Key 的作用和好处</h2><p><code>Key</code> 是用来优化 <code>Diff</code> 算法的。<code>Diff</code>算法核心在于同层次节点比较，<code>Key</code> 就是用于在比较同层次新、旧节点时，判断其是否相同。</p><p><code>Key</code> 一般用于生成一列同类型节点时使用，这种情况下，当修改这些同类型节点的某个内容、变更位置、删除、添加等时，此时界面需要更新视图，<code>Vue</code> 会调用 <code>patch</code> 方法通过对比新、旧节点的变化来更新视图。其从根节点开始若新、旧 <code>VNode</code> 相同，则调用 <code>patchVnode</code></p><p><code>patchVnode</code> 中若新节点没有文本，且新节点和旧节点都有有子节点，则需对子节点进行 <code>Diff</code> 操作，即调用 <code>updateChildren</code>，<code>Key</code> 就在 <code>updateChildren</code> 起了大作用</p><p><code>updateChildren</code> 中会遍历对比上步中的新、旧节点的子节点，并按 Diff 算法通过 <code>sameVnode</code> 来判断要对比的节点是否相同</p><ul><li>若这里的子节点未设置 <code>Key</code>，则此时的每个新、旧子节点在执行 <code>sameVnode</code> 时会判定相同，然后再次执行一次 <code>patchVnode</code> 来对比这些子节点的子节点</li><li>若设置了 <code>Key</code>，当执行 <code>sameVnode</code><ul><li>若 <code>Key</code> 不同 <code>sameVnode</code> 返回 <code>false</code>，然后执行后续判断；</li><li>若 <code>Key</code> 相同 <code>sameVnode</code> 返回 <code>true</code>，然后再执行 patchVnode 来对比这些子节点的子节点</li></ul></li></ul><p>即，使用了 <code>Key</code> 后，可以优化新、旧节点的对比判断，减少了遍历子节点的层次，少使用很多次 <code>patchVnode</code></p><hr><h2 id="4-请简述-Vue-中模板编译的过程"><a href="#4-请简述-Vue-中模板编译的过程" class="headerlink" title="4.请简述 Vue 中模板编译的过程"></a>4.请简述 Vue 中模板编译的过程</h2><h3 id="Vue-模板编译入口文件执行过程"><a href="#Vue-模板编译入口文件执行过程" class="headerlink" title="Vue 模板编译入口文件执行过程"></a>Vue 模板编译入口文件执行过程</h3><p>在完整版 Vue 中，<code>src/platforms/web/entry-runtime-with-compiler.js</code> 里先保留 <code>Vue</code> 实例的 <code>mount</code>方法，然后重写该<code>mount</code>方法，然后重写该<code>mount</code> 方法，这个重写的方法就是完整版 <code>Vue</code> 中的模板编译器，其中在 <code>$options</code> 上挂载了模板编译后生成的 <code>render</code> 函数。</p><p><code>$options</code> 上的 <code>render</code> 函数是由 <code>compileToFunctions(template, options, vm)</code> 这个函数生成，即将 <code>template</code> 转换成了 <code>render</code> 函数。所以这里就是完成了首次加载时对模板的编译。</p><p>这里梳理下生成 <code>render</code> 函数的相关函数的调用过程</p><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>调用 <code>compileToFunctions(template, options, vm)</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/platforms/web/entry-runtime-with-compiler.js </span><span class="token comment">// 把 template 转换成 render 函数</span><span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> staticRenderFns <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>  outputSourceRange<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">,</span>  shouldDecodeNewlines<span class="token punctuation">,</span>  shouldDecodeNewlinesForHref<span class="token punctuation">,</span>  delimiters<span class="token operator">:</span> options<span class="token punctuation">.</span>delimiters<span class="token punctuation">,</span>  comments<span class="token operator">:</span> options<span class="token punctuation">.</span>comments<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>options<span class="token punctuation">.</span>render <span class="token operator">=</span> renderoptions<span class="token punctuation">.</span>staticRenderFns <span class="token operator">=</span> staticRenderFns<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><p><code>compileToFunctions</code> 是由 src/platforms/web/compiler/index.js 里的 <code>createCompiler(baseOptions)</code> 生成的。<code>baseOptions</code> 里是一些关于指令、模块、HTML标签相关的方法，这里不予关心。</p><p>所以 <strong>第一步</strong> 中 <code>compileToFunctions</code> 是这里的 <code>createCompiler</code> 返回的函数。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/platforms/web/compiler/index.js</span><span class="token keyword">import</span> <span class="token punctuation">{</span> baseOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./options'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> createCompiler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'compiler/index'</span><span class="token keyword">const</span> <span class="token punctuation">{</span> compile<span class="token punctuation">,</span> compileToFunctions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createCompiler</span><span class="token punctuation">(</span>baseOptions<span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token punctuation">{</span> compile<span class="token punctuation">,</span> compileToFunctions <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><p><code>createCompiler</code> 来自于 src/compiler/index.js，其中调用了 <code>createCompilerCreator(function baseCompile (template, options))</code> 方法</p><p>所以 <strong>第二步</strong> 中的 <code>createCompiler</code> 来自于这里的 <code>createCompilerCreator</code> 返回的函数，<code>createCompilerCreator</code> 中传入 函数 <code>baseCompile</code> 作为参数</p><p>那么 <strong>第一步</strong> 中的 <code>compileToFunctions</code> 就是这里的 <code>createCompilerCreator</code> 返回的函数执行（即执行 <code>createCompiler(baseOptions)</code>）后返回的函数</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/compiler/index.js</span><span class="token keyword">export</span> <span class="token keyword">const</span> createCompiler <span class="token operator">=</span> <span class="token function">createCompilerCreator</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">baseCompile</span> <span class="token punctuation">(</span>  <span class="token parameter">template<span class="token operator">:</span> string<span class="token punctuation">,</span>  options<span class="token operator">:</span> CompilerOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> CompiledResult <span class="token punctuation">{</span>  <span class="token comment">// 把模板转换成 ast 抽象语法树</span>  <span class="token comment">// 抽象语法树，用来以树形的方式描述代码结构</span>  <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>optimize <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 优化抽象语法树</span>    <span class="token function">optimize</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 把抽象语法树生成字符串形式的 js 代码</span>  <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    ast<span class="token punctuation">,</span>    <span class="token comment">// 渲染函数</span>    render<span class="token operator">:</span> code<span class="token punctuation">.</span>render<span class="token punctuation">,</span>    <span class="token comment">// 静态渲染函数，生成静态 VNode 树</span>    staticRenderFns<span class="token operator">:</span> code<span class="token punctuation">.</span>staticRenderFns  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h3><p><code>createCompilerCreator</code> 来自于 <code>src/compiler/create-compiler.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/compiler/create-compiler.js</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createCompilerCreator</span> <span class="token punctuation">(</span><span class="token parameter">baseCompile<span class="token operator">:</span> Function</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">createCompiler</span> <span class="token punctuation">(</span><span class="token parameter">baseOptions<span class="token operator">:</span> CompilerOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">function</span> <span class="token function">compile</span> <span class="token punctuation">(</span>          <span class="token parameter">template<span class="token operator">:</span> string<span class="token punctuation">,</span>          options<span class="token operator">?</span><span class="token operator">:</span> CompilerOptions</span>        <span class="token punctuation">)</span><span class="token operator">:</span> CompiledResult <span class="token punctuation">{</span>            <span class="token keyword">const</span> finalOptions <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>baseOptions<span class="token punctuation">)</span>            <span class="token operator">...</span><span class="token punctuation">.</span>            <span class="token keyword">const</span> compiled <span class="token operator">=</span> <span class="token function">baseCompile</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> finalOptions<span class="token punctuation">)</span>            <span class="token operator">...</span>            <span class="token keyword">return</span> compiled        <span class="token punctuation">}</span>                <span class="token keyword">return</span> <span class="token punctuation">{</span>          compile<span class="token punctuation">,</span>          compileToFunctions<span class="token operator">:</span> <span class="token function">createCompileToFunctionFn</span><span class="token punctuation">(</span>compile<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看出这个函数返回了 <code>createCompiler(baseOptions)</code> 函数，则往上推可知 <strong>第二步</strong> 中的</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/platforms/web/compiler/index.js</span><span class="token keyword">const</span> <span class="token punctuation">{</span> compile<span class="token punctuation">,</span> compileToFunctions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createCompiler</span><span class="token punctuation">(</span>baseOptions<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其实就是执行的这里的 <code>function createCompiler (baseOptions: CompilerOptions){...}</code>，这个 <code>createCompiler</code> 函数里返回了方法 <code>compile、compileToFunctions</code></p><p>方法 <code>compile</code> 中执行了传入的函数参数 <code>baseCompile</code>，这个 <code>baseCompile</code> 是 <strong>第三步</strong> 中传入的，其返回值为 <code>ast、render、staticRenderFns</code></p><p>而方法 <code>compileToFunctions</code> 正是 <strong>第一步</strong> 中调用的 <code>compileToFunctions(template, options, vm)</code>，其来自于 <code>createCompileToFunctionFn(compile)</code></p><h3 id="第五步"><a href="#第五步" class="headerlink" title="第五步"></a>第五步</h3><p><code>createCompileToFunctionFn</code> 来自于 <code>src/compiler/to-function.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/compiler/to-function.js</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createCompileToFunctionFn</span> <span class="token punctuation">(</span><span class="token parameter">compile<span class="token operator">:</span> Function</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">compileToFunctions</span> <span class="token punctuation">(</span>        <span class="token parameter">template<span class="token operator">:</span> string<span class="token punctuation">,</span>        options<span class="token operator">?</span><span class="token operator">:</span> CompilerOptions<span class="token punctuation">,</span>        vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>      <span class="token punctuation">)</span><span class="token operator">:</span> CompiledFunctionResult <span class="token punctuation">{</span>        <span class="token operator">...</span>                <span class="token comment">// 1. 读取缓存中的 CompiledFunctionResult 对象，如果有直接返回</span>        <span class="token keyword">const</span> key <span class="token operator">=</span> options<span class="token punctuation">.</span>delimiters          <span class="token operator">?</span> <span class="token function">String</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>delimiters<span class="token punctuation">)</span> <span class="token operator">+</span> template          <span class="token operator">:</span> template        <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">}</span>                <span class="token comment">// 2. 把模板编译为编译对象(render, staticRenderFns)，字符串形式的js代码</span>        <span class="token keyword">const</span> compiled <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> options<span class="token punctuation">)</span>                <span class="token comment">// 3. 把字符串形式的js代码转换成js方法</span>        res<span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token function">createFunction</span><span class="token punctuation">(</span>compiled<span class="token punctuation">.</span>render<span class="token punctuation">,</span> fnGenErrors<span class="token punctuation">)</span>        res<span class="token punctuation">.</span>staticRenderFns <span class="token operator">=</span> compiled<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">code</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token function">createFunction</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> fnGenErrors<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token comment">// 4. 缓存并返回res对象(render, staticRenderFns方法)</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>createCompileToFunctionFn</code> 返回函数 <code>compileToFunctions</code>，即 <strong>第四步</strong> 中 <code>createCompiler</code> 函数返回的 <code>compileToFunctions</code>，所以是 <strong>第一步</strong> 中调用的 <code>compileToFunctions</code> 就是在执行这里的 <code>compileToFunctions</code>。</p><h3 id="总结过程"><a href="#总结过程" class="headerlink" title="总结过程"></a>总结过程</h3><ul><li>执行 <code>src/platforms/web/entry-runtime-with-compiler.js</code> 中的 <code>compileToFunctions(template, options, vm)</code></li><li>执行 <code>src/compiler/to-function.js</code> 中的 <code>compileToFunctions</code>，<code>compileToFunctions</code> 中调用 <code>compile(template, options)</code></li><li>执行 <code>src/compiler/create-compiler.js</code> 中的 <code>compile</code>，<code>compile</code> 中调用 <code>baseCompile(template.trim(), finalOptions)</code></li><li>执行 <code>src/compiler/index.js</code> 传入 <code>createCompilerCreator</code> 中的函数参数 baseCompile(template, options)，返回 <code>ast、render、staticRenderFns</code></li><li><code>src/compiler/create-compiler.js</code> 中 <code>const compiled = { ast、render、staticRenderFns }</code>，返回 <code>compiled</code></li><li><code>src/compiler/to-function.js</code> 中返回 <code>res</code>，即返回 <code>render, staticRenderFns</code> 方法</li><li><code>src/platforms/web/entry-runtime-with-compiler.js</code> 获取 <code>render、staticRenderFns</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue源码解析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.js 源码剖析-模板编译和组件化</title>
      <link href="2021/071650852.html"/>
      <url>2021/071650852.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue-js-源码剖析-模板编译和组件化"><a href="#Vue-js-源码剖析-模板编译和组件化" class="headerlink" title="Vue.js 源码剖析-模板编译和组件化"></a>Vue.js 源码剖析-模板编译和组件化</h1><h2 id="模板编译"><a href="#模板编译" class="headerlink" title="模板编译"></a>模板编译</h2><ul><li>模板编译的主要目的是将模板(<code>template</code>)转换为渲染函数(<code>render</code>)</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handler<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>some content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>渲染函数<ul><li>h()函数的作用最终回到用vm.$createElmnent()生成VNode</li></ul></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> on<span class="token operator">:</span> <span class="token punctuation">{</span> click<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'some content'</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>模板编译的作用<ul><li>Vue2.x使用VNode描述视图以及各种交互，用户自己编写VNode比较复杂</li><li>用户只需要编写类似HTML的代码（Vue模板），通过编译器将模板转换为返回VNode的<code>render</code>函数</li><li>.vue文件会被webpack在构建过程中转换成<code>render</code>函数。<code>webpack</code>本身不支持把模板编译成<code>render</code>函数，其内部使用<code>vue-loader</code>进行操作。</li><li>根据编译时间，可以把编译过程分为运行时编译和构建时编译<ul><li>运行时编译<ul><li>前提：必须使用完整版的Vue，因为完整版的Vue才带编译器。在项目运行的过程中把模板编译成<code>render</code>函数</li><li>缺点：Vue体积大，运行速度慢</li></ul></li><li>构建时编译<ul><li>vue-cli创建的项目，默认加载的是运行版本的Vue，不带编译器，体积小</li><li>优点：<code>webpack</code>+<code>vue-loader</code>把模板编译成<code>render</code>函数，加载运行时版本的vue体积小，不需要额外的操作，所以速度快</li></ul></li></ul></li></ul></li></ul><h3 id="体验模板编译的结果"><a href="#体验模板编译的结果" class="headerlink" title="体验模板编译的结果"></a>体验模板编译的结果</h3><ul><li><p>带编译器版本的Vue.js，使用<code>template</code>或<code>el</code>的方式设置模板</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Vue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>模板编译过程<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp</span> <span class="token attr-name">@myclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handler<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../../dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'comp'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>      template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;I am a comp&lt;/div&gt;'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token operator">:</span> <span class="token punctuation">{</span>        msg<span class="token operator">:</span> <span class="token string">'Hello compiler'</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      methods<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token function">handler</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>render<span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>编译后<code>render</code>输出的结果</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// with的作用是在使用with的代码块中，使用this时可以省略this。this._v/this._c......</span>  <span class="token keyword">with</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span>      <span class="token string">"div"</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>attrs<span class="token operator">:</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token string">"app"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">[</span>        <span class="token function">_m</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// renderStatic，对应模板的h1标签</span>        <span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// createTextVNode  创建h1标签与p标签之间的空白文本节点</span>        <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// createElement(createTextVNode(toString(msg)))</span>        <span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// createTextVNode(" ")</span>        <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">"comp"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>on<span class="token operator">:</span> <span class="token punctuation">{</span>myclick<span class="token operator">:</span> handler<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// createElement()</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token number">1</span>  <span class="token comment">// 如果children为二维数组，则将其拍平为一维数组</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>_c是createElement()方法，定义的位置instance/render.js中</p><ul><li><img src="http://5coder.cn/img/Snipaste_2021-07-13_14-46-59.png"></li></ul></li><li><p>相关的渲染函数(_开头的方法定义)，在instance/render-helps/index.js</p></li><li><p>installRenderHelpers(target:any)</p><ul><li><img src="http://5coder.cn/img/Snipaste_2021-07-13_14-49-43.png"></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">installRenderHelpers</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  target<span class="token punctuation">.</span>_o <span class="token operator">=</span> markOnce  target<span class="token punctuation">.</span>_n <span class="token operator">=</span> toNumber  target<span class="token punctuation">.</span>_s <span class="token operator">=</span> toString  <span class="token comment">// toString函数</span>  target<span class="token punctuation">.</span>_l <span class="token operator">=</span> renderList  target<span class="token punctuation">.</span>_t <span class="token operator">=</span> renderSlot  target<span class="token punctuation">.</span>_q <span class="token operator">=</span> looseEqual  target<span class="token punctuation">.</span>_i <span class="token operator">=</span> looseIndexOf  target<span class="token punctuation">.</span>_m <span class="token operator">=</span> renderStatic  <span class="token comment">// 处理静态内容</span>  target<span class="token punctuation">.</span>_f <span class="token operator">=</span> resolveFilter  target<span class="token punctuation">.</span>_k <span class="token operator">=</span> checkKeyCodes  target<span class="token punctuation">.</span>_b <span class="token operator">=</span> bindObjectProps  target<span class="token punctuation">.</span>_v <span class="token operator">=</span> createTextVNode  <span class="token comment">// 创建文本VNode节点</span>  target<span class="token punctuation">.</span>_e <span class="token operator">=</span> createEmptyVNode  target<span class="token punctuation">.</span>_u <span class="token operator">=</span> resolveScopedSlots  target<span class="token punctuation">.</span>_g <span class="token operator">=</span> bindObjectListeners  target<span class="token punctuation">.</span>_d <span class="token operator">=</span> bindDynamicKeys  target<span class="token punctuation">.</span>_p <span class="token operator">=</span> prependModifier<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><code>target._v = createTextVNode</code>–&gt;src/core/vdom/vnode.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createTextVNode</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> string <span class="token operator">|</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token function">String</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><code>target._s = toString</code>–&gt;src/shared/util.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">toString</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>  <span class="token keyword">return</span> val <span class="token operator">==</span> <span class="token keyword">null</span>    <span class="token operator">?</span> <span class="token string">''</span>    <span class="token operator">:</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> val<span class="token punctuation">.</span>toString <span class="token operator">===</span> _toString<span class="token punctuation">)</span>      <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>      <span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>target._m = renderStatic</code>–&gt;instance/render-helps/render-static.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">renderStatic</span> <span class="token punctuation">(</span>  <span class="token parameter">index<span class="token operator">:</span> number<span class="token punctuation">,</span>  isInFor<span class="token operator">:</span> boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token operator">|</span> Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> cached <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_staticTrees <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_staticTrees <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> tree <span class="token operator">=</span> cached<span class="token punctuation">[</span>index<span class="token punctuation">]</span>  <span class="token comment">// if has already-rendered static tree and not inside v-for,</span>  <span class="token comment">// we can reuse the same tree.</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>tree <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isInFor<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> tree  <span class="token punctuation">}</span>  <span class="token comment">// otherwise, render a fresh tree.</span>  tree <span class="token operator">=</span> cached<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>_renderProxy<span class="token punctuation">,</span>    <span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token keyword">this</span> <span class="token comment">// for render fns generated for functional component templates</span>  <span class="token punctuation">)</span>  <span class="token function">markStatic</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">__static__</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> tree<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>把<code>template</code>转换成<code>render</code>的入口src/platform/web/entry-runtime-with-compiler.js，在<code>Vue.prototype.$mount</code>方法中</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 保留 Vue 实例的 $mount 方法</span><span class="token keyword">const</span> mount <span class="token operator">=</span> <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$mount<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>  el<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> Element<span class="token punctuation">,</span>  <span class="token comment">// 非ssr情况下为 false，ssr 时候为true</span>  hydrating<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">)</span><span class="token operator">:</span> Component <span class="token punctuation">{</span>  <span class="token comment">// 获取 el 对象</span>  el <span class="token operator">=</span> el <span class="token operator">&amp;&amp;</span> <span class="token function">query</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>  <span class="token comment">/* istanbul ignore if */</span>  <span class="token comment">// el 不能是 body 或者 html</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>el <span class="token operator">===</span> document<span class="token punctuation">.</span>body <span class="token operator">||</span> el <span class="token operator">===</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Do not mount Vue to &lt;html&gt; or &lt;body&gt; - mount to normal elements instead.</span><span class="token template-punctuation string">`</span></span>    <span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token keyword">this</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options  <span class="token comment">// resolve template/el and convert to render function</span>  <span class="token comment">// 把 template/el 转换成 render 函数</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> template <span class="token operator">=</span> options<span class="token punctuation">.</span>template    <span class="token comment">// 如果模板存在</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> template <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 如果模板是 id 选择器</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">// 获取对应的 DOM 对象的 innerHTML</span>          template <span class="token operator">=</span> <span class="token function">idToTemplate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>          <span class="token comment">/* istanbul ignore if */</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">warn</span><span class="token punctuation">(</span>              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Template element not found or is empty: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>template<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>              <span class="token keyword">this</span>            <span class="token punctuation">)</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 如果模板是元素，返回元素的 innerHTML</span>        template <span class="token operator">=</span> template<span class="token punctuation">.</span>innerHTML      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'invalid template option:'</span> <span class="token operator">+</span> template<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token comment">// 否则返回当前实例</span>        <span class="token keyword">return</span> <span class="token keyword">this</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果没有 template，获取el的 outerHTML 作为模板</span>      template <span class="token operator">=</span> <span class="token function">getOuterHTML</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">/* istanbul ignore if */</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">mark</span><span class="token punctuation">(</span><span class="token string">'compile'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token comment">// 把 template 转换成 render 函数</span>      <span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> staticRenderFns <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>        outputSourceRange<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">,</span>        shouldDecodeNewlines<span class="token punctuation">,</span>        shouldDecodeNewlinesForHref<span class="token punctuation">,</span>        delimiters<span class="token operator">:</span> options<span class="token punctuation">.</span>delimiters<span class="token punctuation">,</span>        comments<span class="token operator">:</span> options<span class="token punctuation">.</span>comments      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>      options<span class="token punctuation">.</span>render <span class="token operator">=</span> render      options<span class="token punctuation">.</span>staticRenderFns <span class="token operator">=</span> staticRenderFns      <span class="token comment">/* istanbul ignore if */</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">mark</span><span class="token punctuation">(</span><span class="token string">'compile end'</span><span class="token punctuation">)</span>        <span class="token function">measure</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> compile</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'compile'</span><span class="token punctuation">,</span> <span class="token string">'compile end'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// 调用 mount 方法，渲染 DOM</span>  <span class="token keyword">return</span> <span class="token function">mount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="Vue-Template-Explorer"><a href="#Vue-Template-Explorer" class="headerlink" title="Vue Template Explorer"></a>Vue Template Explorer</h3><ul><li><a href="https://template-explorer.vuejs.org/#%3Cdiv%20id%3D%22app%22%3E%0A%20%20%3Cselect%3E%0A%20%20%20%20%3Coption%3E%0A%20%20%20%20%20%20%7B%7B%20msg%20%20%7D%7D%0A%20%20%20%20%3C%2Foption%3E%0A%20%20%3C%2Fselect%3E%0A%20%20%3Cdiv%3E%0A%20%20%20%20hello%0A%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E">vue-template-explorer</a><ul><li>Vue2.6把模板编译成render函数的工具</li><li><img src="http://5coder.cn/img/Snipaste_2021-07-14_16-04-40.png"></li></ul></li><li><a href="https://vue-next-template-explorer.netlify.app/#%7B%22src%22%3A%22%3Cdiv%20id%3D%5C%22app%5C%22%3E%5Cn%20%20%3Cselect%3E%5Cn%20%20%20%20%3Coption%3E%5Cn%20%20%20%20%20%20%7B%7B%20msg%20%20%7D%7D%5Cn%20%20%20%20%3C%2Foption%3E%5Cn%20%20%3C%2Fselect%3E%5Cn%20%20%3Cdiv%3E%5Cn%20%20%20%20hello%5Cn%20%20%3C%2Fdiv%3E%5Cn%3C%2Fdiv%3E%22%2C%22options%22%3A%7B%22mode%22%3A%22module%22%2C%22filename%22%3A%22Foo.vue%22%2C%22prefixIdentifiers%22%3Afalse%2C%22hoistStatic%22%3Afalse%2C%22cacheHandlers%22%3Afalse%2C%22scopeId%22%3Anull%2C%22inline%22%3Afalse%2C%22ssrCssVars%22%3A%22%7B%20color%20%7D%22%2C%22compatConfig%22%3A%7B%22MODE%22%3A3%7D%2C%22whitespace%22%3A%22condense%22%2C%22bindingMetadata%22%3A%7B%22TestComponent%22%3A%22setup-const%22%2C%22setupRef%22%3A%22setup-ref%22%2C%22setupConst%22%3A%22setup-const%22%2C%22setupLet%22%3A%22setup-let%22%2C%22setupMaybeRef%22%3A%22setup-maybe-ref%22%2C%22setupProp%22%3A%22props%22%2C%22vMySetupDir%22%3A%22setup-const%22%7D%2C%22optimizeBindings%22%3Afalse%7D%7D">vue-next-template-explorer</a><ul><li>Vue3.0beta把模板编译成render函数的工具</li><li><img src="http://5coder.cn/img/Snipaste_2021-07-14_16-05-02.png"></li></ul></li></ul><p>通过观察编译生成的<code>render</code>函数，可以发现在Vue2的模板的时候，标签内的文本内容<strong>尽量不要添加空白的文本内容（空格、换行等）</strong>。而Vue3则没有要求，<strong>Vue3编译后的render函数已经去除了标签内多余的空白</strong>。</p><h2 id="模板编译过程"><a href="#模板编译过程" class="headerlink" title="模板编译过程"></a>模板编译过程</h2><ul><li>解析、优化、生成</li></ul><h3 id="编译的入口"><a href="#编译的入口" class="headerlink" title="编译的入口"></a>编译的入口</h3><ul><li><p>src\platforms\web\entry-runtime-with-compiler.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>  ……      <span class="token comment">// 把 template 转换成 render 函数</span>      <span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> staticRenderFns <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>        outputSourceRange<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">,</span>        shouldDecodeNewlines<span class="token punctuation">,</span>        shouldDecodeNewlinesForHref<span class="token punctuation">,</span>        delimiters<span class="token operator">:</span> options<span class="token punctuation">.</span>delimiters<span class="token punctuation">,</span>        comments<span class="token operator">:</span> options<span class="token punctuation">.</span>comments      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>      options<span class="token punctuation">.</span>render <span class="token operator">=</span> render      options<span class="token punctuation">.</span>staticRenderFns <span class="token operator">=</span> staticRenderFns   ……<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/Snipaste_2021-07-13_14-37-04.png"></p></li><li><p>调试<code>compileToFunctions()</code>执行过程，生成渲染函数的过程</p><ul><li><code>compileToFunctions:src/compiler/to-function.js</code></li><li><code>compile(template, options): src/compiler/create-compiler.js</code></li><li><code>baseCompile(template.trim(), finalOptions): src/compiler/index.js</code></li></ul></li><li><p><code>render</code>，<code>staticRenderFns</code>由<code>compileToFunction()</code>函数返回</p></li><li><p><code>compileToFunctions()</code>函数由<code>createCompiler()</code>函数返回</p><ul><li><code>createCompiler</code>函数传入参数<code>baseOptions</code><ul><li>baseOptions中导出options<ul><li><code>modules</code>：模块<ul><li><code>klass</code></li><li><code>style</code></li><li><code>model</code><ul><li>与<code>v-if</code>一起使用的<code>v-model</code></li></ul></li></ul></li><li><code>directives</code>：指令<ul><li><code>model</code>：处理<code>v-model</code></li><li><code>text</code>：处理<code>v-text</code></li><li><code>html</code>：处理<code>v-html</code></li></ul></li><li><code>isPreTag</code>：是否是Pre标签</li><li><code>isUnaryTag</code>：是否是一元标签（自闭和标签）</li><li><code>mustUseProp</code>：是否要放入el.prop中</li><li><code>canBeLeftOpenTag</code></li><li><code>isReservedTag</code>：是否是HTML中保留标签</li><li><code>getTagNamespase</code></li><li>…</li></ul></li></ul></li><li><code>createCompiler</code>函数由<code>createCompilerCreater()</code>函数返回</li><li><code>createCompilerCreater()</code>函数传入参数为<code>baseCompile()</code>函数<ul><li><code>baseCompile()</code>函数内容<ul><li>把模板转换成ast抽象语法树</li><li>抽象语法树，用来以树形的方式描述代码结构<ul><li>优化抽象语法树</li></ul></li><li>吧抽象语法树生成字符串形式的js代码</li><li>返回<ul><li><code>ast</code>对象</li><li>渲染函数<code>render</code></li><li>静态渲染函数，生成静态VNode树：<code>staticRenderFns</code></li></ul></li></ul></li><li><code>createCompilerCreater()</code>函数内容<ul><li>返回<code>createCompiler()</code>函数<ul><li><code>createCompiler()</code>函数内容<ul><li>定义<code>compile</code>函数，接受参数：模板<code>template</code>、用户传入的<code>options</code><ul><li><code>compile</code>函数中会把<code>createCompiler</code>函数中和平台相关的<code>baseOptions</code>与用户传入的<code>options</code>合并</li><li>然后调用<code>baseCompile()</code>函数，把合并后的选项参数<code>options</code>传递给它</li><li>最终返回compile函数和<code>compileToFunctions</code><ul><li>compileToFunctions()通过<code>createCompileToFunctionFn()</code>函数返回</li><li><strong><code>createCompileToFunctionFn()</code>函数就是模板编译的入口函数</strong></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p><img src="http://5coder.cn/img/%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%85%A5%E5%8F%A3.png" alt="模板编译入口"></p><h4 id="compileToFunctions"><a href="#compileToFunctions" class="headerlink" title="compileToFunctions"></a>compileToFunctions</h4><p><code>createCompilerCreator()</code></p><ul><li><p>参数：<code>baseCompile()</code>函数</p></li><li><p>返回：createCompiler()函数</p><ul><li><p><code>createCompiler()</code>函数中定义了compile()函数</p></li><li><p>返回：<code>compileToFunctions</code></p><ul><li><p><code>compileToFunctions</code>由函数<code>createCompileToFunctionFn()</code>函数返回</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createCompileToFunctionFn</span> <span class="token punctuation">(</span><span class="token parameter">compile<span class="token operator">:</span> Function</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>  <span class="token keyword">const</span> cache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">compileToFunctions</span> <span class="token punctuation">(</span>    <span class="token parameter">template<span class="token operator">:</span> string<span class="token punctuation">,</span>    options<span class="token operator">?</span><span class="token operator">:</span> CompilerOptions<span class="token punctuation">,</span>    vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>  <span class="token punctuation">)</span><span class="token operator">:</span> CompiledFunctionResult <span class="token punctuation">{</span>    <span class="token comment">// 合并options</span>    options <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>    <span class="token keyword">const</span> warn <span class="token operator">=</span> options<span class="token punctuation">.</span>warn <span class="token operator">||</span> baseWarn    <span class="token keyword">delete</span> options<span class="token punctuation">.</span>warn    <span class="token comment">/* istanbul ignore if */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// detect possible CSP restriction</span>      <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">'return 1'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">unsafe-eval|CSP</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">warn</span><span class="token punctuation">(</span>            <span class="token string">'It seems you are using the standalone build of Vue.js in an '</span> <span class="token operator">+</span>            <span class="token string">'environment with Content Security Policy that prohibits unsafe-eval. '</span> <span class="token operator">+</span>            <span class="token string">'The template compiler cannot work in this environment. Consider '</span> <span class="token operator">+</span>            <span class="token string">'relaxing the policy to allow unsafe-eval or pre-compiling your '</span> <span class="token operator">+</span>            <span class="token string">'templates into render functions.'</span>          <span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// check cache</span>    <span class="token comment">// 1. 读取缓存中的 CompiledFunctionResult 对象，如果有直接返回</span>    <span class="token comment">// 时间换空间，key为模板的内容</span>    <span class="token comment">// delimiters为插值表达式的符号{{}}</span>    <span class="token keyword">const</span> key <span class="token operator">=</span> options<span class="token punctuation">.</span>delimiters      <span class="token operator">?</span> <span class="token function">String</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>delimiters<span class="token punctuation">)</span> <span class="token operator">+</span> template      <span class="token operator">:</span> template    <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token punctuation">}</span>    <span class="token comment">// compile</span>    <span class="token comment">// 2. 把模板编译为编译对象(render, staticRenderFns)，字符串形式的js代码3</span>    <span class="token comment">// render中含有两个属性errors和tips</span>    <span class="token keyword">const</span> compiled <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> options<span class="token punctuation">)</span>    <span class="token comment">// check compilation errors/tips</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>compiled<span class="token punctuation">.</span>errors <span class="token operator">&amp;&amp;</span> compiled<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>outputSourceRange<span class="token punctuation">)</span> <span class="token punctuation">{</span>          compiled<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token function">warn</span><span class="token punctuation">(</span>              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error compiling template:\n\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>              <span class="token function">generateCodeFrame</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> e<span class="token punctuation">.</span>start<span class="token punctuation">,</span> e<span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">,</span>              vm            <span class="token punctuation">)</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token function">warn</span><span class="token punctuation">(</span>            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error compiling template:\n\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>template<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>            compiled<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">,</span>            vm          <span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>compiled<span class="token punctuation">.</span>tips <span class="token operator">&amp;&amp;</span> compiled<span class="token punctuation">.</span>tips<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>outputSourceRange<span class="token punctuation">)</span> <span class="token punctuation">{</span>          compiled<span class="token punctuation">.</span>tips<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">tip</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>msg<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          compiled<span class="token punctuation">.</span>tips<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">msg</span> <span class="token operator">=&gt;</span> <span class="token function">tip</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// turn code into functions</span>    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">const</span> fnGenErrors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment">// 3. 把字符串形式的js代码转换成js方法</span>    res<span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token function">createFunction</span><span class="token punctuation">(</span>compiled<span class="token punctuation">.</span>render<span class="token punctuation">,</span> fnGenErrors<span class="token punctuation">)</span>    res<span class="token punctuation">.</span>staticRenderFns <span class="token operator">=</span> compiled<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">code</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">createFunction</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> fnGenErrors<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// check function generation errors.</span>    <span class="token comment">// this should only happen if there is a bug in the compiler itself.</span>    <span class="token comment">// mostly for codegen development use</span>    <span class="token comment">/* istanbul ignore if */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>compiled<span class="token punctuation">.</span>errors <span class="token operator">||</span> <span class="token operator">!</span>compiled<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fnGenErrors<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">warn</span><span class="token punctuation">(</span>          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to generate render function:\n\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>          fnGenErrors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> err<span class="token punctuation">,</span> code <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> in\n\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          vm        <span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// 4. 缓存并返回res对象(render, staticRenderFns方法)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>函数核心：</p><ul><li>先去找缓存中编译的结果</li><li>如果有的话直接返回</li><li>如果没有的话开始编译（<code>compile()</code>）</li><li>并且把编译后的字符串的js代码转换成函数的形式（<code>createFunction()</code>）</li><li>缓存并且返回</li></ul></blockquote></li></ul></li></ul></li></ul><h4 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h4><ul><li>参数<ul><li>template模板</li><li>options选项（调用compileToFunctions时传入的选项，可以认为时用户传入的选项）</li></ul></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">compile</span> <span class="token punctuation">(</span>  <span class="token parameter">template<span class="token operator">:</span> string<span class="token punctuation">,</span>  options<span class="token operator">?</span><span class="token operator">:</span> CompilerOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> CompiledResult <span class="token punctuation">{</span>  <span class="token comment">// 合并options</span>  <span class="token keyword">const</span> finalOptions <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>baseOptions<span class="token punctuation">)</span>  <span class="token comment">// 存储编译过程中出现的错误和一些信息</span>  <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> tips <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">let</span> <span class="token function-variable function">warn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> range<span class="token punctuation">,</span> tip</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token punctuation">(</span>tip <span class="token operator">?</span> tips <span class="token operator">:</span> errors<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 开始合并baseOptions和options</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>outputSourceRange<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// $flow-disable-line</span>      <span class="token keyword">const</span> leadingSpaceLength <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length      <span class="token function-variable function">warn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> range<span class="token punctuation">,</span> tip</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> data<span class="token operator">:</span> WarningMessage <span class="token operator">=</span> <span class="token punctuation">{</span> msg <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>start <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            data<span class="token punctuation">.</span>start <span class="token operator">=</span> range<span class="token punctuation">.</span>start <span class="token operator">+</span> leadingSpaceLength          <span class="token punctuation">}</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>end <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            data<span class="token punctuation">.</span>end <span class="token operator">=</span> range<span class="token punctuation">.</span>end <span class="token operator">+</span> leadingSpaceLength          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token punctuation">(</span>tip <span class="token operator">?</span> tips <span class="token operator">:</span> errors<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// merge custom modules</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>modules<span class="token punctuation">)</span> <span class="token punctuation">{</span>      finalOptions<span class="token punctuation">.</span>modules <span class="token operator">=</span>        <span class="token punctuation">(</span>baseOptions<span class="token punctuation">.</span>modules <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>modules<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// merge custom directives</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>directives<span class="token punctuation">)</span> <span class="token punctuation">{</span>      finalOptions<span class="token punctuation">.</span>directives <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span>        Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>baseOptions<span class="token punctuation">.</span>directives <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        options<span class="token punctuation">.</span>directives      <span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// copy other options</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!==</span> <span class="token string">'modules'</span> <span class="token operator">&amp;&amp;</span> key <span class="token operator">!==</span> <span class="token string">'directives'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        finalOptions<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> options<span class="token punctuation">[</span>key<span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  finalOptions<span class="token punctuation">.</span>warn <span class="token operator">=</span> warn<span class="token comment">// 调用baseCompile()模板编译的核心函数</span>  <span class="token comment">// compiled为对象，两个成员render和staticRender，此时的render中存储的是字符串形式的代码，在入口函数中调用compileToFunctions中把字符串形式的js代码转换成函数</span>  <span class="token keyword">const</span> compiled <span class="token operator">=</span> <span class="token function">baseCompile</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> finalOptions<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">detectErrors</span><span class="token punctuation">(</span>compiled<span class="token punctuation">.</span>ast<span class="token punctuation">,</span> warn<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  compiled<span class="token punctuation">.</span>errors <span class="token operator">=</span> errors  compiled<span class="token punctuation">.</span>tips <span class="token operator">=</span> tips  <span class="token keyword">return</span> compiled<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>核心作用：</p><ul><li>合并选项</li><li>调用baseCompile()进行编译</li><li>记录错误</li><li>返回编译好的对象</li></ul></blockquote><h4 id="baseCompile-AST"><a href="#baseCompile-AST" class="headerlink" title="baseCompile-AST"></a>baseCompile-AST</h4><p>baseCompile是模板编译的核心函数，主要做了三件事：</p><ul><li>把模板转换成ast抽象语法树</li><li>优化抽象语法树</li><li>把抽象语法树生成字符串形式的 js 代码</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> createCompiler <span class="token operator">=</span> <span class="token function">createCompilerCreator</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">baseCompile</span> <span class="token punctuation">(</span>  <span class="token parameter">template<span class="token operator">:</span> string<span class="token punctuation">,</span>  options<span class="token operator">:</span> CompilerOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> CompiledResult <span class="token punctuation">{</span>  <span class="token comment">// 把模板转换成 ast 抽象语法树</span>  <span class="token comment">// 抽象语法树，用来以树形的方式描述代码结构</span>  <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>optimize <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 优化抽象语法树</span>    <span class="token function">optimize</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 把抽象语法树生成字符串形式的 js 代码</span>  <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    ast<span class="token punctuation">,</span>    <span class="token comment">// 渲染函数</span>    render<span class="token operator">:</span> code<span class="token punctuation">.</span>render<span class="token punctuation">,</span>    <span class="token comment">// 静态渲染函数，生成静态 VNode 树</span>    staticRenderFns<span class="token operator">:</span> code<span class="token punctuation">.</span>staticRenderFns  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="解析-parse"><a href="#解析-parse" class="headerlink" title="解析-parse"></a>解析-parse</h3><blockquote><p>parse整体过程比较复杂，研究的投入与收获不成正比，这里简单介绍</p></blockquote><h4 id="什么抽象语法树"><a href="#什么抽象语法树" class="headerlink" title="什么抽象语法树"></a>什么抽象语法树</h4><ul><li>抽象语法树简称AST（Abstract Syntax Tree）</li><li>使用对象的形式描述树形的代码结构</li><li>此处的抽象语法树是用来描述树形结构的HTML字符串</li></ul><h4 id="为什么要使用抽象语法树"><a href="#为什么要使用抽象语法树" class="headerlink" title="为什么要使用抽象语法树"></a>为什么要使用抽象语法树</h4><ul><li><p>模板字符串转换成AST后，可以通过AST对模板做优化处理</p></li><li><p>标记模板中的静态内容，在patch的时候直接跳过静态内容</p></li><li><p>在patch的过程中，静态内容不需要对比和重新渲染</p></li><li><p>解释器将模板解析为抽象语法树AST，只有将模板解析成AST后，才能给予它做优化或生成代码字符串</p><ul><li><p>src/compiler/index.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token comment">// src/compiler/parser/index.js</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><p>查看得到的AST Tree</p><p><a href="https://astexplorer.net/#/gist/30f2bd28c9bbe0d37c2408e87cabdfcc/1cd0d49beed22d3fc8e2ade0177bb22bbe4b907c">astexplorer</a></p><p><img src="http://5coder.cn/img/image-20210717140315567.png"></p><ul><li><p>结构化指令的处理</p><ul><li><p>v-if最终生成单元表达式</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/compiler/parser/index.js</span><span class="token comment">// structural directives</span><span class="token comment">// 结构化的指令</span><span class="token comment">// v-for</span><span class="token function">processFor</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token function">processIf</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token function">processOnce</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token comment">// src\compiler\codegen\index.js</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genIf</span> <span class="token punctuation">(</span>  <span class="token parameter">el<span class="token operator">:</span> any<span class="token punctuation">,</span>  state<span class="token operator">:</span> CodegenState<span class="token punctuation">,</span>  altGen<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span>  altEmpty<span class="token operator">?</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>  el<span class="token punctuation">.</span>ifProcessed <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// avoid recursion</span>  <span class="token keyword">return</span> <span class="token function">genIfConditions</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>ifConditions<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> altGen<span class="token punctuation">,</span> altEmpty<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 最终调用 genIfConditions 生成三元表达式</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>v-if最终编译的结果</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">ƒ <span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>attrs<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">"id"</span><span class="token operator">:</span><span class="token string">"app"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>      <span class="token function">_m</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">_e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'comp'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>on<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">"myclick"</span><span class="token operator">:</span>onMyClick<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>v-if/v-for结构化指令只能在编译阶段处理，如果我们要在render函数处理条件或者循环只能使用js中deif和for</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'comp'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  data<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    msg<span class="token operator">:</span> <span class="token string">'my comp'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote></li></ul></li></ul><p><img src="http://5coder.cn/img/image-20210717144639230.png"></p><p>parseHTML</p><p><img src="http://5coder.cn/img/image-20210717145525408.png"></p><h4 id="parse整体过程"><a href="#parse整体过程" class="headerlink" title="parse整体过程"></a>parse整体过程</h4><ul><li>parse函数内容处理的过程中会依次去遍历HTML模板字符串，把HTML模板字符串转换成AST对象（普通对象）。HTML中属性和指令都会记录在AST对象中的相应属性上</li></ul><h3 id="优化-optimize"><a href="#优化-optimize" class="headerlink" title="优化-optimize"></a>优化-optimize</h3><ul><li><p>优化抽象语法树，检查子节点是否是纯静态节点</p></li><li><p>一旦检测到纯静态节点，例如：</p><p>hello整体是静态节点</p><p>永远不会更改的节点</p><ul><li>提升为敞亮，重新渲染的时候不再重新创建节点</li><li>在patch的时候跳过静态子树</li></ul></li></ul><p><img src="http://5coder.cn/img/image-20210717145729478.png"></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * Goal of the optimizer: walk the generated template AST tree * and detect sub-trees that are purely static, i.e. parts of * the DOM that never needs to change. * * Once we detect these sub-trees, we can: * * 1. Hoist them into constants, so that we no longer need to *    create fresh nodes for them on each re-render; * 2. Completely skip them in the patching process. */</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">optimize</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token operator">:</span> <span class="token operator">?</span>ASTElement<span class="token punctuation">,</span> options<span class="token operator">:</span> CompilerOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token keyword">return</span>  isStaticKey <span class="token operator">=</span> <span class="token function">genStaticKeysCached</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>staticKeys <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span>  isPlatformReservedTag <span class="token operator">=</span> options<span class="token punctuation">.</span>isReservedTag <span class="token operator">||</span> no  <span class="token comment">// first pass: mark all non-static nodes.</span>  <span class="token comment">// 标记静态节点</span>  <span class="token function">markStatic</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>  <span class="token comment">// second pass: mark static roots.</span>  <span class="token comment">// 标记静态根节点</span>  <span class="token function">markStaticRoots</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/image-20210717150507115.png"></p><p><img src="http://5coder.cn/img/image-20210717150528294.png"></p><p><img src="http://5coder.cn/img/image-20210717150556724.png"></p><blockquote><p>optimize中只是去标记AST对象及其子对象的静态节点和静态根节点。静态根节点指的是：标签中包含<strong>子标签</strong>并且<strong>没有动态内容</strong>，也即是里面为纯文本内容。如果标签中<strong>只包含纯文本内容</strong>没有子标签，Vue中是不会对它做优化的，因为优化的成本大于收益。</p></blockquote><h3 id="生成-generate"><a href="#生成-generate" class="headerlink" title="生成-generate"></a>生成-generate</h3><ul><li><p>src/compiler/index.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>src/compiler/codegen/index.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">generate</span> <span class="token punctuation">(</span>  <span class="token parameter">ast<span class="token operator">:</span> ASTElement <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">,</span>  options<span class="token operator">:</span> CompilerOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> CodegenResult <span class="token punctuation">{</span>  <span class="token comment">// 代码创建过程中生成的state对象</span>  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CodegenState</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>  <span class="token keyword">const</span> code <span class="token operator">=</span> ast <span class="token operator">?</span> <span class="token function">genElement</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">'_c("div")'</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    render<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>    staticRenderFns<span class="token operator">:</span> state<span class="token punctuation">.</span>staticRenderFns  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>src/compiler/to-function.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createFunction</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> errors</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">try</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> err<span class="token punctuation">,</span> code <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> noop  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><img src="http://5coder.cn/img/image-20210718000035248.png"></p><h3 id="模板编译完整过程"><a href="#模板编译完整过程" class="headerlink" title="模板编译完整过程"></a>模板编译完整过程</h3><p><img src="http://5coder.cn/img/%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B.png" alt="模板编译过程"></p><blockquote><p>通过观察模板编译的源代码，我们可以了解到：</p><ul><li>模板编译的过程中会标记静态根节点，对静态根节点进行优化处理，重新渲染时不需要再处理静态根节点，因为它的内容不会改变。</li><li>再模板中不要写一些无意义的换行、空白字符，否则生成对应的AST对象会保留这些空白和换行，它们都会被存储到内存中。而这些空白和换行对浏览器渲染来说是没有任何意义的</li></ul></blockquote><h2 id="组件化机制"><a href="#组件化机制" class="headerlink" title="组件化机制"></a>组件化机制</h2><ul><li>组件化可以让我们方便的把页面拆分成多个可重用的组件</li><li>组件是独立的，系统内可重用，组件之间可以嵌套</li><li>有了组件就可以像搭积木一样开发网页</li><li>下面我们将从远吗的角度来分析Vue’zuijanneiburuhegongzuo<ul><li>组件实例的创建过程是从上而下</li><li>组件实例的挂载过程是从下而上</li></ul></li></ul><h3 id="组件声明"><a href="#组件声明" class="headerlink" title="组件声明"></a>组件声明</h3><ul><li><p>复习全局组件的定义方式</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">const</span> Comp <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'comp'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;Hello Component&lt;/div&gt;'</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>Comp<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Vue.component()</code>入口</p><ul><li><p>创建组件的构造函数，挂载到Vue实例的<code>vm.options.component.componentName = Ctor</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/core/global-api/index.js</span><span class="token comment">// 注册 Vue.directive()、 Vue.component()、Vue.filter()</span><span class="token function">initAssetRegisters</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/core/global-api/assets.js</span><span class="token comment">/* @flow */</span><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">ASSET_TYPES</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'shared/constants'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> isPlainObject<span class="token punctuation">,</span> validateComponentName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initAssetRegisters</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> GlobalAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">/**   * Create asset registration methods.   */</span>  <span class="token comment">// 遍历 ASSET_TYPES 数组，为 Vue 定义相应方法</span>  <span class="token comment">// ASSET_TYPES 包括了directive、 component、filter</span>  <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    Vue<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>      <span class="token parameter">id<span class="token operator">:</span> string<span class="token punctuation">,</span>      definition<span class="token operator">:</span> Function <span class="token operator">|</span> Object</span>    <span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token operator">|</span> Object <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>definition<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment">/* istanbul ignore if */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> type <span class="token operator">===</span> <span class="token string">'component'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">validateComponentName</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token comment">// Vue.component('comp', { template: '' })</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'component'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          definition<span class="token punctuation">.</span>name <span class="token operator">=</span> definition<span class="token punctuation">.</span>name <span class="token operator">||</span> id          <span class="token comment">// 把组件配置转换为组件的构造函数</span>          definition <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>_base<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'directive'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> definition <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          definition <span class="token operator">=</span> <span class="token punctuation">{</span> bind<span class="token operator">:</span> definition<span class="token punctuation">,</span> update<span class="token operator">:</span> definition <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">// 全局注册，存储资源并赋值</span>        <span class="token comment">// this.options['components']['comp'] = definition</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> definition        <span class="token keyword">return</span> definition      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/core/global-api/index.js</span><span class="token comment">// this is used to identify the "base" constructor to extend all plain-object</span><span class="token comment">// components with in Weex's multi-instance scenarios.</span>Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>_base <span class="token operator">=</span> Vue<span class="token comment">// src/core/global-api/extend.js</span>Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>组件构造函数的创建<code>Vue.extend()</code></p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* @flow */</span><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">ASSET_TYPES</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'shared/constants'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComputed<span class="token punctuation">,</span> proxy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../instance/state'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> extend<span class="token punctuation">,</span> mergeOptions<span class="token punctuation">,</span> validateComponentName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initExtend</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> GlobalAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">/**   * Each instance constructor, including Vue, has a unique   * cid. This enables us to create wrapped "child   * constructors" for prototypal inheriance and cache them.   */</span>  Vue<span class="token punctuation">.</span>cid <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> cid <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment">/**   * Class inheritance   */</span>  Vue<span class="token punctuation">.</span><span class="token function-variable function">extend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">extendOptions<span class="token operator">:</span> Object</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>    extendOptions <span class="token operator">=</span> extendOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment">// Vue 构造函数</span>    <span class="token keyword">const</span> Super <span class="token operator">=</span> <span class="token keyword">this</span>    <span class="token keyword">const</span> SuperId <span class="token operator">=</span> Super<span class="token punctuation">.</span>cid    <span class="token comment">// 从缓存中加载组件的构造函数</span>    <span class="token keyword">const</span> cachedCtors <span class="token operator">=</span> extendOptions<span class="token punctuation">.</span>_Ctor <span class="token operator">||</span> <span class="token punctuation">(</span>extendOptions<span class="token punctuation">.</span>_Ctor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> name <span class="token operator">=</span> extendOptions<span class="token punctuation">.</span>name <span class="token operator">||</span> Super<span class="token punctuation">.</span>options<span class="token punctuation">.</span>name    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果是开发环境验证组件的名称</span>      <span class="token function">validateComponentName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> <span class="token function-variable function">Sub</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">VueComponent</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 调用 _init() 初始化</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 原型继承自 Vue</span>    <span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Super</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>    <span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Sub    Sub<span class="token punctuation">.</span>cid <span class="token operator">=</span> cid<span class="token operator">++</span>    <span class="token comment">// 合并 options</span>    Sub<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>      Super<span class="token punctuation">.</span>options<span class="token punctuation">,</span>      extendOptions    <span class="token punctuation">)</span>    Sub<span class="token punctuation">[</span><span class="token string">'super'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Super    <span class="token comment">// For props and computed properties, we define the proxy getters on</span>    <span class="token comment">// the Vue instances at extension time, on the extended prototype. This</span>    <span class="token comment">// avoids Object.defineProperty calls for each instance created.</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">initProps</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">initComputed</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 继承Vue原型对象上的属性</span>    <span class="token comment">// allow further extension/mixin/plugin usage</span>    Sub<span class="token punctuation">.</span>extend <span class="token operator">=</span> Super<span class="token punctuation">.</span>extend    Sub<span class="token punctuation">.</span>mixin <span class="token operator">=</span> Super<span class="token punctuation">.</span>mixin    Sub<span class="token punctuation">.</span>use <span class="token operator">=</span> Super<span class="token punctuation">.</span>use    <span class="token comment">// create asset registers, so extended classes</span>    <span class="token comment">// can have their private assets too.</span>    <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      Sub<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> Super<span class="token punctuation">[</span>type<span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// enable recursive self-lookup</span>    <span class="token comment">// 把组件构造构造函数保存到 Ctor.options.components.comp = Ctor</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>      Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> Sub    <span class="token punctuation">}</span>    <span class="token comment">// keep a reference to the super options at extension time.</span>    <span class="token comment">// later at instantiation we can check if Super's options have</span>    <span class="token comment">// been updated.</span>    Sub<span class="token punctuation">.</span>superOptions <span class="token operator">=</span> Super<span class="token punctuation">.</span>options    Sub<span class="token punctuation">.</span>extendOptions <span class="token operator">=</span> extendOptions    Sub<span class="token punctuation">.</span>sealedOptions <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Sub<span class="token punctuation">.</span>options<span class="token punctuation">)</span>    <span class="token comment">// cache constructor</span>    <span class="token comment">// 把组件的构造函数缓存到 options._Ctor</span>    cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span> <span class="token operator">=</span> Sub    <span class="token keyword">return</span> Sub  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">initProps</span> <span class="token punctuation">(</span><span class="token parameter">Comp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> props <span class="token operator">=</span> Comp<span class="token punctuation">.</span>options<span class="token punctuation">.</span>props  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token class-name">Comp</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_props</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">initComputed</span> <span class="token punctuation">(</span><span class="token parameter">Comp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> computed <span class="token operator">=</span> Comp<span class="token punctuation">.</span>options<span class="token punctuation">.</span>computed  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">defineComputed</span><span class="token punctuation">(</span><span class="token class-name">Comp</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> key<span class="token punctuation">,</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>调试Vue.component()调用的过程</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>  <span class="token keyword">const</span> Comp <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'comp'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;Hello Component&lt;/div&gt;'</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>Comp<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="组件创建和挂载"><a href="#组件创建和挂载" class="headerlink" title="组件创建和挂载"></a>组件创建和挂载</h3><p>回顾首次渲染过程</p><ul><li>Vue构造函数  –&gt;调用<strong>↓</strong></li><li>this._init()  –&gt;调用<strong>↓</strong></li><li>this.$mount()  –&gt;调用<strong>↓</strong></li><li>mountCompunent()  –&gt;创建<strong>↓</strong></li><li>new Watcher() 渲染Watcher –&gt;传入updateComponent()<strong>↓</strong></li><li>updateComponent()  –&gt;调用<strong>↓</strong></li><li>vm._render() -&gt; createElement()</li><li>vm._update()</li></ul><p><img src="http://5coder.cn/img/image-20210718170139407.png"></p><h4 id="组件VNode的创建过程"><a href="#组件VNode的创建过程" class="headerlink" title="组件VNode的创建过程"></a>组件VNode的创建过程</h4><p><img src="http://5coder.cn/img/image-20210718170457685.png"></p><ul><li>创建根组件，首次_render()时，会得到整棵树的VNode结构</li><li>整体流程：<code>new Vue() --&gt; $mount() --&gt; vm._render() --&gt; createElement() --&gt; createComponent()</code></li><li>创建组件的VNode，初始化组件的hook钩子函数</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1._createElement()中调用了createComponent()</span><span class="token comment">// src/core/vdom/create-element.js</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>pre<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>   <span class="token function">isDef</span><span class="token punctuation">(</span>Ctor <span class="token operator">=</span> <span class="token function">resolveAsset</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>$options<span class="token punctuation">,</span> <span class="token string">'components'</span><span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 查找自定义组件构造函数的声明</span>  <span class="token comment">// 根据 Ctor 创建组件的 VNode</span>  <span class="token comment">// component</span>  vnode <span class="token operator">=</span> <span class="token function">createComponent</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">,</span> data<span class="token punctuation">,</span> context<span class="token punctuation">,</span> children<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 2.createComponent()中调用创建自定义组件对应的VNode</span><span class="token comment">// src/core/vdom/create-component.js</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createComponent</span> <span class="token punctuation">(</span>  <span class="token parameter">Ctor<span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span> <span class="token operator">|</span> Function <span class="token operator">|</span> Object <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">,</span>  data<span class="token operator">:</span> <span class="token operator">?</span>VNodeData<span class="token punctuation">,</span>  context<span class="token operator">:</span> Component<span class="token punctuation">,</span>  children<span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span><span class="token punctuation">,</span>  tag<span class="token operator">?</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token operator">|</span> Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span><span class="token operator">...</span>  <span class="token comment">// install component management hooks onto the placeholder node</span>  <span class="token comment">// 安装组件的钩子函数 init/prepatch/insert/destroy</span>  <span class="token comment">// 准备好了 data.hook 中的钩子函数</span>  <span class="token function">installComponentHooks</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment">// return a placeholder vnode</span>  <span class="token keyword">const</span> name <span class="token operator">=</span> Ctor<span class="token punctuation">.</span>options<span class="token punctuation">.</span>name <span class="token operator">||</span> tag  <span class="token comment">// 创建自定义组件的 VNode，设置自定义组件的名字</span>  <span class="token comment">// 记录this.componentOptions = componentOptions</span>  <span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-component-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Ctor<span class="token punctuation">.</span>cid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>    data<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> context<span class="token punctuation">,</span>    <span class="token punctuation">{</span> Ctor<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> listeners<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">,</span>    asyncFactory  <span class="token punctuation">)</span>  <span class="token keyword">return</span> vnode<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 3.installComponentHooks()初始化组件的data.hook</span><span class="token keyword">function</span> <span class="token function">installComponentHooks</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token operator">:</span> VNodeData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> hooks <span class="token operator">=</span> data<span class="token punctuation">.</span>hook <span class="token operator">||</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>hook <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 用户可以传递自定义钩子函数</span>  <span class="token comment">// 把用户传入的自定义钩子函数和 componentVNodeHooks 中预定义的钩子函数合并</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hooksToMerge<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> key <span class="token operator">=</span> hooksToMerge<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">const</span> existing <span class="token operator">=</span> hooks<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">const</span> toMerge <span class="token operator">=</span> componentVNodeHooks<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>existing <span class="token operator">!==</span> toMerge <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>existing <span class="token operator">&amp;&amp;</span> existing<span class="token punctuation">.</span>_merged<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      hooks<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> existing <span class="token operator">?</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span>toMerge<span class="token punctuation">,</span> existing<span class="token punctuation">)</span> <span class="token operator">:</span> toMerge    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 4.钩子函数定义的位置（init()钩子函数中创建组件的实例）</span><span class="token comment">// inline hooks to be invoked on component VNodes during patch</span><span class="token keyword">const</span> componentVNodeHooks <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token function">init</span> <span class="token punctuation">(</span>vnode<span class="token operator">:</span> VNodeWithData<span class="token punctuation">,</span> hydrating<span class="token operator">:</span> boolean<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>boolean <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>      vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">&amp;&amp;</span>      <span class="token operator">!</span>vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">.</span>_isDestroyed <span class="token operator">&amp;&amp;</span>      vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>keepAlive    <span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// kept-alive components, treat as a patch</span>      <span class="token keyword">const</span> mountedNode<span class="token operator">:</span> any <span class="token operator">=</span> vnode <span class="token comment">// work around flow</span>      componentVNodeHooks<span class="token punctuation">.</span><span class="token function">prepatch</span><span class="token punctuation">(</span>mountedNode<span class="token punctuation">,</span> mountedNode<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token comment">// 创建组建的实例挂载到vnode.componentInstance</span>      <span class="token keyword">const</span> child <span class="token operator">=</span> vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> <span class="token function">createComponentInstanceForVnode</span><span class="token punctuation">(</span>        vnode<span class="token punctuation">,</span>        activeInstance      <span class="token punctuation">)</span>      child<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>hydrating <span class="token operator">?</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">prepatch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token operator">:</span> MountedComponentVNode<span class="token punctuation">,</span> vnode<span class="token operator">:</span> MountedComponentVNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">insert</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token operator">:</span> MountedComponentVNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">destroy</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token operator">:</span> MountedComponentVNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 5.创建组件实例的位置，由自定义组件的init()钩子方法调用</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createComponentInstanceForVnode</span> <span class="token punctuation">(</span>  vnode<span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token comment">// we know it's MountedComponentVNode but flow doesn't</span>  parent<span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token comment">// activeInstance in lifecycle state</span><span class="token punctuation">)</span><span class="token operator">:</span> Component <span class="token punctuation">{</span>  <span class="token keyword">const</span> options<span class="token operator">:</span> InternalComponentOptions <span class="token operator">=</span> <span class="token punctuation">{</span>    _isComponent<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    _parentVnode<span class="token operator">:</span> vnode<span class="token punctuation">,</span>    parent  <span class="token punctuation">}</span>  <span class="token comment">// check inline-template render functions</span>  <span class="token comment">// 获取 inline-template</span>  <span class="token comment">// &lt;comp inline-template&gt; xxxx &lt;/comp&gt;</span>  <span class="token keyword">const</span> inlineTemplate <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inlineTemplate  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>inlineTemplate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    options<span class="token punctuation">.</span>render <span class="token operator">=</span> inlineTemplate<span class="token punctuation">.</span>render    options<span class="token punctuation">.</span>staticRenderFns <span class="token operator">=</span> inlineTemplate<span class="token punctuation">.</span>staticRenderFns  <span class="token punctuation">}</span>  <span class="token comment">// 创建组件实例</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">vnode<span class="token punctuation">.</span>componentOptions<span class="token punctuation">.</span>Ctor</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>调试执行过程</li></ul><h3 id="组件实例的创建和挂载过程"><a href="#组件实例的创建和挂载过程" class="headerlink" title="组件实例的创建和挂载过程"></a>组件实例的创建和挂载过程</h3><ul><li>Vue._update() –&gt; patch() –&gt; createElm() –&gt; createComponent()</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/core/vdom/patch.js</span><span class="token comment">// 1.创建组件实例，挂载到真实DOM</span><span class="token keyword">function</span> <span class="token function">createComponent</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> refElm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> isReactivated <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> i<span class="token punctuation">.</span>keepAlive    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 调用 init() 方法，创建和挂载组件实例</span>      <span class="token comment">// init() 的过程中创建好了组件的真实 DOM,挂载到了 vnode.elm 上</span>      <span class="token function">i</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> <span class="token boolean">false</span> <span class="token comment">/* hydrating */</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// after calling the init hook, if the vnode is a child component</span>    <span class="token comment">// it should've created a child instance and mounted it. the child</span>    <span class="token comment">// component also has set the placeholder vnode's elm.</span>    <span class="token comment">// in that case we can just return the element and be done.</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 调用钩子函数（VNode的钩子函数初始化属性/事件/样式等，组件的钩子函数）</span>      <span class="token function">initComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>      <span class="token comment">// 把组件对应的 DOM 插入到父元素中</span>      <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>isReactivated<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">reactivateComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token keyword">return</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 2.调用钩子函数，设置局部作用于样式</span><span class="token keyword">function</span> <span class="token function">initComponent</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pendingInsert<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>insertedVnodeQueue<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pendingInsert<span class="token punctuation">)</span>    vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pendingInsert <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token punctuation">}</span>  vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">.</span>$el  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPatchable</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 调用钩子函数</span>    <span class="token function">invokeCreateHooks</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>    <span class="token comment">// 设置局部作用于样式</span>    <span class="token function">setScope</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// empty component root.</span>    <span class="token comment">// skip all element-related modules except for ref (#3455)</span>    <span class="token function">registerRef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>    <span class="token comment">// make sure to invoke the insert hook</span>    insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 3.调用钩子函数</span><span class="token keyword">function</span> <span class="token function">invokeCreateHooks</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 调用 VNode 的钩子函数</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>    cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook <span class="token comment">// Reuse variable</span>  <span class="token comment">// 调用组件的钩子函数</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>create<span class="token punctuation">)</span><span class="token punctuation">)</span> i<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>insert<span class="token punctuation">)</span><span class="token punctuation">)</span> insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue模板编译 </tag>
            
            <tag> Vue组件化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.js 源码剖析-虚拟DOM</title>
      <link href="2021/070923019.html"/>
      <url>2021/070923019.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue-js-源码剖析-虚拟DOM"><a href="#Vue-js-源码剖析-虚拟DOM" class="headerlink" title="Vue.js 源码剖析-虚拟DOM"></a>Vue.js 源码剖析-虚拟DOM</h1><hr><h1 id="响应式原理回顾"><a href="#响应式原理回顾" class="headerlink" title="响应式原理回顾"></a>响应式原理回顾</h1><ul><li>Vue初始化过程</li><li>Vue中静态成员和实例成员初始化的过程</li><li>首次渲染过程</li><li>响应式实现过程</li></ul><h1 id="虚拟DOM回顾"><a href="#虚拟DOM回顾" class="headerlink" title="虚拟DOM回顾"></a>虚拟DOM回顾</h1><h2 id="什么是虚拟DOM"><a href="#什么是虚拟DOM" class="headerlink" title="什么是虚拟DOM"></a>什么是虚拟DOM</h2><p>虚拟DOM(Virtual DOM)是使用JavaScript对象来描述DOM，虚拟DOM的本质就是JavaScript对象，使用JavaScript对象来描述DOM的结构。应用的各种状态变化首先作用于虚拟DOM，最终映射到DOM。</p><p>Vue.js中的虚拟DOM借鉴了Snabbdom，并添加了一些Vue.js中的特性，例如：指令和组件机制。</p><p>Vue1.x中细粒度监测数据的变化，每个属性对应一个watcher，开销太大。Vue2.x中每个组件对应一个watcher，状态变化通知到组件，再引入虚拟DOM进行对比和渲染</p><h2 id="为什么要使用虚拟DOM"><a href="#为什么要使用虚拟DOM" class="headerlink" title="为什么要使用虚拟DOM"></a>为什么要使用虚拟DOM</h2><ul><li>使用虚拟DOM，可以避免用户直接操作真实DOM，开发过程关注业务代码的实现，不需要关注如何操作DOM，从而提高开发效率</li><li>作为一个中间层，可以跨平台，除Web平台外，还支持服务端渲染SSR、Weex框架（跨移动端平台）</li><li>关于性能方面，在首次渲染的时候肯定不如直接操作DOM，因为要维护一层额外的虚拟DOM对象，如果后续有频繁操作DOM的操作，这个时候可能会有性能的提升，虚拟DOM在更新真实DOM之前会通过Diff算法对比新旧两个虚拟DOM树的差异，组中把差异更新到真实DOM</li></ul><h1 id="Vue-js中的虚拟DOM"><a href="#Vue-js中的虚拟DOM" class="headerlink" title="Vue.js中的虚拟DOM"></a>Vue.js中的虚拟DOM</h1><ul><li><p><strong>演示<code>render</code>中的<code>h</code>函数</strong></p><ul><li><code>h()</code>函数就是<code>createElement()</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// h(tag, data, children)</span>    <span class="token comment">// render h('h1', this.msg)</span>    <span class="token comment">// render h('h1', {domProps: {innerHTML: this.msg}})</span>    <span class="token comment">// render h('h1', { attrs: { id: 'title' } }, this.msg)</span>    <span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span>    <span class="token string">'h1'</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>        attrs<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>msg    <span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>    <span class="token keyword">return</span> vnode  <span class="token punctuation">}</span><span class="token punctuation">,</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span>    msg<span class="token operator">:</span> <span class="token string">'Hello Vue'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/image-20210709061932450.png"></p></li><li><p>h函数（createElement<a href="https://cn.vuejs.org/v2/guide/render-function.html#createElement-%E5%8F%82%E6%95%B0">官方文档</a>）</p><ul><li><code>vm.$createElement(tag, data, children, normalizeChildren)</code><ul><li>tag<ul><li>标签名称或者组件对象</li></ul></li><li>data<ul><li>描述tag，可以设置DOM的属性或者标签的属性</li></ul></li><li>children<ul><li>tag中的文本内容或者子节点</li></ul></li></ul></li></ul></li><li><p>VNode</p><ul><li>VNode的核心属性<ul><li>tag（调用h函数时传入的tag）</li><li>data（调用h函数时传入的data）</li><li>children（调用h函数时传入的children）</li><li>text</li><li>elm（当VNode转换成真实DOM时，elm记录真实DOM）</li><li>key（作用是复用当前元素）</li></ul></li></ul></li></ul><h2 id="虚拟DOM创建过程"><a href="#虚拟DOM创建过程" class="headerlink" title="虚拟DOM创建过程"></a>虚拟DOM创建过程</h2><p><img src="http://5coder.cn/img/%E6%95%B4%E4%BD%93%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90.png" alt="整体过程分析"></p><h2 id="createElement"><a href="#createElement" class="headerlink" title="createElement"></a>createElement</h2><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>createElement()函数，用来创建虚拟节点(Vnode)，我们的render函数中的参数h，就是createElement()</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 此处的h就是vm.$createElement</span>  renturn <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>在vm._render()中调用了，用户传递的或者编译生成的render函数，这个时候传递了createElement</p><ul><li><p>src/core/instance/render.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 对编译生成的 render 进行渲染的方法</span>vm<span class="token punctuation">.</span><span class="token function-variable function">_c</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token comment">// normalization is always applied for the public version, used in</span><span class="token comment">// user-written render functions.</span><span class="token comment">// 对手写 render 函数进行渲染的方法</span>vm<span class="token punctuation">.</span><span class="token function-variable function">$createElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>vm._c和vm.createElement内部都调用了createElement，不同的是最后一个参数。vm._c在编译生成的render函数内部会调用，vm.$createElement在用户传入的render函数内部调用。当用户传入render函数的时候，要对用户传入的参数做处理。</em></p></li><li><p>src/core/vdom/create-element.js</p><p>执行完createElement之后创建好了VNode，把创建好的VNode传递给vm._update()继续处理</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// wrapper function for providing a more flexible interface</span><span class="token comment">// without getting yelled at by flow</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createElement</span> <span class="token punctuation">(</span>  <span class="token parameter">context<span class="token operator">:</span> Component<span class="token punctuation">,</span>  tag<span class="token operator">:</span> any<span class="token punctuation">,</span>  data<span class="token operator">:</span> any<span class="token punctuation">,</span>  children<span class="token operator">:</span> any<span class="token punctuation">,</span>  normalizationType<span class="token operator">:</span> any<span class="token punctuation">,</span>  alwaysNormalize<span class="token operator">:</span> boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token operator">|</span> Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 判断第三个参数</span>  <span class="token comment">// 如果data是数组或者原始值的话就是children，实现类似函数重载的机制</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPrimitive</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    normalizationType <span class="token operator">=</span> children    children <span class="token operator">=</span> data    data <span class="token operator">=</span> <span class="token keyword">undefined</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>alwaysNormalize<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    normalizationType <span class="token operator">=</span> <span class="token constant">ALWAYS_NORMALIZE</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token function">_createElement</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> normalizationType<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">_createElement</span> <span class="token punctuation">(</span>  <span class="token parameter">context<span class="token operator">:</span> Component<span class="token punctuation">,</span>  tag<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span> <span class="token operator">|</span> Function <span class="token operator">|</span> Object<span class="token punctuation">,</span>  data<span class="token operator">?</span><span class="token operator">:</span> VNodeData<span class="token punctuation">,</span>  children<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">,</span>  normalizationType<span class="token operator">?</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token operator">|</span> Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token punctuation">.</span>__ob__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>  <span class="token comment">// 由于MARKDOWN的编译问题，此处将`改为',优化显示，实际使用的是`</span>      <span class="token string">'Avoid using observed data object as vnode data: ${JSON.stringify(data)}\n'</span> <span class="token operator">+</span>      <span class="token string">'Always create fresh vnode data objects in each render!'</span><span class="token punctuation">,</span>      context    <span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token function">createEmptyVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// &lt;component v-bind:is="currentTabComponent"&gt;&lt;/component&gt;</span>  <span class="token comment">// object syntax in v-bind</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>is<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    tag <span class="token operator">=</span> data<span class="token punctuation">.</span>is  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// in case of component :is set to falsy value</span>    <span class="token keyword">return</span> <span class="token function">createEmptyVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// warn against non-primitive key</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>    <span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isPrimitive</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>key<span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>__WEEX__ <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">'@binding'</span> <span class="token keyword">in</span> data<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">warn</span><span class="token punctuation">(</span>        <span class="token string">'Avoid using non-primitive value as key, '</span> <span class="token operator">+</span>        <span class="token string">'use string/number value instead.'</span><span class="token punctuation">,</span>        context      <span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// support single function children as default scoped slot</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>    <span class="token keyword">typeof</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span>    data <span class="token operator">=</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    data<span class="token punctuation">.</span>scopedSlots <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>    children<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>  <span class="token punctuation">}</span><span class="token comment">// 去处理children</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>normalizationType <span class="token operator">===</span> <span class="token constant">ALWAYS_NORMALIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">// 当手写render函数的时候调用</span>     <span class="token comment">// 判断children的类型，如果是原始值的话转换成VNode的数组</span>     <span class="token comment">// 如果是数组的话，继续处理数组中的元素</span>     <span class="token comment">// 如果数组中的子元素又是数组(slot template)，递归处理</span><span class="token comment">// 如果连续两个节点都是字符串会合并文本节点</span>    <span class="token comment">// 返回一维数组，处理用户手写的 render</span>    children <span class="token operator">=</span> <span class="token function">normalizeChildren</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>normalizationType <span class="token operator">===</span> <span class="token constant">SIMPLE_NORMALIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 把二维数组，转换成一维数组</span>    <span class="token comment">// 如果children中有函数组件的话，函数组件会返回数组形式</span>    <span class="token comment">// 这时候children就是一个二维数组，只需要把二维数组转换为一维数组</span>    children <span class="token operator">=</span> <span class="token function">simpleNormalizeChildren</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">let</span> vnode<span class="token punctuation">,</span> ns  <span class="token comment">// 判断tag是字符串还是组件</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> Ctor    ns <span class="token operator">=</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>$vnode <span class="token operator">&amp;&amp;</span> context<span class="token punctuation">.</span>$vnode<span class="token punctuation">.</span>ns<span class="token punctuation">)</span> <span class="token operator">||</span> config<span class="token punctuation">.</span><span class="token function">getTagNamespace</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span>    <span class="token comment">// 是否是 html 的保留标签</span>    <span class="token comment">// 如果是浏览器的保留标签，创建对应的VNode</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isReservedTag</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// platform built-in elements</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>nativeOn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">warn</span><span class="token punctuation">(</span>          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The .native modifier for v-on is only valid on components but it was used on &lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>          context        <span class="token punctuation">)</span>      <span class="token punctuation">}</span>      vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>        config<span class="token punctuation">.</span><span class="token function">parsePlatformTagName</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span>        <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> context      <span class="token punctuation">)</span>    <span class="token comment">// 判断是否是 自定义组件</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>pre<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>       <span class="token function">isDef</span><span class="token punctuation">(</span>Ctor <span class="token operator">=</span> <span class="token function">resolveAsset</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>$options<span class="token punctuation">,</span> <span class="token string">'components'</span><span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 查找自定义组件构造函数的声明</span>      <span class="token comment">// 根据 Ctor 创建组件的 VNode</span>      <span class="token comment">// component</span>      vnode <span class="token operator">=</span> <span class="token function">createComponent</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">,</span> data<span class="token punctuation">,</span> context<span class="token punctuation">,</span> children<span class="token punctuation">,</span> tag<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token comment">// unknown or unlisted namespaced elements</span>      <span class="token comment">// check at runtime because it may get assigned a namespace when its</span>      <span class="token comment">// parent normalizes children</span>      vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>        tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span>        <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> context      <span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// direct component options / constructor</span>    vnode <span class="token operator">=</span> <span class="token function">createComponent</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> context<span class="token punctuation">,</span> children<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> vnode  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ns<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">applyNS</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> ns<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">registerDeepBindings</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">return</span> vnode  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">createEmptyVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><h3 id="功能-1"><a href="#功能-1" class="headerlink" title="功能"></a>功能</h3><p>内部调用vm.<strong>patch</strong>()把虚拟DOM转换成真实DOM</p><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><ul><li>src/core/instance/lifecycle.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> hydrating<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> vm<span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>  <span class="token keyword">const</span> prevEl <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el  <span class="token keyword">const</span> prevVnode <span class="token operator">=</span> vm<span class="token punctuation">.</span>_vnode  <span class="token keyword">const</span> restoreActiveInstance <span class="token operator">=</span> <span class="token function">setActiveInstance</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>  vm<span class="token punctuation">.</span>_vnode <span class="token operator">=</span> vnode  <span class="token comment">// Vue.prototype.__patch__ is injected in entry points</span>  <span class="token comment">// based on the rendering backend used.</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// initial render</span>    vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> <span class="token boolean">false</span> <span class="token comment">/* removeOnly */</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// updates</span>    vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>prevVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">restoreActiveInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// update __vue__ reference</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>prevEl<span class="token punctuation">)</span> <span class="token punctuation">{</span>    prevEl<span class="token punctuation">.</span>__vue__ <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span> <span class="token punctuation">{</span>    vm<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>__vue__ <span class="token operator">=</span> vm  <span class="token punctuation">}</span>  <span class="token comment">// if parent is an HOC, update its $el as well</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$vnode <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$parent <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$vnode <span class="token operator">===</span> vm<span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>_vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    vm<span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>$el <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el  <span class="token punctuation">}</span>  <span class="token comment">// updated hook is called by the scheduler to ensure that children are</span>  <span class="token comment">// updated in a parent's updated hook.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="patch函数初始化"><a href="#patch函数初始化" class="headerlink" title="patch函数初始化"></a>patch函数初始化</h2><h3 id="功能-2"><a href="#功能-2" class="headerlink" title="功能"></a>功能</h3><p>对比两个VNode的差异，把差异更新到真实DOM。如果是首次渲染的话，会把真实DOM先转换成VNode</p><h3 id="Snabbdom中path函数的初始化"><a href="#Snabbdom中path函数的初始化" class="headerlink" title="Snabbdom中path函数的初始化"></a>Snabbdom中path函数的初始化</h3><ul><li>src/snabbdom.ts</li></ul><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">init</span> <span class="token punctuation">(</span>modules<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Partial<span class="token operator">&lt;</span>Module<span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span> domApi<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">DOMAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span>oldVnode<span class="token operator">:</span> VNode <span class="token operator">|</span> Element<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNode<span class="token punctuation">)</span><span class="token operator">:</span> Vnode <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>​    vnode</li></ul><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">vnode</span> <span class="token punctuation">(</span>sel<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  data<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  children<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>VNode <span class="token operator">|</span> <span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  elm<span class="token operator">:</span> Element <span class="token operator">|</span> Text <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>  <span class="token keyword">const</span> key <span class="token operator">=</span> data <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> data<span class="token punctuation">.</span>key  <span class="token keyword">return</span> <span class="token punctuation">{</span> sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> elm<span class="token punctuation">,</span> key <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Vue-js中path函数的初始化"><a href="#Vue-js中path函数的初始化" class="headerlink" title="Vue.js中path函数的初始化"></a>Vue.js中path函数的初始化</h3><ul><li>src/platform/web/runtime/index.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> patch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./patch'</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__patch__ <span class="token operator">=</span> inBrowser <span class="token operator">?</span> patch <span class="token operator">:</span> noop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>src/platform/web/runtime/patch.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* @flow */</span><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> nodeOps <span class="token keyword">from</span> <span class="token string">'web/runtime/node-ops'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> createPatchFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'core/vdom/patch'</span><span class="token keyword">import</span> baseModules <span class="token keyword">from</span> <span class="token string">'core/vdom/modules/index'</span><span class="token keyword">import</span> platformModules <span class="token keyword">from</span> <span class="token string">'web/runtime/modules/index'</span><span class="token comment">// the directive module should be applied last, after all</span><span class="token comment">// built-in modules have been applied.</span><span class="token keyword">const</span> modules <span class="token operator">=</span> platformModules<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>baseModules<span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">const</span> patch<span class="token operator">:</span> Function <span class="token operator">=</span> <span class="token function">createPatchFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span> nodeOps<span class="token punctuation">,</span> modules <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>src/core/vdom/patch.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createPatchFunction</span> <span class="token punctuation">(</span><span class="token parameter">backend</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> i<span class="token punctuation">,</span> j  <span class="token keyword">const</span> cbs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// modules 节点的属性/事件/样式的操作</span>  <span class="token comment">// nodeOps 节点操作</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> modules<span class="token punctuation">,</span> nodeOps <span class="token punctuation">}</span> <span class="token operator">=</span> backend  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hooks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// cbs['update'] = []</span>    cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> modules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// cbs['update'] = [updateAttrs, updateClass, update...]</span>        cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>    <span class="token operator">...</span><span class="token operator">...</span>      <span class="token comment">// 函数柯里化，让一个函数返回一个函数</span>  <span class="token comment">// createPatchFunction({ nodeOps, modules }) 传入平台相关的两个参数</span>  <span class="token comment">// core中的createPatchFunction (backend), const { modules, nodeOps } = backend</span>  <span class="token comment">// core中方法和平台无关，传入两个参数后，可以在上面的函数中使用这两个参数</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> removeOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token operator">...</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="patch函数执行过程"><a href="#patch函数执行过程" class="headerlink" title="patch函数执行过程"></a>patch函数执行过程</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> removeOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 新的 VNode 不存在</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 老的 VNode 存在，执行 Destroy 钩子函数</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token keyword">let</span> isInitialPatch <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token keyword">const</span> insertedVnodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// 老的 VNode 不存在</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// empty mount (likely as component), create new root element</span>    isInitialPatch <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token comment">// 创建新的 VNode</span>    <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// 新的和老的 VNode 都存在，更新</span>    <span class="token keyword">const</span> isRealElement <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span>    <span class="token comment">// 判断参数1是否是真实 DOM，不是真实 DOM</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRealElement <span class="token operator">&amp;&amp;</span> <span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 更新操作，diff 算法</span>      <span class="token comment">// patch existing root node</span>      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> removeOnly<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token comment">// 第一个参数是真实 DOM，创建 VNode</span>      <span class="token comment">// 初始化</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>isRealElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// mounting to a real element</span>        <span class="token comment">// check if this is server-rendered content and if we can perform</span>        <span class="token comment">// a successful hydration.</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">SSR_ATTR</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          oldVnode<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token constant">SSR_ATTR</span><span class="token punctuation">)</span>          hydrating <span class="token operator">=</span> <span class="token boolean">true</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>hydrating<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hydrate</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">invokeInsertHook</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> oldVnode          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">warn</span><span class="token punctuation">(</span>              <span class="token string">'The client-side rendered virtual DOM tree is not matching '</span> <span class="token operator">+</span>              <span class="token string">'server-rendered content. This is likely caused by incorrect '</span> <span class="token operator">+</span>              <span class="token string">'HTML markup, for example nesting block-level elements inside '</span> <span class="token operator">+</span>              <span class="token string">'&lt;p&gt;, or missing &lt;tbody&gt;. Bailing hydration and performing '</span> <span class="token operator">+</span>              <span class="token string">'full client-side render.'</span>            <span class="token punctuation">)</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">// either not server-rendered, or hydration failed.</span>        <span class="token comment">// create an empty node and replace it</span>        oldVnode <span class="token operator">=</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token comment">// replacing existing element</span>      <span class="token keyword">const</span> oldElm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm      <span class="token keyword">const</span> parentElm <span class="token operator">=</span> nodeOps<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>oldElm<span class="token punctuation">)</span>      <span class="token comment">// create new node</span>      <span class="token comment">// 创建 DOM 节点</span>      <span class="token function">createElm</span><span class="token punctuation">(</span>        vnode<span class="token punctuation">,</span>        insertedVnodeQueue<span class="token punctuation">,</span>        <span class="token comment">// extremely rare edge case: do not insert if old element is in a</span>        <span class="token comment">// leaving transition. Only happens when combining transition +</span>        <span class="token comment">// keep-alive + HOCs. (#4590)</span>        oldElm<span class="token punctuation">.</span>_leaveCb <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> parentElm<span class="token punctuation">,</span>        nodeOps<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldElm<span class="token punctuation">)</span>      <span class="token punctuation">)</span>      <span class="token comment">// update parent placeholder node element, recursively</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> ancestor <span class="token operator">=</span> vnode<span class="token punctuation">.</span>parent        <span class="token keyword">const</span> patchable <span class="token operator">=</span> <span class="token function">isPatchable</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>ancestor<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>destroy<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            cbs<span class="token punctuation">.</span>destroy<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>ancestor<span class="token punctuation">)</span>          <span class="token punctuation">}</span>          ancestor<span class="token punctuation">.</span>elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm          <span class="token keyword">if</span> <span class="token punctuation">(</span>patchable<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>              cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> ancestor<span class="token punctuation">)</span>            <span class="token punctuation">}</span>            <span class="token comment">// #6513</span>            <span class="token comment">// invoke insert hooks that may have been merged by create hooks.</span>            <span class="token comment">// e.g. for directives that uses the "inserted" hook.</span>            <span class="token keyword">const</span> insert <span class="token operator">=</span> ancestor<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token punctuation">.</span>insert            <span class="token keyword">if</span> <span class="token punctuation">(</span>insert<span class="token punctuation">.</span>merged<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token comment">// start at index 1 to avoid re-invoking component mounted hook</span>              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> insert<span class="token punctuation">.</span>fns<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                insert<span class="token punctuation">.</span>fns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">}</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token function">registerRef</span><span class="token punctuation">(</span>ancestor<span class="token punctuation">)</span>          <span class="token punctuation">}</span>          ancestor <span class="token operator">=</span> ancestor<span class="token punctuation">.</span>parent        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      <span class="token comment">// destroy old node</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">removeVnodes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>oldVnode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">invokeInsertHook</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> isInitialPatch<span class="token punctuation">)</span>  <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="createElm"><a href="#createElm" class="headerlink" title="createElm"></a>createElm</h2><p>把VNode转换成真实DOM，插入到DOM树上</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createElm</span> <span class="token punctuation">(</span>  <span class="token parameter">vnode<span class="token punctuation">,</span>  insertedVnodeQueue<span class="token punctuation">,</span>  parentElm<span class="token punctuation">,</span>  refElm<span class="token punctuation">,</span>  nested<span class="token punctuation">,</span>  ownerArray<span class="token punctuation">,</span>  index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ownerArray<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// This vnode was used in a previous render!</span>    <span class="token comment">// now it's used as a new node, overwriting its elm would cause</span>    <span class="token comment">// potential patch errors down the road when it's used as an insertion</span>    <span class="token comment">// reference node. Instead, we clone the node on-demand before creating</span>    <span class="token comment">// associated DOM element for it.</span>    vnode <span class="token operator">=</span> ownerArray<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cloneVNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  vnode<span class="token punctuation">.</span>isRootInsert <span class="token operator">=</span> <span class="token operator">!</span>nested <span class="token comment">// for transition enter check</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">createComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data  <span class="token keyword">const</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children  <span class="token keyword">const</span> tag <span class="token operator">=</span> vnode<span class="token punctuation">.</span>tag  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>pre<span class="token punctuation">)</span> <span class="token punctuation">{</span>        creatingElmInVPre<span class="token operator">++</span>      <span class="token punctuation">}</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUnknownElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> creatingElmInVPre<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">warn</span><span class="token punctuation">(</span>          <span class="token string">'Unknown custom element: &lt;'</span> <span class="token operator">+</span> tag <span class="token operator">+</span> <span class="token string">'&gt; - did you '</span> <span class="token operator">+</span>          <span class="token string">'register the component correctly? For recursive components, '</span> <span class="token operator">+</span>          <span class="token string">'make sure to provide the "name" option.'</span><span class="token punctuation">,</span>          vnode<span class="token punctuation">.</span>context        <span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>ns      <span class="token operator">?</span> nodeOps<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>ns<span class="token punctuation">,</span> tag<span class="token punctuation">)</span>      <span class="token operator">:</span> nodeOps<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>    <span class="token function">setScope</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>    <span class="token comment">/* istanbul ignore if */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>__WEEX__<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// in Weex, the default insertion order is parent-first.</span>      <span class="token comment">// List items can be optimized to use children-first insertion</span>      <span class="token comment">// with append="tree".</span>      <span class="token keyword">const</span> appendAsTree <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isTrue</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>appendAsTree<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>appendAsTree<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">invokeCreateHooks</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token function">createChildren</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> children<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>appendAsTree<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">invokeCreateHooks</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token function">createChildren</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> children<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">invokeCreateHooks</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>pre<span class="token punctuation">)</span> <span class="token punctuation">{</span>      creatingElmInVPre<span class="token operator">--</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isComment<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> nodeOps<span class="token punctuation">.</span><span class="token function">createComment</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> nodeOps<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="patchVnode"><a href="#patchVnode" class="headerlink" title="patchVnode"></a>patchVnode</h2><h1 id="patchVnode-node-oldCh-start-end"><a href="#patchVnode-node-oldCh-start-end" class="headerlink" title="patchVnode(node, oldCh, start, end)"></a>patchVnode(node, oldCh, start, end)</h1><ul><li><p>如果老节点和新节点相等，直接返回</p></li><li><p>如果新节点有elm属性，并且ownerArray存在</p><blockquote><p>克隆vnode</p></blockquote></li><li><p>如果占位符相关：pass</p></li><li><p>如果新旧vnode都是静态的，只需要替换<code>componentInstance</code></p></li><li><p>如果<code>vnode.data</code>存在并且<code>data.hook</code>存在并且<code>data.hook.prepatch</code>存在</p><blockquote><p>调用prepatch</p></blockquote></li><li><p>获取新老节点的子节点：oldCh和ch</p></li><li><p>如果vnode.data存在并且vnode是isPatchable</p><ul><li>调用cbs中的钩子函数，操作节点的属性/样式/事件</li><li>调用用户自定义钩子</li></ul></li><li><p>如果新节点没有文本</p><ul><li><p>如果老节点的子节点和新节点的子节点存在</p><ul><li>如果老节点的子节点不等于新节点的子节点<ul><li>调用updateChildren</li></ul></li></ul></li><li><p>如果新的有子节点，老的没有子节点</p><ul><li>判断环境是否为开发环境<ul><li>如果为开发环境，检查key值得重复情况</li></ul></li><li>如果老节点存在text<ul><li>先清空老节点DOM的文本内容，然后为当前DOM节点加入子节点</li></ul></li><li>调用addVnodes</li></ul></li><li><p>如果老节点有子节点，新节点没有子节点</p><ul><li>清空老节点中的文本内容</li></ul></li><li><p>新老节点都有文本节点</p><ul><li>修改文本</li></ul></li><li><p>如果data存在</p><ul><li>如果data.hook存在并且data.hook.postpatch存在，调用data.hook.postpatch()</li></ul></li></ul></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">patchVnode</span> <span class="token punctuation">(</span>  <span class="token parameter">oldVnode<span class="token punctuation">,</span>  vnode<span class="token punctuation">,</span>  insertedVnodeQueue<span class="token punctuation">,</span>  ownerArray<span class="token punctuation">,</span>  index<span class="token punctuation">,</span>  removeOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ownerArray<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// clone reused vnode</span>    vnode <span class="token operator">=</span> ownerArray<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cloneVNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>isAsyncPlaceholder<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>asyncFactory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">hydrate</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      vnode<span class="token punctuation">.</span>isAsyncPlaceholder <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token comment">// reuse element for static trees.</span>  <span class="token comment">// note we only do this if the vnode is cloned -</span>  <span class="token comment">// if the new node is not cloned it means the render functions have been</span>  <span class="token comment">// reset by the hot-reload-api and we need to do a proper re-render.</span>  <span class="token comment">// 如果新旧 VNode 都是静态的，那么只需要替换componentInstance</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isStatic<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>    <span class="token function">isTrue</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>isStatic<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>    vnode<span class="token punctuation">.</span>key <span class="token operator">===</span> oldVnode<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span>    <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isCloned<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isOnce<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span>    vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>componentInstance    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token keyword">let</span> i  <span class="token keyword">const</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>prepatch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">i</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children  <span class="token keyword">const</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isPatchable</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 调用 cbs 中的钩子函数，操作节点的属性/样式/事件....</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>    <span class="token comment">// 用户的自定义钩子</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">i</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 新节点没有文本</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 老节点和老节点都有有子节点</span>    <span class="token comment">// 对子节点进行 diff 操作，调用 updateChildren</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> removeOnly<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 新的有子节点，老的没有子节点</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">checkDuplicateKeys</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token comment">// 先清空老节点 DOM 的文本内容，然后为当前 DOM 节点加入子节点</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>      <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 老节点有子节点，新的没有子节点</span>      <span class="token comment">// 删除老节点中的子节点</span>      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 老节点有文本，新节点没有文本</span>      <span class="token comment">// 清空老节点的文本内容</span>      nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 新老节点都有文本节点</span>    <span class="token comment">// 修改文本</span>    nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>postpatch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">i</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="updateChildren"><a href="#updateChildren" class="headerlink" title="updateChildren"></a>updateChildren</h2><p>updateChildren和Snabbdom中的updateChildren整体算法一致，这里不再展开了。我们再来看下它处理过程中key的作用，在patch函数中，调用patchVnode之前，会首先调用sameVnode()判断当前的辛劳VNode是否是相同节点，sameVnode()中首先判断key是否相同。</p><ul><li><p>通过下面代码来体会key的作用</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>key<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handler<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value in arr<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{value}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../../dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token operator">:</span> <span class="token punctuation">{</span>        arr<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      methods<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token function">handler</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span>          <span class="token comment">// this.arr = ['a', 'x', 'b', 'c', 'd']</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>当没有设置key的时候</p><ul><li>在updateChildren中比较子节点的时候，会做三次更新DOM操作和一次插入DOM的操作</li></ul></li><li><p>当设置key的时候</p><ul><li>在updateChildren中比较子节点的时候，因为oldVnode的子节点的b,c,d和newVnode的x,b,c的key相同，所以只做比较，没有更新DOM的操作，当遍历完毕后，会再把x插入到DOM上，DOM操作只有一次插入操作。</li></ul></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="http://5coder.cn/img/%E6%95%B4%E4%BD%93%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90.png" alt="整体过程分析"></p>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue虚拟DOM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.js 源码剖析-响应式原理-随堂测试</title>
      <link href="2021/07074548.html"/>
      <url>2021/07074548.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue-js-源码剖析-响应式原理-随堂测试"><a href="#Vue-js-源码剖析-响应式原理-随堂测试" class="headerlink" title="Vue.js 源码剖析-响应式原理-随堂测试"></a>Vue.js 源码剖析-响应式原理-随堂测试</h1><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>Part3-2任务一:Vue.js 源码剖析-响应式原理随堂测试</p><ul><li><p><strong>1.</strong> <strong>单选题</strong>下面关于 Vue 的相关版本说法错误的是：**(20分)**</p><ul><li>A完整版的 Vue 同时包含编译器和运行时，编译后的文件名如果是 vue.js，模块化采用的是 UMD</li><li>B运行时版的 Vue 只包含运行时，编译后的文件名如果是 vue.runtime.js，模块化采用的是 CommonJS</li><li>C运行时版本的 Vue 体积比编译器版本的 Vue 要小 30% 左右，并且运行时版本的 Vue 的运行效率要比完整版的 Vue 要高</li><li>D完整版和运行时版的 Vue，编译后的文件中会同时存在支持 UMD、CommonJS、ESM 三种模块化的方式，VueCLI 生成的项目默认使用 Vue 是 ESM 模块化方式的运行时版本</li></ul><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAGTklEQVR4Xu2ce2xTdRTHv6cdHdDJIDPTEBDmM+EhrxmUEMxEUKQoESEaEIOPhIBghG6JJPqX8bF2EkEIiRET0MRgIC7rmBBkMI0vQBmIiArlFZBHExir2zp6j/n1pqVsffxu7+1ta+5N+s92z+N+7u/+fuec34Ng5sVsQ2PdOIDGgPg+sPihAsQDwLgFiPzEdQ2Ea2BqA8EPomNgOgZwK2au/BVEilluU9YN7Vw7GKGOOQBNBeNhgAfqs0lXQNgL8Ddw9NuK6cvO6dOXWjo7gJo/7Yv2wByAFwL8KABblh5CAWgXQJtQUrYVVYs6jbZjLKDmdSUIBhcDtBLMtxvtbEp9RP8AXAencwOqlrYbZdsYQM3NRfh3/3IovApAmVHOZagnABu9g/6Va1BVdT1DHTEx/YCavJMRVtaDMVqvM4bKEw7DbluCGe7v9OjNHNCRLQ74T3sBfhXMmevR4306WSIG6CNU3OHGyHmhdLcn+n9mD+ZbfSdwfQuYJ2Ri1HQZogNA0Ty4Xj+h1bZ2QNs9j0DhbWCUajWW0/sJV2Gjp/FE9W4tfmgD5KudC8ZnABxajOTRvSEQFsBV86WsT/KAGjyvALwhizGNrM967xOx02LMqv5YRpEcILXlfPE/gBNlooDwrExLSg9I9DlhbirgzypZQwnBTjPS9UmpAUVGq+5fCq5Dlvl2xD2i40af8alGt+SAInHOqe8LZiiXhdLzPhECVAyblCxOSg7I510DVpZlareg5Mi2Fi73cvlAMZI+cEveRshG0xcRt52mJEpLercgkXgG94l+J79yK6Oh9PrUcBjOB8b3THB7A2r0rIDCddn2Jy/122glZlZ/EO/bzYBEPac9eDIPSha54hdAiXN4fD3pZkC+WjcYnlx5lxd2CdVw1XijvtwAJMqkwct+0yuBeUElzglRmXTeWhEt394A1OCdDygiEbUu2BZglvtzNZaMXg2eHQBPt+hEsOzErOrHbgASUzNdHWcKNRkdUVKGsQPKcaEriB+vnEcw3K33PSso7jdUTCmpLajRIwruH+rVarb8gCIH1o+ahvlDRsRMn+lowwsHt6M5IN63jouwHK6atSogX209GE/qUGe6aGmRAzsmzsXEQYN72b7a3YVRezfibKeO2R+ieriqZxPEdLDPG9A/42keo1Rwol68/dcPePOYngkNugKXu4zg804AK/vNezx9lmTgCAvbzv+JOQfq9RkjWyXBV/ciOPyJPk3mSMvCEd7UHd8H99E9+hwj+0uERu/7UJQafZqyL60FTrcSRuW3m3Ho2iV9jtlstQSf5yswP6VPU2/psj59Mb70NrRdD6G17SI6lXDGJrTAEUZWHNmN1f4DGduLCRLVExo8rQDfr1+bqkEMi6vufhBv3TsJDps98rdzne14ufVrNF3yazajFc4bR1vw3vGfNNtJLECHCL5aPxjDDdKIJcPGYt3oab3UKcxY1NqETWePSJvSCmfVHy1492+j4ETe9klCQ+1lI8sbF6YtQXmxMyEELZC0wjG25cTcDwhAXUZN6ZQ7+uPC9KUpW4gMpDyBI54jZCggu1hYOOM19LP3yRhSHsGJATL0E9s45nEsGpq+nJ2oJeUZHAEoYHgnPbCoGD9Pfh73lAxK2xnHQ8pDONFO2thhXlAZXOzEnoeek4a07LddWDhkZMLEMxHlLHXICUxFhvnsBIpaIKVtanE3mAdHDPMiUMxiqmE0JFPhiJeiphrZTVaNgmQ6nEhaIJJVE8odeiHlBE4EkCh3mFQwyxRSzuAgWjATpEwquWqFlDs4agetllzFZWLRXhZSTuGoZYm4or3J0z7pIOUcDtBj2kcQM3niUEDaVjn7puCwI9wN9+97sP7UQS2hURbu7TlxGAFk/tSz+L5d5XdhXGk5AqFObL94Av6Oq1l4YK0qE009W4sXVIpJFy+oo5m1/CXp8hcByFpAlWYBlTrkW0vw4rosaxFnFIbYgCe1iFMIWMuAY23IWkiuJqUaF5ILIWsrgjrqpwyhrM0saQAJetZ2KIkw3NpQJwHJ2pIpAcna1CsBydoWLgHJOlhAApJ1NIUEpFhaYh1ukpqWdTyOZGuyDliSBWUd0SVJCoCYUurufAbMU8E0Rf+WB3HIG7cA2FW4h7wlw8db7Gg8PbaQjgn8D3wVByqacZ9sAAAAAElFTkSuQmCC" alt="img">回答正确 +20分</p><p>答案解析</p><p>B. 运行时版本的 Vue 编译后的文件名是 vue.runtime.js 模块化的方式是 UMD，同时会编译出 vue.runtime.js(UMD)、vue.runtime.common.js 和 vue.runtime.esm.js 不同模块化方式的版本</p></li><li><p><strong>2.</strong> <strong>单选题</strong>下面关于 Vue 的响应式说法错误的是：**(20分)**</p><ul><li>AVue 在初始化 data 的过程中会先检测 options 中是否有同名的 prop 或者 method，如果有的话会报相应的警告。</li><li>B创建 Vue 实例或者组件实例的时候传入的 data 对象的层级尽可能少，因为在响应式处理的过程中会递归处理 data 对象的所有子属性</li><li>C数组的响应化的核心处理是把修改原数组内容的数组方法，当调用这些方法的时候会调用 notify() 通知 Watcher 重新渲染，然后再遍历数组中的所有元素通过 observe 函数转换成响应式数据</li><li>D数组的响应化处理的过程中会遍历数组的每一个元素进行响应化处理，所以通过 arr[0] 修改数组，或者通过 arr.length = 0 修改数组后页面会显示最新的数组中的数据</li></ul><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAGTklEQVR4Xu2ce2xTdRTHv6cdHdDJIDPTEBDmM+EhrxmUEMxEUKQoESEaEIOPhIBghG6JJPqX8bF2EkEIiRET0MRgIC7rmBBkMI0vQBmIiArlFZBHExir2zp6j/n1pqVsffxu7+1ta+5N+s92z+N+7u/+fuec34Ng5sVsQ2PdOIDGgPg+sPihAsQDwLgFiPzEdQ2Ea2BqA8EPomNgOgZwK2au/BVEilluU9YN7Vw7GKGOOQBNBeNhgAfqs0lXQNgL8Ddw9NuK6cvO6dOXWjo7gJo/7Yv2wByAFwL8KABblh5CAWgXQJtQUrYVVYs6jbZjLKDmdSUIBhcDtBLMtxvtbEp9RP8AXAencwOqlrYbZdsYQM3NRfh3/3IovApAmVHOZagnABu9g/6Va1BVdT1DHTEx/YCavJMRVtaDMVqvM4bKEw7DbluCGe7v9OjNHNCRLQ74T3sBfhXMmevR4306WSIG6CNU3OHGyHmhdLcn+n9mD+ZbfSdwfQuYJ2Ri1HQZogNA0Ty4Xj+h1bZ2QNs9j0DhbWCUajWW0/sJV2Gjp/FE9W4tfmgD5KudC8ZnABxajOTRvSEQFsBV86WsT/KAGjyvALwhizGNrM967xOx02LMqv5YRpEcILXlfPE/gBNlooDwrExLSg9I9DlhbirgzypZQwnBTjPS9UmpAUVGq+5fCq5Dlvl2xD2i40af8alGt+SAInHOqe8LZiiXhdLzPhECVAyblCxOSg7I510DVpZlareg5Mi2Fi73cvlAMZI+cEveRshG0xcRt52mJEpLercgkXgG94l+J79yK6Oh9PrUcBjOB8b3THB7A2r0rIDCddn2Jy/122glZlZ/EO/bzYBEPac9eDIPSha54hdAiXN4fD3pZkC+WjcYnlx5lxd2CdVw1XijvtwAJMqkwct+0yuBeUElzglRmXTeWhEt394A1OCdDygiEbUu2BZglvtzNZaMXg2eHQBPt+hEsOzErOrHbgASUzNdHWcKNRkdUVKGsQPKcaEriB+vnEcw3K33PSso7jdUTCmpLajRIwruH+rVarb8gCIH1o+ahvlDRsRMn+lowwsHt6M5IN63jouwHK6atSogX209GE/qUGe6aGmRAzsmzsXEQYN72b7a3YVRezfibKeO2R+ieriqZxPEdLDPG9A/42keo1Rwol68/dcPePOYngkNugKXu4zg804AK/vNezx9lmTgCAvbzv+JOQfq9RkjWyXBV/ciOPyJPk3mSMvCEd7UHd8H99E9+hwj+0uERu/7UJQafZqyL60FTrcSRuW3m3Ho2iV9jtlstQSf5yswP6VPU2/psj59Mb70NrRdD6G17SI6lXDGJrTAEUZWHNmN1f4DGduLCRLVExo8rQDfr1+bqkEMi6vufhBv3TsJDps98rdzne14ufVrNF3yazajFc4bR1vw3vGfNNtJLECHCL5aPxjDDdKIJcPGYt3oab3UKcxY1NqETWePSJvSCmfVHy1492+j4ETe9klCQ+1lI8sbF6YtQXmxMyEELZC0wjG25cTcDwhAXUZN6ZQ7+uPC9KUpW4gMpDyBI54jZCggu1hYOOM19LP3yRhSHsGJATL0E9s45nEsGpq+nJ2oJeUZHAEoYHgnPbCoGD9Pfh73lAxK2xnHQ8pDONFO2thhXlAZXOzEnoeek4a07LddWDhkZMLEMxHlLHXICUxFhvnsBIpaIKVtanE3mAdHDPMiUMxiqmE0JFPhiJeiphrZTVaNgmQ6nEhaIJJVE8odeiHlBE4EkCh3mFQwyxRSzuAgWjATpEwquWqFlDs4agetllzFZWLRXhZSTuGoZYm4or3J0z7pIOUcDtBj2kcQM3niUEDaVjn7puCwI9wN9+97sP7UQS2hURbu7TlxGAFk/tSz+L5d5XdhXGk5AqFObL94Av6Oq1l4YK0qE009W4sXVIpJFy+oo5m1/CXp8hcByFpAlWYBlTrkW0vw4rosaxFnFIbYgCe1iFMIWMuAY23IWkiuJqUaF5ILIWsrgjrqpwyhrM0saQAJetZ2KIkw3NpQJwHJ2pIpAcna1CsBydoWLgHJOlhAApJ1NIUEpFhaYh1ukpqWdTyOZGuyDliSBWUd0SVJCoCYUurufAbMU8E0Rf+WB3HIG7cA2FW4h7wlw8db7Gg8PbaQjgn8D3wVByqacZ9sAAAAAElFTkSuQmCC" alt="img">回答正确 +20分</p><p>答案解析</p><p>D. 数组的响应化处理过程虽然会遍历数组中的每一个元素调用 observe 函数处理每一个元素，但是 observe 的作用是把对象转换成响应式对象，并没有处理数组对象本身的索引和 length 属性，修改数组的索引对应的元素，或者修改 length 属性，是不会重新渲染页面的。</p></li><li><p><strong>3.</strong> <strong>多选题</strong>下面关于 Vue 的响应式说法正确是：**(20分)**</p><ul><li>A每一个响应式对象都会创建一个对应的 Observer 对象，记录到该对象的 <strong>ob</strong> 属性中，并且每一个 Observer 对象都会有一个 dep 对象，负责为该对象收集依赖，当该对象发生变化时发送通知</li><li>B响应式对象的属性，都会通过 defineReactive 转换为 getter 和 setter，同时每一个属性都会有一个对象的 dep 对象为该属性收集依赖，当属性变化时发送通知</li><li>C当给响应式对象的属性赋值的时候，如果新值是对象的话，会调用 observe 把该对象转换成响应式对象</li><li>D在响应式对象属性的 getter 中会收集该属性的依赖，如果该属性的值是对象会为该对象收集依赖，如果该值是数组，会为该数组收集依赖</li></ul><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAGTklEQVR4Xu2ce2xTdRTHv6cdHdDJIDPTEBDmM+EhrxmUEMxEUKQoESEaEIOPhIBghG6JJPqX8bF2EkEIiRET0MRgIC7rmBBkMI0vQBmIiArlFZBHExir2zp6j/n1pqVsffxu7+1ta+5N+s92z+N+7u/+fuec34Ng5sVsQ2PdOIDGgPg+sPihAsQDwLgFiPzEdQ2Ea2BqA8EPomNgOgZwK2au/BVEilluU9YN7Vw7GKGOOQBNBeNhgAfqs0lXQNgL8Ddw9NuK6cvO6dOXWjo7gJo/7Yv2wByAFwL8KABblh5CAWgXQJtQUrYVVYs6jbZjLKDmdSUIBhcDtBLMtxvtbEp9RP8AXAencwOqlrYbZdsYQM3NRfh3/3IovApAmVHOZagnABu9g/6Va1BVdT1DHTEx/YCavJMRVtaDMVqvM4bKEw7DbluCGe7v9OjNHNCRLQ74T3sBfhXMmevR4306WSIG6CNU3OHGyHmhdLcn+n9mD+ZbfSdwfQuYJ2Ri1HQZogNA0Ty4Xj+h1bZ2QNs9j0DhbWCUajWW0/sJV2Gjp/FE9W4tfmgD5KudC8ZnABxajOTRvSEQFsBV86WsT/KAGjyvALwhizGNrM967xOx02LMqv5YRpEcILXlfPE/gBNlooDwrExLSg9I9DlhbirgzypZQwnBTjPS9UmpAUVGq+5fCq5Dlvl2xD2i40af8alGt+SAInHOqe8LZiiXhdLzPhECVAyblCxOSg7I510DVpZlareg5Mi2Fi73cvlAMZI+cEveRshG0xcRt52mJEpLercgkXgG94l+J79yK6Oh9PrUcBjOB8b3THB7A2r0rIDCddn2Jy/122glZlZ/EO/bzYBEPac9eDIPSha54hdAiXN4fD3pZkC+WjcYnlx5lxd2CdVw1XijvtwAJMqkwct+0yuBeUElzglRmXTeWhEt394A1OCdDygiEbUu2BZglvtzNZaMXg2eHQBPt+hEsOzErOrHbgASUzNdHWcKNRkdUVKGsQPKcaEriB+vnEcw3K33PSso7jdUTCmpLajRIwruH+rVarb8gCIH1o+ahvlDRsRMn+lowwsHt6M5IN63jouwHK6atSogX209GE/qUGe6aGmRAzsmzsXEQYN72b7a3YVRezfibKeO2R+ieriqZxPEdLDPG9A/42keo1Rwol68/dcPePOYngkNugKXu4zg804AK/vNezx9lmTgCAvbzv+JOQfq9RkjWyXBV/ciOPyJPk3mSMvCEd7UHd8H99E9+hwj+0uERu/7UJQafZqyL60FTrcSRuW3m3Ho2iV9jtlstQSf5yswP6VPU2/psj59Mb70NrRdD6G17SI6lXDGJrTAEUZWHNmN1f4DGduLCRLVExo8rQDfr1+bqkEMi6vufhBv3TsJDps98rdzne14ufVrNF3yazajFc4bR1vw3vGfNNtJLECHCL5aPxjDDdKIJcPGYt3oab3UKcxY1NqETWePSJvSCmfVHy1492+j4ETe9klCQ+1lI8sbF6YtQXmxMyEELZC0wjG25cTcDwhAXUZN6ZQ7+uPC9KUpW4gMpDyBI54jZCggu1hYOOM19LP3yRhSHsGJATL0E9s45nEsGpq+nJ2oJeUZHAEoYHgnPbCoGD9Pfh73lAxK2xnHQ8pDONFO2thhXlAZXOzEnoeek4a07LddWDhkZMLEMxHlLHXICUxFhvnsBIpaIKVtanE3mAdHDPMiUMxiqmE0JFPhiJeiphrZTVaNgmQ6nEhaIJJVE8odeiHlBE4EkCh3mFQwyxRSzuAgWjATpEwquWqFlDs4agetllzFZWLRXhZSTuGoZYm4or3J0z7pIOUcDtBj2kcQM3niUEDaVjn7puCwI9wN9+97sP7UQS2hURbu7TlxGAFk/tSz+L5d5XdhXGk5AqFObL94Av6Oq1l4YK0qE009W4sXVIpJFy+oo5m1/CXp8hcByFpAlWYBlTrkW0vw4rosaxFnFIbYgCe1iFMIWMuAY23IWkiuJqUaF5ILIWsrgjrqpwyhrM0saQAJetZ2KIkw3NpQJwHJ2pIpAcna1CsBydoWLgHJOlhAApJ1NIUEpFhaYh1ukpqWdTyOZGuyDliSBWUd0SVJCoCYUurufAbMU8E0Rf+WB3HIG7cA2FW4h7wlw8db7Gg8PbaQjgn8D3wVByqacZ9sAAAAAElFTkSuQmCC" alt="img">回答正确 +20分 正确答案为 ABCD</p></li><li><p><strong>4.</strong> <strong>多选题</strong>下面关于 nextTick 说法正确的是：**(20分)**</p><ul><li>A在修改完数据后，想要获取更新后 DOM 上最新数据，需要使用 nextTick，因为 DOM 的更新过程是异步的。</li><li>BnextTick 内部优先使用微任务执行异步的回调函数，如果浏览器不支持 Promise 的话会降级成 MutationObserver</li><li>C如果当前浏览器不支持微任务，会降级成宏任务，如果是 IE 浏览器的话优先使用 setImmediate，否则的的使用 setTimeout(callback, 0)</li><li>DnextTick 获取最新的 DOM 数据会导致页面卡顿，因此除非必要否则不建议使用 nextTick</li></ul><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAGTklEQVR4Xu2ce2xTdRTHv6cdHdDJIDPTEBDmM+EhrxmUEMxEUKQoESEaEIOPhIBghG6JJPqX8bF2EkEIiRET0MRgIC7rmBBkMI0vQBmIiArlFZBHExir2zp6j/n1pqVsffxu7+1ta+5N+s92z+N+7u/+fuec34Ng5sVsQ2PdOIDGgPg+sPihAsQDwLgFiPzEdQ2Ea2BqA8EPomNgOgZwK2au/BVEilluU9YN7Vw7GKGOOQBNBeNhgAfqs0lXQNgL8Ddw9NuK6cvO6dOXWjo7gJo/7Yv2wByAFwL8KABblh5CAWgXQJtQUrYVVYs6jbZjLKDmdSUIBhcDtBLMtxvtbEp9RP8AXAencwOqlrYbZdsYQM3NRfh3/3IovApAmVHOZagnABu9g/6Va1BVdT1DHTEx/YCavJMRVtaDMVqvM4bKEw7DbluCGe7v9OjNHNCRLQ74T3sBfhXMmevR4306WSIG6CNU3OHGyHmhdLcn+n9mD+ZbfSdwfQuYJ2Ri1HQZogNA0Ty4Xj+h1bZ2QNs9j0DhbWCUajWW0/sJV2Gjp/FE9W4tfmgD5KudC8ZnABxajOTRvSEQFsBV86WsT/KAGjyvALwhizGNrM967xOx02LMqv5YRpEcILXlfPE/gBNlooDwrExLSg9I9DlhbirgzypZQwnBTjPS9UmpAUVGq+5fCq5Dlvl2xD2i40af8alGt+SAInHOqe8LZiiXhdLzPhECVAyblCxOSg7I510DVpZlareg5Mi2Fi73cvlAMZI+cEveRshG0xcRt52mJEpLercgkXgG94l+J79yK6Oh9PrUcBjOB8b3THB7A2r0rIDCddn2Jy/122glZlZ/EO/bzYBEPac9eDIPSha54hdAiXN4fD3pZkC+WjcYnlx5lxd2CdVw1XijvtwAJMqkwct+0yuBeUElzglRmXTeWhEt394A1OCdDygiEbUu2BZglvtzNZaMXg2eHQBPt+hEsOzErOrHbgASUzNdHWcKNRkdUVKGsQPKcaEriB+vnEcw3K33PSso7jdUTCmpLajRIwruH+rVarb8gCIH1o+ahvlDRsRMn+lowwsHt6M5IN63jouwHK6atSogX209GE/qUGe6aGmRAzsmzsXEQYN72b7a3YVRezfibKeO2R+ieriqZxPEdLDPG9A/42keo1Rwol68/dcPePOYngkNugKXu4zg804AK/vNezx9lmTgCAvbzv+JOQfq9RkjWyXBV/ciOPyJPk3mSMvCEd7UHd8H99E9+hwj+0uERu/7UJQafZqyL60FTrcSRuW3m3Ho2iV9jtlstQSf5yswP6VPU2/psj59Mb70NrRdD6G17SI6lXDGJrTAEUZWHNmN1f4DGduLCRLVExo8rQDfr1+bqkEMi6vufhBv3TsJDps98rdzne14ufVrNF3yazajFc4bR1vw3vGfNNtJLECHCL5aPxjDDdKIJcPGYt3oab3UKcxY1NqETWePSJvSCmfVHy1492+j4ETe9klCQ+1lI8sbF6YtQXmxMyEELZC0wjG25cTcDwhAXUZN6ZQ7+uPC9KUpW4gMpDyBI54jZCggu1hYOOM19LP3yRhSHsGJATL0E9s45nEsGpq+nJ2oJeUZHAEoYHgnPbCoGD9Pfh73lAxK2xnHQ8pDONFO2thhXlAZXOzEnoeek4a07LddWDhkZMLEMxHlLHXICUxFhvnsBIpaIKVtanE3mAdHDPMiUMxiqmE0JFPhiJeiphrZTVaNgmQ6nEhaIJJVE8odeiHlBE4EkCh3mFQwyxRSzuAgWjATpEwquWqFlDs4agetllzFZWLRXhZSTuGoZYm4or3J0z7pIOUcDtBj2kcQM3niUEDaVjn7puCwI9wN9+97sP7UQS2hURbu7TlxGAFk/tSz+L5d5XdhXGk5AqFObL94Av6Oq1l4YK0qE009W4sXVIpJFy+oo5m1/CXp8hcByFpAlWYBlTrkW0vw4rosaxFnFIbYgCe1iFMIWMuAY23IWkiuJqUaF5ILIWsrgjrqpwyhrM0saQAJetZ2KIkw3NpQJwHJ2pIpAcna1CsBydoWLgHJOlhAApJ1NIUEpFhaYh1ukpqWdTyOZGuyDliSBWUd0SVJCoCYUurufAbMU8E0Rf+WB3HIG7cA2FW4h7wlw8db7Gg8PbaQjgn8D3wVByqacZ9sAAAAAElFTkSuQmCC" alt="img">回答正确 +20分</p><p>答案解析</p><p>D nextTick 用来异步获取 DOM 的最新数据，本身仅仅是用来开启一个微任务或者宏任务，所以它不会造成页面的卡顿，除非回调函数中的代码过于耗时会导致页面卡顿</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue响应式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.js 源码剖析-响应式原理</title>
      <link href="2021/062142659.html"/>
      <url>2021/062142659.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue源码解析-响应式原理"><a href="#Vue源码解析-响应式原理" class="headerlink" title="Vue源码解析-响应式原理"></a>Vue源码解析-响应式原理</h1><h2 id="课程目标"><a href="#课程目标" class="headerlink" title="课程目标"></a>课程目标</h2><ul><li>Vue.js的静态成员和实例成员初始化过程<ul><li><code>vue.use()</code>、<code>vue.set()</code>、vue.extened()等这些全局成员的创建过程</li><li>vm.$el、<code>vm.$data</code>、vm.$on、<code>vm.$mount</code>等这些实例成员的创建过程</li></ul></li><li>首次渲染的过程<ul><li>创建完vue实例，并把数据传递给vue之后，vue内部是如何把数据渲染到页面的，后续在分析源码过程中都是基于这个过程的</li></ul></li><li><strong>数据响应式原理（核心）</strong></li></ul><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h4 id="Vue源码的获取"><a href="#Vue源码的获取" class="headerlink" title="Vue源码的获取"></a>Vue源码的获取</h4><ul><li>项目地址：<a href="https://github.com/vuejs/vue">https://github.com/vuejs/vue</a></li><li>Fork一份到自己仓库，克隆到本地，可以自己写注释提交到github</li><li>为什么分析Vue2.6<ul><li>到目前为止Vue3.0的正式版本还没有发布</li><li>新版本发布后，现有项目不会升级到3.0，2.x患有很长一段过渡期</li><li>3.0项目地址：<a href="https://github.com/vuejs/vue-next">https://github.com/vuejs/vue-next</a></li></ul></li></ul><h4 id="源码目录结构"><a href="#源码目录结构" class="headerlink" title="源码目录结构"></a>源码目录结构</h4><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">vue    ├─dist  打包之后的结果，包含不同版本    ├─examples  示例    ├─flow      ├─packages    ├─scripts    ├─src        ├─compiler  编译相关（把模板转换成render函数，render函数会创建虚拟DOM）        ├─core  Vue 核心库        ├─components  定义vue自带的keep-alive组件        ├─global-api  定义vue中的静态方法，包含vue.component()、vue.filter()、vue.extend()等        ├─instance  创建vue示例的位置，定义vue的构造函数以及vue的初始化、生命周期的响应函数        ├─observer  响应式机制实现的位置        ├─utils  公共成员        ├─vdom  虚拟DOM，vue中的虚拟DOM重写了snabbdom，增加了组件的形式        ├─platforms 平台相关代码        ├─web  web平台下相关代码                ├─compiler                ├─runtime                ├─server                ├─util                ├─entry-compiler.js  打包入口文件                ├─entry-runtime.js  打包入口文件                ├─entry-runtime-with-compiler.js  打包入口文件                ├─entry-server-basic-renderer.js  打包入口文件                ├─entry-server-renderer.js  打包入口文件        ├─weex  week平台下相关代码（week是vue基于移动端下开发的框架）        ├─server SSR，服务端渲染        ├─sfc .vue 文件编译为 js 对象（Single File Component单文件组件）        └─shared 公共的代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="了解Flow"><a href="#了解Flow" class="headerlink" title="了解Flow"></a>了解Flow</h4><ul><li>官网：<a href="https://flow.org/">https://flow.org/</a></li><li>JavaScript的静态类型检查器</li><li>Flow的静态类型检车错误是通过静态类型推断实现的<ul><li>文件开头通过<code>// @flow</code> 或者<code>/* @flow */</code>声明</li></ul></li></ul><h4 id="调试设置"><a href="#调试设置" class="headerlink" title="调试设置"></a>调试设置</h4><h5 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h5><ul><li><p>打包工具Rollup</p><ul><li>vue.js源码的打包工具使用的是Rollup，比webpack清凉</li><li>Webpack把所有的文件当做模块，Rollup只处理js文件，更适合在Vue.js这样的库中使用</li><li>Rollup打包不会生成冗余的代码</li></ul></li><li><p>安装依赖</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>设置sourcemap</p><ul><li><p>package.json文件中的script的dev脚本中添加参数<code>--sourcemap</code></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"rollup -w -c scripts/config.js --sourcemap --environment TARGET:webfull-dev"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li><li><p>执行dev</p><ul><li><p>执行打包前先删除dist目录，rollup会自动生成dist目录</p></li><li><p>yarn dev执行打包，用的是rollup，-w参数是坚挺稳健的变化，文件变化自动重新打包</p></li><li><p>结果</p><p><img src="http://5coder.cn/img/image-20210621215220709.png"></p></li></ul></li></ul><h5 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h5><ul><li><p>examples的实例中引入的是vue.min.js，将其改为vue.js</p></li><li><p>打开Chrome的调试工具中的source</p><p><img src="http://5coder.cn/img/image-20210621215534350.png"></p></li></ul><iframe src="http://5coder.cn/static/video/20210621_215739.mp4" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height="500" width="700" autoplay="false"> </iframe><h4 id="Vue的不同构件版本"><a href="#Vue的不同构件版本" class="headerlink" title="Vue的不同构件版本"></a>Vue的不同构件版本</h4><ul><li><p>运行<code>yarn build</code>重新打包所有文件</p></li><li><p>官方文档 - <a href="https://cn.vuejs.org/v2/guide/installation.html#%E5%AF%B9%E4%B8%8D%E5%90%8C%E6%9E%84%E5%BB%BA%E7%89%88%E6%9C%AC%E7%9A%84%E8%A7%A3%E9%87%8A">对不同构建版本的解释</a></p></li><li><p>dist\README.md</p><table><thead><tr><th></th><th>UMD</th><th>CommonJS</th><th>ES Module</th></tr></thead><tbody><tr><td><strong>Full</strong></td><td>vue.js</td><td>vue.common.js</td><td>vue.esm.js</td></tr><tr><td><strong>Runtime-only</strong></td><td>vue.runtime.js</td><td>vue.common.min.js</td><td>vue.esm.min.js</td></tr><tr><td><strong>Full(Production)</strong></td><td>vue.min.js</td><td></td><td></td></tr><tr><td><strong>Runtime-only(Production)</strong></td><td>vue.runtime.min.js</td><td></td><td></td></tr></tbody></table></li></ul><h5 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h5><ul><li><strong>完整版</strong>：同时包含<strong>编译器</strong>和<strong>运行时</strong>的版本</li><li><strong>编译器</strong>：用来将模板字符串编译成为JavaScript渲染函数的代码，体积大、效率低</li><li><strong>运行时</strong>：用来创建Vue实例、渲染并处理虚拟DOM等的代码，体积小、效率高。基本上就是除去编译器的代码</li><li><strong><a href="https://github.com/umdjs/umd">UMD</a><strong>：UMD版本</strong>通用的模块版本</strong>，支持多种模块方式。vue.js默认文件就是运行时+编译器的UMD版本</li><li><a href="http://wiki.commonjs.org/wiki/Modules/1.1"><strong>CommonJS</strong></a>(cjs)：CommonJS版本用来配合老的打包工具比如<a href="https://browserify.org/">Browserify</a>或<a href="https://webpack.github.io/">webpack 1</a></li><li><a href="https://exploringjs.com/es6/ch_modules.html"><strong>ES Module</strong></a>：从2.6开始Vue会提供两个ES Module(ESM)构建稳健，为现代打包工具提供的版本<ul><li>ESM格式被设计为可以被静态分析，所以打包工具可以利用这一点来进行“Tree-Shaking”并将用不到的代码排除最终的包</li><li><a href="https://es6.ruanyifeng.com/#docs/module-loader#ES6-%E6%A8%A1%E5%9D%97%E4%B8%8E-CommonJS-%E6%A8%A1%E5%9D%97%E7%9A%84%E5%B7%AE%E5%BC%82">ES6模块与CommonJS模块的差异</a></li></ul></li></ul><h5 id="Runtime-Compiler-VS-Runtime-only"><a href="#Runtime-Compiler-VS-Runtime-only" class="headerlink" title="Runtime + Compiler VS Runtime-only"></a>Runtime + Compiler VS Runtime-only</h5><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../../dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token comment">// Compiler</span>  <span class="token comment">// 需要编译器，把template转换成render函数</span>  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    template<span class="token operator">:</span> <span class="token string">'&lt;h1&gt;{{ msg }}&lt;/h1&gt;'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      msg<span class="token operator">:</span> <span class="token string">"Hello Vue"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/image-20210621232639624.png"></p><p>将vue版本改为<code>vue.runtime.js</code>，发现浏览器报错，提示更改为render函数或者用compiler-included build。</p><p><img src="http://5coder.cn/img/image-20210621232855357.png"></p><p>更改template如下：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../../dist/vue.runtime.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token comment">// Compiler</span>  <span class="token comment">// 需要编译器，把template转换成render函数</span>  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    <span class="token comment">// template: '&lt;h1&gt;{{ msg }}&lt;/h1&gt;',</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      msg<span class="token operator">:</span> <span class="token string">"Hello Vue"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/image-20210621233125601.png"></p><h4 id="使用vue-cli创建项目时查看vue构件版本"><a href="#使用vue-cli创建项目时查看vue构件版本" class="headerlink" title="使用vue-cli创建项目时查看vue构件版本"></a>使用vue-cli创建项目时查看vue构件版本</h4><p>在使用<code>vue create projectName</code>创建的项目中，查看<code>vue</code>的构建版本。由于Vue对<code>webpack.config.js</code>进行了深度封装，所以在目录中无法看到其配置文件，但是Vue提供了命令行来查看配置文件。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vue inspect  <span class="token comment"># 直接输出到控制台</span>vue inspect <span class="token operator">&gt;</span> output.js  <span class="token comment"># 将执行vue inspect命令后的结果输出到output.js文件中</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/image-20210622055014013.png"></p><blockquote><p>output.js不是一个有效的<code>webpack</code>配置文件，不能拿来直接使用。</p></blockquote><p>可以看到在<code>resolve</code>中的<code>alias</code>中，vue-cli使用了<code>vue.runtime.esm.js</code>（运行时版本，模块化为ES Module）作为构建版本，<code>vue$</code>中的<code>$</code>符号为精确匹配，在使用时直接使用<code>import Vue from vue</code>。</p><blockquote><p>runtime+compiler与runtime对比（ast：抽象语法树），由下面过程可见runtime-only性能更高。</p><ul><li><strong>runtime+compiler</strong><ul><li><code>template -&gt; ast -&gt; render -&gt; vdom -&gt;UI</code></li></ul></li><li><strong>runtime-only</strong><ul><li><code>render -&gt; vdom -&gt; UI</code></li></ul></li></ul><p><img src="http://5coder.cn/img/image-20210622060735123.png"></p><p>以上内容来自<a href="https://www.bilibili.com/video/BV15741177Eh?p=96"><strong>coderwhy</strong>哔哩哔哩动画第96节视频</a></p></blockquote><h2 id="寻找入口文件"><a href="#寻找入口文件" class="headerlink" title="寻找入口文件"></a>寻找入口文件</h2><ul><li>查看dist/vue.js的构建过程</li></ul><h3 id="执行构建"><a href="#执行构建" class="headerlink" title="执行构建"></a>执行构建</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> dev<span class="token comment"># "dev": "rollup -w -c scripts/config.js --sourcemap --environment TARGET:web-full-dev"</span><span class="token comment"># --environment TARGET:web-full-dev 设置环境变量TARGET</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><p><code>script/config.js</code>的执行过程</p><ul><li>作用：生成<code>rollup</code>构建的配置文件</li><li>使用环境变量<code>TARGET=web-full-dev</code></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 判断环境变量中是否有TARGET</span><span class="token comment">// 如果有的话，使用genConfig()生成rullup配置文件</span><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TARGET</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">genConfig</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TARGET</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// 否则获取全部配置</span>    exports<span class="token punctuation">.</span>getBuild <span class="token operator">=</span> getConfig    exports<span class="token punctuation">.</span><span class="token function-variable function">getAllBuilds</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Objet<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>builds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>genconfig<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>genConfig(name)</code></p><ul><li>根据环境变量TARGET获取配置信息</li><li>builds[name]获取生成配置的信息</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Runtime+compiler development build (Browser)</span><span class="token string">'web-full-dev'</span><span class="token operator">:</span> <span class="token punctuation">{</span>    entry<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'web/entry-runtime-with-compiler.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    dest<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'dist/vue.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    format<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>    env<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>    alias<span class="token operator">:</span> <span class="token punctuation">{</span> he<span class="token operator">:</span> <span class="token string">'./entity-decoder'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    banner<span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>resolve()</code></p><ul><li>获取入口和出口文件的绝对路径</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> aliases <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./alias'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">p</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 根据路径中的前半部分去alias中找别名</span>    <span class="token keyword">const</span> base <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>aliases<span class="token punctuation">[</span>base<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>aliases<span class="token punctuation">[</span>base<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../'</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><ul><li>把<code>src/platforms/web/entry-runtime-with-compiler.js</code>构建成<code>dist/vue.js</code>，如果设置<code>--sourcemap</code>，则会生成<code>vue.js.map</code>文件</li><li><code>src/platform</code>文件夹下是Vue可以构建成不同平台下使用的库，目前有<code>weex</code>和<code>web</code>，还有服务端渲染<code>SSR</code>的库</li></ul><h2 id="从入口开始"><a href="#从入口开始" class="headerlink" title="从入口开始"></a>从入口开始</h2><ul><li>src/platform/web/entry-runtime-with-compiler.js</li></ul><h4 id="通过查看源码解决下面问题"><a href="#通过查看源码解决下面问题" class="headerlink" title="通过查看源码解决下面问题"></a>通过查看源码解决下面问题</h4><ul><li>观察以下代码，通过阅读源码，回答在页面上输出的结果</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    template<span class="token operator">:</span> <span class="token string">'&lt;h3&gt;Hello Template&lt;/h3&gt;'</span><span class="token punctuation">,</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h4'</span><span class="token punctuation">,</span> <span class="token string">'Hello Render'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>阅读源码记录</p><ul><li>el不能是body或者html标签</li><li>如果没有render，把template转换成render函数</li><li>如果有render方法，直接调用mount挂载DOM</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 1. el 不能是 body 或者 htmlif (el === document.body || el === document.documentElement) {  process.env.NODE_ENV !== 'production' &amp;&amp; warn(    `Do not mount Vue to &lt;html&gt; or &lt;body&gt; - mount to normal elementsinstead.`  )  return this}const options = this.$optionsif (!options.render) {// 2. 把 template/el 转换成 render 函数……}// 3. 调用 mount 方法，挂载 DOMreturn mount.call(this, el, hydrating)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>调试代码<ul><li>调试的方法</li></ul></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    template<span class="token operator">:</span> <span class="token string">'&lt;h3&gt;Hello template&lt;/h3&gt;'</span><span class="token punctuation">,</span>    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h4'</span><span class="token punctuation">,</span> <span class="token string">'Hello render'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="http://5coder.cn/img/image-20210622223137140.png"></p></li></ul><h4 id="Vue的构造函数在哪里"><a href="#Vue的构造函数在哪里" class="headerlink" title="Vue的构造函数在哪里"></a>Vue的构造函数在哪里</h4><blockquote><p>Vue的构造函数在哪？</p><p>Vue实例的成员/Vue的静态成员从哪里来的？</p></blockquote><ul><li><p><code>src/platform/web/entry-runtime-with-compiler.js</code>中引用了’<code>./runtime/index</code>‘</p></li><li><p><code>src/platform/web/runtime/index.js</code></p><ul><li>设置Vue.config</li><li>设置平台相关的指令和组件<ul><li>指令v-model、v-show</li><li>组件transition、transition-group</li></ul></li><li>设置平台相关的<code>__patch__</code>方法（打补丁方法，对比新旧的VNode）</li><li>设置<code>$mount</code>方法，挂载DOM</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">/</span> install platform runtime directives <span class="token operator">&amp;</span> components<span class="token comment">// 注册跟平台相关指令和组件extend(Vue.options.directives, platformDirectives)  // 注册指令v-model、v-showextend(Vue.options.components, platformComponents)  // 注册组件v-transition、v-TransitionGroup// install platform patch function// 如果为浏览器环境则返回patch，否则返回noop空函数Vue.prototype.__patch__ = inBrowser ? patch : noop// public mount methodVue.prototype.$mount = function (  el?: string | Element,  hydrating?: boolean): Component {  el = el &amp;&amp; inBrowser ? query(el) : undefined  return mountComponent(this, el, hydrating)  // 渲染DOM}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>src/platform/web/runtime/index.js</code>中引用了’<code>core/index</code>‘</li><li><code>src/core/index.js</code><ul><li>定义了Vue的静态方法</li><li><code>initGlobalAPI(Vue)</code></li></ul></li><li><code>src/core/index.js</code>中引用了’<code>./instance/index</code>‘</li><li><code>src/core/instance/index.js</code><ul><li>定义了Vue的构造函数</li></ul></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">/</span> 此处不用<span class="token keyword">class</span>的原因是因为方便后续给Vue实例混入实例成员<span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vue</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Vue is a constructor and should be called with the `new` keyword'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 调用_init()方法  this._init(options)}// 注册vm的_init()方法，初始化vminitMixin(Vue)// 注册vm的$data/$props/$set/$delete/$watchstateMixin(Vue)// 初始化事件相关方法// $on/$once/$off/$emiteventsMixin(Vue)// 初始化生命周期相关的混入方法// _update/$forceUpdate/$destroylifecycleMixin(Vue)// 混入render// $nextTick/_renderrenderMixin(Vue)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h4 id="四个导出Vue的模块"><a href="#四个导出Vue的模块" class="headerlink" title="四个导出Vue的模块"></a>四个导出Vue的模块</h4><ul><li><code>src/platform/web/entry-runtime-with-compiler.js</code>(核心作用：增加了编译的功能)<ul><li>web平台相关的入口</li><li>重写了平台相关的<code>$mount()</code>方法</li><li>除了使用<code>$mount</code>方法可以将模板字符串转换成<code>render()</code>函数，还定义了<code>Vue.compile()</code>方法可以将模板字符串转换成<code>render()</code>函数</li><li>注册了<code>Vue.compile()</code>方法，传递了一个HTML字符串返回<code>render</code>函数</li></ul></li><li><code>src/platform/web/runtime/index.js</code><ul><li>web平台相关</li><li>注册和平台相关的全局指令：<code>v-model</code>、<code>v-show</code></li><li>注册和平台相关的全局组件：<code>v-transition</code>、<code>v-transition-group</code></li><li>全局方法：<ul><li><code>__patch__</code>：把虚拟DOM转换成真实DOM</li><li><code>$mount</code>：挂载方法，把DOM渲染到界面上</li></ul></li></ul></li><li><code>src/core/index.js</code><ul><li>与平台无关</li><li>设置了Vue的静态方法，<code>initGlobalAPI(Vue)</code></li></ul></li><li>src/core/instance/index.js<ul><li>与平台无关</li><li>定义了Vue构造函数，调用了<code>this._init(options)</code>方法</li><li>给Vue中混入了常用的实例成员</li></ul></li></ul><p><img src="http://5coder.cn/img/Snipaste_2021-06-23_06-11-34.png" alt="Snipaste_2021-06-23_06-11-34"></p><h2 id="Vue的初始化"><a href="#Vue的初始化" class="headerlink" title="Vue的初始化"></a>Vue的初始化</h2><h3 id="src-core-global-api-index-js"><a href="#src-core-global-api-index-js" class="headerlink" title="src/core/global-api/index.js"></a>src/core/global-api/index.js</h3><ul><li>初始化Vue的静态方法</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* @flow */</span><span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'../config'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initUse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./use'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./mixin'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initExtend <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./extend'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initAssetRegisters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./assets'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> set<span class="token punctuation">,</span> del <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../observer/index'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">ASSET_TYPES</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'shared/constants'</span><span class="token keyword">import</span> builtInComponents <span class="token keyword">from</span> <span class="token string">'../components/index'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> observe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'core/observer/index'</span><span class="token keyword">import</span> <span class="token punctuation">{</span>  warn<span class="token punctuation">,</span>  extend<span class="token punctuation">,</span>  nextTick<span class="token punctuation">,</span>  mergeOptions<span class="token punctuation">,</span>  defineReactive<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initGlobalAPI</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> GlobalAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// config</span>  <span class="token keyword">const</span> configDef <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  configDef<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> config  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    configDef<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token function">warn</span><span class="token punctuation">(</span>        <span class="token string">'Do not replace the Vue.config object, set individual fields instead.'</span>      <span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// 初始化Vue.config对象</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> <span class="token string">'config'</span><span class="token punctuation">,</span> configDef<span class="token punctuation">)</span>  <span class="token comment">// exposed util methods.</span>  <span class="token comment">// NOTE: these are not considered part of the public API - avoid relying on</span>  <span class="token comment">// them unless you are aware of the risk.</span>  <span class="token comment">// 这些工具方法不视作全局API的一部分，除非你已经意识到某些风险，否则不要去依赖他们</span>  Vue<span class="token punctuation">.</span>util <span class="token operator">=</span> <span class="token punctuation">{</span>    warn<span class="token punctuation">,</span>    extend<span class="token punctuation">,</span>    mergeOptions<span class="token punctuation">,</span>    defineReactive  <span class="token punctuation">}</span>  <span class="token comment">// 静态方法 set/delete/nextTick</span>  Vue<span class="token punctuation">.</span>set <span class="token operator">=</span> <span class="token keyword">set</span>  Vue<span class="token punctuation">.</span>delete <span class="token operator">=</span> del  Vue<span class="token punctuation">.</span>nextTick <span class="token operator">=</span> nextTick  <span class="token comment">// 2.6 explicit observable API</span>  <span class="token comment">// 让一个对象可响应</span>  Vue<span class="token punctuation">.</span>observable <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter"><span class="token constant">T</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token function">observe</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>    <span class="token keyword">return</span> obj  <span class="token punctuation">}</span> <span class="token comment">// 初始化vue.options对象，并给其扩展</span>  Vue<span class="token punctuation">.</span>options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>  <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    Vue<span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// this is used to identify the "base" constructor to extend all plain-object</span>  <span class="token comment">// components with in Weex's multi-instance scenarios.</span>  Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>_base <span class="token operator">=</span> Vue  <span class="token comment">// 设置 keep-alive组件</span>  <span class="token function">extend</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components<span class="token punctuation">,</span> builtInComponents<span class="token punctuation">)</span>  <span class="token comment">// 注册Vue.use()用来注册插件</span>  <span class="token function">initUse</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>  <span class="token comment">// 注册Vue.mixin()实现混入</span>  <span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>  <span class="token comment">// 注册Vue.extend()基于传入的options返回一个组件的构造函数</span>  <span class="token function">initExtend</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>  <span class="token comment">// 注册Vue.directive()、Vue.component()、Vue.filter()</span>  <span class="token function">initAssetRegisters</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>src/core/global-api/use.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* @flow */</span><span class="token keyword">import</span> <span class="token punctuation">{</span> toArray <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initUse</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> GlobalAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  Vue<span class="token punctuation">.</span><span class="token function-variable function">use</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">plugin<span class="token operator">:</span> Function <span class="token operator">|</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> installedPlugins <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_installedPlugins <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_installedPlugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedPlugins<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">this</span>    <span class="token punctuation">}</span>    <span class="token comment">// additional parameters    // 把数组中的第一个元素(plugin)去除，后面的是install方法或plugin的参数的参数    const args = toArray(arguments, 1)    args.unshift(this)    // 把this(Vue)插入第一个元素的位置    if (typeof plugin.install === 'function') {      plugin.install.apply(plugin, args)    } else if (typeof plugin === 'function') {      plugin.apply(null, args)    }    installedPlugins.push(plugin)    return this  }}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>src/core/global-api/mixin.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* @flow */</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mergeOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> GlobalAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  Vue<span class="token punctuation">.</span><span class="token function-variable function">mixin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">mixin<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">,</span> mixin<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token keyword">this</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>src/core/global-api/extend.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* @flow */</span><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">ASSET_TYPES</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'shared/constants'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComputed<span class="token punctuation">,</span> proxy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../instance/state'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> extend<span class="token punctuation">,</span> mergeOptions<span class="token punctuation">,</span> validateComponentName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initExtend</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> GlobalAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">/**   * Each instance constructor, including Vue, has a unique   * cid. This enables us to create wrapped "child   * constructors" for prototypal inheritance and cache them.   */</span>  Vue<span class="token punctuation">.</span>cid <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> cid <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment">/**   * Class inheritance   */</span>  Vue<span class="token punctuation">.</span><span class="token function-variable function">extend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">extendOptions<span class="token operator">:</span> Object</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>    extendOptions <span class="token operator">=</span> extendOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment">// Vue的构造函数</span>    <span class="token keyword">const</span> Super <span class="token operator">=</span> <span class="token keyword">this</span>    <span class="token keyword">const</span> SuperId <span class="token operator">=</span> Super<span class="token punctuation">.</span>cid    <span class="token comment">// 从缓存中加载组件的构造函数</span>    <span class="token keyword">const</span> cachedCtors <span class="token operator">=</span> extendOptions<span class="token punctuation">.</span>_Ctor <span class="token operator">||</span> <span class="token punctuation">(</span>extendOptions<span class="token punctuation">.</span>_Ctor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> name <span class="token operator">=</span> extendOptions<span class="token punctuation">.</span>name <span class="token operator">||</span> Super<span class="token punctuation">.</span>options<span class="token punctuation">.</span>name    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果是开发环境验证组件的名称</span>      <span class="token function">validateComponentName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 组件对应的构造函数</span>    <span class="token keyword">const</span> <span class="token function-variable function">Sub</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">VueComponent</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 调用——init()初始化</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 原型继承自Vue</span>    <span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Super</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>    <span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Sub    Sub<span class="token punctuation">.</span>cid <span class="token operator">=</span> cid<span class="token operator">++</span>    <span class="token comment">// 合并options</span>    Sub<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>      Super<span class="token punctuation">.</span>options<span class="token punctuation">,</span>      extendOptions    <span class="token punctuation">)</span>    Sub<span class="token punctuation">[</span><span class="token string">'super'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Super    <span class="token comment">// For props and computed properties, we define the proxy getters on</span>    <span class="token comment">// the Vue instances at extension time, on the extended prototype. This</span>    <span class="token comment">// avoids Object.defineProperty calls for each instance created.</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">initProps</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">initComputed</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// allow further extension/mixin/plugin usage</span>    Sub<span class="token punctuation">.</span>extend <span class="token operator">=</span> Super<span class="token punctuation">.</span>extend    Sub<span class="token punctuation">.</span>mixin <span class="token operator">=</span> Super<span class="token punctuation">.</span>mixin    Sub<span class="token punctuation">.</span>use <span class="token operator">=</span> Super<span class="token punctuation">.</span>use    <span class="token comment">// create asset registers, so extended classes</span>    <span class="token comment">// can have their private assets too.</span>    <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      Sub<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> Super<span class="token punctuation">[</span>type<span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// enable recursive self-lookup</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>      Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> Sub    <span class="token punctuation">}</span>    <span class="token comment">// keep a reference to the super options at extension time.</span>    <span class="token comment">// later at instantiation we can check if Super's options have</span>    <span class="token comment">// been updated.</span>    Sub<span class="token punctuation">.</span>superOptions <span class="token operator">=</span> Super<span class="token punctuation">.</span>options    Sub<span class="token punctuation">.</span>extendOptions <span class="token operator">=</span> extendOptions    Sub<span class="token punctuation">.</span>sealedOptions <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Sub<span class="token punctuation">.</span>options<span class="token punctuation">)</span>    <span class="token comment">// cache constructor</span>    cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span> <span class="token operator">=</span> Sub    <span class="token keyword">return</span> Sub  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>src/core/global-api/extend.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* @flow */</span><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">ASSET_TYPES</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'shared/constants'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> isPlainObject<span class="token punctuation">,</span> validateComponentName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initAssetRegisters</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> GlobalAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">/**   * Create asset registration methods.   */</span>  <span class="token comment">// 遍历ASSET_TYPE数组，为Vue定义响应方法</span>  <span class="token comment">// ASSET_TYPE包括了directive、component、filter</span>  <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    Vue<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>      <span class="token parameter">id<span class="token operator">:</span> string<span class="token punctuation">,</span>      definition<span class="token operator">:</span> Function <span class="token operator">|</span> Object</span>    <span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token operator">|</span> Object <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>definition<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment">/* istanbul ignore if */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> type <span class="token operator">===</span> <span class="token string">'component'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">validateComponentName</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token comment">// Vue.component('comp', { template: '' })</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'component'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          definition<span class="token punctuation">.</span>name <span class="token operator">=</span> definition<span class="token punctuation">.</span>name <span class="token operator">||</span> id          <span class="token comment">// 把组件配置转换为组件的构造函数</span>          definition <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>_base<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'directive'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> definition <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          definition <span class="token operator">=</span> <span class="token punctuation">{</span> bind<span class="token operator">:</span> definition<span class="token punctuation">,</span> update<span class="token operator">:</span> definition <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">// 全局注册，存储资源并赋值</span>        <span class="token comment">// this.options['components']['comp'] = definition</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> definition        <span class="token keyword">return</span> definition      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/image-20210628055348086.png"></p><h3 id="src-core-instance-index-js"><a href="#src-core-instance-index-js" class="headerlink" title="src/core/instance/index.js"></a>src/core/instance/index.js</h3><ul><li>定义Vue的构造函数</li><li>初始化Vue的实例成员</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> initMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./init'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> stateMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./state'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> renderMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./render'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> eventsMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./events'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> lifecycleMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./lifecycle'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> warn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token comment">// Vue构造函数，此处不用class的原因是因为方便后续给Vue实例混入实例成员</span><span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vue</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Vue is a constructor and should be called with the `new` keyword'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 调用_init()方法</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 注册vm的_init()方法，初始化vm</span><span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token comment">// 注册vm的$data/$props/$set/$delete/$watch</span><span class="token function">stateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token comment">// 初始化事件相关方法</span><span class="token comment">// $on/$once/$off/$emit</span><span class="token function">eventsMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token comment">// 初始化生命周期相关的混入方法</span><span class="token comment">// _update/$forceUpdate/$destroy</span><span class="token function">lifecycleMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token comment">// 混入render</span><span class="token comment">// $nextTick/_render</span><span class="token function">renderMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> Vue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>initMixin(Vue)—-（src/core/instance/init.js）</p><ul><li><p>初始化<code>_init()</code>方法</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* @flow */</span><span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'../config'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initProxy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./proxy'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./state'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initRender <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./render'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initEvents <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./events'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> mark<span class="token punctuation">,</span> measure <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/perf'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initLifecycle<span class="token punctuation">,</span> callHook <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./lifecycle'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> initProvide<span class="token punctuation">,</span> initInjections <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./inject'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> extend<span class="token punctuation">,</span> mergeOptions<span class="token punctuation">,</span> formatComponentName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">let</span> uid <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 给vue的原型挂载init方法</span>  <span class="token comment">// 合并options / 初始化操作</span>  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> vm<span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>    <span class="token comment">// a uid</span>    vm<span class="token punctuation">.</span>_uid <span class="token operator">=</span> uid<span class="token operator">++</span>    <span class="token keyword">let</span> startTag<span class="token punctuation">,</span> endTag    <span class="token comment">/* istanbul ignore if */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>      startTag <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-perf-start:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>vm<span class="token punctuation">.</span>_uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>      endTag <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-perf-end:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>vm<span class="token punctuation">.</span>_uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>      <span class="token function">mark</span><span class="token punctuation">(</span>startTag<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// a flag to avoid this being observed</span>    <span class="token comment">// 如果是Vue实例则不需要被observe</span>    vm<span class="token punctuation">.</span>_isVue <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token comment">// merge options</span>    <span class="token comment">// 合并options</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>_isComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// optimize internal component instantiation</span>      <span class="token comment">// since dynamic options merging is pretty slow, and none of the</span>      <span class="token comment">// internal component options needs special treatment.</span>      <span class="token function">initInternalComponent</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> options<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      vm<span class="token punctuation">.</span>$options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>        <span class="token function">resolveConstructorOptions</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">,</span>        options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        vm      <span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">/* istanbul ignore else */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">initProxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      vm<span class="token punctuation">.</span>_renderProxy <span class="token operator">=</span> vm    <span class="token punctuation">}</span>    <span class="token comment">// expose real self</span>    vm<span class="token punctuation">.</span>_self <span class="token operator">=</span> vm    <span class="token comment">// Vm</span>    <span class="token comment">// vm的生命周期相关变量初始化</span>    <span class="token comment">// $children/$parent/$root/$refs</span>    <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>        <span class="token comment">// vm的事件监听初始化，父组件绑定在当前组件的事件</span>    <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>        <span class="token comment">// vm的编译render初始化</span>    <span class="token comment">// $slots/$scopedSlots_c/$createElement/$attrs/$listeners</span>    <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>        <span class="token comment">// beforeCreate生命钩子的回调</span>    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span>        <span class="token comment">// 把inject的成员注入到vm上</span>    <span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve injections before data/props</span>        <span class="token comment">// 初始化vm的_props/methods/_data/computed/watch</span>    <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>        <span class="token comment">// 初始化provide</span>    <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve provide after data/props</span>        <span class="token comment">// create生命钩子的回调</span>    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span>    <span class="token comment">/* istanbul ignore if */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>      vm<span class="token punctuation">.</span>_name <span class="token operator">=</span> <span class="token function">formatComponentName</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>      <span class="token function">mark</span><span class="token punctuation">(</span>endTag<span class="token punctuation">)</span>      <span class="token function">measure</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>vm<span class="token punctuation">.</span>_name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> init</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> startTag<span class="token punctuation">,</span> endTag<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>      vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initInternalComponent</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component<span class="token punctuation">,</span> options<span class="token operator">:</span> InternalComponentOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>options<span class="token punctuation">)</span>  <span class="token comment">// doing this because it's faster than dynamic enumeration.</span>  <span class="token keyword">const</span> parentVnode <span class="token operator">=</span> options<span class="token punctuation">.</span>_parentVnode  opts<span class="token punctuation">.</span>parent <span class="token operator">=</span> options<span class="token punctuation">.</span>parent  opts<span class="token punctuation">.</span>_parentVnode <span class="token operator">=</span> parentVnode  <span class="token keyword">const</span> vnodeComponentOptions <span class="token operator">=</span> parentVnode<span class="token punctuation">.</span>componentOptions  opts<span class="token punctuation">.</span>propsData <span class="token operator">=</span> vnodeComponentOptions<span class="token punctuation">.</span>propsData  opts<span class="token punctuation">.</span>_parentListeners <span class="token operator">=</span> vnodeComponentOptions<span class="token punctuation">.</span>listeners  opts<span class="token punctuation">.</span>_renderChildren <span class="token operator">=</span> vnodeComponentOptions<span class="token punctuation">.</span>children  opts<span class="token punctuation">.</span>_componentTag <span class="token operator">=</span> vnodeComponentOptions<span class="token punctuation">.</span>tag  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>    opts<span class="token punctuation">.</span>render <span class="token operator">=</span> options<span class="token punctuation">.</span>render    opts<span class="token punctuation">.</span>staticRenderFns <span class="token operator">=</span> options<span class="token punctuation">.</span>staticRenderFns  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">resolveConstructorOptions</span> <span class="token punctuation">(</span><span class="token parameter">Ctor<span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> options <span class="token operator">=</span> Ctor<span class="token punctuation">.</span>options  <span class="token keyword">if</span> <span class="token punctuation">(</span>Ctor<span class="token punctuation">.</span>super<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> superOptions <span class="token operator">=</span> <span class="token function">resolveConstructorOptions</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">.</span>super<span class="token punctuation">)</span>    <span class="token keyword">const</span> cachedSuperOptions <span class="token operator">=</span> Ctor<span class="token punctuation">.</span>superOptions    <span class="token keyword">if</span> <span class="token punctuation">(</span>superOptions <span class="token operator">!==</span> cachedSuperOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// super option changed,</span>      <span class="token comment">// need to resolve new options.</span>      Ctor<span class="token punctuation">.</span>superOptions <span class="token operator">=</span> superOptions      <span class="token comment">// check if there are any late-modified/attached options (#4976)</span>      <span class="token keyword">const</span> modifiedOptions <span class="token operator">=</span> <span class="token function">resolveModifiedOptions</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">)</span>      <span class="token comment">// update base extend options</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>modifiedOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">extend</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">.</span>extendOptions<span class="token punctuation">,</span> modifiedOptions<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      options <span class="token operator">=</span> Ctor<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>superOptions<span class="token punctuation">,</span> Ctor<span class="token punctuation">.</span>extendOptions<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        options<span class="token punctuation">.</span>components<span class="token punctuation">[</span>options<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> Ctor      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> options<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">resolveModifiedOptions</span> <span class="token punctuation">(</span><span class="token parameter">Ctor<span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Object <span class="token punctuation">{</span>  <span class="token keyword">let</span> modified  <span class="token keyword">const</span> latest <span class="token operator">=</span> Ctor<span class="token punctuation">.</span>options  <span class="token keyword">const</span> sealed <span class="token operator">=</span> Ctor<span class="token punctuation">.</span>sealedOptions  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> latest<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>latest<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> sealed<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>modified<span class="token punctuation">)</span> modified <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>      modified<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> latest<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> modified<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>stateMixin(Vue)</p><p><img src="http://5coder.cn/img/image-20210628060200588.png"></p></li><li><p>eventsMixin(Vue)</p><p><img src="http://5coder.cn/img/image-20210628060108441.png"></p></li><li><p>lifecycleMixin(Vue)</p></li></ul><p><img src="http://5coder.cn/img/image-20210628060417525.png"></p><ul><li>renderMixin(Vue)</li></ul><p><img src="http://5coder.cn/img/image-20210628060433991.png"></p><h2 id="首次渲染过程"><a href="#首次渲染过程" class="headerlink" title="首次渲染过程"></a>首次渲染过程</h2><ul><li>Vue初始化完毕，开始真正的执行</li><li>调用new Vue()之前，已经初始化完毕</li><li>通过调试代码，记录首次渲染过程</li></ul><p><img src="http://5coder.cn/img/%E9%A6%96%E6%AC%A1%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B.png" alt="首次渲染过程"></p><h2 id="数据响应式原理"><a href="#数据响应式原理" class="headerlink" title="数据响应式原理"></a>数据响应式原理</h2><p>参考之前的文章：<a href="http://blog.5coder.cn/2021/052627165.html">模拟Vue.js响应式原理</a>，文章中自己模拟了响应式原理，实现了简易版的响应式机制，其中的思想与方法与Vue.js源码吻合，可对照查看。</p><h3 id="通过查看源码解决下面问题-1"><a href="#通过查看源码解决下面问题-1" class="headerlink" title="通过查看源码解决下面问题"></a>通过查看源码解决下面问题</h3><ul><li><code>vm.msg = { count: 0 }</code>，重新给属性赋值，是否是响应式的？</li><li><code>vm.arr[0] = 4</code>，给数组元素赋值，视图是否会更新？</li><li><code>vm.arr.length = 0</code>， 修改数组的length，视图是否会更新？</li><li><code>vm.arr.push(4)</code>，视图是否会更新？</li></ul><h3 id="响应式处理的入口"><a href="#响应式处理的入口" class="headerlink" title="响应式处理的入口"></a>响应式处理的入口</h3><p>整个响应式处理的过程是比较复杂的，下面我们先从</p><ul><li><p><code>src/core/instance/init.js</code></p><ul><li><code>initState(vm)</code>vm状态的初始化</li><li>初始化了<code>_data、_props、methods</code>等</li></ul></li><li><p><code>src/core/instance/state.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 数据的初始化</span><span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">observe</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>initData(vm)</code> vm数据的初始化</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">initData</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> data <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data  <span class="token comment">// 初始化_data,组件中data是函数，调用函数返回结果</span>  <span class="token comment">// 否则直接返回data</span>  data <span class="token operator">=</span> vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span>    <span class="token operator">?</span> <span class="token function">getData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>    <span class="token operator">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>      <span class="token string">'data functions should return an object:\n'</span> <span class="token operator">+</span>      <span class="token string">'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function'</span><span class="token punctuation">,</span>      vm    <span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// proxy data on instance</span>  <span class="token comment">// 获取data中的所有属性</span>  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment">// 获取props / methods</span>  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props  <span class="token keyword">const</span> methods <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>methods  <span class="token keyword">let</span> i <span class="token operator">=</span> keys<span class="token punctuation">.</span>length  <span class="token comment">// 判断data上的成员是否和props/methods重名</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>methods <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>methods<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">warn</span><span class="token punctuation">(</span>          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Method "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" has already been defined as a data property.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>          vm        <span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>props <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The data property "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" is already declared as a prop. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Use prop default value instead.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>        vm      <span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isReserved</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_data</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// observe data</span>  <span class="token comment">// 响应式处理</span>  <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>src/core/observer/index.js</code></p><ul><li><p><code>observe(value, asRootData)</code></p></li><li><p>负责为每一个Object类型的value创建一个<code>observer</code>实例</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any<span class="token punctuation">,</span> asRootData<span class="token operator">:</span> <span class="token operator">?</span>boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>  <span class="token comment">// 判断 value 是否是对象  if (!isObject(value) || value instanceof VNode) {    return  }  let ob: Observer | void  // 如果 value 有 __ob__(observer对象) 属性 结束  if (hasOwn(value, '__ob__') &amp;&amp; value.__ob__ instanceof Observer) {    ob = value.__ob__  } else if (    shouldObserve &amp;&amp;    !isServerRendering() &amp;&amp;    (Array.isArray(value) || isPlainObject(value)) &amp;&amp;    Object.isExtensible(value) &amp;&amp;    !value._isVue  ) {    // 创建一个 Observer 对象    ob = new Observer(value)  }  if (asRootData &amp;&amp; ob) {    ob.vmCount++  }  return ob}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li></ul><h3 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h3><ul><li><p><code>src/core/observer/index.js</code></p><ul><li><p>对对象做响应化处理</p></li><li><p>对数组做响应化处理</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>  <span class="token comment">// 观测对象  value: any;  // 依赖对象  dep: Dep;  // 实例计数器  vmCount: number; // number of vms that have this object as root $data  constructor (value: any) {    this.value = value    this.dep = new Dep()    // 初始化实例的 vmCount 为0    this.vmCount = 0    // 将实例挂载到观察对象的 __ob__ 属性    def(value, '__ob__', this)    // 数组的响应式处理    if (Array.isArray(value)) {      if (hasProto) {        protoAugment(value, arrayMethods)      } else {        copyAugment(value, arrayMethods, arrayKeys)      }      // 为数组中的每一个对象创建一个 observer 实例      this.observeArray(value)    } else {      // 遍历对象中的每一个属性，转换成 setter/getter      this.walk(value)    }  }  /**   * Walk through all properties and convert them into   * getter/setters. This method should only be called when   * value type is Object.   */  walk (obj: Object) {    // 获取观察对象的每一个属性    const keys = Object.keys(obj)    // 遍历每一个属性，设置为响应式数据    for (let i = 0; i &lt; keys.length; i++) {      defineReactive(obj, keys[i])    }  }  /**   * Observe a list of Array items.   */  observeArray (items: Array&lt;any&gt;) {    for (let i = 0, l = items.length; i &lt; l; i++) {      observe(items[i])    }  }}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>wakl(obj)</code></p><ul><li>遍历obj的所有属性，为每一个属性调用<code>defineReactive()</code>方法，设置<code>getter/setter</code></li></ul></li></ul></li></ul><h3 id="defineReactive"><a href="#defineReactive" class="headerlink" title="defineReactive()"></a>defineReactive()</h3><ul><li><code>src/core/observer/index.js</code></li><li><code>defineReactive(obj, key, val, customSetter, shallow)</code><ul><li>为一个对象定义一个响应式的属性，每一个属性对应一个<code>dep</code>对象</li><li>如果该属性的值是对象，继续调用<code>observe</code></li><li>如果给属性赋新值，继续调用<code>observe</code></li><li>如果数据更新发送通知</li></ul></li></ul><h4 id="对象响应式处理"><a href="#对象响应式处理" class="headerlink" title="对象响应式处理"></a>对象响应式处理</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * Define a reactive property on an Object. */</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span> <span class="token punctuation">(</span>  <span class="token parameter">obj<span class="token operator">:</span> Object<span class="token punctuation">,</span>  key<span class="token operator">:</span> string<span class="token punctuation">,</span>  val<span class="token operator">:</span> any<span class="token punctuation">,</span>  customSetter<span class="token operator">?</span><span class="token operator">:</span> <span class="token operator">?</span>Function<span class="token punctuation">,</span>  shallow<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 1.为每一个属性，创建依赖对象实例</span>  <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 获取obj的属性描述符</span>  <span class="token keyword">const</span> property <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>configurable <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token comment">// 提供预定义的存取器函数</span>  <span class="token comment">// cater for pre-defined getter/setters</span>  <span class="token keyword">const</span> getter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>get  <span class="token keyword">const</span> setter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>set  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>getter <span class="token operator">||</span> setter<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>  <span class="token punctuation">}</span>  <span class="token comment">// 2.判断是否递归观察子对象，并将子对象属性都转换成getter/setter，返回子观察对象</span>  <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果预定义的getter存在，则value等于getter调用的返回值</span>      <span class="token comment">// 否则直接赋予属性值</span>      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val      <span class="token comment">// 如果存在当前依赖目标，即watcher对象，则建立依赖</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// dep()添加相互的依赖</span>        <span class="token comment">// 一个组件对应一个watcher对象</span>        <span class="token comment">// 一个watcher会对应多个dep（要观察的属性很多）</span>        <span class="token comment">// 我们可以手动创建多个watcher监听一个属性的变化，一个dep可以对应多个watcher</span>        dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// 如果子观察对象目标存在，建立子对象的依赖关系</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span>          childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment">// 如果属性是数组，则特殊处理收集数组对象依赖</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      <span class="token comment">// 返回属性值</span>      <span class="token keyword">return</span> value    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span> <span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果预定义的getter存在则value等于getter调用的返回值</span>      <span class="token comment">// 否则直接赋予属性值</span>      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val      <span class="token comment">/* eslint-disable no-self-compare */</span>      <span class="token comment">// 如果新值等于旧值或者新旧值为NaN则不执行</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> value <span class="token operator">||</span> <span class="token punctuation">(</span>newVal <span class="token operator">!==</span> newVal <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span>      <span class="token punctuation">}</span>      <span class="token comment">/* eslint-enable no-self-compare */</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> customSetter<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">customSetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token comment">// 如果没有setter直接返回</span>      <span class="token comment">// #7981: for accessor properties without setter</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>getter <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>setter<span class="token punctuation">)</span> <span class="token keyword">return</span>      <span class="token comment">// 如果预定义setter存在则调用，否则直接更新新值</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>setter<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        val <span class="token operator">=</span> newVal      <span class="token punctuation">}</span>      <span class="token comment">// 3.如果新值是对象，观察子对象并返回子对象的observer对象</span>      childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span>      <span class="token comment">// 4.派发更新（发布更改通知）</span>      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="数组的响应式处理"><a href="#数组的响应式处理" class="headerlink" title="数组的响应式处理"></a>数组的响应式处理</h4><ul><li><p>Observer的构造函数中</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 数组的响应式处理</span><span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasProto<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">protoAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">copyAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 为数组中的每一个对象创建一个 observer 实例</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// 遍历对象中的每一个属性，转换成 setter/getter</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// helpers</span><span class="token comment">/** * Augment a target Object or Array by intercepting * the prototype chain using __proto__ */</span><span class="token keyword">function</span> <span class="token function">protoAugment</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> src<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">/* eslint-disable no-proto */</span>  target<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> src  <span class="token comment">/* eslint-enable no-proto */</span><span class="token punctuation">}</span><span class="token comment">/** * Augment a target Object or Array by defining * hidden properties. */</span><span class="token comment">/* istanbul ignore next */</span><span class="token keyword">function</span> <span class="token function">copyAugment</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> Object<span class="token punctuation">,</span> src<span class="token operator">:</span> Object<span class="token punctuation">,</span> keys<span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token function">def</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>处理数组修改数据的方法</p><ul><li><p><code>src/core/observer/array.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* * not type checking this file because flow doesn't play well with * dynamically accessing methods on Array prototype */</span><span class="token keyword">import</span> <span class="token punctuation">{</span> def <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token comment">// 使用数组的原型创建一个新的对象(克隆数组的原型)</span><span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span><span class="token comment">// 修改数组元素的方法</span><span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token string">'push'</span><span class="token punctuation">,</span>  <span class="token string">'pop'</span><span class="token punctuation">,</span>  <span class="token string">'shift'</span><span class="token punctuation">,</span>  <span class="token string">'unshift'</span><span class="token punctuation">,</span>  <span class="token string">'splice'</span><span class="token punctuation">,</span>  <span class="token string">'sort'</span><span class="token punctuation">,</span>  <span class="token string">'reverse'</span><span class="token punctuation">]</span><span class="token comment">/** * Intercept mutating methods and emit events */</span>methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// cache original method</span>  <span class="token comment">// 保存数组原方法</span>  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>  <span class="token comment">// 调用Object.defineProperty() 重新定义修改数组的方法</span>  <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 执行数组的原始方法</span>    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>    <span class="token comment">// 获取数组对象的ob对象</span>    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__    <span class="token keyword">let</span> inserted    <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>      <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>        inserted <span class="token operator">=</span> args        <span class="token keyword">break</span>      <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>        inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">break</span>    <span class="token punctuation">}</span>    <span class="token comment">// 对插入的新元素，重新遍历数组元素设置为响应式数据</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>    <span class="token comment">// notify change</span>    <span class="token comment">// 调用了修改数组的方法，调用数组的ob对象发送通知</span>    ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> result  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>def</code>方法</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * Define a property. */</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">def</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> Object<span class="token punctuation">,</span> key<span class="token operator">:</span> string<span class="token punctuation">,</span> val<span class="token operator">:</span> any<span class="token punctuation">,</span> enumerable<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>    value<span class="token operator">:</span> val<span class="token punctuation">,</span>    enumerable<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumerable<span class="token punctuation">,</span>    writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    configurable<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h3 id="Dep类"><a href="#Dep类" class="headerlink" title="Dep类"></a>Dep类</h3><ul><li>src/core/observer/dep.js</li><li>依赖对象</li><li>记录watcher对象</li><li>depend() —- watcher记录对应的dep</li><li>发布通知</li></ul><ol><li>在<code>defineReactive()</code>中的<code>getter</code>中创建<code>dep</code>对象，并判断<code>Dep.target</code>是否有值（一会再来看看有什么时候有值得），调用<code>dep.depend()</code></li><li><code>dep.depend()</code>内部调用<code>Dep.target.addDep(this)</code>，也就是<code>watcher</code>的<code>addDep()</code>方法，它内部最后调用<code>dep.addSub(this)</code>，把<code>watcher</code>对象，添加到<code>dep.subs.push(watcher)</code>中，也就是把订阅者添加到<code>dep</code>的<code>subs</code>数组中，当数据变化的时候调用<code>watcher</code>对象的<code>update()</code>方法</li><li>什么时候设置的<code>Dep.target</code>？通过简单的案例调试观察。调用<code>mountComponent()</code>方法的时候，创建了渲染<code>watcher</code>对象，执行<code>watcher</code>中的<code>get()</code>方法</li><li><code>get()</code>方法内部调用<code>pushTarget(this)</code>，把当前<code>Dep.target = watcher</code>，同时把当前<code>watcher</code>入栈，因为有父子组件嵌套的时候，先把父组件对应的<code>watcher</code>入栈，再去处理子组件的<code>watcher</code>，子组件的处理完毕后，再把父组件对应的<code>watcher</code>出栈，继续操作</li><li><code>Dep.target</code>用来存放目前正在使用的<code>watcher</code>。全局唯一，并且一次也只能有一个<code>watcher</code>被使用</li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* @flow */</span><span class="token keyword">import</span> type Watcher <span class="token keyword">from</span> <span class="token string">'./watcher'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> remove <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'../config'</span><span class="token keyword">let</span> uid <span class="token operator">=</span> <span class="token number">0</span><span class="token comment">// dep 是个可观察对象，可以有多个指令订阅它</span><span class="token comment">/** * A dep is an observable that can have multiple * directives subscribing to it. */</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>  <span class="token comment">// 静态属性，watcher 对象</span>  <span class="token keyword">static</span> target<span class="token operator">:</span> <span class="token operator">?</span>Watcher<span class="token punctuation">;</span>  <span class="token comment">// dep 实例 Id</span>  id<span class="token operator">:</span> number<span class="token punctuation">;</span>  <span class="token comment">// dep 实例对应的 watcher 对象/订阅者数组</span>  subs<span class="token operator">:</span> Array<span class="token operator">&lt;</span>Watcher<span class="token operator">&gt;</span><span class="token punctuation">;</span>  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> uid<span class="token operator">++</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span>  <span class="token comment">// 添加新的订阅者 watcher 对象</span>  <span class="token function">addSub</span> <span class="token punctuation">(</span><span class="token parameter">sub<span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 移除订阅者</span>  <span class="token function">removeSub</span> <span class="token punctuation">(</span><span class="token parameter">sub<span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">,</span> sub<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 将观察对象和 watcher 建立依赖</span>  <span class="token function">depend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果 target 存在，把 dep 对象添加到 watcher 的依赖中</span>      Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// 发布通知</span>  <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// stabilize the subscriber list first</span>    <span class="token keyword">const</span> subs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>config<span class="token punctuation">.</span>async<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// subs aren't sorted in scheduler if not running async</span>      <span class="token comment">// we need to sort them now to make sure they fire in correct</span>      <span class="token comment">// order</span>      subs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>id <span class="token operator">-</span> b<span class="token punctuation">.</span>id<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 调用每个订阅者的update方法实现更新</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> subs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      subs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// Dep.target 用来存放目前正在使用的watcher</span><span class="token comment">// 全局唯一，并且一次也只能有一个watcher被使用</span><span class="token comment">// The current target watcher being evaluated.</span><span class="token comment">// This is globally unique because only one watcher</span><span class="token comment">// can be evaluated at a time.</span>Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">const</span> targetStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">// 入栈并将当前 watcher 赋值给 Dep.target</span><span class="token comment">// 父子组件嵌套的时候先把父组件对应的 watcher 入栈，</span><span class="token comment">// 再去处理子组件的 watcher，子组件的处理完毕后，再把父组件对应的 watcher 出栈，继续操作</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">pushTarget</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> <span class="token operator">?</span>Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  targetStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>  Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">popTarget</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 出栈操作</span>  targetStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> targetStack<span class="token punctuation">[</span>targetStack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Watcher类"><a href="#Watcher类" class="headerlink" title="Watcher类"></a>Watcher类</h3><ul><li><p>Watcher分为三种，<code>Comouted Watcher</code>、用户<code>Watcher</code>（侦听器）、<strong>渲染<code>Watcher</code></strong></p></li><li><p>渲染<code>Watcher</code>的创建时机</p><ul><li><p><code>src/core/instance/lifecycle.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mountComponent</span> <span class="token punctuation">(</span>  <span class="token parameter">vm<span class="token operator">:</span> Component<span class="token punctuation">,</span>  el<span class="token operator">:</span> <span class="token operator">?</span>Element<span class="token punctuation">,</span>  hydrating<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> Component <span class="token punctuation">{</span>  vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> el  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>    vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>render <span class="token operator">=</span> createEmptyVNode    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">/* istanbul ignore if */</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>template <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token operator">||</span>        vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el <span class="token operator">||</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">warn</span><span class="token punctuation">(</span>          <span class="token string">'You are using the runtime-only build of Vue where the template '</span> <span class="token operator">+</span>          <span class="token string">'compiler is not available. Either pre-compile the templates into '</span> <span class="token operator">+</span>          <span class="token string">'render functions, or use the compiler-included build.'</span><span class="token punctuation">,</span>          vm        <span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">warn</span><span class="token punctuation">(</span>          <span class="token string">'Failed to mount component: template or render function not defined.'</span><span class="token punctuation">,</span>          vm        <span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeMount'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> updateComponent  <span class="token comment">/* istanbul ignore if */</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> name <span class="token operator">=</span> vm<span class="token punctuation">.</span>_name      <span class="token keyword">const</span> id <span class="token operator">=</span> vm<span class="token punctuation">.</span>_uid      <span class="token keyword">const</span> startTag <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-perf-start:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>      <span class="token keyword">const</span> endTag <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-perf-end:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>      <span class="token function">mark</span><span class="token punctuation">(</span>startTag<span class="token punctuation">)</span>      <span class="token keyword">const</span> vnode <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token function">mark</span><span class="token punctuation">(</span>endTag<span class="token punctuation">)</span>      <span class="token function">measure</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> render</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> startTag<span class="token punctuation">,</span> endTag<span class="token punctuation">)</span>      <span class="token function">mark</span><span class="token punctuation">(</span>startTag<span class="token punctuation">)</span>      vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>      <span class="token function">mark</span><span class="token punctuation">(</span>endTag<span class="token punctuation">)</span>      <span class="token function">measure</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> patch</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> startTag<span class="token punctuation">,</span> endTag<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token comment">// 创建渲染Watcher，exOrFn为updateComponent</span>  <span class="token comment">// we set this to vm._watcher inside the watcher's constructor</span>  <span class="token comment">// since the watcher's initial patch may call $forceUpdate (e.g. inside child</span>  <span class="token comment">// component's mounted hook), which relies on vm._watcher being already defined</span>  <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> updateComponent<span class="token punctuation">,</span> noop<span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token function">before</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_isMounted <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>_isDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeUpdate'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* isRenderWatcher */</span><span class="token punctuation">)</span>  hydrating <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token comment">// manually mounted instance, call mounted on self</span>  <span class="token comment">// mounted is called for render-created child components in its inserted hook</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$vnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    vm<span class="token punctuation">.</span>_isMounted <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'mounted'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> vm<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>渲染<code>watcher</code>创建的位置：lifecycle.js的<code>mountComponent</code>函数中</p></li><li><p><code>Watcher</code>的构造函数初始化，处理<code>exOrFn</code>（渲染<code>watcher</code>和侦听器处理不同，渲染<code>watcher</code>为<code>updateComponent</code>，对比新旧<code>vdom</code>并渲染到页面上）</p></li><li><p>调用<code>this.get()</code>，他里面调用<code>pushTarget()</code>，然后<code>this.getter.call(vm,vm)</code>（对于渲染<code>watcher</code>调用<code>updateComponent</code>），如果是用户<code>watcher</code>会回去属性的值（触发<code>get</code>操作）</p></li><li><p>当数据更新时，<code>dep</code>中调用<code>notify()</code>方法，<code>notify()</code>中调用<code>watcher</code>的<code>update()</code>方法</p></li><li><p><code>update()</code>中调用<code>queueWatcher()</code></p></li><li><p><code>queueWatcher()</code>是一个核心方法，去除重复操作，调用<code>flushSchedulerQueue()</code>刷新队列并执行<code>watcher</code></p></li><li><p><code>flushSchedulerQueue()</code>中对<code>watcher</code>排序，遍历所有<code>watcher</code>，如果有<code>before</code>，触发生命周期的钩子函数<code>beforeUpdate</code>，执行<code>wacher.run()</code>，它内部调用<code>this.get()</code>，然后调用<code>this.cb()</code>（渲染<code>wacher</code>的<code>cb</code>是<code>noop</code>，侦听器的<code>function</code>）</p><ol><li>组件更新的顺序是从父组件到子组件（因为先创建父组件，后创建子组件）</li><li>组件的用户<code>watcher</code>在渲染watcher之前运行（因为用户<code>watcher</code>（initState）是在渲染<code>watcher</code>（mountComponent）之前创建的）</li><li>如果一个组件在父组件执行之前被销毁，那他应该被跳过</li></ol></li><li><p>整个流程结束</p></li></ul><h3 id="调试响应式数据执行过程"><a href="#调试响应式数据执行过程" class="headerlink" title="调试响应式数据执行过程"></a>调试响应式数据执行过程</h3><ul><li><p>数组响应式处理的核心过程和数组收集依赖的过程</p></li><li><p>当数组的数据改变的时候watcher的执行过程</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>observe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    {{ arr }}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../../dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token operator">:</span> <span class="token punctuation">{</span>        arr<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// vm.arr.push(8)</span>    <span class="token comment">// vm.arr[0] = 100</span>    <span class="token comment">// vm.arr.length = 0</span>      </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="回答以下问题"><a href="#回答以下问题" class="headerlink" title="回答以下问题"></a>回答以下问题</h3><ul><li><p>检测变化的注意事项</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>obj<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">555</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>转换成响应式数据</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>obj<span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token number">555</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="数据响应式原理总结"><a href="#数据响应式原理总结" class="headerlink" title="数据响应式原理总结"></a>数据响应式原理总结</h3><p><img src="http://5coder.cn/img/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B.png"></p><h3 id="动态添加一个响应式属性"><a href="#动态添加一个响应式属性" class="headerlink" title="动态添加一个响应式属性"></a>动态添加一个响应式属性</h3><blockquote><p>当我们给一个响应式对象，动态增加一个对象，这个属性是否为响应式？</p></blockquote><p>示例代码</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>set<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    {{ obj.title }}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>    {{ obj.name }}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>    {{ arr }}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../../dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token operator">:</span> <span class="token punctuation">{</span>        obj<span class="token operator">:</span> <span class="token punctuation">{</span>          title<span class="token operator">:</span> <span class="token string">'Hello Vue'</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        arr<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/image-20210706052116706.png"></p><p>打开浏览器开发者模式，分别键入如下内容：</p><ul><li><p><code>vm.obj.name = 'abc'</code></p><p><img src="http://5coder.cn/img/image-20210706052150370.png"></p><p><strong>可以发现，动态给<code>obj</code>增加<code>name</code>属性，视图并未更新，说明此时<code>name</code>属性不是响应式的</strong></p></li><li><p><code>vm.$set(vm.obj, 'name', 'zhangsan')</code></p><p><img src="http://5coder.cn/img/image-20210706052431324.png"></p><p>可以使用<code>vm.$set(vm.obj, 'name', 'zhangsan')</code>来给响应式对象动态添加响应式属性(或者使用Vue.set())。</p><p>使用vm.$set()方法改变数组的第一个元素的值：<code>vm.$set(vm.arr, 0, 100)</code>。vm.$set()<a href="https://cn.vuejs.org/v2/api/#vm-set">官方文档</a></p><p><img src="http://5coder.cn/img/image-20210706053012528.png"></p><p><img src="http://5coder.cn/img/image-20210706053024997.png"></p><p>不能给Vue实例或者Vue实例的跟数组对象动态的添加响应式属性。</p><p><img src="http://5coder.cn/img/image-20210706053237085.png"></p></li></ul><h2 id="实例方法-数据"><a href="#实例方法-数据" class="headerlink" title="实例方法/数据"></a>实例方法/数据</h2><h3 id="vm-set"><a href="#vm-set" class="headerlink" title="vm.$set"></a>vm.$set</h3><h4 id="定义位置"><a href="#定义位置" class="headerlink" title="定义位置"></a>定义位置</h4><ul><li><p><code>Vue.set()</code></p><ul><li>global-api/index.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 静态方法 set/delete/nextTick</span>Vue<span class="token punctuation">.</span>set <span class="token operator">=</span> <span class="token keyword">set</span>Vue<span class="token punctuation">.</span>delete <span class="token operator">=</span> delVue<span class="token punctuation">.</span>nextTick <span class="token operator">=</span> nextTick<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>vm.$set()</code></p><ul><li>instance/index.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 注册vm的$data/$props/$set/$delete/$watch</span><span class="token comment">// instance/state.js</span><span class="token function">stateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token comment">// instance/state.js</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$set <span class="token operator">=</span> set<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">delete</span> <span class="token operator">=</span> del<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h4><ul><li><p><code>set()</code>方法</p><ul><li>observer/index.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * Set a property on an object. Adds the new property and * triggers change notification if the property doesn't * already exist. */</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">set</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">,</span> key<span class="token operator">:</span> any<span class="token punctuation">,</span> val<span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>    <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPrimitive</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot set reactive property on undefined, null, or primitive value: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>target<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断target是否是数组，key值是否是合法的索引</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isValidArrayIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    target<span class="token punctuation">.</span>length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>length<span class="token punctuation">,</span> key<span class="token punctuation">)</span>    <span class="token comment">// 通过splice对key位置的元素进行替换</span>    <span class="token comment">// splice在array.js进行了响应化的处理，此处的splice已经不是原生的splice方法</span>    target<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>    <span class="token keyword">return</span> val  <span class="token punctuation">}</span>  <span class="token comment">// 如果key在对象中已经存在，直接赋值</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> target <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val    <span class="token keyword">return</span> val  <span class="token punctuation">}</span>  <span class="token comment">// 获取target中的observer对象</span>  <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token punctuation">.</span>__ob__  <span class="token comment">// 如果target是Vue实例或者$data直接返回，如果是$data的话其observe对象中的vmCount为1，否则为0</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>_isVue <span class="token operator">||</span> <span class="token punctuation">(</span>ob <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">.</span>vmCount<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>      <span class="token string">'Avoid adding reactive properties to a Vue instance or its root $data '</span> <span class="token operator">+</span>      <span class="token string">'at runtime - declare it upfront in the data option.'</span>    <span class="token punctuation">)</span>    <span class="token keyword">return</span> val  <span class="token punctuation">}</span>  <span class="token comment">// 如果ob不存在，target不是响应式对象，此时直接赋值即可</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val    <span class="token keyword">return</span> val  <span class="token punctuation">}</span>  <span class="token comment">// 把key设置为响应式属性</span>  <span class="token function">defineReactive</span><span class="token punctuation">(</span>ob<span class="token punctuation">.</span>value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span>  <span class="token comment">// 发送通知</span>  ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> val<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="调试-1"><a href="#调试-1" class="headerlink" title="调试"></a>调试</h4><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>set<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    {{ obj.title }}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>    {{ obj.name }}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>    {{ arr }}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../../dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token operator">:</span> <span class="token punctuation">{</span>        obj<span class="token operator">:</span> <span class="token punctuation">{</span>          title<span class="token operator">:</span> <span class="token string">'Hello Vue'</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        arr<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>回顾<code>defineReactive</code>中的<code>childOb</code>，给每一个响应式对象设置一个<strong>ob</strong></p><p>调用<code>$set</code>的时候，会获取<code>ob</code>对象，并通过<code>ob.dep.notify()</code>发送通知</p></blockquote><h3 id="vm-delete"><a href="#vm-delete" class="headerlink" title="vm.$delete"></a>vm.$delete</h3><ul><li><p>功能</p><p>删除对象的属性。如果对象是响应式的，确保删除能触发更新视图。这个方法主要用于避开Vue不能检测到属性被删除的限制，但是你应该很少会使用它。</p><blockquote><p>注意：目标不能是一个Vue实例或者Vue实例的跟数据对象</p></blockquote></li><li><p>示例</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">vm<span class="token punctuation">.</span>$<span class="token keyword">delete</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>obj<span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h4 id="定义位置-1"><a href="#定义位置-1" class="headerlink" title="定义位置"></a>定义位置</h4><ul><li><p><code>Vue.delete()</code></p><ul><li>global-api/index.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 静态方法 set/delete/nextTick</span>Vue<span class="token punctuation">.</span>set <span class="token operator">=</span> <span class="token keyword">set</span>Vue<span class="token punctuation">.</span>delete <span class="token operator">=</span> delVue<span class="token punctuation">.</span>nextTick <span class="token operator">=</span> nextTick<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>vm.$delete()</code></p><ul><li>instance/index.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 注册 vm 的 $data/$props/$set/$delete/$watch</span><span class="token function">stateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token comment">// instance/state.js</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$set <span class="token operator">=</span> set<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">delete</span> <span class="token operator">=</span> del<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="源码-1"><a href="#源码-1" class="headerlink" title="源码"></a>源码</h4><ul><li><p>src/core/observer/index.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * Delete a property and trigger change if necessary. */</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">del</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">,</span> key<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>    <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPrimitive</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot delete reactive property on undefined, null, or primitive value: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>target<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断是否是数组，以及key是否合法</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isValidArrayIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果是数组通过splice删除</span>    <span class="token comment">// splice做过响应式处理</span>    target<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token comment">// 获取target的ob对象</span>  <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token punctuation">.</span>__ob__  <span class="token comment">// target如果是Vue实例或者$data对象，直接返回</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>_isVue <span class="token operator">||</span> <span class="token punctuation">(</span>ob <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">.</span>vmCount<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>      <span class="token string">'Avoid deleting properties on a Vue instance or its root $data '</span> <span class="token operator">+</span>      <span class="token string">'- just set it to null.'</span>    <span class="token punctuation">)</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token comment">// 如果target对象没有key属性直接返回，判断依据是：key是否直接属于target属性，而不是继承来的</span>  <span class="token comment">// 如果是继承来的或者没有这个属性，直接返回</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token comment">// 删除属性</span>  <span class="token keyword">delete</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token comment">// 通过ob发送通知</span>  ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="vm-watch"><a href="#vm-watch" class="headerlink" title="vm.$watch"></a>vm.$watch</h3><p><code>vm.$watch(expOrFn, callback, [options])</code>，<a href="https://cn.vuejs.org/v2/api/#vm-watch">官方文档</a></p><ul><li><p>功能</p><p>观察Vue实例变化的一个表达式或计算属性函数。回调函数得到的参数为新值和旧值。表达式只接受监督的键路径。对于更负责的表达式，用一个函数取代</p></li><li><p>参数</p><ul><li>expOrFn：要监视的$data中的属性，可以是表达式或函数</li><li>callback：数据变化后执行的函数<ul><li>函数：回调函数</li><li>对象：具有handler属性(字符串或者函数)，如果该属性为字符串则methods中相应的定义</li></ul></li><li>options：可选的选项<ul><li>deep：布尔类型，深度监听</li><li>immediate：布尔类型，是否立即执行一次回调函数</li></ul></li></ul></li><li><p>示例1</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>watcher<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">&gt;</span>    <span class="token punctuation">{</span><span class="token punctuation">{</span> user<span class="token punctuation">.</span>fullName <span class="token punctuation">}</span><span class="token punctuation">}</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../../dist/vue.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token operator">:</span> <span class="token punctuation">{</span>        user<span class="token operator">:</span> <span class="token punctuation">{</span>          firstName<span class="token operator">:</span> <span class="token string">'诸葛'</span><span class="token punctuation">,</span>          lastName<span class="token operator">:</span> <span class="token string">'亮'</span><span class="token punctuation">,</span>          fullName<span class="token operator">:</span> <span class="token string">''</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span>      <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">.</span>fullName <span class="token operator">=</span> newValue<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> newValue<span class="token punctuation">.</span>lastName      <span class="token punctuation">}</span>    <span class="token punctuation">)</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打开浏览器，发现并没有立即显示<code>诸葛亮</code>，此时需要添加第三个参数options，内容为：<code>{immediate: true}</code>，其意味着立即执行。再次刷新页面，发现页面显示了诸葛亮。</p><p>当我们需要监听vm.$data.user.firstName时，发现后续可能还要监听vm.$data.user.lastName，所以此时写多个watch是非常不方便的，此时在options中添加：deep: true，即为深度监听。不但监听user对象的变化，而且监听其内部属性的变化。此时修改firstName，发现视图也会更新。</p></li><li><p>示例2</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span>    a<span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>    b<span class="token operator">:</span> <span class="token string">'2'</span><span class="token punctuation">,</span>    msg<span class="token operator">:</span> <span class="token string">'Hello Vue'</span><span class="token punctuation">,</span>    user<span class="token operator">:</span> <span class="token punctuation">{</span>      firstName<span class="token operator">:</span> <span class="token string">'诸葛'</span><span class="token punctuation">,</span>      lastName<span class="token operator">:</span> <span class="token string">'亮'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// expOrFn是表达式</span>vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  congole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'user.firstName'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  congole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// expOrFn是函数</span>vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// deep是true，此时比较消耗性能</span>vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  deep<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// immediate是true</span>vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>immediate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="三种类型的Watcher对象"><a href="#三种类型的Watcher对象" class="headerlink" title="三种类型的Watcher对象"></a>三种类型的Watcher对象</h4><ul><li>没有静态方法，因为$watch方法中要使用vue的实例</li><li>Watcher分三种：计算属性Watcher、用户Watcher(侦听器)、渲染Watcher</li><li>创建顺序：计算属性Watcher、用户Watcher(侦听器)、渲染Watcher</li><li>vm.$watch()<ul><li>src/core/instance/state.js</li></ul></li></ul><h4 id="源码-2"><a href="#源码-2" class="headerlink" title="源码"></a>源码</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$watch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>  <span class="token parameter">expOrFn<span class="token operator">:</span> string <span class="token operator">|</span> Function<span class="token punctuation">,</span>  cb<span class="token operator">:</span> any<span class="token punctuation">,</span>  options<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>  <span class="token comment">// 获取 Vue 实例 this</span>  <span class="token keyword">const</span> vm<span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 判断如果 cb 是对象执行 createWatcher</span>    <span class="token keyword">return</span> <span class="token function">createWatcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> expOrFn<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// 标记为用户 watcher</span>  options<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token boolean">true</span>  <span class="token comment">// 创建用户 watcher 对象</span>  <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> expOrFn<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token comment">// 判断 immediate 如果为 true</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>immediate<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 立即执行一次 cb 回调，并且把当前值传入</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> watcher<span class="token punctuation">.</span>value<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">callback for immediate watcher "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>watcher<span class="token punctuation">.</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// 返回取消监听的方法</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">unwatchFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    watcher<span class="token punctuation">.</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="调试-2"><a href="#调试-2" class="headerlink" title="调试"></a>调试</h4><ul><li><p>查看watcher的创建顺序</p></li><li><p>测试代码</p><ul><li>```html  <meta charset="UTF-8">  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <title>watcher</title>  <div id="app">        <hr>      </div>  <script src="../../dist/vue.js"></script>  <script>    const vm = new Vue({      el: '#app',      data: {        message: 'Hello Vue',        user: {          firstName: '诸葛',          lastName: '亮',          fullName: ''        }      },      computed: {        reversedMessage: function () {          return this.message.split('').reverse().join('')        }      },      watch: {        // 'user.firstName': function (newValue, oldValue) {        //   this.user.fullName = this.user.firstName + ' ' + this.user.lastName        // },        // 'user.lastName': function (newValue, oldValue) {        //   this.user.fullName = this.user.firstName + ' ' + this.user.lastName        // },        'user': {          handler: function (newValue, oldValue) {            this.user.fullName = this.user.firstName + ' ' + this.user.lastName          },          deep: true,          immediate: true        }      }    })  </script><pre class="line-numbers language-none"><code class="language-none">    将断点打在src/core/observer/watcher.js中的watcher构造函数中  - 计算属性watcher    ![](http://5coder.cn/img/image-20210707055015275.png)  - 用户watcher（侦听器）    ![](http://5coder.cn/img/image-20210707055122029.png)    ![](http://5coder.cn/img/image-20210707055217763.png)  - 渲染watcher    ![](http://5coder.cn/img/image-20210707055333356.png)    ![](http://5coder.cn/img/image-20210707055459252.png)    - 查看渲染`watcher`的执行过程      - 当数据更新，`defineReactive`的`set`方法中调用`dep.notify()`      - 调用`watcher`的`update()`      - 调用`ququeWatcher()`，把`watcher`存入队列，如果已经存在，不重复添加      - 循环调用`flushSchedulerQueue()`        - 通过nextTick()，在消息循环结束之前时候调用`flushShedulerQueue()`      - 调用`watcher.run()`        - 调用`watcher.get()`获取最新值        - 如果是渲染`wacher`结束        - 如果 用户`watcher`，调用`this.cb()`## 异步更新队列-nextTick()- Vue更新DOM是异步执行的，批量的  - 在下次DOM更新循环结束之后执行延迟回调。在修改数据之后立即使用这个办法，获取更新后的DOM- `vm.$nextTick(function() { /* 操作DOM */ }` / `Vue.$nextTick(function () {})`### vm.$nextTick()代码演示```html&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;  &lt;meta charset="UTF-8"&gt;  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;  &lt;title&gt;nextTick&lt;/title&gt;&lt;/head&gt;&lt;body&gt;  &lt;div id="app"&gt;    &lt;p id="p" ref="p1"&gt;{{ msg }}&lt;/p&gt;    {{ name }}&lt;br&gt;    {{ title }}&lt;br&gt;  &lt;/div&gt;  &lt;script src="../../dist/vue.js"&gt;&lt;/script&gt;  &lt;script&gt;    const vm = new Vue({      el: '#app',      data: {        msg: 'Hello nextTick',        name: 'Vue.js',        title: 'Title'      },      mounted() {        this.msg = 'Hello World'        this.name = 'Hello snabbdom'        this.title = 'Vue.js'          Vue.nextTick(() =&gt; {          console.log(this.$refs.p1.textContent)        })      }    })      &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h3 id="vm-nextTick-代码演示"><a href="#vm-nextTick-代码演示" class="headerlink" title="vm.$nextTick()代码演示"></a>vm.$nextTick()代码演示</h3><h3 id="定义位置-2"><a href="#定义位置-2" class="headerlink" title="定义位置"></a>定义位置</h3><ul><li>src/core/instance/render.js</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$nextTick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">nextTick</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="源码-3"><a href="#源码-3" class="headerlink" title="源码"></a>源码</h3><ul><li><p>手动调用<code>vm.$nextTick()</code></p></li><li><p>在<code>Watcher</code>的<code>queueWatcher</code>中执行<code>nextTick()</code></p></li><li><p>src/core/util/next-tick.js</p></li><li><p>$nextTick()实例方法</p><p><img src="http://5coder.cn/img/image-20210707063325418.png"></p></li><li><p>$nextTick()静态方法</p><p><img src="http://5coder.cn/img/image-20210707063356290.png"></p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span> <span class="token punctuation">(</span><span class="token parameter">cb<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> ctx<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> _resolve  <span class="token comment">// 把 cb 加上异常处理存入 callbacks 数组中</span>  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token comment">// 调用 cb()</span>        <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">'nextTick'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>    pending <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token comment">// 调用</span>    <span class="token function">timerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// $flow-disable-line</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 返回 promise 对象</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      _resolve <span class="token operator">=</span> resolve    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>timerFunc()</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* @flow */</span><span class="token comment">/* globals MutationObserver */</span><span class="token keyword">import</span> <span class="token punctuation">{</span> noop <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'shared/util'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> handleError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./error'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> isIE<span class="token punctuation">,</span> isIOS<span class="token punctuation">,</span> isNative <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./env'</span><span class="token keyword">export</span> <span class="token keyword">let</span> isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">const</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">function</span> <span class="token function">flushCallbacks</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  pending <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token keyword">const</span> copies <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  callbacks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    copies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// Here we have async deferring wrappers using microtasks.</span><span class="token comment">// In 2.5 we used (macro) tasks (in combination with microtasks).</span><span class="token comment">// However, it has subtle problems when state is changed right before repaint</span><span class="token comment">// (e.g. #6813, out-in transitions).</span><span class="token comment">// Also, using (macro) tasks in event handler would cause some weird behaviors</span><span class="token comment">// that cannot be circumvented (e.g. #7109, #7153, #7546, #7834, #8109).</span><span class="token comment">// So we now use microtasks everywhere, again.</span><span class="token comment">// A major drawback of this tradeoff is that there are some scenarios</span><span class="token comment">// where microtasks have too high a priority and fire in between supposedly</span><span class="token comment">// sequential events (e.g. #4521, #6690, which have workarounds)</span><span class="token comment">// or even between bubbling of the same event (#6566).</span><span class="token keyword">let</span> timerFunc<span class="token comment">// The nextTick behavior leverages the microtask queue, which can be accessed</span><span class="token comment">// via either native Promise.then or MutationObserver.</span><span class="token comment">// MutationObserver has wider support, however it is seriously bugged in</span><span class="token comment">// UIWebView in iOS &gt;= 9.3.3 when triggered in touch event handlers. It</span><span class="token comment">// completely stops working after triggering a few times... so, if native</span><span class="token comment">// Promise is available, we will use it:</span><span class="token comment">/* istanbul ignore next, $flow-disable-line */</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>    <span class="token comment">// In problematic UIWebViews, Promise.then doesn't completely break, but</span>    <span class="token comment">// it can get stuck in a weird state where callbacks are pushed into the</span>    <span class="token comment">// microtask queue but the queue isn't being flushed, until the browser</span>    <span class="token comment">// needs to do some other work, e.g. handle a timer. Therefore we can</span>    <span class="token comment">// "force" the microtask queue to be flushed by adding an empty timer.</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isIOS<span class="token punctuation">)</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>noop<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isIE <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> MutationObserver <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>  <span class="token function">isNative</span><span class="token punctuation">(</span>MutationObserver<span class="token punctuation">)</span> <span class="token operator">||</span>  <span class="token comment">// PhantomJS and iOS 7.x</span>  MutationObserver<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object MutationObserverConstructor]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// Use MutationObserver where native Promise is not available,</span>  <span class="token comment">// e.g. PhantomJS, iOS7, Android 4.4</span>  <span class="token comment">// (#6466 MutationObserver is unreliable in IE11)</span>  <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">1</span>  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>  <span class="token keyword">const</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>  observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>textNode<span class="token punctuation">,</span> <span class="token punctuation">{</span>    characterData<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    counter <span class="token operator">=</span> <span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span>    textNode<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> setImmediate <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>setImmediate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// Fallback to setImmediate.</span>  <span class="token comment">// Technically it leverages the (macro) task queue,</span>  <span class="token comment">// but it is still a better choice than setTimeout.</span>  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token function">setImmediate</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// Fallback to setTimeout.</span>  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span> <span class="token punctuation">(</span><span class="token parameter">cb<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> ctx<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> _resolve  <span class="token comment">// 把 cb 加上异常处理存入 callbacks 数组中</span>  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token comment">// 调用 cb()</span>        <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">'nextTick'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>    pending <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token comment">// 调用</span>    <span class="token function">timerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// $flow-disable-line</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 返回 promise 对象</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      _resolve <span class="token operator">=</span> resolve    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue响应式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试题分享1</title>
      <link href="2021/062023260.html"/>
      <url>2021/062023260.html</url>
      
        <content type="html"><![CDATA[<p>前端面试题分享：<code>fn1.call.call(fn2)</code></p><blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">fn1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>fn2<span class="token punctuation">)</span>  <span class="token comment">// 此处打印结果</span>fn1<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>fn2<span class="token punctuation">)</span>  <span class="token comment">// 此处打印结果</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><p>思路：自己实现call方法，根据实现过程中了解打印结果出现的原因。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">mycall</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">my</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// context -&gt; window</span>  <span class="token comment">// ??表示只有context的值是undefined或null时才会返回window</span>  context <span class="token operator">=</span> context <span class="token operator">??</span> window  context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span>  <span class="token keyword">const</span> result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>  <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn  <span class="token keyword">return</span> result<span class="token punctuation">}</span>fn1<span class="token punctuation">.</span><span class="token function">mycall</span><span class="token punctuation">(</span>fn2<span class="token punctuation">)</span>  <span class="token comment">// 打印结果1</span>fn1<span class="token punctuation">.</span>mycall<span class="token punctuation">.</span><span class="token function">mycall</span><span class="token punctuation">(</span>fn2<span class="token punctuation">)</span>  <span class="token comment">// 打印结果2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>fn1.mycall.mycall(fn2)</code>调用中，首先调用<code>mycall(fn2)</code>，调用过程中，首先参数<code>context</code>接收到的是<code>fn2</code>，<code>this</code>指向的值为<code>f my(context, ...args)</code>，然后在第二次执行<code>context.fn(...args)</code>时，实际执行的是<code>fn2.my(context, ...args)</code>，代码再次调用<code>function my(context, ...args)</code>，再次调用时context接受的是空数组，所以判断结果为<code>context=window</code>，所以内部指向为<code>context.fn = this</code>，实际为<code>window.fn = fn2()</code>，因此代码最后执行的实际调用为：<code>window.fn2()</code>，其结果自然是<code>2</code>。</p><p>如果对过程不是很明白的话，可以再浏览器中进行调试，一步步F11进行调试，过程就很清晰了，如果本文章有帮助到你，可以再评论区写下你的观点~</p>]]></content>
      
      
      <categories>
          
          <category> 前端面试题 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> call </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3-1作业</title>
      <link href="2021/061816452.html"/>
      <url>2021/061816452.html</url>
      
        <content type="html"><![CDATA[<h1 id="一、简单题"><a href="#一、简单题" class="headerlink" title="一、简单题"></a>一、简单题</h1><blockquote><p><strong>1、当我们点击按钮的时候动态给 data 增加的成员是否是响应式数据，如果不是的话，如何把新增成员设置成响应式数据，它的内部原理是什么。</strong></p></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> el<span class="token operator">:</span> <span class="token string">'#el'</span> data<span class="token operator">:</span> <span class="token punctuation">{</span>  o<span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>  dog<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> method<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token function">clickHandler</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">// 该 name 属性是否是响应式的</span>   <span class="token keyword">this</span><span class="token punctuation">.</span>dog<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Trump'</span>  <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过<code>this.dog.name = 'Trump'</code>并不是响应式数据，因为在Vue中当吧一个普通的JavaScript对象传入Vue实例作为<code>data</code>选项，Vue将便利所有对象的所有<code>property</code>，并使用<code>Object.defineProperty</code>把这些<code>property</code>全部转换为<code>getter/setter</code>。Vue无法检测<code>property</code>的<strong>添加或移除</strong>。由于Vue会在初始化实例时对<code>property</code>执行<code>getter/setter</code>转化，所以<code>property</code>必须在<code>data</code>对象上<strong>存在</strong>才能让Vue将它转换为响应式。</p><p><strong>对于对象</strong></p><p>对于已创建的实例，Vue不允许动态添加跟级别的响应式property。但是，可以使用</p><p><code>Vue.set(object, propertyName, value)</code>方法向嵌套对象添加响应式property。例如：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">Vue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>someObject<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>还可以使用vm.$set实例方法，这也是Vue.set方法的别名：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>someObject<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当需要为已有对象赋值多个新property，比如使用Object.assign()或_.extend()。但是这样添加到对象的新property不会触发更新。这种情况下，应该使用原对象与要混合进去的对象的property一起创建一个新的对象。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 代替 Object.assgin(this.someObject, { a: 1, b: 2 })</span><span class="token keyword">this</span><span class="token punctuation">.</span>someObject <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assgin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>someObject<span class="token punctuation">,</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>对于数组</strong></p><p>Vue不能检测一下数组的变动：</p><ol><li>当里利用索引直接设置一个数组项时，例如：<code>vm.items[indexOfItem] = newValue</code></li><li>当你修改数组的长度时，例如：<code>vm.items.length = newLength</code></li></ol><p>举个例子：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span>    items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'x'</span>  <span class="token comment">// 不是响应式的</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">2</span>  <span class="token comment">// 不是响应式的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>解决第一类问题（利用数组索引设置一个数组项<code>vm.items[indexOfItem] = newValue</code>）：</p><ul><li>```js<br>// Vue.set<br>Vue.set(vm.items, indexOfItem, newValue)<pre class="line-numbers language-none"><code class="language-none">- ```js  // Array.property.splice  vm.items.splice(indexOfItem, 1, newValue)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>解决第二类问题（修改数组长度<code>vm.items.length = newLength</code>）</p><ul><li>```js<br>vm.items.splice(newLength)<pre class="line-numbers language-none"><code class="language-none">*数组更新检查****变更方法***- *push()：向尾部添加元素。改变原数组。*- *pop()：从数组中删除最后一个元素，并返回该元素的值。并重置数组的长度。改变原数组。*- *shift()：删除**第一个**元素并返回该元素的值，并重置数组的长度。改变原数组。*- *unshift()：将一个或多个元素添加到数组的**开头**，并返回该数组的**新长度**。改变原数组。*- *splice()：通过删除或替换现有元素或者原地添加新的元素来修改数组,并以数组形式返回被修改的内容。改变原数组。*- *sort()：方法用[原地算法](https://en.wikipedia.org/wiki/In-place_algorithm)对数组的元素进行排序，并返回数组。默认排序顺序是在将元素转换为字符串，然后比较它们的UTF-16代码单元值序列时构建的。改变原数组。*- *reverse()：将数组中元素的位置颠倒，并返回该数组。数组的第一个元素会变成最后一个，数组的最后一个元素变成第一个。改变原数组。****替换数组****变更方法，顾名思义，会变更调用了这些方法的原始数组。相比之下，也有非变更方法，例如 `filter()`、`concat()` 和 `slice()`。它们不会变更原始数组，而**总是返回一个新数组**。当使用非变更方法时，可以用新数组替换旧数组：*```jsexample1.items = example1.items.filter(function (item) {  return item.message.match(/Foo/)})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><hr><blockquote><p><strong>2.请简述Diff算法的执行过程</strong></p></blockquote><p>在执行Diff算法的过程就是调用名为<code>patch</code>的函数，比较新旧节点。一边比较一边给真实DOM打补丁。<code>patch</code>函数接收两个参数：<code>oldVnode</code>和<code>vnode</code>，分别代表旧节点和新节点。<code>patch</code>函数内部会先执行<code>pre</code>钩子函数。</p><p>执行完成后，使用<code>isVnode</code>（函数内部查看<code>oldVnode</code>是否有<code>sel</code>属性）判断传入的<code>oldVnode</code>是否为DOM对象，如果不是vnode，则使用<code>emptyNodeAt</code>（函数内部找到<code>id/class/tagName</code>，调用<code>vnode()</code>函数将其转换为<code>vnode</code>对象：<code>{api.tagName(elm).toLowerCase() + id + c, {}, [], undefined, elm}</code>）将真实DOM转换为<code>vnode</code>对象。</p><p><code>isVnode</code></p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">isVnode</span> <span class="token punctuation">(</span>vnode<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> vnode <span class="token keyword">is</span> VNode <span class="token punctuation">{</span>  <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>sel <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>emptyNodeAt</code></p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">emptyNodeAt</span> <span class="token punctuation">(</span>elm<span class="token operator">:</span> Element<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> id <span class="token operator">=</span> elm<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token string">'#'</span> <span class="token operator">+</span> elm<span class="token punctuation">.</span>id <span class="token operator">:</span> <span class="token string">''</span>  <span class="token keyword">const</span> c <span class="token operator">=</span> elm<span class="token punctuation">.</span>className <span class="token operator">?</span> <span class="token string">'.'</span> <span class="token operator">+</span> elm<span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span>  <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span><span class="token function">tagName</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> id <span class="token operator">+</span> c<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> elm<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>vnode</code></p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">vnode</span> <span class="token punctuation">(</span>sel<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  data<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  children<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>VNode <span class="token operator">|</span> <span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  elm<span class="token operator">:</span> Element <span class="token operator">|</span> Text <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>  <span class="token keyword">const</span> key <span class="token operator">=</span> data <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> data<span class="token punctuation">.</span>key  <span class="token keyword">return</span> <span class="token punctuation">{</span> sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> elm<span class="token punctuation">,</span> key <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来使用<code>sameVnode</code>（函数内部判断两个<code>oldVnode</code>和<code>vnode</code>的<code>key</code>和<code>sel</code>是否都相同，如果都想同则认为是同一个vnode对象）函数判断<code>oldVnode</code>和<code>vnode</code>是否为同一个<code>vnode</code>。</p><p><code>sameVnode</code></p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">sameVnode</span> <span class="token punctuation">(</span>vnode1<span class="token operator">:</span> VNode<span class="token punctuation">,</span> vnode2<span class="token operator">:</span> VNode<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> vnode1<span class="token punctuation">.</span>key <span class="token operator">===</span> vnode2<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> vnode1<span class="token punctuation">.</span>sel <span class="token operator">===</span> vnode2<span class="token punctuation">.</span>sel<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><p>如果为相同节点，则使用<code>patchVnode</code>（函数细节在下面讲）函数对比新旧节点差异，并更新到DOM上。</p><p><code>patchVnode</code></p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">patchVnode</span> <span class="token punctuation">(</span>oldVnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token operator">:</span> VNodeQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> hook <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token operator">?.</span>hook  hook<span class="token operator">?.</span>prepatch<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>  <span class="token keyword">const</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span>  <span class="token keyword">const</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token keyword">return</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>data <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>    vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token operator">?.</span>update<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>      <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  hook<span class="token operator">?.</span>postpatch<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>patchVnode函数内部，首先获取vnode中的<code>hook</code>钩子函数并执行<code>prepatch</code>，然后通过<code>oldVnode.elm!</code>获取<code>elm</code>属性，并赋值给<code>vnode.elm</code>与<code>elm</code>，通过<code>oldVnode.children as Vnode[]</code>获取老<code>vnode</code>子元素列表<code>oldCh</code>，通过<code>vnode.children as Vnode[]</code>获取新<code>Vnode</code>子元素列表<code>ch</code>。</p><p>判断<code>vnode.data</code>如果不为<code>undefined</code>，遍历循环<code>cbs</code>并执行<code>update</code>钩子函数（<code>for (let i = 0; i &lt; cbs.update.length; ++i) cbs.update[i](oldVnode, vnode)</code>）。</p><p>判断<code>vnode.text</code>是否为<code>undefined</code></p><ul><li>如果为<code>undefined</code>，再此判断<code>oldCh</code>和<code>ch</code>是否为<code>undefined</code><ul><li>如果<code>oldCh</code>和<code>ch</code>存在，则判断如果<code>oldCh</code>不等于<code>ch</code>，执行<code>updateChildren</code>函数（下面详解）</li><li>如果<code>oldCh</code>不存在，<code>ch</code>存在<ul><li>如果<code>oldVnode.text</code>存在，使用<code>api.setTextContent(elm, '')</code>，设置<code>elm</code>的<code>textContent</code>内容</li><li>调用<code>addVnodes</code>添加节点</li></ul></li><li>如果<code>oldCh</code>存在，<code>ch</code>不存在<ul><li>调用<code>removeVnodes</code>删除老节点</li></ul></li><li>如果<code>oldVnode.text</code>存在，设置<code>elm</code>的<code>textContent</code>内容</li></ul></li><li>如果<code>vnode.text</code>不为<code>undefined</code>且<code>oldVnode.text !== vnode.text</code><ul><li>如果<code>oldCh</code>存在，使用<code>removeVnode</code>删除<code>oldCh</code>节点</li><li>给elm设置<code>vnode.text</code>值</li></ul></li></ul></li><li><p>如果不为相同节点，</p><ul><li><p>获取<code>oldVnode</code>的<code>elm</code>属性（<code>oldVnode.elm!</code>）并赋值给<code>elm</code></p></li><li><p>获取<code>oldVnode</code>的parent父元素（<code>api.parentNode(elm) as Node</code>）</p></li><li><p>使用<code>createElm</code>（函数内部返回<strong>vnode.elm</strong>）函数将elm属性赋值给<code>vnode.elm</code></p><p><code>createElm</code></p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">createElm</span> <span class="token punctuation">(</span>vnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token operator">:</span> VNodeQueue<span class="token punctuation">)</span><span class="token operator">:</span> Node <span class="token punctuation">{</span>  <span class="token comment">// 执行用户设置的init钩子函数</span>  <span class="token keyword">let</span> i<span class="token operator">:</span> <span class="token builtin">any</span>  <span class="token keyword">let</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data  <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> init <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token operator">?.</span>init    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">init</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>      data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>接下来判断<code>parent</code>是否为空，如果不为空，调用<code>api.insertBefore(parent, vnode.elm!, api.nextSibling(elm))</code>将其插入到<code>parent</code>元素中的兄弟节点（一般为文本节点）之后，然后使用<code>removeVnodes</code>函数删除原来的<code>oldVnode</code></p><p><code>removeVnode</code></p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">removeVnodes</span> <span class="token punctuation">(</span>parentElm<span class="token operator">:</span> Node<span class="token punctuation">,</span>  vnodes<span class="token operator">:</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  startIdx<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>  endIdx<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>  <span class="token comment">// 参数一：要删除节点的父节点</span>  <span class="token comment">// 参数二：要删除的节点</span>  <span class="token comment">// 参数三：开始索引</span>  <span class="token comment">// 参数四：结束索引</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> startIdx <span class="token operator">&lt;=</span> endIdx<span class="token punctuation">;</span> <span class="token operator">++</span>startIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//</span>    <span class="token keyword">let</span> listeners<span class="token operator">:</span> <span class="token builtin">number</span>    <span class="token keyword">let</span> <span class="token function-variable function">rm</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>    <span class="token keyword">const</span> ch <span class="token operator">=</span> vnodes<span class="token punctuation">[</span>startIdx<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span>sel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 内部触发了vnode的destroy钩子函数</span>        <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>        <span class="token comment">// 防止重复删除DOM元素</span>        listeners <span class="token operator">=</span> cbs<span class="token punctuation">.</span>remove<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span>        <span class="token comment">// createRmCb高阶函数，内部返回真正删除dom元素的函数</span>        rm <span class="token operator">=</span> <span class="token function">createRmCb</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">,</span> listeners<span class="token punctuation">)</span>        <span class="token comment">// remove钩子函数内部会真正调用rm（删除DOM元素）</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>remove<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>remove<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> rm<span class="token punctuation">)</span>        <span class="token comment">// 用户是否传入remove钩子函数</span>        <span class="token keyword">const</span> removeHook <span class="token operator">=</span> ch<span class="token operator">?.</span>data<span class="token operator">?.</span>hook<span class="token operator">?.</span>remove        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>removeHook<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">removeHook</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> rm<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token function">rm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// Text node</span>        api<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> ch<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><p>接下来遍历<code>insertVnodeQueue</code>（保存新插入节点的队列，为了触发钩子函数），执行<code>create</code>钩子函数。然后遍历<code>cbs</code>中的<code>post</code>，调用（<code>cbs.post[i]()</code>）post钩子函数。最后返回<code>vnode</code>对象。</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> insertedVnodeQueue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>  insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>hook<span class="token operator">!</span><span class="token punctuation">.</span>insert<span class="token operator">!</span><span class="token punctuation">(</span>insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">return</span> vnode<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="二、编程题"><a href="#二、编程题" class="headerlink" title="二、编程题"></a>二、编程题</h1><blockquote><p><strong>1、模拟 VueRouter 的 hash 模式的实现，实现思路和 History 模式类似，把 URL 中的 # 后面的内容作为路由的地址，可以通过 hashchange 事件监听路由地址的变化。</strong></p></blockquote><p> 实现思路（构建类图如下）：</p><ul><li><code>+ options</code></li><li><code>+data</code></li><li><code>+routeMap</code></li><li><code>+Constructor(Options): VueRouter</code></li><li><code>_install(Vue): void</code></li><li><code>+init(): void</code></li><li><code>+initEvent(): void</code></li><li><code>+createRouteMap(): void</code></li><li><code>initComponents(Vue): void</code></li></ul><p>代码实现地址：<a href="https://gitee.com/coder5leo/fed-e-task-03-01/blob/master/codes/vue-router-hash/src/vuerouter/index.js">https://gitee.com/coder5leo/fed-e-task-03-01/blob/master/codes/vue-router-hash/src/vuerouter/index.js</a></p><blockquote><p><strong>2、在模拟 Vue.js 响应式源码的基础上实现 v-html 指令，以及 v-on 指令。</strong></p></blockquote><p> 代码实现地址：<a href="https://gitee.com/coder5leo/fed-e-task-03-01/tree/master/codes/minivue">https://gitee.com/coder5leo/fed-e-task-03-01/tree/master/codes/minivue</a></p><blockquote><p><strong>3、参考 Snabbdom 提供的电影列表的示例，利用Snabbdom 实现类似的效果，如图：</strong></p><p><img src="http://5coder.cn/img/Ciqc1F7zUZ-AWP5NAAN0Z_t_hDY449.png"></p></blockquote><p>代码实现地址：<a href="https://gitee.com/coder5leo/fed-e-task-03-01/tree/master/codes/snabbdom-movie">https://gitee.com/coder5leo/fed-e-task-03-01/tree/master/codes/snabbdom-movie</a></p>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue响应式 </tag>
            
            <tag> Diff </tag>
            
            <tag> VueRouter </tag>
            
            <tag> Snabbdom </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Virtual DOM 的实现原理</title>
      <link href="2021/060417380.html"/>
      <url>2021/060417380.html</url>
      
        <content type="html"><![CDATA[<h1 id="Virtual-DOM的实现原理"><a href="#Virtual-DOM的实现原理" class="headerlink" title="Virtual DOM的实现原理"></a>Virtual DOM的实现原理</h1><h2 id="一、Virtual-DOM"><a href="#一、Virtual-DOM" class="headerlink" title="一、Virtual DOM"></a>一、Virtual DOM</h2><h3 id="1-课程目标"><a href="#1-课程目标" class="headerlink" title="1.课程目标"></a>1.课程目标</h3><ul><li><p>了解什么是虚拟DOM，以及虚拟DOM的作用</p></li><li><p>Snabbdom的基本使用</p><p>Vue内部的虚拟DOM改造了一个开源库Snabbdom</p></li><li><p><strong>Snabbdom的源码解析</strong></p></li></ul><h3 id="2-什么是Virtual-DOM"><a href="#2-什么是Virtual-DOM" class="headerlink" title="2.什么是Virtual DOM"></a>2.什么是Virtual DOM</h3><ul><li><p>Virtual DOM(虚拟DOM)，是由普通的JS对象来描述DOM对象</p></li><li><p>真实DOM成员</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>  s <span class="token operator">+=</span> key <span class="token operator">+</span> <span class="token string">','</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 打印DIV的所有成员</span>align<span class="token punctuation">,</span>title<span class="token punctuation">,</span>lang<span class="token punctuation">,</span>translate<span class="token punctuation">,</span>dir<span class="token punctuation">,</span>hidden<span class="token punctuation">,</span>accessKey<span class="token punctuation">,</span>draggable<span class="token punctuation">,</span>spellcheck<span class="token punctuation">,</span>autocapitalize<span class="token punctuation">,</span>contentEditable<span class="token punctuation">,</span>isContentEditable<span class="token punctuation">,</span>inputMode<span class="token punctuation">,</span>offsetParent<span class="token punctuation">,</span>offsetTop<span class="token punctuation">,</span>offsetLeft<span class="token punctuation">,</span>offsetWidth<span class="token punctuation">,</span>offsetHeight<span class="token punctuation">,</span>style<span class="token punctuation">,</span>innerText<span class="token punctuation">,</span>outerText<span class="token punctuation">,</span>oncopy<span class="token punctuation">,</span>oncut<span class="token punctuation">,</span>onpaste<span class="token punctuation">,</span>onabort<span class="token punctuation">,</span>onblur<span class="token punctuation">,</span>oncancel<span class="token punctuation">,</span>oncanplay<span class="token punctuation">,</span>oncanplaythrough<span class="token punctuation">,</span>onchange<span class="token punctuation">,</span>onclick<span class="token punctuation">,</span>onclose<span class="token punctuation">,</span>oncontextmenu<span class="token punctuation">,</span>oncuechange<span class="token punctuation">,</span>ondblclick<span class="token punctuation">,</span>ondrag<span class="token punctuation">,</span>ondragend<span class="token punctuation">,</span>ondragenter<span class="token punctuation">,</span>ondragleave<span class="token punctuation">,</span>ondragover<span class="token punctuation">,</span>ondragstart<span class="token punctuation">,</span>ondrop<span class="token punctuation">,</span>ondurationchange<span class="token punctuation">,</span>onemptied<span class="token punctuation">,</span>onended<span class="token punctuation">,</span>onerror<span class="token punctuation">,</span>onfocus<span class="token punctuation">,</span>oninput<span class="token punctuation">,</span>oninvalid<span class="token punctuation">,</span>onkeydown<span class="token punctuation">,</span>onkeypress<span class="token punctuation">,</span>onkeyup<span class="token punctuation">,</span>onload<span class="token punctuation">,</span>onloadeddata<span class="token punctuation">,</span>onloadedmetadata<span class="token punctuation">,</span>onloadstart<span class="token punctuation">,</span>onmousedown<span class="token punctuation">,</span>onmouseenter<span class="token punctuation">,</span>onmouseleave<span class="token punctuation">,</span>onmousemove<span class="token punctuation">,</span>onmouseout<span class="token punctuation">,</span>onmouseover<span class="token punctuation">,</span>onmouseup<span class="token punctuation">,</span>onmousewheel<span class="token punctuation">,</span>onpause<span class="token punctuation">,</span>onplay<span class="token punctuation">,</span>onplaying<span class="token punctuation">,</span>onprogress<span class="token punctuation">,</span>onratechange<span class="token punctuation">,</span>onreset<span class="token punctuation">,</span>onresize<span class="token punctuation">,</span>onscroll<span class="token punctuation">,</span>onseeked<span class="token punctuation">,</span>onseeking<span class="token punctuation">,</span>onselect<span class="token punctuation">,</span>onstalled<span class="token punctuation">,</span>onsubmit<span class="token punctuation">,</span>onsuspend<span class="token punctuation">,</span>ontimeupdate<span class="token punctuation">,</span>ontoggle<span class="token punctuation">,</span>onvolumechange<span class="token punctuation">,</span>onwaiting<span class="token punctuation">,</span>onwheel<span class="token punctuation">,</span>onauxclick<span class="token punctuation">,</span>ongotpointercapture<span class="token punctuation">,</span>onlostpointercapture<span class="token punctuation">,</span>onpointerdown<span class="token punctuation">,</span>onpointermove<span class="token punctuation">,</span>onpointerup<span class="token punctuation">,</span>onpointercancel<span class="token punctuation">,</span>onpointerover<span class="token punctuation">,</span>onpointerout<span class="token punctuation">,</span>onpointerenter<span class="token punctuation">,</span>onpointerleave<span class="token punctuation">,</span>onselectstart<span class="token punctuation">,</span>onselectionchange<span class="token punctuation">,</span>onanimationend<span class="token punctuation">,</span>onanimationiteration<span class="token punctuation">,</span>onanimationstart<span class="token punctuation">,</span>ontransitionend<span class="token punctuation">,</span>dataset<span class="token punctuation">,</span>nonce<span class="token punctuation">,</span>autofocus<span class="token punctuation">,</span>tabIndex<span class="token punctuation">,</span>click<span class="token punctuation">,</span>focus<span class="token punctuation">,</span>blur<span class="token punctuation">,</span>enterKeyHint<span class="token punctuation">,</span>onformdata<span class="token punctuation">,</span>onpointerrawupdate<span class="token punctuation">,</span>attachInternals<span class="token punctuation">,</span>namespaceURI<span class="token punctuation">,</span>prefix<span class="token punctuation">,</span>localName<span class="token punctuation">,</span>tagName<span class="token punctuation">,</span>id<span class="token punctuation">,</span>className<span class="token punctuation">,</span>classList<span class="token punctuation">,</span>slot<span class="token punctuation">,</span>part<span class="token punctuation">,</span>attributes<span class="token punctuation">,</span>shadowRoot<span class="token punctuation">,</span>assignedSlot<span class="token punctuation">,</span>innerHTML<span class="token punctuation">,</span>outerHTML<span class="token punctuation">,</span>scrollTop<span class="token punctuation">,</span>scrollLeft<span class="token punctuation">,</span>scrollWidth<span class="token punctuation">,</span>scrollHeight<span class="token punctuation">,</span>clientTop<span class="token punctuation">,</span>clientLeft<span class="token punctuation">,</span>clientWidth<span class="token punctuation">,</span>clientHeight<span class="token punctuation">,</span>attributeStyleMap<span class="token punctuation">,</span>onbeforecopy<span class="token punctuation">,</span>onbeforecut<span class="token punctuation">,</span>onbeforepaste<span class="token punctuation">,</span>onsearch<span class="token punctuation">,</span>elementTiming<span class="token punctuation">,</span>previousElementSibling<span class="token punctuation">,</span>nextElementSibling<span class="token punctuation">,</span>children<span class="token punctuation">,</span>firstElementChild<span class="token punctuation">,</span>lastElementChild<span class="token punctuation">,</span>childElementCount<span class="token punctuation">,</span>onfullscreenchange<span class="token punctuation">,</span>onfullscreenerror<span class="token punctuation">,</span>onwebkitfullscreenchange<span class="token punctuation">,</span>onwebkitfullscreenerror<span class="token punctuation">,</span>setPointerCapture<span class="token punctuation">,</span>releasePointerCapture<span class="token punctuation">,</span>hasPointerCapture<span class="token punctuation">,</span>hasAttributes<span class="token punctuation">,</span>getAttributeNames<span class="token punctuation">,</span>getAttribute<span class="token punctuation">,</span>getAttributeNS<span class="token punctuation">,</span>setAttribute<span class="token punctuation">,</span>setAttributeNS<span class="token punctuation">,</span>removeAttribute<span class="token punctuation">,</span>removeAttributeNS<span class="token punctuation">,</span>hasAttribute<span class="token punctuation">,</span>hasAttributeNS<span class="token punctuation">,</span>toggleAttribute<span class="token punctuation">,</span>getAttributeNode<span class="token punctuation">,</span>getAttributeNodeNS<span class="token punctuation">,</span>setAttributeNode<span class="token punctuation">,</span>setAttributeNodeNS<span class="token punctuation">,</span>removeAttributeNode<span class="token punctuation">,</span>closest<span class="token punctuation">,</span>matches<span class="token punctuation">,</span>webkitMatchesSelector<span class="token punctuation">,</span>attachShadow<span class="token punctuation">,</span>getElementsByTagName<span class="token punctuation">,</span>getElementsByTagNameNS<span class="token punctuation">,</span>getElementsByClassName<span class="token punctuation">,</span>insertAdjacentElement<span class="token punctuation">,</span>insertAdjacentText<span class="token punctuation">,</span>insertAdjacentHTML<span class="token punctuation">,</span>requestPointerLock<span class="token punctuation">,</span>getClientRects<span class="token punctuation">,</span>getBoundingClientRect<span class="token punctuation">,</span>scrollIntoView<span class="token punctuation">,</span>scroll<span class="token punctuation">,</span>scrollTo<span class="token punctuation">,</span>scrollBy<span class="token punctuation">,</span>scrollIntoViewIfNeeded<span class="token punctuation">,</span>animate<span class="token punctuation">,</span>computedStyleMap<span class="token punctuation">,</span>before<span class="token punctuation">,</span>after<span class="token punctuation">,</span>replaceWith<span class="token punctuation">,</span>remove<span class="token punctuation">,</span>prepend<span class="token punctuation">,</span>append<span class="token punctuation">,</span>querySelector<span class="token punctuation">,</span>querySelectorAll<span class="token punctuation">,</span>requestFullscreen<span class="token punctuation">,</span>webkitRequestFullScreen<span class="token punctuation">,</span>webkitRequestFullscreen<span class="token punctuation">,</span>createShadowRoot<span class="token punctuation">,</span>getDestinationInsertionPoints<span class="token punctuation">,</span><span class="token constant">ELEMENT_NODE</span><span class="token punctuation">,</span><span class="token constant">ATTRIBUTE_NODE</span><span class="token punctuation">,</span><span class="token constant">TEXT_NODE</span><span class="token punctuation">,</span><span class="token constant">CDATA_SECTION_NODE</span><span class="token punctuation">,</span><span class="token constant">ENTITY_REFERENCE_NODE</span><span class="token punctuation">,</span><span class="token constant">ENTITY_NODE</span><span class="token punctuation">,</span><span class="token constant">PROCESSING_INSTRUCTION_NODE</span><span class="token punctuation">,</span><span class="token constant">COMMENT_NODE</span><span class="token punctuation">,</span><span class="token constant">DOCUMENT_NODE</span><span class="token punctuation">,</span><span class="token constant">DOCUMENT_TYPE_NODE</span><span class="token punctuation">,</span><span class="token constant">DOCUMENT_FRAGMENT_NODE</span><span class="token punctuation">,</span><span class="token constant">NOTATION_NODE</span><span class="token punctuation">,</span><span class="token constant">DOCUMENT_POSITION_DISCONNECTED</span><span class="token punctuation">,</span><span class="token constant">DOCUMENT_POSITION_PRECEDING</span><span class="token punctuation">,</span><span class="token constant">DOCUMENT_POSITION_FOLLOWING</span><span class="token punctuation">,</span><span class="token constant">DOCUMENT_POSITION_CONTAINS</span><span class="token punctuation">,</span><span class="token constant">DOCUMENT_POSITION_CONTAINED_BY</span><span class="token punctuation">,</span><span class="token constant">DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</span><span class="token punctuation">,</span>nodeType<span class="token punctuation">,</span>nodeName<span class="token punctuation">,</span>baseURI<span class="token punctuation">,</span>isConnected<span class="token punctuation">,</span>ownerDocument<span class="token punctuation">,</span>parentNode<span class="token punctuation">,</span>parentElement<span class="token punctuation">,</span>childNodes<span class="token punctuation">,</span>firstChild<span class="token punctuation">,</span>lastChild<span class="token punctuation">,</span>previousSibling<span class="token punctuation">,</span>nextSibling<span class="token punctuation">,</span>nodeValue<span class="token punctuation">,</span>textContent<span class="token punctuation">,</span>hasChildNodes<span class="token punctuation">,</span>getRootNode<span class="token punctuation">,</span>normalize<span class="token punctuation">,</span>cloneNode<span class="token punctuation">,</span>isEqualNode<span class="token punctuation">,</span>isSameNode<span class="token punctuation">,</span>compareDocumentPosition<span class="token punctuation">,</span>contains<span class="token punctuation">,</span>lookupPrefix<span class="token punctuation">,</span>lookupNamespaceURI<span class="token punctuation">,</span>isDefaultNamespace<span class="token punctuation">,</span>insertBefore<span class="token punctuation">,</span>appendChild<span class="token punctuation">,</span>replaceChild<span class="token punctuation">,</span>removeChild<span class="token punctuation">,</span>addEventListener<span class="token punctuation">,</span>removeEventListener<span class="token punctuation">,</span>dispatchEvent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>可以看到有很多成员，也就是创建一个dom对象的成本非常高。</p></li><li><p>使用Virtual DOM来描述真实DOM</p><p>创建Virtual DOM的成员很少，创建一个Virtual DOM的开销要比真实的DOM小很多</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 普通的JavaScript对象</span><span class="token punctuation">{</span>  sel<span class="token operator">:</span> <span class="token string">"div"</span><span class="token punctuation">,</span>  <span class="token comment">// 选择器</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  children<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  text<span class="token operator">:</span> <span class="token string">"Hello Virtual DOM"</span><span class="token punctuation">,</span>  <span class="token comment">// dom文本</span>  elm<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  key<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="3-为什么使用Virtual-DOM"><a href="#3-为什么使用Virtual-DOM" class="headerlink" title="3.为什么使用Virtual DOM"></a>3.为什么使用Virtual DOM</h3><ul><li><p>手动操作DOM比较麻烦，还需要考虑浏览器兼容性问题，虽然jQuery等库简化DOM操作，但随着项目的复杂DOM操作负责提升</p><p>jQuery开发的列表<a href="https://codesandbox.io/s/jq-demo-5i7qp?file=/index.html">demo</a>，列表有三种功能：增加、排序、删除，三种功能增加渐变效果，在2s之内把透明度从0变为1。通过点击增加、排序、删除按钮，发现页面每次都需要闪烁，其内部是重新渲染所有列表，性能消耗较高</p><p><img src="http://5coder.cn/img/izVHJKWlDroh2tT.gif"></p></li><li><p>为了简化DOM的负责操作，于是出现了各种的MVVM框架，MVVM矿建解决了视图和状态的同步问题</p></li><li><p>为了简化视图的操作，可以使用模板引擎，但是模板引擎没有解决跟踪状态变化的问题，于是Virtual DOM出现了</p></li><li><p>Virtual DOM的好处是当状态改变时不需要立即更新DOM，只需要创建一个虚拟树来描述DOM，Virtual DOM内部将弄清楚如何有效(<strong>diff算法</strong>)的更新DOM</p><p>Virtual DOM列表<a href="https://codesandbox.io/s/jq-demo-4hbyb?file=/index.html">案例演示</a>，可以看到当点击增加时，只有列表第一条在变化，整个页面并没有闪烁。通过Virtual DOM可有效减少DOM操作，Virtual记录上一次状态。</p><p><img src="http://5coder.cn/img/gDTbA1F7hZCS2oz.gif"></p></li><li><p>参考GitHub上<a href="https://github.com/Matt-Esch/virtual-dom">virtual-dom</a>的描述</p><ul><li>虚拟DOM可以维护程序的状态，跟踪上一次的状态</li><li>通过比较前后两次状态的差异来更新真实的DOM</li></ul></li></ul><h3 id="4-虚拟DOM的作用"><a href="#4-虚拟DOM的作用" class="headerlink" title="4.虚拟DOM的作用"></a>4.虚拟DOM的作用</h3><ul><li>维护视图和状态的关系</li><li>负责视图情况下提升渲染性能</li><li>跨平台<ul><li>浏览器平台渲染DOM</li><li>服务端渲染SSR(Nuxt.js/Next.js)</li><li>原生应用(Weex/React Native)</li><li>小程序(mpvue/uni-app)等</li></ul></li></ul><p><img src="http://5coder.cn/img/5QhHaZcxpKoCDJl.png"></p><h3 id="5-Virtual-DOM库"><a href="#5-Virtual-DOM库" class="headerlink" title="5.Virtual DOM库"></a>5.Virtual DOM库</h3><ul><li><a href="https://github.com/snabbdom/snabbdom">Snabbdom</a><ul><li>Vue2.x内部使用的Virtual DOM就是改造的Snabbdom</li><li>大约200SLOC（Single Line Of Code）</li><li>通过模块可扩展</li><li>源码使用TypeScript开发</li><li>最快的Virtual DOM之一</li></ul></li><li><a href="https://github.com/Matt-Esch/virtual-dom">virtual-dom</a></li></ul><h3 id="6-案例演示"><a href="#6-案例演示" class="headerlink" title="6.案例演示"></a>6.案例演示</h3><ul><li><a href="https://codesandbox.io/s/jq-demo-5i7qp">jQuery-demo</a></li><li><a href="https://codesandbox.io/s/snabbdom-demo-4hbyb">snabbdom-demo</a></li></ul><h2 id="二、Snabbdom基本使用"><a href="#二、Snabbdom基本使用" class="headerlink" title="二、Snabbdom基本使用"></a>二、Snabbdom基本使用</h2><h3 id="1-创建项目"><a href="#1-创建项目" class="headerlink" title="1.创建项目"></a>1.创建项目</h3><ul><li><p>为了使用简单，使用了 <a href="https://parceljs.org/getting_started.html">parcel</a></p></li><li><p>创建项目</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># windows环境，创建项目目录</span>md snabbdom-demo<span class="token comment"># 进入项目目录</span><span class="token builtin class-name">cd</span> snabbdom-demo<span class="token comment"># 创建package.json</span><span class="token function">yarn</span> init -y<span class="token comment"># 本地安装parcel</span><span class="token function">yarn</span> <span class="token function">add</span> parcel-bundler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置package.json的scripts</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"parcel index.html --open"</span><span class="token punctuation">,</span>    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"parcel bundle index.html"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>创建项目目录结构</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">│  index.html│  package.json└─src     01-basicusage.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="2-导入Snabbdom"><a href="#2-导入Snabbdom" class="headerlink" title="2.导入Snabbdom"></a>2.导入Snabbdom</h3><h4 id="Snabbdom文档"><a href="#Snabbdom文档" class="headerlink" title="Snabbdom文档"></a>Snabbdom文档</h4><ul><li><p>看文档的意义</p><ul><li>学习任何一个库都要 先看文档</li><li>通过文档了解库的作用</li><li>看文档中提供的实例，自己快速实现一个demo</li><li>通过文档查看API的使用</li></ul></li><li><p>文档地址</p><ul><li><p><a href="https://github.com/snabbdom/snabbdom">https://github.com/snabbdom/snabbdom</a></p></li><li><p>当前版本v2.1.0</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># --depth 表示克隆深度, 1 表示只克隆最新的版本. 因为如果项目迭代的版本很多, 克隆会很慢</span><span class="token function">git</span> clone -b v2.1.0 --depth<span class="token operator">=</span><span class="token number">1</span> https://github.com/snabbdom/snabbdom.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul></li></ul><h4 id="安装Snabbdom"><a href="#安装Snabbdom" class="headerlink" title="安装Snabbdom"></a>安装Snabbdom</h4><ul><li><p>安装Snabbdom</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> snabbdom@2.1.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>Snabbdom</code>的两个核心函数是<code>init</code>和<code>h()</code></p><ul><li><code>init()</code>是一个高阶函数，返回<code>patch()</code>函数</li><li><code>h()</code>函数返回虚拟节点VNode，这个函数在Vue.js的时候见过</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/init'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/h'</span><span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// init()函数接受一个参数为数组</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>注意：此时运行的话，项目会报错，提示找不到<code>init/h</code>模块，因为模块路径并不是<code>snabbdom/init</code>，这个路径是在package.json中的<code>exports</code>字段设置的，而我们使用的打包工具不支持<code>exports</code>这个字段，webpack4也不支持，webpack5支持该字段。</p><p><img src="http://5coder.cn/img/fvRIz9ZgeTPwF1c.png"></p><p>该字段在导入<code>snabbdom/init</code>的时候回补全路径成<code>snabbdom/build/package/init.js</code></p></blockquote><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"exports"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"./init"</span><span class="token operator">:</span> <span class="token string">"./build/package/init.js"</span><span class="token punctuation">,</span>    <span class="token property">"./h"</span><span class="token operator">:</span> <span class="token string">"./build/package/h.js"</span><span class="token punctuation">,</span>    <span class="token property">"./helpers/attachto"</span><span class="token operator">:</span> <span class="token string">"./build/package/helpers/attachto.js"</span><span class="token punctuation">,</span>    <span class="token property">"./hooks"</span><span class="token operator">:</span> <span class="token string">"./build/package/hooks.js"</span><span class="token punctuation">,</span>    <span class="token property">"./htmldomapi"</span><span class="token operator">:</span> <span class="token string">"./build/package/htmldomapi.js"</span><span class="token punctuation">,</span>    <span class="token property">"./is"</span><span class="token operator">:</span> <span class="token string">"./build/package/is.js"</span><span class="token punctuation">,</span>    <span class="token property">"./jsx"</span><span class="token operator">:</span> <span class="token string">"./build/package/jsx.js"</span><span class="token punctuation">,</span>    <span class="token property">"./modules/attributes"</span><span class="token operator">:</span> <span class="token string">"./build/package/modules/attributes.js"</span><span class="token punctuation">,</span>    <span class="token property">"./modules/class"</span><span class="token operator">:</span> <span class="token string">"./build/package/modules/class.js"</span><span class="token punctuation">,</span>    <span class="token property">"./modules/dataset"</span><span class="token operator">:</span> <span class="token string">"./build/package/modules/dataset.js"</span><span class="token punctuation">,</span>    <span class="token property">"./modules/eventlisteners"</span><span class="token operator">:</span> <span class="token string">"./build/package/modules/eventlisteners.js"</span><span class="token punctuation">,</span>    <span class="token property">"./modules/hero"</span><span class="token operator">:</span> <span class="token string">"./build/package/modules/hero.js"</span><span class="token punctuation">,</span>    <span class="token property">"./modules/module"</span><span class="token operator">:</span> <span class="token string">"./build/package/modules/module.js"</span><span class="token punctuation">,</span>    <span class="token property">"./modules/props"</span><span class="token operator">:</span> <span class="token string">"./build/package/modules/props.js"</span><span class="token punctuation">,</span>    <span class="token property">"./modules/style"</span><span class="token operator">:</span> <span class="token string">"./build/package/modules/style.js"</span><span class="token punctuation">,</span>    <span class="token property">"./thunk"</span><span class="token operator">:</span> <span class="token string">"./build/package/thunk.js"</span><span class="token punctuation">,</span>    <span class="token property">"./tovnode"</span><span class="token operator">:</span> <span class="token string">"./build/package/tovnode.js"</span><span class="token punctuation">,</span>    <span class="token property">"./vnode"</span><span class="token operator">:</span> <span class="token string">"./build/package/vnode.js"</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>如果使用不支持package.json的exports字段的打包工具，我们应该把模块路径写全</p><ul><li><p>查看安装的snabbdom的目录结构</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/h'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/init'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> classModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/modules/class'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>回顾Vue中的render函数</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>router<span class="token punctuation">,</span>store<span class="token punctuation">,</span><span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="3-代码演示"><a href="#3-代码演示" class="headerlink" title="3.代码演示"></a>3.代码演示</h3><p>案例一：使用<code>snabbdom</code>写一个<code>Hello World</code>，使用虚拟DOM在<code>div</code>中放置纯文本内容“Hello World”。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>init<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/init'</span><span class="token keyword">import</span> <span class="token punctuation">{</span>h<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/h'</span><span class="token comment">// init内部返回patch函数，把虚拟DOM渲染成真实DOM并挂载到DOM树上</span><span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">/** h函数创建虚拟DOM，这里创建的是VNode虚拟节点，VNode的作用是用来描述真实DOM* h函数参数：* 参数一：标签+选择器，字符串形式* 参数二：如果是字符串时，代表标签中的文本内容* 此处创建的vnode div将要替换掉index.html中用来占位的#app的div* */</span><span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div#container.cls'</span><span class="token punctuation">,</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token comment">/** patch函数的作用是对比两个VNode，把两个VNode的差异更新到真实DOM上* 参数一：旧的 VNode或旧的真实DOM，patch函数内部会将真实DOM转换为VNode* 参数二：新的 Vnode* 返回值：返回一个新的Vnode，返回的值回作为下次调用patch函数时的第一个参数，老的VNode* */</span><span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>命令行运行<code>yarn dev</code>，查看结果</p><p><img src="http://5coder.cn/img/Yj5s46tyR73bPZc.png"></p><p>再加一个小功能：假设页面上有一个按钮，当点击按钮时，把<code>id</code>是<code>container</code>的<code>div</code>改成Hello Snabbdom，并且更改类样式。</p><p><img src="http://5coder.cn/img/lb7zgO1VPkB93mY.png"></p><p>结果演示：<img src="http://5coder.cn/img/KV4UkexDc5uRtis.png"></p><p>案例二：在<code>div</code>中创建两个子元素：<code>h</code>和<code>p</code>标签。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>init<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/init'</span><span class="token keyword">import</span> <span class="token punctuation">{</span>h<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/h'</span><span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div#container'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'Hello p'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token keyword">let</span> oldVNode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/luEnD57tcdWOeAs.png"></p><p>拓展1：</p><blockquote><p>两秒中后更新h标签和p标签中的文本内容</p></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>init<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/init'</span><span class="token keyword">import</span> <span class="token punctuation">{</span>h<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/h'</span><span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div#container'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'Hello p'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token keyword">let</span> oldVNode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token comment">// 两秒中后更新h标签和p标签中的文本内容</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div.cls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">,</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'这是段落'</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 把老的视图更新到新的状态</span>  <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/ZzFB7SoLud3VstD.gif"></p><p>拓展2：</p><blockquote><p>两秒后清空div标签的内容</p></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>init<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/init'</span><span class="token keyword">import</span> <span class="token punctuation">{</span>h<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/h'</span><span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div#container'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'Hello p'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token keyword">let</span> oldVNode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token comment">// 两秒后清空div标签的内容</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// h('!')是创建注释</span>  vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span>  <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/XWG9SNfIaOwcbgy.gif"></p><h3 id="4-模块"><a href="#4-模块" class="headerlink" title="4.模块"></a>4.模块</h3><p>Snabbdom 的核心库并不能处理DOM元素的属性/样式/事件等，如果需要处理的话，可以使用模块</p><h4 id="常用模块"><a href="#常用模块" class="headerlink" title="常用模块"></a>常用模块</h4><ul><li>官方提供了6个模块<ul><li><code>attributes</code><ul><li>设置VNode对应的DOM元素的属性，内部使用DOM的标准方法<code>setAttribute()</code></li><li>内部会对DOM对象的布尔类型的属性做判断，例如：selected/checked等</li></ul></li><li><code>props</code><ul><li>和<code>attributes</code>模块相似，设置DOM元素的属性，内部使用<code>element[attr] = value</code></li><li>内部不能处理布尔类型的属性</li></ul></li><li><code>dataset</code><ul><li>设置HTML5中提供的<code>data-*</code>的自定义属性</li></ul></li><li><code>class</code><ul><li>不是用来<strong>设置</strong>类样式的，而是用来<strong>切换</strong>类样式。如果要设置类样式，可以通过<code>h()</code>的第一个参数来设置<code>h('#div.red', vnode)</code></li><li>注意：给元素设置类样式是通过<code>sel</code>选择器</li></ul></li><li><code>eventListeners</code><ul><li>注册和移除事件</li></ul></li><li><code>style</code><ul><li>设置行内样式，使用该模块可以很容易设置动画</li><li>内部注册了<code>transitionEnd</code>事件</li><li><code>delayed/remove/destroy</code></li></ul></li></ul></li></ul><h4 id="模块使用"><a href="#模块使用" class="headerlink" title="模块使用"></a>模块使用</h4><p>模块的使用步骤：</p><ul><li>导入需要的模块</li><li><code>init()</code>函数中注册模块</li><li>使用<code>h()</code>函数创建VNode的时候，可以把第二个参数设置为对象，其他参数依次后移</li></ul><h4 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h4><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>init<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/init'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/h'</span><span class="token comment">// 1.导入所需的模块</span><span class="token keyword">import</span> <span class="token punctuation">{</span> styleModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/modules/style'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> eventListenersModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom/build/package/modules/eventlisteners'</span><span class="token comment">// 2.init函数中注册所需的模块</span><span class="token comment">// init()的参数是数组，可以用来传入模块，处理属性、样式、事件等</span><span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token comment">// 注册模块</span>  styleModule<span class="token punctuation">,</span>  eventListenersModule<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">// 3.使用h()函数创建Vnode</span><span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div.cls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>style<span class="token operator">:</span> <span class="token punctuation">{</span>backgroundColor<span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'这里是h1标签'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>on<span class="token operator">:</span> <span class="token punctuation">{</span>click<span class="token operator">:</span> eventHandler<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'这里是p标签'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">eventHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'别点我，疼'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/L1sDmbwxZ7SnjqG.png"></p><h2 id="三、Snabbdom源码解析"><a href="#三、Snabbdom源码解析" class="headerlink" title="三、Snabbdom源码解析"></a>三、Snabbdom源码解析</h2><blockquote><p>接下来学习Snabbdom源码，因为Vue中的虚拟DOM是通过改造Snabbdom实现的。所以看完Snabbdom源码之后，就掌握了Vue中虚拟DOM的实现原理。通过查看Snabbdom源码，可以掌握VNode到底是什么，<code>h()、init()、patch()</code>到底是如何工作的。</p></blockquote><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h3><h4 id="如何学习源码"><a href="#如何学习源码" class="headerlink" title="如何学习源码"></a>如何学习源码</h4><ul><li>先宏观了解</li><li>带着目标看源码</li><li>看源码的过程不求甚解</li><li>调试</li><li>参考资料</li></ul><h4 id="Snabbdom的核心"><a href="#Snabbdom的核心" class="headerlink" title="Snabbdom的核心"></a>Snabbdom的核心</h4><ul><li>使用<code>h()</code>函数创建<code>JavaScript</code>对象(<code>VNode</code>)描述真实<code>DOM</code></li><li><code>init()</code>设置模块，创建<code>patch()</code></li><li><code>patch()</code>比较新旧两个VNode，如果patch函数的第一个参数是真实DOM，首先将真实DOM转换成虚拟DOM，再进行对比</li><li>把变化的内容更新到真实<code>DOM</code>树上</li></ul><h4 id="Snabbdom源码"><a href="#Snabbdom源码" class="headerlink" title="Snabbdom源码"></a>Snabbdom源码</h4><ul><li><p>源码地址：</p><ul><li><a href="https://github.com/snabbdom/snabbdom">https://github.com/snabbdom/snabbdom</a></li><li>当前使用版本：v2.1.0</li></ul></li><li><p>克隆代码</p><ul><li>```bash<br>git clone -b v2.1.0 –depth=1 <a href="https://github.com/snabbdom/snabbdom.git">https://github.com/snabbdom/snabbdom.git</a><pre class="line-numbers language-none"><code class="language-none">- src目录结构  ```txt  ├── package  │&nbsp;&nbsp; ├── helpers  │&nbsp;&nbsp; │&nbsp;&nbsp; └── attachto.ts定义了 vnode.ts 中 AttachData 的数据结构  │&nbsp;&nbsp; ├── modules  │&nbsp;&nbsp; │&nbsp;&nbsp; ├── attributes.ts  │&nbsp;&nbsp; │&nbsp;&nbsp; ├── class.ts  │&nbsp;&nbsp; │&nbsp;&nbsp; ├── dataset.ts  │&nbsp;&nbsp; │&nbsp;&nbsp; ├── eventlisteners.ts  │&nbsp;&nbsp; │&nbsp;&nbsp; ├── hero.tsexample 中使用到的自定义钩子  │&nbsp;&nbsp; │&nbsp;&nbsp; ├── module.ts定义了模块中用到的钩子函数  │&nbsp;&nbsp; │&nbsp;&nbsp; ├── props.ts  │&nbsp;&nbsp; │&nbsp;&nbsp; └── style.ts  │&nbsp;&nbsp; ├── h.tsh() 函数，用来创建 VNode  │&nbsp;&nbsp; ├── hooks.ts所有钩子函数的定义  │&nbsp;&nbsp; ├── htmldomapi.ts对 DOM API 的包装  │&nbsp;&nbsp; ├── init.ts加载 modules、DOMAPI，返回 patch 函数  │&nbsp;&nbsp; ├── is.ts辅助模块，判断数组和原始值的函数  │&nbsp;&nbsp; ├── jsx-global.tsjsx 的类型声明文件  │&nbsp;&nbsp; ├── jsx.ts处理 jsx  │&nbsp;&nbsp; ├── thunk.ts优化处理，对复杂视图不可变值得优化  │&nbsp;&nbsp; ├── tovnode.tsDOM 转换成 VNode  │&nbsp;&nbsp; ├── ts-transform-js-extension.cjs  │&nbsp;&nbsp; ├── tsconfig.jsonts 的编译配置文件  │&nbsp;&nbsp; └── vnode.ts虚拟节点定义<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h3 id="2-h函数"><a href="#2-h函数" class="headerlink" title="2.h函数"></a>2.h函数</h3><ul><li><p><code>h()</code>函数介绍</p><ul><li><p>在使用Vue的时候见过<code>h()</code>函数</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    router<span class="token punctuation">,</span>    store<span class="token punctuation">,</span>    <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>h()</code>函数最早见于<a href="https://github.com/hyperhype/hyperscript">hyperscript</a>，使用<code>JavaScript</code>创建超文本</p></li><li><p>Snabbdom中的<code>h()</code>函数不是用来创建超文本，而是创建<code>VNode</code></p></li></ul></li><li><p><a href="https://www.zhihu.com/question/63751258">函数重载</a></p><ul><li><p>概念</p><ul><li>函数名相同，<strong>参数个数</strong>或<strong>参数类型</strong>不同的函数</li><li><code>JavaScript</code>中没有重载的概念</li><li><code>TypeScript</code>中有重载，不过重载的实现还是用过代码调整参数</li></ul></li><li><p>重载的示意</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 参数个数不同的函数重载</span><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number<span class="token punctuation">,</span> c<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// 调用第一个add函数</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">// 调用第二个add函数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 参数类型不同的函数重载</span><span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// 调用第一个add函数</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span>  <span class="token comment">// 调用第二个add函数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>源码位置：src/package/h.ts</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// h 函数的重载</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span>sel<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span>sel<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span>sel<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> children<span class="token operator">:</span> VNodeChildren<span class="token punctuation">)</span><span class="token operator">:</span> VNode<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span>sel<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> children<span class="token operator">:</span> VNodeChildren<span class="token punctuation">)</span><span class="token operator">:</span> VNode<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span>sel<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> b<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> c<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>  <span class="token keyword">var</span> data<span class="token operator">:</span> VNodeData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token keyword">var</span> children<span class="token operator">:</span> <span class="token builtin">any</span>  <span class="token keyword">var</span> text<span class="token operator">:</span> <span class="token builtin">any</span>  <span class="token keyword">var</span> i<span class="token operator">:</span> <span class="token builtin">number</span>  <span class="token comment">// 处理参数，实现重载的机制</span>  <span class="token comment">// 当c参数不为undefined时，正面函数参数个数为3</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 处理三个参数的情况</span>    <span class="token comment">// sel、data、children/text</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      data <span class="token operator">=</span> b    <span class="token punctuation">}</span>    <span class="token comment">// 如果 c 是数组</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">is</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      children <span class="token operator">=</span> c    <span class="token comment">// 如果 c 是字符串或者数字，是给节点标签中用来显示的内容</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">is</span><span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      text <span class="token operator">=</span> c    <span class="token comment">// 如果 c 是VNode</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>      children <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> b <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 处理两个参数的情况</span>    <span class="token comment">// 如果b是数组</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">is</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      children <span class="token operator">=</span> b    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">is</span><span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果 c 是字符串或者数字</span>      text <span class="token operator">=</span> b    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果 b 是 VNode</span>      children <span class="token operator">=</span> <span class="token punctuation">[</span>b<span class="token punctuation">]</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> data <span class="token operator">=</span> b <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>children <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 处理 children 中的原始值(string/number)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果 child 是 string/number，创建文本节点</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">is</span><span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">vnode</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>    sel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'s'</span> <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'v'</span> <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'g'</span> <span class="token operator">&amp;&amp;</span>    <span class="token punctuation">(</span>sel<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">||</span> sel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'.'</span> <span class="token operator">||</span> sel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'#'</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果是 svg，添加命名空间</span>    <span class="token function">addNS</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> sel<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 返回 VNode</span>  <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h3 id="3-VNode"><a href="#3-VNode" class="headerlink" title="3.VNode"></a>3.VNode</h3><ul><li><p>一个VNode就是一个虚拟节点，用来描述一个DOM元素，如果这个VNode有<code>children</code>就是Virtual DOM</p></li><li><p>源码位置：src/package/vnode.ts</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">VNode</span> <span class="token punctuation">{</span>  <span class="token comment">// 选择器</span>  sel<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>  <span class="token comment">// 节点数据：属性/样式/事件等</span>  data<span class="token operator">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>  <span class="token comment">// 子节点，和 text 只能互斥</span>  children<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>VNode <span class="token operator">|</span> <span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>  <span class="token comment">// 记录 vnode 对应的真实 DOM</span>  elm<span class="token operator">:</span> Node <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>  <span class="token comment">// 节点中的内容，和 children 只能互斥</span>  text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>  <span class="token comment">// 优化用</span>  key<span class="token operator">:</span> Key <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">VNodeData</span> <span class="token punctuation">{</span>  props<span class="token operator">?</span><span class="token operator">:</span> Props  attrs<span class="token operator">?</span><span class="token operator">:</span> Attrs  <span class="token keyword">class</span><span class="token operator">?</span><span class="token operator">:</span> Classes  style<span class="token operator">?</span><span class="token operator">:</span> VNodeStyle  dataset<span class="token operator">?</span><span class="token operator">:</span> Dataset  on<span class="token operator">?</span><span class="token operator">:</span> On  hero<span class="token operator">?</span><span class="token operator">:</span> Hero  attachData<span class="token operator">?</span><span class="token operator">:</span> AttachData  hook<span class="token operator">?</span><span class="token operator">:</span> Hooks  key<span class="token operator">?</span><span class="token operator">:</span> Key  ns<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// for SVGs</span>  fn<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> VNode <span class="token comment">// for thunks</span>  args<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// for thunks</span>  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token comment">// for any other 3rd party module</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">vnode</span> <span class="token punctuation">(</span>sel<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>                      data<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>                      children<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>VNode <span class="token operator">|</span> <span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>                      text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>                      elm<span class="token operator">:</span> Element <span class="token operator">|</span> Text <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>  <span class="token keyword">const</span> key <span class="token operator">=</span> data <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> data<span class="token punctuation">.</span>key  <span class="token keyword">return</span> <span class="token punctuation">{</span> sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> elm<span class="token punctuation">,</span> key <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="4-Snabbdom"><a href="#4-Snabbdom" class="headerlink" title="4.Snabbdom"></a>4.Snabbdom</h3><h4 id="patch-整体过程分析"><a href="#patch-整体过程分析" class="headerlink" title="patch 整体过程分析"></a>patch 整体过程分析</h4><ul><li><code>patch(oldVnode, newVnode)</code></li><li><code>patch</code>函数俗称打补丁，把新节点中变化的内容渲染到真实DOM，最后返回新节点作为下一次处理的旧节点</li><li>对比新旧VNode是否相同节点(节点的<code>key</code>和<code>sel</code>相同)<ul><li>如果不是相同节点，删除之前的内容重新渲染</li><li>如果是相同节点，在判断新的<code>VNode</code>是否有<code>text</code>，如果有并且和<code>oldVnode</code>的<code>text</code>不同，直接更新文本内容<ul><li>如果新的<code>VNode</code>有<code>children</code>，判断子节点是否有变化，判断子节点的过程使用的就是<code>diff</code>算法</li></ul></li></ul></li><li><code>diff</code>过程只是进行同层级比较</li></ul><p><img src="http://5coder.cn/img/ykzGs5gIqB8DFa2.png"></p><h4 id="init"><a href="#init" class="headerlink" title="init"></a>init</h4><ul><li><p>功能：<code>init(modules, domAPI)</code>, 返回<code>patch()</code>函数（高阶函数）</p></li><li><p>为什么使用高阶函数？</p><ul><li>因为<code>patch()</code>函数在<strong>外部会调用多次</strong>，每次调用依赖一些参数，比如：modules、domAPI、cbs</li><li>通过高阶函数让<code>init()</code>内部形成闭包，返回的<code>patch()</code>可以访问到<code>modules、domAPI、cbs</code>，而不需要重新创建</li></ul></li><li><p><code>init()</code>在返回<code>fatch()</code>之前，首先收集了所有模块中的钩子函数存储到<code>cbs</code>对象中</p></li><li><p>源码位置：src/package/init.ts</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 定义了一些hooks钩子函数的名称，这些钩子函数在init时会被初始化，在特定的时机会被执行</span><span class="token keyword">const</span> hooks<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token keyword">keyof</span> Module<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'create'</span><span class="token punctuation">,</span> <span class="token string">'update'</span><span class="token punctuation">,</span> <span class="token string">'remove'</span><span class="token punctuation">,</span> <span class="token string">'destroy'</span><span class="token punctuation">,</span> <span class="token string">'pre'</span><span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">]</span><span class="token comment">// 参数一：modules，模块数组</span><span class="token comment">// 参数二：domAPI，用来把VNode对象转换成其他平台下的对应的元素，没有传递时默认设置成DOMAPI(浏览器环境下的dom对象，htmlDomApi)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">init</span> <span class="token punctuation">(</span>modules<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Partial<span class="token operator">&lt;</span>Module<span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span> domApi<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">DOMAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> i<span class="token operator">:</span> <span class="token builtin">number</span>  <span class="token keyword">let</span> j<span class="token operator">:</span> <span class="token builtin">number</span>  <span class="token comment">// callbacks回调函数，存储模块中的钩子函数</span>  <span class="token keyword">const</span> cbs<span class="token operator">:</span> ModuleHooks <span class="token operator">=</span> <span class="token punctuation">{</span>    create<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    update<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    remove<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    destroy<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    pre<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    post<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span>  <span class="token comment">// 初始化 api</span>  <span class="token keyword">const</span> api<span class="token operator">:</span> <span class="token constant">DOMAPI</span> <span class="token operator">=</span> domApi <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> domApi <span class="token operator">:</span> htmlDomApi  <span class="token comment">// 把传入的所有模块的钩子方法，统一存储到 cbs 对象中</span>  <span class="token comment">// 最终构建的 cbs 对象的形式 cbs = [ create: [fn1, fn2], update: [], ... ]</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hooks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// cbs['create'] = []</span>    cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> modules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// const hook = modules[0]['create']</span>        <span class="token keyword">const</span> hook <span class="token operator">=</span> modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>hook <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token punctuation">(</span>cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>hook<span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span>    ……  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span>oldVnode<span class="token operator">:</span> VNode <span class="token operator">|</span> Element<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNode<span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>    ……  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h4><ul><li><p>功能</p><ul><li>传入新旧 <code>VNode</code>，对比差异，把差异渲染到 <code>DOM</code></li><li>返回新的 <code>VNode</code>，作为下一次 <code>patch()</code> 的 <code>oldVnode</code></li></ul></li><li><p>执行过程</p><ul><li><p>首先执行<strong>模块</strong>中的<strong>钩子函数pre</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>如果 <code>oldVnode</code> 和<code>vnode</code> 相同（<code>key</code>和<code>sel</code>相同）</p><p>sameVnode</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sameVnode</span> <span class="token punctuation">(</span><span class="token parameter">vnode1<span class="token operator">:</span> VNode<span class="token punctuation">,</span> vnode2<span class="token operator">:</span> VNode</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>  <span class="token comment">// key和sel都相同</span>  <span class="token keyword">return</span> vnode1<span class="token punctuation">.</span>key <span class="token operator">===</span> vnode2<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> vnode1<span class="token punctuation">.</span>sel <span class="token operator">===</span> vnode2<span class="token punctuation">.</span>sel<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>调用<code>patchVnode()</code>，找节点的差异并更新<code>DOM</code>(后面详细讲解)</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">patchVnode</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token operator">:</span> VNodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> hook <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token operator">?.</span>hook  hook<span class="token operator">?.</span>prepatch<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>  <span class="token keyword">const</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span>  <span class="token keyword">const</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token keyword">return</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>data <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>    vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token operator">?.</span>update<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>      <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  hook<span class="token operator">?.</span>postpatch<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>如果<code>oldVnode</code>是<code>DOM</code>元素</p><ul><li><p>把<code>DOM</code>元素转换成<code>oldVnode</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">emptyNodeAt</span> <span class="token punctuation">(</span><span class="token parameter">elm<span class="token operator">:</span> Element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> id <span class="token operator">=</span> elm<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token string">'#'</span> <span class="token operator">+</span> elm<span class="token punctuation">.</span>id <span class="token operator">:</span> <span class="token string">''</span>  <span class="token keyword">const</span> c <span class="token operator">=</span> elm<span class="token punctuation">.</span>className <span class="token operator">?</span> <span class="token string">'.'</span> <span class="token operator">+</span> elm<span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span>  <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span><span class="token function">tagName</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> id <span class="token operator">+</span> c<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> elm<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>调用<code>createElm()</code>把<code>vnode</code>转换为真实<code>DOM</code>，记录到<code>vnode.elm</code></p></li><li><p>把刚创建的<code>DOM</code>元素插入到<code>parent</code>中</p></li><li><p>移除老节点</p></li><li><p>触发用户设置的<code>create</code>钩子函数</p></li></ul></li></ul></li><li><p>源码位置：src/package/init.ts</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span>oldVnode<span class="token operator">:</span> VNode <span class="token operator">|</span> Element<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNode<span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>  <span class="token keyword">let</span> i<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> elm<span class="token operator">:</span> Node<span class="token punctuation">,</span> parent<span class="token operator">:</span> Node  <span class="token comment">// 保存新插入节点的队列，为了触发钩子函数</span>  <span class="token keyword">const</span> insertedVnodeQueue<span class="token operator">:</span> VNodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// 执行模块的 pre 钩子函数</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 如果 oldVnode 不是 VNode，创建 VNode 并设置 elm </span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 通过 emptyNodeAt 把 DOM 元素转换成空的 VNode</span>    oldVnode <span class="token operator">=</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 如果新旧节点是相同节点(key 和 sel 相同)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 找节点的差异并更新 DOM</span>    <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果新旧节点不同，vnode 创建对应的 DOM</span>    <span class="token comment">// 获取当前的 DOM 元素,!是TypeScript语法标识这个属性一定有值</span>    elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span>    parent <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span> <span class="token keyword">as</span> Node    <span class="token comment">// 触发 init/create 钩子函数,创建 DOM</span>    <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果父节点不为空，把 vnode 对应的 DOM 插入到文档中</span>      api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">// 移除老节点</span>      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">[</span>oldVnode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token comment">// 执行用户设置的 insert 钩子函数</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> insertedVnodeQueue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>    insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>hook<span class="token operator">!</span><span class="token punctuation">.</span>insert<span class="token operator">!</span><span class="token punctuation">(</span>insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 执行模块的 post 钩子函数</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> vnode<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="createElm"><a href="#createElm" class="headerlink" title="createElm"></a>createElm</h4><ul><li><p>功能</p><ul><li><code>createEle(Vnode, insertedVnodeQueue)</code>, 返回创建的DOM元素</li><li>创建<code>vnode</code>对应的<code>DOM</code>元素，把DOM元素存储在<code>vnode</code>的<code>elm</code>属性中，但是并没有挂载在DOM树上</li></ul></li><li><p>执行过程</p><blockquote><p>主要分为三个过程：</p><ul><li>执行用户设置的<code>init</code>钩子函数</li><li>把VNode转换成真实DOM，并存储在vnode的elm属性上，此时并没有挂载到DOM树上</li><li>返回新创建的DOM</li></ul></blockquote><ul><li>首先触发用户设置的<code>init</code>钩子函数</li><li>如果选择器是<code>!</code>，创建注释节点</li><li>如果选择器为空，创建文本节点</li><li>如果选择器不为空<ul><li>解析选择器，设置标签的<code>id</code>和<code>class</code>属性</li><li>执行模块的<code>create</code>钩子函数</li><li>如果<code>vnode</code>有<code>children</code>，创建子<code>vnode</code>对应的<code>DOM</code>，追加到<code>DOM</code>树</li><li>如果<code>vnode</code>的<code>text</code>值是<code>string/number</code>，创建文本节点并追加到<code>DOM</code>树</li><li>执行用户设置的<code>create</code>钩子函数</li><li>如果有用户设置的<code>insert</code>钩子函数，把<code>vnode</code>添加到队列中</li></ul></li></ul></li><li><p>源码位置：src/package/init.ts</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">createElm</span> <span class="token punctuation">(</span>vnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token operator">:</span> VNodeQueue<span class="token punctuation">)</span><span class="token operator">:</span> Node <span class="token punctuation">{</span>  <span class="token keyword">let</span> i<span class="token operator">:</span> <span class="token builtin">any</span>  <span class="token keyword">let</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data    <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 执行用户设置的 init 钩子函数</span>    <span class="token keyword">const</span> init <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token operator">?.</span>init    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">init</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>      data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children  <span class="token keyword">const</span> sel <span class="token operator">=</span> vnode<span class="token punctuation">.</span>sel  <span class="token keyword">if</span> <span class="token punctuation">(</span>sel <span class="token operator">===</span> <span class="token string">'!'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果选择器是!，创建注释节点</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      vnode<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">''</span>    <span class="token punctuation">}</span>    vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">createComment</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sel <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果选择器不为空</span>    <span class="token comment">// 解析选择器</span>    <span class="token comment">// Parse selector</span>    <span class="token keyword">const</span> hashIdx <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> dotIdx <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> hashIdx<span class="token punctuation">)</span>    <span class="token keyword">const</span> hash <span class="token operator">=</span> hashIdx <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> hashIdx <span class="token operator">:</span> sel<span class="token punctuation">.</span>length    <span class="token keyword">const</span> dot <span class="token operator">=</span> dotIdx <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> dotIdx <span class="token operator">:</span> sel<span class="token punctuation">.</span>length    <span class="token keyword">const</span> tag <span class="token operator">=</span> hashIdx <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> dotIdx <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> dot<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> sel    <span class="token keyword">const</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>ns<span class="token punctuation">)</span>      <span class="token operator">?</span> api<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> tag<span class="token punctuation">)</span>  <span class="token comment">// 一般是SVG</span>      <span class="token operator">:</span> api<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span>  <span class="token comment">// 创建DOM元素</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hash <span class="token operator">&lt;</span> dot<span class="token punctuation">)</span> elm<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>hash <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> dot<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dotIdx <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> elm<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>dot <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// 遍历执行模块的 create 钩子函数</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>    <span class="token comment">// 如果 vnode 中有子节点，创建子 vnode 对应的 DOM 元素并追加到 DOM 树上</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">is</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> ch <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          api<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token function">createElm</span><span class="token punctuation">(</span>ch <span class="token keyword">as</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">is</span><span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果 vnode 的 text 值是 string/number，创建文本节点并追加到 DOM 树</span>      api<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> hook <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>hook    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>hook<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 执行用户传入的钩子 create</span>      hook<span class="token punctuation">.</span>create<span class="token operator">?.</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>insert<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 把 vnode 添加到队列中，为后续执行 insert 钩子做准备</span>        insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果选择器为空，创建文本节点</span>    vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 返回新创建的 DOM                                </span>  <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="removeVnodes"><a href="#removeVnodes" class="headerlink" title="removeVnodes"></a>removeVnodes</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">removeVnodes</span> <span class="token punctuation">(</span>parentElm<span class="token operator">:</span> Node<span class="token punctuation">,</span>  vnodes<span class="token operator">:</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  startIdx<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>  endIdx<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>  <span class="token comment">// 参数一：要删除节点的父节点</span>  <span class="token comment">// 参数二：要删除的节点</span>  <span class="token comment">// 参数三：开始索引</span>  <span class="token comment">// 参数四：结束索引</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> startIdx <span class="token operator">&lt;=</span> endIdx<span class="token punctuation">;</span> <span class="token operator">++</span>startIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//</span>    <span class="token keyword">let</span> listeners<span class="token operator">:</span> <span class="token builtin">number</span>    <span class="token keyword">let</span> <span class="token function-variable function">rm</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>    <span class="token keyword">const</span> ch <span class="token operator">=</span> vnodes<span class="token punctuation">[</span>startIdx<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span>sel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 内部触发了vnode的destroy钩子函数</span>        <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>        <span class="token comment">// 防止重复删除DOM元素</span>        listeners <span class="token operator">=</span> cbs<span class="token punctuation">.</span>remove<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span>        <span class="token comment">// createRmCb高阶函数，内部返回真正删除dom元素的函数</span>        rm <span class="token operator">=</span> <span class="token function">createRmCb</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">,</span> listeners<span class="token punctuation">)</span>        <span class="token comment">// remove钩子函数内部会真正调用rm（删除DOM元素）</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>remove<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>remove<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> rm<span class="token punctuation">)</span>        <span class="token comment">// 用户是否传入remove钩子函数</span>        <span class="token keyword">const</span> removeHook <span class="token operator">=</span> ch<span class="token operator">?.</span>data<span class="token operator">?.</span>hook<span class="token operator">?.</span>remove        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>removeHook<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">removeHook</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> rm<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token function">rm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// Text node</span>        api<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> ch<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>invokeDestroyHook</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">invokeDestroyHook</span> <span class="token punctuation">(</span>vnode<span class="token operator">:</span> VNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data  <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    data<span class="token operator">?.</span>hook<span class="token operator">?.</span>destroy<span class="token operator">?.</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>destroy<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>destroy<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>children <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> child <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">[</span>j<span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> child <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>createRmCb</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">createRmCb</span> <span class="token punctuation">(</span>childElm<span class="token operator">:</span> Node<span class="token punctuation">,</span> listeners<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">rmCb</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>listeners <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> parent <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>childElm<span class="token punctuation">)</span> <span class="token keyword">as</span> Node      api<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> childElm<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="addVnodes"><a href="#addVnodes" class="headerlink" title="addVnodes"></a>addVnodes</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">addVnodes</span> <span class="token punctuation">(</span>  parentElm<span class="token operator">:</span> Node<span class="token punctuation">,</span>  <span class="token comment">// 父元素</span>  before<span class="token operator">:</span> Node <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token comment">// 参考节点，vnode定义的节点插入到before之前</span>  vnodes<span class="token operator">:</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 添加的节点</span>  startIdx<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>  <span class="token comment">// 开始索引</span>  endIdx<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>  <span class="token comment">// 结束索引</span>  insertedVnodeQueue<span class="token operator">:</span> VNodeQueue  <span class="token comment">// 存储刚刚插入的具有insert钩子函数的vnode节点</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> startIdx <span class="token operator">&lt;=</span> endIdx<span class="token punctuation">;</span> <span class="token operator">++</span>startIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> ch <span class="token operator">=</span> vnodes<span class="token punctuation">[</span>startIdx<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> <span class="token function">createElm</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">,</span> before<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="patchVnode"><a href="#patchVnode" class="headerlink" title="patchVnode"></a>patchVnode</h4><ul><li>功能<ul><li><code>patchVnode(oldVnode, vnode, insertedVnodeQueue)</code></li><li>对比<code>oldVnode</code>和<code>vnode</code>的差异，把差异渲染到DOM</li></ul></li><li><strong>执行过程</strong><ul><li>首先执行<strong>用户</strong>设置的<code>prepatch</code>钩子函数</li><li>执行<code>create</code>钩子函数<ul><li>首先执行<strong>模块</strong>的<code>create</code>钩子函数</li><li>然后执行<strong>用户</strong>设置的<code>create</code>钩子函数</li></ul></li><li>如果<strong>vnode.text</strong>未定义<ul><li>如果<code>oldVnode.children</code>和<code>vnode.children</code>都有值<ul><li>调用<code>updateChildren()</code></li><li>使用diff算法对比子节点，更新子节点</li></ul></li><li>如果<code>vnode.children</code>有值，<code>oldVnode.children</code>无值<ul><li>清空DOM元素</li><li>调用<code>addVnodes()</code>，批量添加子节点</li></ul></li><li>如果<code>oldVnode.children</code>有值，<code>vnode.children</code>无值<ul><li>调用<code>removeVnode()</code>，批量移除子节点</li></ul></li><li>如果<code>oldVnode.text</code>有值<ul><li>清空DOM元素的内容</li></ul></li></ul></li><li>如果设置了<code>vnode.text</code>并且和<code>oldVnode.text</code>不等<ul><li>如果老节点有子节点，全部移除</li><li>设置DOM元素的<code>textContent</code>为<code>vnode.text</code></li></ul></li><li>最后执行用户设置的<code>postpatch</code>钩子函数</li></ul></li></ul><p><img src="http://5coder.cn/img/aSVb3ZNoyTWgeck.png"></p><p>源码位置：src/package/init.ts</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">patchVnode</span> <span class="token punctuation">(</span>oldVnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token operator">:</span> VNodeQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> hook <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token operator">?.</span>hook    <span class="token comment">// 首先执行用户设置的 prepatch 钩子函数</span>    hook<span class="token operator">?.</span>prepatch<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>    <span class="token keyword">const</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span>    <span class="token keyword">const</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">const</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// 如果新老 vnode 相同返回</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token keyword">return</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>data <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 执行模块的 update 钩子函数</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>      <span class="token comment">// 执行用户设置的 update 钩子函数</span>      vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token operator">?.</span>update<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token comment">// 如果 vnode.text 未定义</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果新老节点都有 children</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 调用 updateChildren 对比子节点，更新子节点</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 如果新节点有 children，老节点没有 children</span>      <span class="token comment">// 如果老节点有text，清空dom 元素的内容</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        <span class="token comment">// 批量添加子节点</span>        <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 如果老节点有children，新节点没有children</span>      <span class="token comment">// 批量移除子节点</span>        <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 如果老节点有 text，清空 DOM 元素</span>        api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果没有设置 vnode.text</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 如果老节点有 children，移除</span>        <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token comment">// 设置 DOM 元素的 textContent 为 vnode.text</span>      api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 最后执行用户设置的 postpatch 钩子函数</span>    hook<span class="token operator">?.</span>postpatch<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="updateChildren"><a href="#updateChildren" class="headerlink" title="updateChildren"></a>updateChildren</h4><ul><li><p><strong>功能</strong></p><ul><li>diff算法的核心，对比新旧节点的children，更新DOM</li></ul></li><li><p><strong>执行过程：</strong></p><ul><li><p>要对比两棵树的差异，我们可以取第一棵树的没一个节点一次和第二棵树的每一个节点比较，但是这样的时间复杂度为O(n^3)</p></li><li><p>在DOM操作的时候我们很少很少会把一个<strong>父节点移动/更新到某一个子节点</strong></p></li><li><p>因此只需要找<strong>同级别</strong>的<strong>子节点</strong>一次比较，然后<strong>再找下一级别的节点比较</strong>，这样算法的时间复杂度为O(n)</p><p><img src="http://5coder.cn/img/HOKszpbk76tA9yZ.png"></p></li><li><p>在进行同级别节点比较的时候，首先会对新老节点数组的<strong>开始和结尾</strong>节点设置<strong>标记索引</strong>，遍历的过程中移动索引</p></li><li><p>在对<strong>开始和结束节点</strong>比较的时候，总共会有四种情况：</p><ul><li><p><code>oldStartVnode</code> / <code>newStartVnode</code>（旧开始节点 / 新开始节点）</p></li><li><p><code>oldEndVnode</code> / <code>newEndVnode</code>（旧结束节点 / 新结束节点）</p></li><li><p><code>oldStartVnode</code> / <code>newEndVnode</code>（旧开始节点 / 新结束节点）</p></li><li><p><code>oldEndVnode</code> / <code>newStartVnode</code>（旧结束节点 / 新开始节点）</p><p><img src="http://5coder.cn/img/ZjSoAHM1vYNJCm5.png"></p></li></ul></li><li><p>开始节点和结束节点比较，这两种情况类似</p><ul><li><code>oldStartVnode</code> / <code>newStartVnode</code>（旧开始节点 / 新开始节点）</li><li><code>oldEndVnode</code> / <code>newEndVnode</code>（旧结束节点 / 新结束节点）</li></ul></li><li><p>如果<code>oldStartVnode</code>和<code>newStartVnode</code>是<code>sameVnode</code>（key和sel相同）</p><ul><li><p>调用<code>patchVnode</code>对比和更新节点</p></li><li><p>把旧开始和新开始索引往后移动<code>oldStartIdx++</code> / <code>oldEndIdx++</code></p><p><img src="http://5coder.cn/img/njXLUz5tsFNWvql.png"></p></li></ul></li><li><p><code>oldStartVnode</code> / <code>newEndVnode</code>（旧开始节点 / 新结束节点）相同</p><ul><li><p>调用<code>patchVnode()</code>对比和更新节点</p></li><li><p>把<code>oldStartVnode</code>对应的DOM元素，移动到右边</p></li><li><p>更新索引</p><p><img src="http://5coder.cn/img/image-20200103125428541.png"></p></li></ul></li><li><p><code>oldEndVnode</code> / <code>newStartVnode</code>（旧结束节点 / 新开始节点）相同</p><ul><li><p>调用<code>patchVnode()</code>对比和更新节点</p></li><li><p>把<code>oldEndVnode</code>对应的DOM元素，移动到左边</p></li><li><p>更新索引</p><p><img src="http://5coder.cn/img/image-20200103125735048.png"></p></li></ul></li><li><p>如果不是以上四种情况</p><ul><li><p>遍历新节点，使用<code>newStartNode</code>的<code>key</code>在老节点数组中找相同节点</p></li><li><p>如果没有找到，说明<code>newStartNode</code>是新节点</p><ul><li>创建新节点对应的DOM元素，插入到DOM树中</li></ul></li><li><p>如果找到了</p><ul><li><p>判断新节点和找到的老节点的sel选择器是否相同</p><ul><li>如果不同，说明节点被修改了<ul><li>重新创建对应的DOM元素，插入到DOM树中</li></ul></li><li>如果相同，把<code>elmToMove</code>对应的DOM元素，移动到左边</li></ul><p><img src="http://5coder.cn/img/image-20200109184822439.png"></p></li></ul></li></ul></li><li><p>循环结束</p><ul><li>当老节点的所有子节点先遍历完（<code>oldStartIdx &gt; oldEndIdx</code>），循环结束</li><li>新节点的所有子节点先遍历完（<code>newStartIdx &lt; newEndIdx</code>），循环结束</li></ul></li><li><p>如果老节点的数组先遍历完（<code>oldStartIdx &gt; oldEndIdx</code>），说明新节点有剩余，把剩余节点批量插入到右边</p><p><img src="http://5coder.cn/img/image-20200103150918335.png"></p></li><li><p>如果新节点的数组先遍历完（<code>newStartIdx &gt; newEndIdx</code>），说明老节点有剩余，把剩余节点批量删除</p><p><img src="http://5coder.cn/img/image-20200109194751093.png"></p></li></ul></li><li><p>源码位置：src/package/init.ts</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">updateChildren</span> <span class="token punctuation">(</span>parentElm<span class="token operator">:</span> Node<span class="token punctuation">,</span>  oldCh<span class="token operator">:</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  newCh<span class="token operator">:</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  insertedVnodeQueue<span class="token operator">:</span> VNodeQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> oldStartIdx <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> newStartIdx <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> oldEndIdx <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>  <span class="token keyword">let</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token keyword">let</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIdx<span class="token punctuation">]</span>  <span class="token keyword">let</span> newEndIdx <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>  <span class="token keyword">let</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token keyword">let</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx<span class="token punctuation">]</span>  <span class="token keyword">let</span> oldKeyToIdx<span class="token operator">:</span> KeyToIndexMap <span class="token operator">|</span> <span class="token keyword">undefined</span>  <span class="token keyword">let</span> idxInOld<span class="token operator">:</span> <span class="token builtin">number</span>  <span class="token keyword">let</span> elmToMove<span class="token operator">:</span> VNode  <span class="token keyword">let</span> before<span class="token operator">:</span> <span class="token builtin">any</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 索引变化后，可能会把节点设置为空</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 节点为空移动索引</span>      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span> <span class="token comment">// Vnode might have been moved left</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldEndVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newEndVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span>    <span class="token comment">// 比较开始和结束节点的四种情况</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 1. 比较老开始节点和新的开始节点</span>      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span>      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 2. 比较老结束节点和新的结束节点</span>      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Vnode moved right</span>      <span class="token comment">// 3. 比较老开始节点和新的结束节点</span>      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>      api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span>      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Vnode moved left</span>      <span class="token comment">// 4. 比较老结束节点和新的开始节点</span>      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>      api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldEndVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">)</span>      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token comment">// 开始节点和结束节点都不相同</span>      <span class="token comment">// 使用 newStartNode 的 key 再老节点数组中找相同节点</span>      <span class="token comment">// 先设置记录 key 和 index 的对象</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldKeyToIdx <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        oldKeyToIdx <span class="token operator">=</span> <span class="token function">createKeyToOldIdx</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token comment">// 遍历 newStartVnode, 从老的节点中找相同 key 的 oldVnode 的索引</span>      idxInOld <span class="token operator">=</span> oldKeyToIdx<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">]</span>      <span class="token comment">// 如果是新的vnode</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>idxInOld<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// New element</span>        <span class="token comment">// 如果没找到，newStartNode 是新节点</span>        <span class="token comment">// 创建元素插入 DOM 树</span>        api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> <span class="token function">createElm</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment">// 如果找到相同 key 相同的老节点，记录到 elmToMove 遍历</span>        elmToMove <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>elmToMove<span class="token punctuation">.</span>sel <span class="token operator">!==</span> newStartVnode<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">// 如果新旧节点的选择器不同</span>          <span class="token comment">// 创建新开始节点对应的 DOM 元素，插入到 DOM 树中</span>          api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> <span class="token function">createElm</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token comment">// 如果相同，patchVnode()</span>          <span class="token comment">// 把 elmToMove 对应的 DOM 元素，移动到左边</span>          <span class="token function">patchVnode</span><span class="token punctuation">(</span>elmToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>          oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span> <span class="token keyword">as</span> <span class="token builtin">any</span>          api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> elmToMove<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      <span class="token comment">// 重新给 newStartVnode 赋值，指向下一个新节点</span>      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// 循环结束，老节点数组先遍历完成或者新节点数组先遍历完成</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">||</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&gt;</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果老节点数组先遍历完成，说明有新的节点剩余</span>      <span class="token comment">// 把剩余的新节点都插入到右边</span>      before <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>elm      <span class="token function">addVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> before<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果新节点数组先遍历完成，说明老节点有剩余</span>      <span class="token comment">// 批量删除老节点</span>      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="调试updateChildren"><a href="#调试updateChildren" class="headerlink" title="调试updateChildren"></a>调试updateChildren</h4><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>微博<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>视频<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>视频<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>微博<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> Vue响应式原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>模拟Vue.js响应式原理</title>
      <link href="2021/052627165.html"/>
      <url>2021/052627165.html</url>
      
        <content type="html"><![CDATA[<h1 id="模拟-Vue-js-响应式原理"><a href="#模拟-Vue-js-响应式原理" class="headerlink" title="模拟 Vue.js 响应式原理"></a>模拟 Vue.js 响应式原理</h1><blockquote><p>摘要：</p><p>接下来学习Vue响应式的原理，其中会模拟实现一个最简单的Vue。下面先来看一段代码，这段代码是Vue最基础的结构，我们要做的事情就是自己实现一个实现相同的效果。模拟的原因是我们都知道在面试的时候，Vue响应式原理是一个必问的问题，通过模拟显示Vue响应式的原理，可以更好的回答这些问题。另外在模拟显示原理的过程中，就是借鉴Vue的源码模拟一个最小版本的Vue，这个过程中可以学习别人优秀的经验，并且把它转化成自己的经验，在实际项目中遇到问题也可以通过原理层面来解决。</p><p><img src="http://5coder.cn/img/gkYTl1K65hJvWoQ.png"></p><p>课程目标：</p><ul><li>模拟一个最小版本的Vue</li><li>响应式原理在面试的常见问题</li><li>学习别人优秀的经验，转换成自己的经验</li><li>实际项目中出问题的原理层面的解决<ul><li>给Vue实例新增一个成员是否是响应式的？</li><li>给属性重新赋值成对象，是否是响应式的？</li></ul></li><li>为学习Vue源码做铺垫</li></ul></blockquote><h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1.准备工作"></a>1.准备工作</h2><ul><li>数据驱动</li><li>响应式的核心原理</li><li>发布订阅模式和观察者模式</li></ul><h3 id="1-1数据驱动"><a href="#1-1数据驱动" class="headerlink" title="1.1数据驱动"></a>1.1数据驱动</h3><blockquote><p>数据响应式、双向绑定、数据驱动</p></blockquote><ul><li>数据响应式<ul><li>数据模型仅仅是普通的JavaScript对象，而当修改数据时，视图会进行更新，避免了繁琐的DOM操作，提高开发效率（jQuery的核心是进行DOM操作）</li></ul></li><li>双向绑定<ul><li>数据改变，视图改变；视图改变，数据也随之改变</li><li>可以用v-model在表单元素上创建双向数据绑定</li></ul></li><li>数据驱动是Vue最独特的特性之一<ul><li>开发过程中仅需要关注数据本身，不需要关心数据是如何渲染到视图</li></ul></li></ul><h3 id="1-2数据响应式的核心原理"><a href="#1-2数据响应式的核心原理" class="headerlink" title="1.2数据响应式的核心原理"></a>1.2数据响应式的核心原理</h3><h4 id="数据响应式核心原理-Vue2"><a href="#数据响应式核心原理-Vue2" class="headerlink" title="数据响应式核心原理-Vue2"></a>数据响应式核心原理-Vue2</h4><ul><li><p><a href="https://cn.vuejs.org/v2/guide/reactivity.html">Vue2.x数据响应式核心原理</a></p><p>当你把一个普通的 JavaScript 对象传入 Vue 实例作为 <code>data</code> 选项，Vue 将遍历此对象所有的 property，并使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty"><code>Object.defineProperty</code></a> 把这些 property 全部转为 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Working_with_Objects#%E5%AE%9A%E4%B9%89_getters_%E4%B8%8E_setters">getter/setter</a>。<code>Object.defineProperty</code> 是 ES5 中一个无法 shim 的特性，这也就是 Vue 不支持 IE8 以及更低版本浏览器的原因。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">MDN-Object.defineProperty</a></p></li><li><p>浏览器兼容IE8以上（不兼容IE8）</p></li></ul><p>1.defineProperty单个成员</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token comment">// 模拟Vue中的data选项</span>  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>    msg<span class="token operator">:</span> <span class="token string">'hello'</span>  <span class="token punctuation">}</span>  <span class="token comment">// 模拟Vue实例</span>  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// 数据劫持： 当访问或者设置vm中的成员的时候，做一些干预操作</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token comment">// 可枚举（可遍历）</span>    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token comment">// 可配置（可以使用delete删除，可以通过defineProperty重新定义）</span>    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token comment">// 当获取值的时候执行</span>    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get: '</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span>      <span class="token keyword">return</span> data<span class="token punctuation">.</span>msg    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// 当设置值的时候执行</span>    <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set: '</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span>      <span class="token punctuation">}</span>      data<span class="token punctuation">.</span>msg <span class="token operator">=</span> newValue      <span class="token comment">// 数据更改，更新DOM的值</span>      document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>msg    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 测试</span>  vm<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'Hello World'</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>msg<span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.defineProperty多个成员</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token comment">// 模拟 Vue 中的 data 选项</span>    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>        msg<span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>        count<span class="token operator">:</span> <span class="token number">10</span>    <span class="token punctuation">}</span>    <span class="token comment">// 模拟 Vue 的实例</span>    <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token function">proxyData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">function</span> <span class="token function">proxyData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 遍历data对象的所有属性</span>        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// 把data中的属性，转换成vm的setter/getter</span>            Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>                enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get: '</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set: '</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">return</span>                    <span class="token punctuation">}</span>                    data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newValue                    <span class="token comment">// 数据改变，更新DOM的值</span>                    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 测试</span>    vm<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'Hello World'</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>msg<span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Vue2.x中响应式的核心原理是基于defineProperty实现的</strong></p><h4 id="数据响应式核心原理-Vue3"><a href="#数据响应式核心原理-Vue3" class="headerlink" title="数据响应式核心原理-Vue3"></a>数据响应式核心原理-Vue3</h4><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">MDN - Proxy</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/get">MDN-Proxy-get</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set">MDN-Proxy-set</a></li><li>直接监听对象，而非属性</li><li>ES 6中新增，IE 不支持，性能由浏览器优化</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token comment">// 模拟Vue中的data选项</span>    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>        msg<span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>        count<span class="token operator">:</span> <span class="token number">0</span>    <span class="token punctuation">}</span>    <span class="token comment">// 模拟 Vue 实例</span>    <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token comment">// 执行代理行为的函数</span>        <span class="token comment">// 当访问 vm 的成员会执行。target参数：目标对象；key参数：被获取的属性名</span>        <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get, key: '</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment">// 当设置 vm 的成员会执行</span>        <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set, key: '</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span>            <span class="token punctuation">}</span>            target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newValue            document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// 测试</span>    vm<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'Hello World'</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>msg<span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Vue3.0的响应式核心原理是基于Proxy实现的。</strong></p><h3 id="1-3发布订阅模式和观察者模式"><a href="#1-3发布订阅模式和观察者模式" class="headerlink" title="1.3发布订阅模式和观察者模式"></a>1.3发布订阅模式和观察者模式</h3><h4 id="发布订阅模式"><a href="#发布订阅模式" class="headerlink" title="发布订阅模式"></a>发布订阅模式</h4><blockquote><p>案例：</p><p>场景：小学三年级二班</p><p>人物：班主任、学生家长</p><p>每次考试后，学生家长订阅学生开始成绩，班主任发布成绩，班级作为数据中心。这时候，家长为订阅者，班主任为发布者。</p><p>我们假定，存在一个”信号中心”，某个任务执行完成，就向信号中心”发布”（publish）一个信号，其他任务可以向信号中心”订阅”（subscribe）这个信号，从而知道什么时候自己可以开始执行。这就叫做**”发布/订阅模式”（publish-subscribe pattern）**</p></blockquote><p><a href="https://cn.vuejs.org/v2/guide/migration.html#dispatch-%E5%92%8C-broadcast-%E6%9B%BF%E6%8D%A2">Vue中的自定义事件</a></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Vue 自定义事件</span><span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// vm内部存在一个属性，该属性记录每次注册事件的数据，键为时间类型，值为每个时间类型记录的处理函数，多个处理函数为Array形式，</span><span class="token comment">// { 'click': [fn1, fn2], 'change': [fn] }</span><span class="token comment">// 注册事件(订阅消息)</span>vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'dataChange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dataChange'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'dataChange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dataChange1'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 触发事件(发布消息)</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'dataChange'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Vue兄弟组件通信过程</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// eventBus.js</span><span class="token comment">// 事件中心</span><span class="token keyword">let</span> eventHub <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// ComponentA.vue</span><span class="token comment">// 发布者</span><span class="token function-variable function">addTodo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 发布消息(事件)</span>    eventHub<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'add-todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>text<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newTodoText<span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>newTodoText <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token comment">// ComponentB.vue</span><span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 订阅消息(事件)</span>    eventHub<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'add-todo'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addTodo<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>模拟Vue自定义事件的实现</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 事件触发器</span><span class="token keyword">class</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// { 'click': [fn1, fn2], 'change': [fn] }</span>    <span class="token comment">// 用来存储发布事件的数据，数据类型如上所示</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 注册事件</span>  <span class="token function">$on</span> <span class="token punctuation">(</span><span class="token parameter">eventType<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// 判断当前的事件类型中是否存在事件对应的处理函数Array</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 触发事件</span>  <span class="token function">$emit</span> <span class="token punctuation">(</span><span class="token parameter">eventType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 判断事件类型中是否存在事件对应的处理函数Array</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">handler</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 测试</span><span class="token keyword">let</span> em <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>em<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click1'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>em<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click2'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>em<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/Hv9K5PRl6NQO2mI.png"></p><h4 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h4><ul><li>观察者(订阅者)–Watcher<ul><li>update()：当事件发生时，具体要做的事情</li></ul></li><li>目标(发布者)–Dep<ul><li>subs数组：存储所有的观察者</li><li>addSubs()：添加观察者</li><li>notify()：当事件发生，调用所有观察者的update()方法</li></ul></li><li>没有事件中心</li></ul><p>代码实现：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 发布者</span><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>  <span class="token comment">// 存储所有观察者</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span>  <span class="token comment">// 添加所有的观察者</span>  <span class="token function">addSub</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sub <span class="token operator">&amp;&amp;</span> sub<span class="token punctuation">.</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// 通知所有观察者</span>  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">sub</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 观察者(订阅者)</span><span class="token keyword">class</span> <span class="token class-name">Watcher</span><span class="token punctuation">{</span>  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'观察者update被调用'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 测试</span><span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">let</span> watcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/3hWS41TbeR6Oz5x.png"></p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul><li>观察者模式是由具体目标调度，比如当事件触发，Dep就会调用观察者的方法，所以观察者模式的订阅者与发布者之前是存在依赖的。例如Vue中的生命周期函数update方法。</li><li>发布/订阅模式由统一调度中心调用，因此发布者和订阅者不需要知道对方的存在。例如Vue中的兄弟组件通信。</li></ul><blockquote><p>现实案例：</p><p>观察者模式：发布者-老师，观察者-家长，事件-学生成绩不合格。老师技能是每当某个学生成绩不合格，老师会通知家长，家长执行update方法（打孩子，家长必须存在一个update方法），前提是家长需要和老师提前沟通，老师将需要的家长添加到通知列表。</p><p>发布/订阅模式：发布者-老师，订阅者-家长，事件中心-班级。每当考试完毕，老师会推送每个学生成绩至对应家长，有兴趣的家长自己调用老师的发布技能，获取学生成绩。</p></blockquote><p><img src="http://5coder.cn/img/UqTQB6cAK2GC3Ro.png"></p><h2 id="2-响应式原理模拟"><a href="#2-响应式原理模拟" class="headerlink" title="2.响应式原理模拟"></a>2.响应式原理模拟</h2><h3 id="2-1-整体分析"><a href="#2-1-整体分析" class="headerlink" title="2.1.整体分析"></a>2.1.整体分析</h3><p>Vue基本结构</p><p><img src="http://5coder.cn/img/WEDe4Jft6cV89zZ.png"></p><p>打开浏览器，打印Vue实例vm。</p><p><img src="http://5coder.cn/img/SwtJ2sjnTY3dNz4.png"></p><p>最小版本的Vue中要模拟vm中的$data、$el、$options，还要把data中的成员注入到Vue实例中。</p><p>最小版本Vue由下面的类型组成。</p><p><img src="http://5coder.cn/img/3KCXRfpqz7H1OTv.png"></p><ul><li>Vue<ul><li>把data中的成员注入到Vue实例，并且把data中的成员转成getter/setter，Vue内部会调用Observer和Compiler</li></ul></li><li>Observer<ul><li>能够对数据对象的所有属性进行监听，如有变动可拿到最新值并通知Dep(发布者)</li></ul></li><li>Compiler<ul><li>解析每个元素中的指令/插值表达式，并替换成相应的数据</li></ul></li><li>Dep<ul><li>添加观察者(watcher)，当数据变化通知所有观察者</li></ul></li><li>Watcher<ul><li>数据变化更新视图</li></ul></li></ul><h3 id="2-2-Vue"><a href="#2-2-Vue" class="headerlink" title="2.2.Vue"></a>2.2.Vue</h3><p>首先实现第一个部分-Vue。</p><ul><li><p>功能</p><ul><li>负责接收初始化的参数(选项)</li><li>负责把data中的属性注入到Vue实例，转换成getter/setter</li><li>负责调用observer监听data中所有属性的变化</li><li>负责调用compiler解析指令/插值表达式</li></ul></li><li><p>结构</p><p><img src="http://5coder.cn/img/NYb5DAh92ZdHQWq.png"></p></li><li><p>实现代码</p><p>miniVue结构</p><p><img src="http://5coder.cn/img/hjcJ1WilUo5Ran6.png"></p><p><code>index.html</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Mini Vue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>差值表达式<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>{{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>v-text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>v-model<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>count<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/dep.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/watcher.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/compiler.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/observer.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>        data<span class="token operator">:</span> <span class="token punctuation">{</span>            msg<span class="token operator">:</span> <span class="token string">'Hello Vue'</span><span class="token punctuation">,</span>            count<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>            person<span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'zs'</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>vue.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 1.通过属性保存选项</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$data <span class="token operator">=</span> options<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$el <span class="token operator">=</span> <span class="token keyword">typeof</span> options<span class="token punctuation">.</span>el <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">?</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token operator">:</span> options<span class="token punctuation">.</span>el    <span class="token comment">// 2.把data中的成员转换成setter和getter,注入到vue实例中</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_proxyData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span>    <span class="token comment">// 下面两件事需要依赖observer和compiler，后面再实现</span>    <span class="token comment">// 3.调用observer对象，监听数据的变化</span>    <span class="token comment">// 4.调用compiler对象，解析指令和插值表达式</span>  <span class="token punctuation">}</span>  <span class="token function">_proxyData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 让vue代理data中的属性</span>    <span class="token comment">// 遍历data中的所有属性</span>    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token comment">// 把data的属性注入到vue实例中</span>      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>        enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span>          <span class="token punctuation">}</span>          data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newValue        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试，打开index.html，打开控制台，打印vm实例，如下图，预期的$el、$data、$options都已经注入到vue实例中了。</p><p><img src="http://5coder.cn/img/wdUEylYAkFm4jiD.png"></p></li></ul><h3 id="2-3-Observer"><a href="#2-3-Observer" class="headerlink" title="2.3.Observer"></a>2.3.Observer</h3><p>接下来实现第二部分，Observer</p><p>功能：</p><ul><li>负责把data选项中的属性转换成响应式数据</li><li>data中的某个属性也是对象，把该属性转换成响应式数据</li><li>数据变化发送通知</li></ul><p>结构</p><p><img src="http://5coder.cn/img/7yM3LboGNw9SnWp.png"></p><p><code>walk</code>方法的作用是遍历<code>data</code>中的所有属性，所以它的参数是data对象。defineReactive（定义响应式数据），通过调用<code>Object.definePropoty()</code>把属性转换成getter和setter，<code>walk</code>方法在循环过程会调用<code>defineReactive()</code>方法。</p><p>代码实现：</p><p>Observer.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">walk</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 核心作用是遍历data对象中的所有属性</span>    <span class="token comment">// 1.判断data是否是对象</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span>    <span class="token punctuation">}</span>    <span class="token comment">// 2.遍历data对象所有属性</span>    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token comment">// 此处使用箭头函数，箭头函数不会改变this的执行，所以此处this依然指的是Observer对象</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 参数obj对象,其实就是data对象；key是obj的属性；val是obj对象对应key的值</span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>      enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> val      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span>        <span class="token punctuation">}</span>        val <span class="token operator">=</span> newValue        <span class="token comment">// TODO 最后实现，发送通知</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试：</p><p>因为在Vue.js中第三步中需要创建Observer对象，所以添加以下代码：</p><p><img src="http://5coder.cn/img/MUfGaRr5QluWYnC.png"></p><p>因为在index.html中引入的vue.js需要依赖observer.js，所以先引入observer.js，打开浏览器，打开控制台，打印vm对象。Observer对象核心的功能是把data中的属性转换成getter和setter，如下图实现：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/observer.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/EBcl4FXakydrMue.png"></p><h4 id="Observer-defineReactive-1"><a href="#Observer-defineReactive-1" class="headerlink" title="Observer-defineReactive 1"></a>Observer-defineReactive 1</h4><p>接下来解释一下为什么defineReactive需要传递第三个参数val，为了演示问题，需要触发get方法。所以在index.html中访问msg属性，<code>console.log(vm.msg)</code>，当访问<code>vm.msg</code>时，首先会触发vue.js中的_proxyData中get方法，而vue.js中的get方法又调用了<code>data[key]</code>，当访问<code>data[key]</code>时，又会触发observer.js中<code>defineReactive</code>中的get方法。</p><p><img src="http://5coder.cn/img/PgsKkopbcXZBNm6.png"></p><blockquote><p>上图中的vue.js第29行键入错误，改为<code>data[key] = newValue</code>。</p></blockquote><p>打开浏览器，控制台正常打印出来了<code>'Hello Vue'</code>。当将observer中的get方法中返回的<code>val</code>改变为<code>obj[key]</code>。时，查看浏览器控制台出现报错——<strong>堆栈溢出</strong>。</p><p><img src="http://5coder.cn/img/VSnf2aMutcoQlh3.png"></p><p>此时在observer.js中的19行出现错误，内容是<code>return obj[key]</code>，此处的obj就是data对象，当访问data[key]时就会触发此处的get方法。这就形成<strong>死递归</strong>，这就是传递<code>val</code>参数而不是直接使用<code>obj[key]</code>的原因。</p><p>此处还有一个细节，当<code>defineReactive</code>方法调用完成之后，val参数是一个局部变量，所以他的值应该被释放掉，但是在index.html中依然可以打印出来，原因就此处形成了闭包，提升了<code>val</code>的作用域。defineReactive第一个参数obj其实就是$data对象，$data中引用了get方法，而get方法又对val有引用，也就是外部对get方法有引用，而get方法又用到了val，所以此处发生了闭包，所以val的值并没有被释放掉。</p><p><img src="http://5coder.cn/img/G591WQvneaxoZyI.png"></p><h4 id="Observer-defineReactive-2"><a href="#Observer-defineReactive-2" class="headerlink" title="Observer-defineReactive 2"></a>Observer-defineReactive 2</h4><p>defineReactive中的两个问题，</p><ol><li><p><strong>如果data中的某个属性是对象，需要把对象内部的属性转换成响应式数据</strong></p><ul><li><p>处理前</p><p><img src="http://5coder.cn/img/U2oFrSq8wCsH1lO.png"></p><p>在浏览器控制台打印vm实例，发现person对象的name属性并没有getter和setter方法，也就是并未被转换成响应式，只对<strong>person对象</strong>进行响应式处理，并未对<strong>person内部属性</strong>做任何处理。</p></li><li><p>处理后</p><p><img src="http://5coder.cn/img/G7NRC4B3ngskWZ5.png"></p><p>浏览器测试，发现person对象的name属性也具有getter和setter，第一个问题解决。</p><p><img src="http://5coder.cn/img/wlLZJDkihvgH3te.png"></p></li></ul></li><li><p><strong>当data的当前属性重新赋值成一个新对象的时候，该对象的内部属性需要转换成响应式数据</strong></p><ul><li><p>处理前</p><p>将data中的msg属性的值由字符串改为对象<code>vm.msg = { test: 'Hello' }</code>，观察更改后的对象的属性test属性并没有getter和setter方法，同样$data中的msg对象的属性test也没有getter和setter。</p><p><img src="http://5coder.cn/img/pcgEkSm7WLQNOwJ.png"></p></li><li><p>处理后</p><p><img src="http://5coder.cn/img/qbjvRndk9asSt4Y.png"></p><p>浏览器测试，发现新修改的msg的值中的test属性也具有getter和setter，为响应式的。</p><p><img src="http://5coder.cn/img/YtFyesvKrgHLGPA.png"></p></li></ul></li></ol><h3 id="2-4-Compiler"><a href="#2-4-Compiler" class="headerlink" title="2.4.Compiler"></a>2.4.Compiler</h3><p>功能</p><blockquote><p>与Vue内部不同，做了简化，并没有使用虚拟DOM，只是做了DOM操作。</p></blockquote><ul><li>负责编译模板，解析指令/插值表达式</li><li>负责页面的首次渲染</li><li>当数据变化后重新渲染视图</li></ul><p>结构</p><p><img src="http://5coder.cn/img/S6dLN3w7rbEehjc.png"></p><p>基本结构实现：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm  <span class="token punctuation">}</span>  <span class="token comment">// 编译模板，处理文本节点和元素节点</span>  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>  <span class="token comment">// 编译元素节点，处理指令</span>  <span class="token function">compileElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>  <span class="token comment">// 编译文本节点，处理插值表达式</span>  <span class="token function">compileText</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断元素属性的名字是否为指令</span>  <span class="token function">isDirective</span><span class="token punctuation">(</span><span class="token parameter">attrName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> attrName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'v-'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断传入的节点是否为文本节点</span>  <span class="token function">isTextNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">3</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断传入的节点是否为元素节点</span>  <span class="token function">isElementNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>node.nodeType用法，请参考<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType">MDN（Node.nodeType）</a></p></blockquote><h4 id="Compiler-compile"><a href="#Compiler-compile" class="headerlink" title="Compiler-compile"></a>Compiler-compile</h4><p>接下来实现compile方法</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 编译模板，处理文本节点和元素节点</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> childNodes <span class="token operator">=</span> el<span class="token punctuation">.</span>childNodes  Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isTextNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 处理文本节点</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compileText</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isElementNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 处理元素节点</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compileElement</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 以上处理只是el中的第一层子节点，当node节点中还有其他节点时,</span>    <span class="token comment">// 判断node节点，是否有子节点，如果有子节点，要递归调用compile</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Compiler-compileText"><a href="#Compiler-compileText" class="headerlink" title="Compiler-compileText"></a>Compiler-compileText</h4><p>首先在compileText中打印出node节点的内容</p><p><img src="http://5coder.cn/img/1DkHvEN4wjUtByc.png"></p><p>打开浏览器，打印结果如下图：</p><p><img src="http://5coder.cn/img/KQyOBhqp14eArdk.png"></p><p>接下来开始写compileText的内容。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 编译文本节点，处理插值表达式</span><span class="token function">compileText</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// console.dir(node)</span>  <span class="token comment">// 使用正则表达式匹配花括号中的内容</span>  <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\{\{(.+?)\}\}</span><span class="token regex-delimiter">/</span></span>  <span class="token comment">// 获取文本节点的内容</span>  <span class="token keyword">let</span> value <span class="token operator">=</span> node<span class="token punctuation">.</span>textContent  <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 获取正则表达式匹配的第一个分组内容(.+?)，即花括号中的内容并去除左右空格</span>    <span class="token keyword">let</span> key <span class="token operator">=</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// 将正则表达式中匹配到的插值表达式替换成该属性对应的值,重新赋值给文本节点</span>    node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打开浏览器测试，发现index.html中的插值表达式已经被替换成正确的值了</p><p><img src="http://5coder.cn/img/JQ9g4wIbsvy6NGC.png"></p><h4 id="Compiler-compileElement"><a href="#Compiler-compileElement" class="headerlink" title="Compiler-compileElement"></a>Compiler-compileElement</h4><p>最后实现compileElement，他的作用是编译元素节点，处理指令，此处只模拟<code>v-text</code>与<code>v-model</code>。</p><p>首先遍历dom元素所有属性，找到v-开头的属性名，也就是指令，以及v-开头的属性名对应的值，也就是指令关联的数据，最终需要把这个指令对应的数据展示到指令指定的位置。</p><p>观察属性节点，name为指令名称，value为指令的值，也就是对应的vm实例中的属性名。</p><p><img src="http://5coder.cn/img/gKnAQBHwrRoELZD.png"></p><p>代码实现</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 编译元素节点，处理指令</span><span class="token function">compileElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// console.log(node.attributes)</span>  <span class="token comment">// 遍历所有的属性节点</span>  Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">attr</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> attrName <span class="token operator">=</span> attr<span class="token punctuation">.</span>name  <span class="token comment">// v-text或v-model</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirective</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// v-text去除v-</span>      attrName <span class="token operator">=</span> attrName<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>      <span class="token keyword">let</span> key <span class="token operator">=</span> attr<span class="token punctuation">.</span>value  <span class="token comment">// 对应的msg或count</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> attrName<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 判断是否是指令</span><span class="token punctuation">}</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> attrName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> updateFn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>attrName <span class="token operator">+</span> <span class="token string">'Updater'</span><span class="token punctuation">]</span>  updateFn <span class="token operator">&amp;&amp;</span> <span class="token function">updateFn</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 处理v-text指令</span><span class="token function">textUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 替换元素的显示内容</span>  node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> value<span class="token punctuation">}</span><span class="token comment">// 处理v-model指令</span><span class="token function">modelUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 替换表单元素的值</span>  node<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/LkSXbnzEtPy3cvT.png"></p><p>打开浏览器测试，发现v-指令中的内容全部被替换成为真实的值。</p><p><img src="http://5coder.cn/img/rypSQYKwDICv7BH.png"></p><h4 id="Compiler复习"><a href="#Compiler复习" class="headerlink" title="Compiler复习"></a>Compiler复习</h4><p>完整代码</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span>  <span class="token comment">// 调用new Compiler()创建对象时，可以立即编译模板</span>  <span class="token punctuation">}</span>  <span class="token comment">// 编译模板，处理文本节点和元素节点</span>  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> childNodes <span class="token operator">=</span> el<span class="token punctuation">.</span>childNodes    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isTextNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 处理文本节点</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compileText</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isElementNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 处理元素节点</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compileElement</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token comment">// 以上处理只是el中的第一层子节点，当node节点中还有其他节点时,</span>      <span class="token comment">// 判断node节点，是否有子节点，如果有子节点，要递归调用compile</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 编译元素节点，处理指令</span>  <span class="token function">compileElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// console.log(node.attributes)</span>    <span class="token comment">// 遍历所有的属性节点</span>    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">attr</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> attrName <span class="token operator">=</span> attr<span class="token punctuation">.</span>name  <span class="token comment">// v-text或v-model</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirective</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// v-text去除v-,只保留后面的值</span>        attrName <span class="token operator">=</span> attrName<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">let</span> key <span class="token operator">=</span> attr<span class="token punctuation">.</span>value  <span class="token comment">// 对应的msg或count</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> attrName<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// 判断是否是指令</span>  <span class="token punctuation">}</span>  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> attrName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 参数node：dom元素；key：data中的属性名；attrName：指令去掉v-后面的内容</span>    <span class="token keyword">let</span> updateFn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>attrName <span class="token operator">+</span> <span class="token string">'Updater'</span><span class="token punctuation">]</span>  <span class="token comment">// 获取指令对应的方法</span>    updateFn <span class="token operator">&amp;&amp;</span> <span class="token function">updateFn</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token comment">// 处理v-text指令</span>  <span class="token function">textUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 替换元素的显示内容</span>    node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> value  <span class="token punctuation">}</span><span class="token comment">// 处理v-model指令</span>  <span class="token function">modelUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 替换表单元素的值</span>    node<span class="token punctuation">.</span>value <span class="token operator">=</span> value  <span class="token punctuation">}</span>  <span class="token comment">// 编译文本节点，处理插值表达式</span>  <span class="token function">compileText</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// console.dir(node)</span>    <span class="token comment">// 使用正则表达式匹配花括号中的内容{{ msg }}</span>    <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\{\{(.+?)\}\}</span><span class="token regex-delimiter">/</span></span>    <span class="token comment">// 获取文本节点的内容</span>    <span class="token keyword">let</span> value <span class="token operator">=</span> node<span class="token punctuation">.</span>textContent    <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 获取正则表达式匹配的第一个分组内容(.+?)，即花括号中的内容并去除左右空格</span>      <span class="token keyword">let</span> key <span class="token operator">=</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">// 将正则表达式中匹配到的插值表达式替换成该属性对应的值,重新赋值给文本节点</span>      node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断元素属性的名字是否为指令</span>  <span class="token function">isDirective</span><span class="token punctuation">(</span><span class="token parameter">attrName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> attrName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'v-'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断传入的节点是否为文本节点</span>  <span class="token function">isTextNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">3</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断传入的节点是否为元素节点</span>  <span class="token function">isElementNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-5-Dep"><a href="#2-5-Dep" class="headerlink" title="2.5.Dep"></a>2.5.Dep</h3><p><img src="http://5coder.cn/img/WAQm6v9sdrKCn3l.png"></p><p>功能：</p><ul><li>收集依赖，添加观察者（watcher）</li><li>通知所有观察者</li></ul><p>结构：</p><p><img src="http://5coder.cn/img/qiOb7STVP9EzapF.png"></p><p>代码实现：</p><p>dep.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 存储所有的观察者watcher</span>    <span class="token comment">// Stores all observers</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span>  <span class="token comment">// 添加观察者</span>  <span class="token comment">// Add observer</span>  <span class="token function">addSubs</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 判断是否为空以及是否是观察者（观察者拥有update方法）</span>    <span class="token comment">// Determine if the sub is empty and if it's an observer(the observer has the update method)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sub <span class="token operator">&amp;&amp;</span> sub<span class="token punctuation">.</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// 发送通知,遍历subs数组中的所有观察者，调用每个观察者的update方法去更新视图</span>  <span class="token comment">// Send notification，Iterate through all the observers in the subs array and call the update method on each</span>  <span class="token comment">// observer to update the view</span>  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">sub</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Dep类的作用是收集依赖和发送通知，需要为每一个响应式数据创建一个Dep对象，在使用响应式数据的时收集依赖，也就是创建观察者对象，当数据变化的时候，通知所有观察者，调用观察者的<code>update</code>的方法更新视图，所以需要在observer中来创建Dep对象。</p><p><img src="http://5coder.cn/img/8qLOb1R9GohAIvg.png"></p><p><code>observer</code>类中的<code>get</code>方法中，当访问属性的值的时去收集依赖，在收集依赖的时候首先要判断<code>Dep</code>这个类有没有设置静态属性<code>target</code>，也就是观察者对象，但是在定义<code>Dep</code>这个类的时候并没有给这个类设置它的属性，它的这个属性是在<code>watcher</code>对象中来添加的，在写<code>watcher</code>的时候再回过来看。首先判断<code>Dep</code>这个类有没有<code>target</code>这个静态属性，如果有的话再进入<code>Dep</code>对象的<code>addSub()</code>方法去添加观察者。</p><h3 id="2-6-Watcher"><a href="#2-6-Watcher" class="headerlink" title="2.6.Watcher"></a>2.6.Watcher</h3><p>watcher</p><p><img src="http://5coder.cn/img/eQP8Acin3tmpr5D.png"></p><p>在<code>data</code>中的属性的<code>getter</code>方法中，通过<code>Dep</code>对象收集依赖，在<code>data</code>属性的<code>setter</code>方法中，通过<code>Dep</code>对象触发依赖。所以<code>data</code>中的每一个属性都需要创建一个<code>Dep</code>对象，在收集依赖时，把依赖该数据的所有<code>watcher</code>(观察者对象)添加到<code>Dep</code>对象中的<code>subs</code>数组中。在<code>setter</code>方法中去触发依赖，也就是发送通知，调用<code>Dep</code>对象的<code>notify</code>方法去通知所有关联的<code>watcher</code>对象，watcher对象负责更新对应的视图。</p><p>总结<code>watcher</code>对象的功能：</p><ul><li>当数据变化触发依赖，dep通知所有的Watcher实例更新视图</li><li>自身实例化的时候往dep对象中添加自己</li></ul><p>结构</p><p><img src="http://5coder.cn/img/ZmEdC5uB14vhyig.png"></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// vue实例</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm    <span class="token comment">// data中的属性名称</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key    <span class="token comment">// 回调函数，负责更新视图</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb    <span class="token comment">// 把当前的watcher对象记录到Dep类的静态属性target中</span>    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span>    <span class="token comment">// 在访问vm[key]时触发了get方法，在get方法中调用addSub()方法</span>    <span class="token comment">// 在observer中的get方法中以及调用了addSub方法：Dep.target &amp;&amp; dep.addSub(Dep.target)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>oldValue <span class="token operator">=</span> vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token comment">// 置空，防止重复添加</span>    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token punctuation">}</span>  <span class="token comment">// 当数据发生变化时更新视图</span>  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> newValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>oldValue <span class="token operator">===</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span>    <span class="token punctuation">}</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="创建watcher对象-1"><a href="#创建watcher对象-1" class="headerlink" title="创建watcher对象 1"></a>创建watcher对象 1</h4><p>compiler.js中的compileText方法，在处理插值表达式时创建watcher对象</p><p><img src="http://5coder.cn/img/txg8LHGMnqXJZaA.png"></p><p>index.html中引入</p><p><img src="http://5coder.cn/img/JnZrkD3VUTNA8y2.png"></p><p>打开浏览器控制台，改变插值表达式绑定的值msg</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vm.msg <span class="token operator">=</span> <span class="token string">'xxx'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="http://5coder.cn/img/rXgSAIemNzB53Ed.png"></p><h4 id="创建watcher对象2"><a href="#创建watcher对象2" class="headerlink" title="创建watcher对象2"></a>创建watcher对象2</h4><p>这里处理textUpdater——v-text指令和modelUpdater——v-model指令，在指令中新增如下代码：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 处理v-text指令</span><span class="token function">textUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 替换元素的显示内容</span>  node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> value  <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newValue  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 处理v-model指令</span><span class="token function">modelUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 替换表单元素的值</span>  node<span class="token punctuation">.</span>value <span class="token operator">=</span> value  <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    node<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中，<code>new Watcher()</code>中的第一个参数：<code>this.vm</code>，在调用<code>textUpdater()</code>和<code>modelUpdater()</code>方法时是直接通过<code>updateFn()</code>进行调用的，因此此处的<code>this</code>指向的是有问题的，并不是期望的<code>Compiler</code>对象(<code>this</code>的指向是由谁调用来决定的，如果调用<code>updateFn</code>时是使用<code>this.updateFn()</code>调用，则this指向<code>Compiler</code>对象)。所以在调用updateFn方法时，使用call方法改变this的指向：<code>updateFn &amp;&amp; updateFn.call(this, node, this.vm[key])</code>，其中的第一个参数代表<code>update</code>方法指向的this<code>，</code>而<code>update</code>方法的调用是通过this.update()调用的，因此此处this指向Compiler对象。</p><p>第二个参数：key，由于在textUpdater和modelUpdater中并没有传递key值，所以需要在调用updateFn时将key传递下去，因此为<code>updateFn &amp;&amp; updateFn.call(this, node, this.vm[key], key)</code></p><p>所以修改后的完整代码是compiler.js：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 编译模板，处理文本节点和元素节点</span>  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> childNodes <span class="token operator">=</span> el<span class="token punctuation">.</span>childNodes    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isTextNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 处理文本节点</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compileText</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isElementNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 处理元素节点</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compileElement</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token comment">// 以上处理只是el中的第一层子节点，当node节点中还有其他节点时,</span>      <span class="token comment">// 判断node节点，是否有子节点，如果有子节点，要递归调用compile</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 编译元素节点，处理指令</span>  <span class="token function">compileElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// console.log(node.attributes)</span>    <span class="token comment">// 遍历所有的属性节点</span>    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">attr</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> attrName <span class="token operator">=</span> attr<span class="token punctuation">.</span>name  <span class="token comment">// v-text或v-model</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirective</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// v-text去除v-</span>        attrName <span class="token operator">=</span> attrName<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">let</span> key <span class="token operator">=</span> attr<span class="token punctuation">.</span>value  <span class="token comment">// 对应的msg或count</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> attrName<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// 判断是否是指令</span>  <span class="token punctuation">}</span>  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> attrName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> updateFn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>attrName <span class="token operator">+</span> <span class="token string">'Updater'</span><span class="token punctuation">]</span>    <span class="token comment">// 使用call方法改变this的指向，进而在textUpdater和modelUpdater中可以通过this.vm获取到vue实例</span>    updateFn <span class="token operator">&amp;&amp;</span> <span class="token function">updateFn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> node<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 处理v-text指令</span>  <span class="token function">textUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 替换元素的显示内容</span>    node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> value    <span class="token comment">// 为每一个指令/插值表达式创建 watcher 对象，监视数据的变化</span>    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newValue    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 处理v-model指令</span>  <span class="token function">modelUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 替换表单元素的值</span>    node<span class="token punctuation">.</span>value <span class="token operator">=</span> value    <span class="token comment">// 为每一个指令/插值表达式创建 watcher 对象，监视数据的变化</span>    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      node<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 编译文本节点，处理插值表达式</span>  <span class="token function">compileText</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// console.dir(node)</span>    <span class="token comment">// 使用正则表达式匹配花括号中的内容</span>    <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\{\{(.+?)\}\}</span><span class="token regex-delimiter">/</span></span>    <span class="token comment">// 获取文本节点的内容</span>    <span class="token keyword">let</span> value <span class="token operator">=</span> node<span class="token punctuation">.</span>textContent    <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 获取正则表达式匹配的第一个分组内容(.+?)，即花括号中的内容并去除左右空格</span>      <span class="token keyword">let</span> key <span class="token operator">=</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">// 将正则表达式中匹配到的插值表达式替换成该属性对应的值,重新赋值给文本节点</span>      node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token comment">// 创建watcher对象，当数据改变更新视图</span>      <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newValue      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断元素属性的名字是否为指令</span>  <span class="token function">isDirective</span><span class="token punctuation">(</span><span class="token parameter">attrName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> attrName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'v-'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断传入的节点是否为文本节点</span>  <span class="token function">isTextNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">3</span>  <span class="token punctuation">}</span>  <span class="token comment">// 判断传入的节点是否为元素节点</span>  <span class="token function">isElementNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-7-视图变化更新数据"><a href="#2-7-视图变化更新数据" class="headerlink" title="2.7.视图变化更新数据"></a>2.7.视图变化更新数据</h3><p>上述步骤实现了数据变化更新视图，但是并没有完成双向绑定，即v-model中的input改变后，视图并没有更新，代码实现如下compiler.js：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 处理v-model指令</span><span class="token function">modelUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 替换表单元素的值</span>  node<span class="token punctuation">.</span>value <span class="token operator">=</span> value  <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    node<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 双向绑定</span>  node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">.</span>value  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试，当输入框的值改变时，插值表达式和v-text对应的视图也会发生变化。</p><p><img src="http://5coder.cn/img/doKJPLU1G7HqtXe.png"></p><h3 id="2-8-调试"><a href="#2-8-调试" class="headerlink" title="2.8.调试"></a>2.8.调试</h3><blockquote><p>视频是录制拉勾教育-大前端高薪训练营Part3，如有侵权，请联系删除。此处放置视频，是因为DEBUG过程用文字不好描述，视频更加清晰明了。</p></blockquote><ul><li><p>调试页面首次渲染的过程</p><iframe src="http://5coder.cn/static/video/22.mp4" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height="500" width="700" autoplay="false"> </iframe></li><li><p>调试数据改变更新视图的过程</p><iframe src="http://5coder.cn/static/video/23.mp4" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height="500" width="700" autoplay="false"> </iframe></li></ul><h3 id="2-9-总结"><a href="#2-9-总结" class="headerlink" title="2.9.总结"></a>2.9.总结</h3><p>问题</p><ul><li><p>给属性重新赋值成对象，是否是响应式的？</p><p>重新给属性赋值成对象，该属性依然是响应式的。在observer.js中，当重新赋值时，触发defineReactive方法中的set方法，首先记录newValue也就是新对象的值，然后调用that.walk方法，重新遍历newValue的所有属性，并重新调用defineReactive方法。</p><p><img src="http://5coder.cn/img/bRYNsQcxuE6XA8M.png"></p></li><li><p>给Vue实例新增一个成员是否是响应式的？（<a href="https://cn.vuejs.org/v2/guide/reactivity.html#%E6%A3%80%E6%B5%8B%E5%8F%98%E5%8C%96%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">官方文档</a>）</p><p><img src="http://5coder.cn/img/HyEFBuSLljkAsIM.png"></p><p>data中的属性是在new Vue中，通过new Observer()转换成响应式数据，而手动给vm添加一个test属性，并没有经过observer处理，仅仅是在vm上添加了一个普通的js属性，所以不是响应式的。</p><p><img src="http://5coder.cn/img/2naKVrAsozIleDJ.png"></p></li></ul><p>整体流程</p><p><img src="http://5coder.cn/img/C1BAcQ4KMIHDRTw.png"></p><ul><li>Vue<ul><li>记录传入的选项，设置<code>$data/$el</code></li><li>把<code>data</code>的成员注入到Vue实例</li><li>负责调用<code>Observer</code>实现数据响应式处理（数据劫持），内部有get和set方法</li><li>负责调用<code>Compiler</code>编译指令和插值表达式</li></ul></li><li>Observer<ul><li>数据劫持<ul><li>负责把data中的成员转换成<code>getter/setter</code></li><li>负责把多层属性转换成<code>getter/setter</code></li><li>如果给属性赋值为新对象，把新对象的成员设置为<code>getter/setter</code></li></ul></li><li>添加<code>Dep</code>和<code>Watcher</code>的依赖关系</li><li>数据变化发送通知</li></ul></li><li>Compiler<ul><li>负责编译模板，解析指令/插值表达式</li><li>负责页面的首次渲染过程</li><li>当数据变化后重新渲染</li></ul></li><li>Dep<ul><li>收集依赖，添加订阅者（<code>watcher</code>）</li><li>通知所有订阅者</li></ul></li><li>Watcher<ul><li>自身实例化的时候往<code>dep</code>对象中添加自己</li><li>当数据变化<code>dep</code>通知所有的<code>Watcher</code>实例更新视图</li></ul></li></ul><h2 id="TODO：有空的时候会将所有文件做一张脑图，用来复习！"><a href="#TODO：有空的时候会将所有文件做一张脑图，用来复习！" class="headerlink" title="TODO：有空的时候会将所有文件做一张脑图，用来复习！"></a>TODO：有空的时候会将所有文件做一张脑图，用来复习！</h2>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> Vue响应式原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为什么我建议你卸载这些APP？</title>
      <link href="2021/052341852.html"/>
      <url>2021/052341852.html</url>
      
        <content type="html"><![CDATA[<p>作者 | 鸣哥 来源丨张小鸣</p><p>推荐人丨铁木君（ID：tetemu）</p><blockquote><p><strong>文章转载至【铁木君】公众号，侵删。</strong></p></blockquote><p>你好，我是铁木君。</p><p>不知道你有没有发现，我们渐渐成为了别人的活靶子。</p><p>不信你现在打开手机，就能收到各种推送信息。</p><blockquote><p>xxx深夜与陌生男子携手走进酒店；</p><p>开黑节来临，战令皮肤限时免费领；</p><p>有小哥哥发起了直播，赶紧去看看吧。</p></blockquote><p><strong>各种吸睛的字眼、刺激猎奇的信息，无时无刻不在占据你的视野。</strong></p><p>如果你拿着别人的手机一对比，会发现，在每个人的手机上，推送信息是不一样的。</p><p>在人工智能越来越聪明的时代，你的每一次搜索、评论、点赞。</p><p>甚至是在某个视频多驻足10秒，都会被大数据抓取，存入数据库。</p><p><strong>系统会分析你的喜好，然后推送你感兴趣的东西。</strong></p><p><strong>这些信息，都是为你量身定做的。</strong></p><p>所以越来越多的人沉迷手机，每天什么都不想做，把大量的时间花在各种APP上。想想就十分可怕。</p><p>今天分享这篇文章，就来聊聊这个话题，或许看完你就会明白，为什么要建议你卸载这些APP了。</p><p><img src="http://5coder.cn/img/rIMOzVTe4C8pd92.png"></p><p><strong>01.</strong></p><p>我曾经也有过这样的状态：</p><blockquote><p><strong>早上起床后第一件事，就是打开手机；</strong></p><p>工作时无精打采，在各种新闻热搜中流连忘返；</p><p>周末打算抽时间学习，却总是下意识地打开手机，追剧、刷短视频；</p><p>晚上叫上同学开黑，在游戏里大喊大叫，直到手机没电；</p><p><strong>第二天，顶着个黑眼圈，依旧重复昨天的生活。</strong></p></blockquote><p><strong>一开始，我觉得是自己自控力差，贪玩，后来我发现，我错了。</strong></p><p><strong>真正的原因是：****一个人习惯了高刺激的环境，就很难适应低强度的刺激。</strong></p><p>这就像富人的生活，由俭入奢易，由奢入俭难。</p><p>你习惯了业余时间玩游戏，即使有一天把游戏卸载了，也只会去刷短视频，而不是去阅读。</p><p>你过惯了追剧的日子，即使戒掉了，也会打开热搜，吃各路瓜，而不是去图书馆自习。</p><p><strong>你沉浸在这些APP里，感受到了前所未有的快感。</strong></p><p>你忘却了现实世界的烦恼，那不如意的生活，揪扯不清的人际关系，都抛到九霄云外了。</p><p><strong>然而，一旦你放下手机，无尽的空虚便会向你袭来。</strong></p><p>你感受到了巨大的失落感，开始变得心烦意乱，总想着干点什么。</p><p><strong>因为你已经习惯了这种高强度的刺激，一脱离这种环境，就会像热锅上的蚂蚁一般，焦躁不安。</strong></p><p>于是，为了重回高刺激的「怀抱」，你习惯性的拿起了手机，在各种APP之间欢呼雀跃。</p><p>然而问题是，你越沉迷游戏、视频、小说，内心便越空虚，于是形成了恶性循环。</p><p><strong>最后的结果，就是彻底成为手机的奴隶。</strong></p><p>虽然有时候也会振作一下，但挣扎几下便放弃治疗。</p><p><img src="http://5coder.cn/img/mza3tyZWRODEk8M.png"></p><p><strong>02.</strong></p><p>长此以往，会有怎样的影响呢？</p><p>当你习惯了手机上各类信息的高频刺激，你会变得越来越急躁，越来越没耐心去做一件事了。</p><p><strong>原因很简单啊，你的注意力都被这些高频刺激的信息给捕获了。</strong></p><p>在这样的环境里，你每触碰一次屏幕，每点击一个按键，都会立即给你反馈结果，你已经对即时反馈形成了「路径依赖」。</p><p><strong>久而久之，你的心态也被「训练」成急功近利，追求短期速成。</strong></p><p>所以，当你的注意力从某个高频刺激的对象移开时，只会转移到另一个高频刺激的对象上面。</p><p>比如说，你玩了几小时游戏，直到强制休息，这个时候，你是很难静下心来学习的。</p><p><strong>因为学习对你来说是程度很低的刺激，你根本没那个耐心。</strong></p><p>即使你强迫自己学习，也很难专注，还是会转移到高频刺激的事物上面。</p><p>不信你看看下面这位读者，反复的「安装—卸载」游戏，也很难静下心来看书。</p><p><img src="http://5coder.cn/img/t1kiZmJ7Ra23jAK.jpg"></p><p><strong>即使他把所有娱乐软件卸载了，注意力也只会从游戏转移到朋友圈。</strong></p><p>回想一下，你已经多久没有心平气和的坐下来，看一本书，或者思考一件事了。</p><p><strong>03.</strong></p><p>接下来，请你想象一下这样的画面：</p><blockquote><p>一个沉迷手机的人，他已经适应了高刺激的环境，那么他对阅读、学习这类事情是非常排斥的，只会对娱乐信息感兴趣；</p><p>一个持续学习的人，没有被高频刺激的事物提升阈值，他仍然能接受低频刺激，所以业余时间，他一直坚持学习、思考。</p></blockquote><p>两三年后，会出现什么变化？</p><p><strong>沉迷手机的人，他的人生越来越不值钱，逐渐被社会淘汰。</strong></p><p><strong>而持续学习的人，他的思考能力、认知水平、见识格局都碾压前者。</strong></p><p>他们的差距会越来越大。</p><p>这是一件很可怕的事情，所以啊，我一直有个观点：</p><p><strong>在这个心浮气躁的时代，能够静下心来阅读长文的人，比那些只关注15s短视频的人，大概率要优秀。</strong></p><p><strong><img src="http://5coder.cn/img/yvGr539zX41Bl7I.png"></strong></p><p><strong>04.</strong></p><p>ok，那么该如何改变这种状态呢？</p><p><strong>1、远离那些高强度的刺激吧</strong></p><p>一个人所处的生活环境，会对他的生活习惯造成决定性影响。</p><p><strong>那些轻易就能获取的反馈，我劝你远离。</strong></p><p>不是说非要杜绝接触这些信息，这可能不太现实。</p><p><strong>但我想说的是，千万不要被这些信息「塑造」成高频刺激的敏感体质。</strong></p><p><strong>凡事得有个度，你的时间应该放在，对你人生长期有益的事情上。</strong></p><p>假如你实在无法克制自己，我建议你卸载。</p><p>没有了这些APP的刺激，你的心没那么「躁动」，但有一说一，刚开始会很痛苦。</p><p><strong>2、让自己去做低刺激的事</strong></p><p>我认为，这才是治本方法。</p><p>我在前面说过，当一个人习惯了高强度的刺激，就很难去做低刺激的事。</p><p><strong>确实如此，但如果这件低刺激的事，刚好是你感兴趣的，那么结果又会不一样。</strong></p><blockquote><p>比如说，高三的时候，我沉迷小说，而且很讨厌上物理课，所以，一上物理课我就看小说。</p><p>后来，换了一个物理老师，这位老师画图画得特别好，所以每次上课，我就在草稿上模仿他。</p></blockquote><p>情况开始改变了，我戒掉了小说，喜欢画图，而且喜欢上物理课。</p><p><strong>高考的时候，物理是我考的最好的一门。</strong></p><p>所以，如果你喜欢听歌，那么在某个周末，戴上耳机，绕着校园走一圈。</p><p><strong>你喜欢爬山，那么叫上三五好友，一起享受登上顶峰的成就感。</strong></p><p>一段时间后，你就会恢复低频刺激的体质。</p><p><img src="http://5coder.cn/img/eNDpmUG3WRghHzF.jpg"></p><p><strong>05.</strong></p><p>必须要承认，追求安逸享乐，这是人类刻在骨子里的本性。</p><p>而学习、思考，总是与人性背道而驰的，但先甜后苦，还是先苦后甜，确实需要自己拿捏清楚。</p><p>每个人都应该为自己的人生负责。</p><p><strong>是选择继续用手机填补内心的空虚，还是走出这种状态，全看自己。</strong></p><p><strong>只是你需要知道：人过的太舒服了，会出问题的。</strong></p><p>希望我们都能引以为戒。</p><p><strong>-END-</strong></p>]]></content>
      
      
      <categories>
          
          <category> 鸡汤 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 鸡汤 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue-Router 原理实现</title>
      <link href="2021/052360218.html"/>
      <url>2021/052360218.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue-Router-原理实现"><a href="#Vue-Router-原理实现" class="headerlink" title="Vue-Router 原理实现"></a>Vue-Router 原理实现</h1><blockquote><p>摘要：</p><p><strong>首先来复习一下Vue-Router的基本使用，模拟实现之前，通过它的基本使用方式来进行分析如何实现。然后再来回顾一下，Hash模式和History模式的区别，演示一下History模式如何去使用，History模式要结合服务器一起来使用。最后再来模拟实现自己的Vue-Router，通过自己来实现一个Vue-Router，通过模拟实现Vue-Router来了解Vue-Router内部的实现原理。</strong></p><p><a href="https://router.vuejs.org/zh/">官方文档</a></p></blockquote><h2 id="1-Vue-Router基本回顾-使用步骤"><a href="#1-Vue-Router基本回顾-使用步骤" class="headerlink" title="1.Vue-Router基本回顾-使用步骤"></a>1.Vue-Router基本回顾-使用步骤</h2><ol><li><p>使用<code>Vue.use(VueRouter)</code>注册路由插件</p><p><code>src/router/index.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token keyword">import</span> Index <span class="token keyword">from</span> <span class="token string">'../views/Index.vue'</span><span class="token comment">// 1. 注册路由插件(Vue.use接收参数，如果参数是函数，则直接调用函数注册插件，如果是对象则使用对象的install方法注册组件)</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>创建<code>router</code>对象</p><p><code>src/router/index.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 路由规则</span><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">{</span>    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>    name<span class="token operator">:</span> <span class="token string">'Index'</span><span class="token punctuation">,</span>    component<span class="token operator">:</span> Index  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span>    path<span class="token operator">:</span> <span class="token string">'/blog'</span><span class="token punctuation">,</span>    name<span class="token operator">:</span> <span class="token string">'Blog'</span><span class="token punctuation">,</span>    <span class="token comment">// route level code-splitting</span>    <span class="token comment">// this generates a separate chunk (about.[hash].js) for this route</span>    <span class="token comment">// which is lazy-loaded when the route is visited.</span>    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "blog" */</span> <span class="token string">'../views/Blog.vue'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span>    path<span class="token operator">:</span> <span class="token string">'/photo'</span><span class="token punctuation">,</span>    name<span class="token operator">:</span> <span class="token string">'Photo'</span><span class="token punctuation">,</span>    <span class="token comment">// route level code-splitting</span>    <span class="token comment">// this generates a separate chunk (about.[hash].js) for this route</span>    <span class="token comment">// which is lazy-loaded when the route is visited.</span>    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "photo" */</span> <span class="token string">'../views/Photo.vue'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token comment">// 2. 创建 router 对象</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  routes<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> router<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>注册<code>router</code>对象</p><p><code>src/main.js</code></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment">// 3. 注册 router 对象</span>  router<span class="token punctuation">,</span>  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>创建路由组件的占位：<code>&lt;router-view/&gt;</code></p><p><code>src/App.vue</code></p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;  &lt;div id="app"&gt;    &lt;div&gt;      &lt;img src="@/assets/logo.png" alt=""&gt;    &lt;/div&gt;    &lt;div id="nav"&gt;      &lt;!-- 5. 创建链接 --&gt;      &lt;router-link to="/"&gt;Index&lt;/router-link&gt; |      &lt;router-link to="/blog"&gt;Blog&lt;/router-link&gt; |      &lt;router-link to="/photo"&gt;Photo&lt;/router-link&gt;    &lt;/div&gt;    &lt;!-- 4. 创建路由组建的占位 --&gt;    &lt;router-view/&gt;  &lt;/div&gt;&lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>创建链接</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Index<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span> |<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/blog<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Blog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span> |<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/photo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Photo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><p>创建Vue实例时，传入Vue-Router的作用：</p><ol><li><p>未传入router对象</p><p>main.js中注释router：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token comment">// import router from './router'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment">// 3. 注册 router 对象</span>  <span class="token comment">// router,</span>  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打开浏览器，打印vm实例，发现vm实例中并无router相关的属性。</p><p><img src="http://5coder.cn/img/g2W65s8Xtaw9fFr.png"></p></li><li><p>传入router对象</p><p>将router对象解开注释，在浏览器控制台打印vm实例。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment">// 3. 注册 router 对象</span>  router<span class="token punctuation">,</span>  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/Tz2uN3rWpYIJUZw.png"></p><p>发现vm实例中多出了属性$route和$router属性。</p><ul><li><p>$route</p><p>route是一个跳转的路由对象，每一个路由都会有一个route对象，是一个局部的对象，可以获取对应的name,path,params,query等</p><p><img src="http://5coder.cn/img/mDbk2HtwN6ngsSc.png"></p><ul><li>$route.path<br>字符串，等于当前路由对象的路径，会被解析为绝对路径，如 <code>"/home/news"</code> 。</li><li>$route.params<br>对象，包含路由中的动态片段和全匹配片段的键值对</li><li>$route.query<br>对象，包含路由中查询参数的键值对。例如，对于 <code>/home/news/detail/01?favorite=yes</code> ，会得到<code>$route.query.favorite == 'yes'</code> 。</li><li>$route.router<br>路由规则所属的路由器（以及其所属的组件）。</li><li>$route.matched<br>数组，包含当前匹配的路径中所包含的所有片段所对应的配置参数对象。</li><li>$route.name<br>当前路径的名字，如果没有使用具名路径，则名字为空。</li></ul><blockquote><p><strong>注意：query和params的区别</strong></p><p>params传递参数需要在路由文件中进行配置，例如  path: “/detail/:id/:name”,  component: Detail,最终url生成的路径是detail/10/apple , 传参的方式是： this.$router.push({ path: “/detail/“+id });</p><p>query可以直接传递参数，且最终的url格式是 detail？id=10，传参的方式是：this.$router.push({ path: “/detail”，query：{id：this.id}});</p><p>query和params获取参数传递参数都是通过当前路由 this.$route</p></blockquote></li><li><p>$router</p><p>$router是VueRouter的一个对象，通过Vue.use(VueRouter)和VueRouter构造函数得到一个router的实例对象，这个对象中是一个全局的对象，他包含了所有的路由包含了许多关键的对象和属性。</p><p><img src="http://5coder.cn/img/tHy76qjJxMCNLeV.png"></p><p>举例：history对象</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span><span class="token string">'home'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 本质是向history栈中添加一个路由，在我们看来是 切换路由，但本质是在添加一个history记录</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>方法：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">$router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span><span class="token string">'home'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 替换路由，没有历史记录</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li></ol><h2 id="2-动态路由"><a href="#2-动态路由" class="headerlink" title="2.动态路由"></a>2.动态路由</h2><p>代码示例：</p><p><img src="http://5coder.cn/img/MRqg8TNYynwb74h.png"></p><p>首先配置首页路径，其路径为固定”/“。详情页的路径为”/detail/:id”，不同商品对应不同的id，<code>:id</code>为占位符，告诉component要展示的商品，这就是动态路由。detail路由规则中，component组件采用路由懒加载的方式加载路由，用户访问详情页时才加载该组件。</p><p>组件中如何获取动态路由规则中的动态id？</p><ul><li>方式1：通过当前路由规则<code>{{ $route.params.id }}</code>，获取数据</li><li>方式2：路由规则中开启props传参</li></ul><p><img src="http://5coder.cn/img/RfosrUwIHl6BcjT.png"></p><h2 id="3-嵌套路由"><a href="#3-嵌套路由" class="headerlink" title="3.嵌套路由"></a>3.嵌套路由</h2><p>当多个组件中有相同的路由，可以把相同的内容提取到公共的组件中。如下图所示，加入首页、详情页有相同的头和尾，这时可以提取新的组件layout，把头和尾放到layout组件中，中间部分动态变化的使用router-view占位。访问首页时，将index组件和layout组件合并输出。</p><p><img src="http://5coder.cn/img/bjdzc3Pn2vfoxCM.png"></p><p>由于首页和详情页面有相同的头和尾，所以将相同的头和尾提取到components中的layout.vue组件中。</p><p><img src="http://5coder.cn/img/L9TMSi1aumeFjYt.png"></p><p>Index.vue、Detail.vue、Login.vue</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;!-- -------------------------------Index.vue------------------------------- --&gt;&lt;template&gt;  &lt;div&gt;    这里是首页 &lt;br&gt;    &lt;router-link to="login"&gt;登录&lt;/router-link&gt; |    &lt;router-link to="detail/5"&gt;详情&lt;/router-link&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  name: 'Index'}&lt;/script&gt;&lt;style&gt;&lt;/style&gt;&lt;!-- -------------------------------Detail.vue------------------------------- --&gt;&lt;template&gt;  &lt;div&gt;    &lt;!-- 方式1： 通过当前路由规则，获取数据 --&gt;    通过当前路由规则获取：{{ $route.params.id }}    &lt;br&gt;    &lt;!-- 方式2：路由规则中开启 props 传参 --&gt;    通过开启 props 获取：{{ id }}  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  name: 'Detail',  props: ['id']}&lt;/script&gt;&lt;style&gt;&lt;/style&gt;&lt;!-- -------------------------------Login.vue------------------------------- --&gt;&lt;template&gt;  &lt;div&gt;    这是登录页面    &lt;br&gt;    &lt;router-link to="/"&gt;首页&lt;/router-link&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default {  name: 'Login'}&lt;/script&gt;&lt;style scoped&gt;&lt;/style&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>路由规则<strong>router/index.js</strong></p><p>路由规则中，首先配置的登录页面，当访问登陆页面时，直接加载Login组件。因为首页和详情页有相同的头和尾，而头和尾都提取到layout组件中，所以这里使用了<strong>嵌套路由</strong>，嵌套路由中会将外部的path与children中的path进行合并，分别加载Layout组件和Index组件，把他们合并到一起。</p><p>当嵌套路由中的path为根路径时，Index组件中的path可以写为空字符串。children中的path可以写为相对路径，也可以写为绝对路径，空字符串为相对路径。当访问根时，先加载Layout，再去加载Index，合并到一起进行渲染。</p><p>访问详情页时，外面的路径为根路径，Detail中配置的路径为相对路径，路径拼接后：”/detail/:id”，合并Layout和Detail后渲染出来。</p><p><img src="http://5coder.cn/img/rFhfvWHYicSLPDR.png"></p><p>浏览器访问效果：</p><p><img src="http://5coder.cn/img/y86emD4zdM1UoIk.png"></p><p><img src="http://5coder.cn/img/myjW7eVwtZoIR4u.png"></p><p><img src="http://5coder.cn/img/pU19vKumQa5Hhln.png"></p><h2 id="4-编程式导航"><a href="#4-编程式导航" class="headerlink" title="4.编程式导航"></a>4.编程式导航</h2><p>编程式导航<a href="https://router.vuejs.org/zh/guide/essentials/navigation.html"><strong>官方文档</strong></a></p><p>之前在页面跳转时使用<code>router-link</code>形成超链接，但是在登陆页面时需要点击按钮跳转到首页，这时就需要使用编程式导航，调<code>用$router.push()</code>方法。</p><ul><li><p>Login.vue中，按钮button绑定方法push方法，内部使用<code>this.$router.push('/')</code>方法跳转到首页。使用push方法时参数接受有两种方式：</p><ul><li>第一种方式是字符串-跳转的路由地址</li><li>第二种方式是对象，对象为{ name: ‘Home’ }，其中name来源于router/index.js中路由规则中的name属性，如图：</li></ul><p><img src="http://5coder.cn/img/1kCXnyGANKsHPgt.png"></p></li><li><p>Index.vue中，两个按钮分别绑定replace和getDetail方法。replace方法与push方法类似，都可以跳转到指定的路径，它们的参数形式也是一样的，但是replace方法不会记录历史，它会将当前的地址直接替换为’/login’地址。</p><p>push方法传递路由参数，首先需要指定跳转的路由名称<code>name: 'Detail'</code>，接着使用params指定路由参数。</p></li><li><p>Detail.vue中使用go方法：跳转到历史中的某一次路径，它可以使负数，也就是后退，当参数为-1时与<code>$router.back()</code>方法效果相同。</p></li></ul><p><img src="http://5coder.cn/img/ReDFIjCUOL2bn3z.png"></p><h2 id="5-Hash-模式和-History-模式的区别"><a href="#5-Hash-模式和-History-模式的区别" class="headerlink" title="5.Hash 模式和 History 模式的区别"></a>5.Hash 模式和 History 模式的区别</h2><p><code>vue-router</code>默认hash模式——使用URL的hash来模拟一个完整的URL，于是当URL改变时，页面不会重新加载。</p><p>如果不想要很丑的hash，可以使用路由的history模式，这种模式充分利用<code>history.pushState</code> API来完成URl跳转而无需重新加载页面。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  mode<span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>  routes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>当时用history模式时，URL就像正常的url，例如：</p><p><code>http://blog.5coder.cn/user/id</code>，也好看！</p><p>不过这种模式要玩好，还需要后台配置支持。因为我们的应用是个单页客户端应用，如果后台没有正确的配置，当用户在浏览器直接访问 <code>http://oursite.com/user/id</code> 就会返回 404，这就不好看了。</p><p>所以呢，你要在服务端增加一个覆盖所有情况的候选资源：如果 URL 匹配不到任何静态资源，则应该返回同一个 <code>index.html</code> 页面，这个页面就是你 app 依赖的页面。</p><p><img src="http://5coder.cn/img/qtNlXpJ9RYM2EVr.png"></p><p><img src="http://5coder.cn/img/tKYyfsveLOjhpWa.png"></p><h2 id="6-History-模式"><a href="#6-History-模式" class="headerlink" title="6.History 模式"></a>6.History 模式</h2><p>History模式的使用</p><ul><li>History需要服务器的支持</li><li>单页应用中，服务端不存在<code>http://www.testurl.com/login</code>这样的地址会返回找不到该页面<ul><li>vue-cli自带的web服务器已经配置好了对history模式的支持，所以无法演示，后面会在node和nginx服务器中进行演示</li></ul></li><li>在服务端应该出了静态资源外都返回单页应用的index.html</li></ul><p><img src="http://5coder.cn/img/zUIkK7wQBPMEfXq.png"></p><p><img src="http://5coder.cn/img/BzTIUiLqoE8nVQf.png"></p><h2 id="7-History-模式-Node-js"><a href="#7-History-模式-Node-js" class="headerlink" title="7.History 模式 - Node.js"></a>7.History 模式 - Node.js</h2><p>接下来通过node开发的web服务器演示vue-router的history模式。项目目录结构如下：</p><p><img src="http://5coder.cn/img/fg1S8CBbacz9djL.png"></p><p>express开发的Web服务器：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token comment">// 导入处理 history 模式的模块</span><span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'connect-history-api-fallback'</span><span class="token punctuation">)</span><span class="token comment">// 导入 express</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>  <span class="token comment">// express是基于node的一个web开发框架</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 注册处理 history 模式的中间件</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 处理静态资源的中间件，网站根目录 ../web</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../web'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 开启服务器，端口是 3000</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器开启，端口：3000'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用<code>node app.js</code>启动web服务器，在浏览器中访问<code>localhost:3000</code>地址，当app.js中注释掉app.use(history())时，切换至About页面，F5刷新浏览器后，此时浏览器要向服务器发送请求，请求当前地址**’/adbot’**，而在node的服务器中并没有处理这个地址，所以这个时候node服务器输出一个默认的404页面。</p><p>当启用history插件时，再次刷新about页面，服务器会判断当前请求的页面服务器上没有，它会把单页应用默认的首页index.html返回给浏览器，浏览器接收到这个页面之后，会再去判断路由地址，发现是about，于是会加载about组件对应的内容，并且把它渲染浏览器上来，这是history执行的一个过程。</p><h2 id="8-History-模式-nginx"><a href="#8-History-模式-nginx" class="headerlink" title="8.History 模式 - nginx"></a>8.History 模式 - nginx</h2><p>nginx服务器配置</p><ul><li>从官网下载nginx的压缩包</li><li>把压缩包解压到指定目录</li><li>打开命令行，切换至刚才解压的目录</li><li>命令行启动nginx<ul><li>start nginx 启动nginx</li><li>nginx -s reload 重启nginx（修改nginx配置文件后需要重启nginx服务器）</li><li>nginx -s stop 停止nginx</li></ul></li></ul><p>安装好的nginx目录如下图：</p><p><img src="http://5coder.cn/img/YKlEoP5nA19qufX.png"></p><p><img src="http://5coder.cn/img/C1msbSd8tMkJvVI.png"></p><p>命令行中启动nginx <code>start nginx.ext</code>，启动后在浏览器中访问localhost，如果现实下图则证明启动成功。</p><p><img src="http://5coder.cn/img/R7ibO1FAXe4chnU.png"></p><p>将打包好的dist目录内容拷贝到nginx/html目录中，再次刷新浏览器localhost路径可以看到刚才写的index.html，并且about、video都是可以正常进行跳转的。</p><p><img src="http://5coder.cn/img/znI5TCDBEf4Fyks.png"></p><p>当浏览器地址为localhost/about或者localhost/video时，刷新浏览器会出现404，如下图，因为nginx并未处理vue-router的history模式，当刷新时，服务器中不存在请求路径中对应的文件，所以服务器会返回404页面。</p><p><img src="http://5coder.cn/img/Bg1tbz3smwUScDK.png"></p><p>nginx解决vue-router的history模式，需要修改nginx/conf/nginx.conf的文件内容，如下：</p><p><img src="http://5coder.cn/img/jrvlKg8cza564SW.png"></p><p>修改nginx.conf后，需要重启nginx——<code>nginx -s reload</code>，再次刷新浏览器，发现nginx并未返回404页面，其工作的原理是：</p><p>nginx服务器会判断当前请求的页面服务器上不存在，它会把单页应用默认的首页index.html返回给浏览器，浏览器接收到这个页面之后，会再去判断路由地址，发现是about，于是会加载about组件对应的内容，并且把它渲染浏览器上来，这是history执行的一个过程。</p><h2 id="9-VueRouter-实现原理"><a href="#9-VueRouter-实现原理" class="headerlink" title="9.VueRouter 实现原理"></a>9.VueRouter 实现原理</h2><p>vue-router有两种模式，一种是hash模式，另外一种是history模式，此处使用history模式来模拟，hash模式可以自己实现，差别很小。</p><p>在模拟实现vue-router时会用到vue的一些基本概念，例如：</p><ul><li>插件</li><li>混入mixin</li><li>Vue.observable()</li><li>插槽</li><li>render函数</li><li>运行时和完整版的Vue</li></ul><h3 id="Hash模式"><a href="#Hash模式" class="headerlink" title="Hash模式"></a>Hash模式</h3><p>URL中 <code>#</code> 后面的内容作为路径地址，可以直接通过<code>location.url()</code>来切换URL地址，如果只改变路径中 <code>#</code> 后面的内容，浏览器不会向服务器请求对应的地址，但是会将该地址记录至访问历史中。</p><p>当hash改变后，需要监听hash的变化并做相应的处理，只需要监听<code>hashchange</code>事件。当hash改变后，会触发<code>hashchange</code>事件，在该事件记录当前的路由地址并找到该路径对应的组件然后重新渲染。</p><h3 id="History模式"><a href="#History模式" class="headerlink" title="History模式"></a>History模式</h3><p>history模式的路径就是一个普通的url，调用<code>history.pushState()</code>方法来改变地址栏，<code>pushState</code>方法仅仅改变当前地址栏并保存到浏览器的访问历史中，并不会真正的跳转到指定路径去向服务器请求。</p><p>通过监听<code>popstate</code>事件，可以监听到浏览器历史操作的变化。在<code>popstate</code>事件的处理函数中，可以记录改变后的地址。需要注意的是，当调用<code>pushState</code>或<code>replaceState</code>时并不会触发该事件。当点击浏览器的前进和后退按钮的时候，或者调用<code>history.back()</code>或<code>history.forword()</code>方法时，该事件才会被触发。当地址改变之后，根据当前路由地址找到对应组件重新渲染。</p><h2 id="10-VueRouter-模拟实现-分析"><a href="#10-VueRouter-模拟实现-分析" class="headerlink" title="10.VueRouter 模拟实现-分析"></a>10.VueRouter 模拟实现-分析</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// router/index.js</span><span class="token comment">// 注册插件 Vue.use()接受两种参数：</span><span class="token comment">// 1.函数：Vue.use()内部直接调用函数</span><span class="token comment">// 2.对象: Vue.use()内部调用对象的install方法</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span><span class="token comment">// 创建路由对象，后续模拟时需要创建静态的install方法</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    routes<span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> homeComponent<span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// main.js</span><span class="token comment">// 创建Vue实例，注册router对象</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    router<span class="token punctuation">,</span>    <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/V9dtQF68YLa5rzX.png"></p><h2 id="11-VueRouter-install"><a href="#11-VueRouter-install" class="headerlink" title="11.VueRouter-install"></a>11.VueRouter-install</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> _Vue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VueRouter</span><span class="token punctuation">{</span>    <span class="token comment">// 静态方法install，Vue.use()调用install方法时会传入两个参数：</span>    <span class="token comment">// 一个是Vue构造函数</span>    <span class="token comment">// 另一个个是可选的选项对象</span>    <span class="token keyword">static</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 1. 判断当前插件是否被安装</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>VueRouter<span class="token punctuation">.</span>install<span class="token punctuation">.</span>installed<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>        VueRouter<span class="token punctuation">.</span>install<span class="token punctuation">.</span>installed <span class="token operator">=</span> <span class="token boolean">true</span>        <span class="token comment">// 2. 把Vue的构造函数记录在全局</span>        <span class="token comment">// 把vue的构造函数记录到全局变量中，因为当前的install方法是一个静态方法，在这个静态方法中，接收的一个</span>        <span class="token comment">// 参数Vue的构造函数，将来在Vue中的一些实例方法中要使用这个Vue的构造函数。</span>        <span class="token comment">// 比如创建router-link和router-view这两个组件时调用vue.component()来创建，所以需要把Vue的构造函数给他记录到全局变量中</span>        _Vue <span class="token operator">=</span> Vue        <span class="token comment">// 3. 把创建Vue实例时传入的router对象注入到Vue实例</span>        <span class="token comment">// 把创建vue实例时传入的router对象，注入到所有的Vue实例上，之前所使用的this.$router就是在这个时候注入到Vue实例上的，</span>        <span class="token comment">// 所有的组件也都是vue的实例</span>        <span class="token comment">// _Vue.prototype.$router = this.$options.router  // 此时通过VueRouter.install()来调用，此时this指向VueRouter这个类，而不是Vue实例</span>        _Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// 此时能获取到Vue实例，this的指向为Vue实例</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 判断的作用是防止所有的组件都执行beforeCreate函数去注如</span>                    <span class="token class-name">_Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router  <span class="token comment">// 从传入的选项中获取router属性</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="12-VueRouter-构造函数"><a href="#12-VueRouter-构造函数" class="headerlink" title="12.VueRouter-构造函数"></a>12.VueRouter-构造函数</h2><p>构造函数需要接收一个参数options对象，其返回值是VueRouter对象。构造函数中需要初始化三个属性，分别是options、routeMap、data属性。data是一个响应式的对象，因为data中要存储当前的路由地址，当路由变化的时候要自动加载组件，所以data需要设置成响应式的对象。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> _Vue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VueRouter</span> <span class="token punctuation">{</span>    <span class="token comment">// 静态方法install，Vue.use()调用install方法时会传入两个参数：...</span>    <span class="token keyword">static</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options  <span class="token comment">// 记录构造函数中传入的选项options</span>        <span class="token comment">// 作用是将options中传入的路由规则-routes解析出来，存储到routeMap对象中，routeMap对象是键值对的形式，</span>        <span class="token comment">// 键为路由地址，值为路由组件，在router-view组件中会根据当前的路由地址来routeMap里边找到对应的组件，把它渲染到浏览器中。</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>routeMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                <span class="token comment">// data是响应式的对象,其中有属性current，用来记录当前的路由地址。默认情况下当前的路由地址是'/',就是根目录。</span>        <span class="token comment">// Vue提供了一个方法vue.observable,该方法的作用是用来创建响应式对象。使用observable方法创建的响应式的对象可以直接用在渲染函数或者计算属性。</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> _Vue<span class="token punctuation">.</span><span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            current<span class="token operator">:</span> <span class="token string">'/'</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="13-VueRouter-createRouteMap"><a href="#13-VueRouter-createRouteMap" class="headerlink" title="13.VueRouter-createRouteMap"></a>13.VueRouter-createRouteMap</h2><p>对比类图，上面已经完成了三个属性this.options、this.data、this.routeMap的初始化以及install()方法，这里来完成createRouteMap()方法。该方法的作用是将this.optons中的routes遍历，取出其中的path作为this.routeMap的键，取出其中的component作为this.routeMap的值，代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> _Vue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VueRouter</span> <span class="token punctuation">{</span>    <span class="token comment">// 静态方法install，Vue.use()调用install方法时会传入两个参数：...</span>    <span class="token keyword">static</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>    <span class="token comment">// 初始化属性</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>        <span class="token comment">// 遍历所有路由规则，把路由规则解析成键值对的形式，并存储到routeMap中</span>    <span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>routeMap<span class="token punctuation">[</span>route<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> route<span class="token punctuation">.</span>component  <span class="token comment">// 键为route中的path，值为route中的component</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="14-VueRouter-router-link"><a href="#14-VueRouter-router-link" class="headerlink" title="14.VueRouter-router-link"></a>14.VueRouter-router-link</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> _Vue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VueRouter</span> <span class="token punctuation">{</span>    <span class="token comment">// 静态方法install，Vue.use()调用install方法时会传入两个参数：...</span>    <span class="token keyword">static</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>    <span class="token comment">// 初始化属性</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>        <span class="token comment">// 遍历所有路由规则，把路由规则解析成键值对的形式，并存储到routeMap中</span>    <span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>        <span class="token comment">// 创建initComponent方法，用来创建router-link组件。</span>    <span class="token function">initComponent</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 传入Vue构造器，减少对外部_Vue的依赖</span>        <span class="token comment">// 使用Vue.component方法创建组件</span>        Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'router-link'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>            props<span class="token operator">:</span> <span class="token punctuation">{</span>                to<span class="token operator">:</span> String            <span class="token punctuation">}</span><span class="token punctuation">,</span>            template<span class="token operator">:</span> <span class="token string">'&lt;a :href="to"&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/a&gt;'</span>  <span class="token comment">// 使用:href绑定to的值，使用slot插槽用于放置router-link中间的内容</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>initComponent方法创建完成后进行测试，测试时需要先执行createRouteMap方法和initComponent方法，在静态方法install中，当插件注册完成时来立即调用初始化方法（<code>_Vue.prototype.$router = this.$options.router</code>）。创建init方法，包装createRouteMap方法和initComponent方法，便于在install方法中调用。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> _Vue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VueRouter</span> <span class="token punctuation">{</span>    <span class="token comment">// 静态方法install，Vue.use()调用install方法时会传入两个参数：...</span>    <span class="token keyword">static</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token operator">...</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 判断的作用是防止所有的组件都执行beforeCreate函数去注如</span>        <span class="token class-name">_Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router  <span class="token comment">// 从传入的选项中获取router属性</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ----通过调用init方法来调用createRouteMap方法和initComponent方法</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// 初始化属性</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>        <span class="token comment">// 包装createRouteMap方法和initComponent方法，便于在install方法中调用</span>    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initComponent</span><span class="token punctuation">(</span>_Vue<span class="token punctuation">)</span>  <span class="token comment">// 需要传入Vue的构造函数，此处直接传入全局变量_Vue</span>    <span class="token punctuation">}</span>        <span class="token comment">// 遍历所有路由规则，把路由规则解析成键值对的形式，并存储到routeMap中</span>    <span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>    <span class="token comment">// 创建initComponent方法，用来创建router-link组件。</span>    <span class="token function">initComponent</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 传入Vue构造器，减少对外部_Vue的依赖</span>        <span class="token comment">// 使用Vue.component方法创建组件</span>        Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'router-link'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>            props<span class="token operator">:</span> <span class="token punctuation">{</span>                to<span class="token operator">:</span> String            <span class="token punctuation">}</span><span class="token punctuation">,</span>            template<span class="token operator">:</span> <span class="token string">'&lt;a :href="to"&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/a&gt;'</span>  <span class="token comment">// 使用:href绑定to的值，使用slot插槽用于放置router-link中间的内容</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后修改router/index.js中导入VueRouter，将官方提供的<code>vue-router</code>改为自己实现的VueRouter。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// import VueRouter from 'vue-router'</span><span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'../VueRouter'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>命令行运行<code>yarn serve</code>，启动浏览器发现两个错误，第一个是运行时版本和完整版本的错误，错误内容：</p><blockquote><p><img src="http://5coder.cn/img/M6PBIQpJgCfFdWn.png"></p><p>你正在使用的是只包含运行时版本的，没有模板编辑器不可用，你可以使用预编译把模板编译成render函数或者使用包含编译器版本的内容</p></blockquote><p>第二个错误是router-view组件错误，因为还没有创建router-view组件，暂时不理会。</p><p>Vue的构件版本</p><ul><li>运行时版：不支持template模板，需要打包的时候提前编译</li><li>完整版：包含运行时和编译器，体积比运行时版大10k左右，程序运行的时候把template模板转换成为render函数</li></ul><p>下面使用两种方法解决这个问题。</p><h2 id="15-VueRouter-完整版的-Vue"><a href="#15-VueRouter-完整版的-Vue" class="headerlink" title="15.VueRouter-完整版的 Vue"></a>15.VueRouter-完整版的 Vue</h2><p>使用完整版Vue解决上面提到的Vue运行时版本的错误。</p><p><img src="http://5coder.cn/img/vdp6mVE3ICloFU4.png"></p><p>找到runtimeCompiler选项</p><p><img src="http://5coder.cn/img/yAE6NadFGklMfXW.png"></p><p>接着在项目的根目录创建vue.config.js，内容如下，之后重启项目，回到浏览器，发现第一个运行时版本的错误以及消失了。打开Element发现Home和About也都被渲染为a链接。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>export <span class="token punctuation">{</span>    runtimeCompiler<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/D5qrEu1Jgem4vlT.png"></p><h2 id="16-VueRouter-render"><a href="#16-VueRouter-render" class="headerlink" title="16.VueRouter-render"></a>16.VueRouter-render</h2><p>下面使用运行时版本的Vue解决之前的问题。运行时版本的Vue不带编译器，不支持组件中的template的选项。编译器的作用就是把template的编译成render函数。正在运行时版本的Vue中，组件可以直接写render函数。所以重点是render函数怎么写？</p><p>这个时候你可能会有疑问，在使用单文件组件的时候一直在写template模板，也没有写render函数，为什么单文件组件可以正常工作呢？这是因为在打包的过程中，把单文件的template编译成了render函数，叫做预编译。下面使用运行时版本解决之前的问题，解决之前，删除上面创建的vue.config.js文件。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 创建initComponent方法，用来创建router-link组件。</span>    <span class="token function">initComponent</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 传入Vue构造器，减少对外部_Vue的依赖</span>        <span class="token comment">// 使用Vue.component方法创建组件</span>        Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'router-link'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>            props<span class="token operator">:</span> <span class="token punctuation">{</span>                to<span class="token operator">:</span> String            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token comment">// template: '&lt;a :href="to"&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/a&gt;'  // 使用:href绑定to的值，使用slot插槽用于放置router-link中间的内容</span>            <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// h函数三个参数：</span>                <span class="token comment">// 1.h函数创建元素对应的选择器，这里使用标签选择器</span>                <span class="token comment">// 2.给标签设置属性</span>                <span class="token comment">// 3.生成的元素中的子元素,当前a标签内容为slot默认插槽，</span>                <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    attrs<span class="token operator">:</span> <span class="token punctuation">{</span>                        href<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>到这里完整版本的vue和运行时版本的vue它们的区别就演示完了。完整版本Vue包含运行时和编译器，运行时版本的Vue在组件中，要自己来写render函数。运行时版本的Vue并不支持template，完整版本的Vue中的编译器，就是把template模板变异成render函数，这里<code>router-link</code>组件就创建完了。</p><h2 id="17-VueRouter-router-view"><a href="#17-VueRouter-router-view" class="headerlink" title="17.VueRouter-router-view"></a>17.VueRouter-router-view</h2><p>router-view组件相当于占位符，在router-vue组件内部，需要根据当前路由地址获取到对应的路由组件，并渲染到router-vue的位置。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 创建initComponent方法，用来创建router-link组件。</span><span class="token function">initComponent</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 传入Vue构造器，减少对外部_Vue的依赖</span>    <span class="token comment">// 使用Vue.component方法创建组件</span>    Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'router-link'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        props<span class="token operator">:</span> <span class="token punctuation">{</span>            to<span class="token operator">:</span> String        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token comment">// template: '&lt;a :href="to"&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/a&gt;'  // 使用:href绑定to的值，使用slot插槽用于放置router-link中间的内容</span>        <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// h函数三个参数：</span>            <span class="token comment">// 1.h函数创建元素对应的选择器，这里使用标签选择器</span>            <span class="token comment">// 2.给标签设置属性</span>            <span class="token comment">// 3.生成的元素中的子元素,当前a标签内容为slot默认插槽，</span>            <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                attrs<span class="token operator">:</span> <span class="token punctuation">{</span>                    href<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to                <span class="token punctuation">}</span><span class="token punctuation">,</span>                on<span class="token operator">:</span> <span class="token punctuation">{</span>                    click<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clickHandler                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        methods<span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token function">clickHandler</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// 参数data：触发popstate传给popstate事件对象的参数；title：网页标题；url：地址</span>                history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">)</span>                <span class="token comment">// 加载路径对应的组件,将当前的路径记录到data.current中，</span>                <span class="token comment">// 当this.$router.data.current改变后，会对应重新加载组件，并重新渲染到视图上</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>data<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to                e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 阻止a链接默认跳转事件</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span>    Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'router-view'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">/*            * render函数内部，先要找到当前路由的地址，再根据当前路由的地址去routerMap对象中找这个路由地址            * 对应的组件，然后再利用render函数把这个组件转换成Vue组件直接返回，render函数，还可以直接把一个组件转换成虚拟DOM。            * 当前路由地址：this.data.current,其中render方法中this指向方法内部，所以需要先保存VueRouter实例            * */</span>            <span class="token comment">// const component = self.routeMap[self.data.current]</span>            <span class="token comment">// return h(component)  // h函数会将组件转换为虚拟DOM并返回</span>            <span class="token comment">// 上面代码执行后，此时打开浏览器发现点击Home和About后，浏览器会刷新向服务器重新请求，</span>            <span class="token comment">// 所以还需要处理a链接的默认点击行为以及点击事件————改变地址栏</span>            <span class="token comment">// 在创建router-link中更改代码</span>            <span class="token keyword">const</span> component <span class="token operator">=</span> self<span class="token punctuation">.</span>routeMap<span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>current<span class="token punctuation">]</span>            <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span>  <span class="token comment">// h函数会将组件转换为虚拟DOM并返回</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="18-VueRouter-initEvent"><a href="#18-VueRouter-initEvent" class="headerlink" title="18.VueRouter-initEvent"></a>18.VueRouter-initEvent</h2><p>最后再来实现类图中的最后一个方法initEvent，在这个方法中要来注册一个事件popstate。之前的工作都已经实现了路由点击跳转的功能，但是点击浏览器的前进和后退按钮，地址栏确实发生了变化，但是组件却没重新加载这个地址对应的组件，所以在initEvent中处理这个问题，也就是历史发生变化的时候，要去加载当前地址栏中的地址对应的组件，并且把它渲染出来。</p><p><img src="http://5coder.cn/img/AeaOrRWgz3CBcMK.png"></p><p>到这里模拟vue-router的history模式就全部做完了。</p><h2 id="19-最终文件"><a href="#19-最终文件" class="headerlink" title="19.最终文件"></a>19.最终文件</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> _Vue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VueRouter</span> <span class="token punctuation">{</span>    <span class="token comment">// 静态方法install，Vue.use()调用install方法时会传入两个参数：</span>    <span class="token comment">// 一个是Vue构造函数</span>    <span class="token comment">// 另一个个是可选的选项对象</span>    <span class="token keyword">static</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 1. 判断当前插件是否被安装</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>VueRouter<span class="token punctuation">.</span>install<span class="token punctuation">.</span>installed<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>        VueRouter<span class="token punctuation">.</span>install<span class="token punctuation">.</span>installed <span class="token operator">=</span> <span class="token boolean">true</span>        <span class="token comment">// 2. 把Vue的构造函数记录在全局</span>        <span class="token comment">// 把vue的构造函数记录到全局变量中，因为当前的install方法是一个静态方法，在这个静态方法中，接收的一个</span>        <span class="token comment">// 参数Vue的构造函数，将来在Vue中的一些实例方法中要使用这个Vue的构造函数。</span>        <span class="token comment">// 比如创建router-link和router-view这两个组件时调用vue.component()来创建，所以需要把Vue的构造函数给他记录到全局变量中</span>        _Vue <span class="token operator">=</span> Vue        <span class="token comment">// 3. 把创建Vue实例时传入的router对象注入到Vue实例</span>        <span class="token comment">// 把创建vue实例时传入的router对象，注入到所有的Vue实例上，之前所使用的this.$router就是在这个时候注入到Vue实例上的，</span>        <span class="token comment">// 所有的组件也都是vue的实例</span>        <span class="token comment">// _Vue.prototype.$router = this.$options.router  // 此时通过VueRouter.install()来调用，此时this指向VueRouter这个类，而不是Vue实例</span>        _Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// 此时能获取到Vue实例，this的指向为Vue实例</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 判断的作用是防止所有的组件都执行beforeCreate函数去注如</span>                    <span class="token class-name">_Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router  <span class="token comment">// 从传入的选项中获取router属性</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ----通过调用init方法来调用createRouteMap方法和initComponent方法</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options        <span class="token keyword">this</span><span class="token punctuation">.</span>routeMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> _Vue<span class="token punctuation">.</span><span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            current<span class="token operator">:</span> <span class="token string">'/'</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 包装createRouteMap方法和initComponent方法，便于在install方法中调用</span>    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initComponent</span><span class="token punctuation">(</span>_Vue<span class="token punctuation">)</span>  <span class="token comment">// 需要传入Vue的构造函数，此处直接传入全局变量_Vue</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 遍历所有路由规则，把路由规则解析成键值对的形式，并存储到routeMap中</span>    <span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>routeMap<span class="token punctuation">[</span>route<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> route<span class="token punctuation">.</span>component  <span class="token comment">// 键为route中的path，值为route中的component</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 创建initComponent方法，用来创建router-link组件。</span>    <span class="token function">initComponent</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 传入Vue构造器，减少对外部_Vue的依赖</span>        <span class="token comment">// 使用Vue.component方法创建组件</span>        Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'router-link'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>            props<span class="token operator">:</span> <span class="token punctuation">{</span>                to<span class="token operator">:</span> String            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token comment">// template: '&lt;a :href="to"&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/a&gt;'  // 使用:href绑定to的值，使用slot插槽用于放置router-link中间的内容</span>            <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// h函数三个参数：</span>                <span class="token comment">// 1.h函数创建元素对应的选择器，这里使用标签选择器</span>                <span class="token comment">// 2.给标签设置属性</span>                <span class="token comment">// 3.生成的元素中的子元素,当前a标签内容为slot默认插槽，</span>                <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    attrs<span class="token operator">:</span> <span class="token punctuation">{</span>                        href<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    on<span class="token operator">:</span> <span class="token punctuation">{</span>                        click<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clickHandler                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            methods<span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token function">clickHandler</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">// 参数data：触发popstate传给popstate事件对象的参数；title：网页标题；url：地址</span>                    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">)</span>                    <span class="token comment">// 加载路径对应的组件,将当前的路径记录到data.current中，</span>                    <span class="token comment">// 当this.$router.data.current改变后，会对应重新加载组件，并重新渲染到视图上</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>data<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to                    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 阻止a链接默认跳转事件</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span>        Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'router-view'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>            <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">/*                * render函数内部，先要找到当前路由的地址，再根据当前路由的地址去routerMap对象中找这个路由地址                * 对应的组件，然后再利用render函数把这个组件转换成Vue组件直接返回，render函数，还可以直接把一个组件转换成虚拟DOM。                * 当前路由地址：this.data.current,其中render方法中this指向方法内部，所以需要先保存VueRouter实例                * */</span>                <span class="token comment">// const component = self.routeMap[self.data.current]</span>                <span class="token comment">// return h(component)  // h函数会将组件转换为虚拟DOM并返回</span>                <span class="token comment">// 上面代码执行后，此时打开浏览器发现点击Home和About后，浏览器会刷新向服务器重新请求，</span>                <span class="token comment">// 所以还需要处理a链接的默认点击行为以及点击事件————改变地址栏</span>                <span class="token comment">// 在创建router-link中更改代码</span>                <span class="token keyword">const</span> component <span class="token operator">=</span> self<span class="token punctuation">.</span>routeMap<span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>current<span class="token punctuation">]</span>                <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span>  <span class="token comment">// h函数会将组件转换为虚拟DOM并返回</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">initEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>current <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue-Router </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.js基础回顾</title>
      <link href="2021/052341703.html"/>
      <url>2021/052341703.html</url>
      
        <content type="html"><![CDATA[<h1 id="一、Vue基础结构"><a href="#一、Vue基础结构" class="headerlink" title="一、Vue基础结构"></a>一、Vue基础结构</h1><p>Vue代码的基础结构：</p><ol><li>这是最基础的Vue代码，在创建Vue实例时，传入<code>el</code>和<code>data</code>选项，Vue内部会把<code>data</code>中的数据传入到<code>el</code>指向的模板中，并把模板渲染到浏览器。</li></ol><p><img src="http://5coder.cn/img/98EjT6puZt5nlBF.png" alt="image-20210523093150780"></p><ol start="2"><li>本段代码执行的效果与上面相同，这里使用了render选项和**$mount<strong>方法。使用</strong>Vue-cli<strong>脚手架创建的代码解构与下面的代码相同，</strong>render<strong>方法接受一个参数，参数为</strong>h<strong>函数，</strong>h<strong>函数在后面的笔记中会有详细的讲解，这里简单介绍一下，h函数的作用是创建虚拟dom，</strong>render<strong>方法把h函数创建的虚拟dom返回。​</strong>$mount**的作用是把虚拟dom转换成真实dom渲染到浏览器。</li></ol><p><img src="http://5coder.cn/img/TnFxfGS3zP5iYOV.png" alt="image-20210523093852667"></p><h1 id="二、Vue的生命周期"><a href="#二、Vue的生命周期" class="headerlink" title="二、Vue的生命周期"></a>二、Vue的生命周期</h1><p>下面给出vue生命周期图示，每个生命周期函数作用都会讲到。</p><p>每个 Vue 实例在被创建时都要经过一系列的初始化过程——例如，需要设置数据监听、编译模板、将实例挂载到 DOM 并在数据变化时更新 DOM 等。同时在这个过程中也会运行一些叫做<strong>生命周期钩子</strong>的函数，这给了用户在不同阶段添加自己的代码的机会。</p><p><img src="http://5coder.cn/img/9mk8PLyboMi6uwV.png" alt="20210323232204766.png"></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>数据更新<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg=<span class="token punctuation">'</span>No<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>h3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{msg}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      msg<span class="token operator">:</span> <span class="token string">'ok'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'show方法被调用'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log(this.msg)  // undefined</span>      <span class="token comment">// this.show()  // this.show is not a function</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log(this.msg)  // ok</span>      <span class="token comment">// this.show()  // show方法被调用</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log(document.getElementById('h3').innerHTML)  // {{msg}}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log(document.getElementById('h3').innerHTML)  // ok</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log(document.getElementById('h3').innerHTML)  // ok</span>      <span class="token comment">// console.log('data中的数据' + this.msg)  // No</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log('界面上的内容' + document.getElementById('h3').innerHTML)  // ok</span>      <span class="token comment">// console.log('data中的数据' + this.msg)  // ok</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="三、Vue语法和概念"><a href="#三、Vue语法和概念" class="headerlink" title="三、Vue语法和概念"></a>三、Vue语法和概念</h1><p>详细信息查看链接（Vue官方文档）</p><ol><li><p>插值表达式</p><ul><li><p>文本</p><p>数据绑定最常见的形式就是使用“Mustache”语法 (双大括号) 的文本插值：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>Message: {{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Mustache 标签将会被替代为对应数据对象上 <code>msg</code> property 的值。无论何时，绑定的数据对象上 <code>msg</code> property 发生了改变，插值处的内容都会更新。</p><p>通过使用 <a href="https://cn.vuejs.org/v2/api/#v-once">v-once 指令</a>，你也能执行一次性地插值，当数据改变时，插值处的内容不会更新。但请留心这会影响到该节点上的其它数据绑定：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-once</span><span class="token punctuation">&gt;</span></span>这个将不会改变: {{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li><li><p>指令（指令详细文档，请移步<a href="">这里</a>，官方文档在<a href="https://cn.vuejs.org/v2/guide/syntax.html#%E6%8C%87%E4%BB%A4">这里</a>）</p></li><li><p><a href="https://cn.vuejs.org/v2/guide/computed.html">计算属性和侦听器</a></p></li><li><p><a href="https://cn.vuejs.org/v2/guide/class-and-style.html">Class和Style绑定</a></p></li><li><p><a href="https://cn.vuejs.org/v2/guide/conditional.html">条件渲染</a>/<a href="https://cn.vuejs.org/v2/guide/list.html">列表渲染</a></p></li><li><p><a href="https://cn.vuejs.org/v2/guide/forms.html">表单输入绑定</a></p></li><li><p><a href="https://cn.vuejs.org/v2/guide/components.html">组件</a></p></li><li><p><a href="https://cn.vuejs.org/v2/guide/components-slots.html">插槽</a></p></li><li><p><a href="https://cn.vuejs.org/v2/guide/plugins.html">插件</a></p></li><li><p><a href="https://cn.vuejs.org/v2/guide/mixins.html">混入mixin</a></p></li><li><p><a href="https://cn.vuejs.org/v2/guide/reactivity.html">深入响应式原理</a></p></li><li><p><a href="https://cn.vuejs.org/v2/guide/migration.html">不同构建版本的Vue</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git与远程仓库链接</title>
      <link href="2021/052153620.html"/>
      <url>2021/052153620.html</url>
      
        <content type="html"><![CDATA[<ol><li>GitHub上创建空仓库（服务器创建空仓库），复制仓库地址</li><li>按照下图操作，将本地仓库与远程仓库链接</li><li><img src="http://5coder.cn/img/image-20210615061400980.png"></li><li>搞定，小白记录一下</li></ol>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小白NGINX</title>
      <link href="2021/052037541.html"/>
      <url>2021/052037541.html</url>
      
        <content type="html"><![CDATA[<p><em>Nginx 是一个采用主从架构的 Web 服务器，可用于反向代理、负载均衡器、邮件代理和 HTTP 缓存</em>。</p><p>Emmm，上面的 Nginx 介绍看过去有些复杂而且充满了不明觉厉的术语。Relax，在这篇文章里，我（原作者）会先带你理解 Nginx 的架构和专有术语，最后实践一把安装和配置 <strong>Nginx</strong>。</p><p><img src="http://5coder.cn/img/q7r9OEdkxBVuwln.jpg"></p><p>简单来说，你只要记住一点：<em>Nginx 是个神奇的 Web 服务器</em>。（注：神奇之处下文会娓娓道来）</p><p>那什么是 Web 服务器呢？简而言之，Web 服务器就是一个中间人。举个例子，你要访问 <code>hellogithub.com</code>（注：原文例子为 dev.to），在地址栏输入 <code>https://hellogithub.com</code> 时，你的浏览器会找到 <code>https://hellogithub.com</code> 的网络服务器地址并将它指向后端服务器，后端服务器再返回响应给客户端。</p><h2 id="代理-vs-反向代理"><a href="#代理-vs-反向代理" class="headerlink" title="代理 vs 反向代理"></a><strong>代理 vs 反向代理</strong></h2><p>Nginx 的基本特性是代理，所以你一定要明白什么是<strong>代理</strong>和<strong>反向代理</strong>。</p><h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a><strong>代理</strong></h3><p>看个小例子，现在我们有 N 个客户端（N &gt;= 1），一个中间 Web 服务器（在本例中，我们称之为代理）和一个服务器。这个例子主要的场景是，服务器不知道哪个客户端在请求（响应）。是不是有点难以理解？下面让我用示意图讲解下：</p><p><img src="http://5coder.cn/img/dHWV6JLXwz4rgmI.jpg"></p><p>如图，<em>client1</em> 和 <em>client2</em> 通过代理服务器向服务器发送请求 <em>request1</em> 和 <em>request2</em>，此时后端服务器不知道 <em>request1</em> 是由 <em>client1</em> 发送的还是 <em>client2</em> 发送的，但会执行（响应）操作。</p><h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a><strong>反向代理</strong></h3><p>简单来说，反向代理与代理的功能相反。现在我们有一个客户端、一个中间 Web 服务器和 N 个后端服务器（N &gt;= 1），同样的来看下示意图：</p><p><img src="http://5coder.cn/img/v2-2d5a169d1b6781b636e6fa27d7402399_b.jpg"></p><p>如图，客户端将通过 Web 服务器发送请求。而 Web 服务器会通过一个算法，当中最有意思的算法是轮询，直接将请求指向许多后端服务器中的一个，并通过 Web 服务器将响应返回给客户端。因此，在上面的例子中，客户端其实并不知道在与哪个后端服务器进行交互。</p><h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a><strong>负载均衡</strong></h2><p>又是枯燥的一个名词：负载均衡，不过它很好理解，因为负载均衡本身就是<strong>反向代理</strong>的一个实例。</p><p>来看看负载均衡和反向代理的本质区别。在负载均衡中，你必须有 2 个或者更多的后端服务器，但在反向代理中，多台服务器不是必需的，甚至一台后端服务器也能运作。我们再深入点，如果我们有很多来自客户端的请求，负载均衡器会检查每个后端服务器的状态，均匀地分配请求，更快地向客户端发送响应。</p><h2 id="有状态-vs-无状态应用"><a href="#有状态-vs-无状态应用" class="headerlink" title="有状态 vs 无状态应用"></a><strong>有状态 vs 无状态应用</strong></h2><p>Okay，在我们开始实践 Nginx 之前，先搞清所有的基本知识！</p><h3 id="有状态应用"><a href="#有状态应用" class="headerlink" title="有状态应用"></a><strong>有状态应用</strong></h3><p>有状态应用存了一个额外变量，只用来保存服务器中单个实例使用所需的信息。</p><p><img src="http://5coder.cn/img/8QLK1FxkDNntWyB.jpg"></p><p>如图所示，一个后端服务器 <em>server1</em> 存储了一些信息，服务器 <em>server2</em> 并不存储此信息，因此，客户端 (上图 Bob) 的交互可能会也可能不会得到想要的结果，因为它可能会与 <em>server1</em> 或 <em>server2</em> 交互。在本例中，<em>server1</em> 允许 Bob 查看数据文件，但 <em>server2</em> 不允许。因此，虽然有状态应用避免对数据库的多次 API 调用，并且（响应）速度更快，但它可能会在不同的服务器上导致这个（无法得到想要结果）问题。</p><h3 id="无状态应用"><a href="#无状态应用" class="headerlink" title="无状态应用"></a><strong>无状态应用</strong></h3><p>无状态应用有更多的数据库 API 调用，但当客户端与不同后端服务器的交互时，无状态应用却存在更少的问题。</p><p><img src="http://5coder.cn/img/XQiwhWptVSuzdvU.jpg"></p><p>没明白？简单来说，如果我通过 Web 服务器从客户端向后端服务器 <em>server1</em> 发送请求，它将向客户端返回一个令牌，用于任何进一步的访问请求。客户端可以使用令牌并向 Web 服务器发送请求。此 Web 服务器将请求连同令牌一起发送到任意后端服务器，而每个后端服务器都能提供相同的所需结果。</p><h2 id="Nginx-是什么"><a href="#Nginx-是什么" class="headerlink" title="Nginx 是什么?"></a><strong>Nginx 是什么?</strong></h2><p>Nginx 是网络服务器，到目前为止，我的整个博客一直在用这个网络服务器。老实说，Nginx 这就像个<strong>中间人</strong>。</p><p><img src="http://5coder.cn/img/v2-0502aeb476680bcae43090ec92467803_b.jpg"></p><p>这个图不难理解，它是目前为止所有概念的一个组合。在这里，我们有 3 个后端服务器运行在 3001、3002 和 3003 端口，这些后端服务器都能访问同一个运行在 5432 端口的数据库。</p><p>当一个客户端向 <code>https://localhost</code> （默认端口 443）发起一个 <code>GET /employees</code> 请求时，Nginx 将基于算法向任意后端服务器发送请求，从数据库获取数据并将 JSON 数据返回 Nginx Web 服务器再发送给客户端。</p><p>如果我们使用一个诸如轮询这样的算法，它让 <em>client2</em> 向 <code>https://localhost</code> 发送一个请求，然后 Nginx 服务器会先将请求传到 3000 端口并将响应返回给客户端。对另一个请求，Nginx 会把请求传给 3002 端口，以此类推。</p><p>知识储备完成！到这里，你对 Nginx 是什么以及 Nginx 所涉及的术语有了一个清晰的理解。是时候，了解安装和配置技术了。</p><h2 id="开始安装-Nginx"><a href="#开始安装-Nginx" class="headerlink" title="开始安装 Nginx"></a><strong>开始安装 Nginx</strong></h2><p>时机到了，如果你了解了上面的概念，可以动手开始 Nginx 实践了。</p><p><img src="http://5coder.cn/img/v2-dce888494829e097fdbe8e3695bb056a_b.jpg" alt="img"></p><p>嗯，Nginx 的安装过程对任何系统来说都很简单。我是一个 Mac OSX 用户，所以例子的命令是基于 macOS 的， <strong><a href="https://link.zhihu.com/?target=https://ubuntu.com/tutorials/install-and-configure-nginx%232-installing-nginx">Ubuntu</a><strong>、</strong><a href="https://link.zhihu.com/?target=https://www.maketecheasier.com/install-nginx-server-windows/">Windows</a></strong> 和其他 Linux 发行版操作和例子类似。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ brew install Nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>只要执行上面这步，你的系统就有 Nginx 了！是不是很神奇！</p><h3 id="运行-Nginx-如此简单"><a href="#运行-Nginx-如此简单" class="headerlink" title="运行 Nginx 如此简单"></a><strong>运行 Nginx 如此简单</strong></h3><p>要检查 Nginx 是否运行也很简单。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ nginx # OR $ sudo nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>执行上面指令，再打开浏览器并输入 <code>http://localhost:8080/</code> 回车查看下，你会看到以下画面！</p><p><img src="http://5coder.cn/img/v2-5e6766e81f555711aabf7a1cd1554fba_b.jpg" alt="img"></p><h2 id="Nginx-基本配置-amp-示例"><a href="#Nginx-基本配置-amp-示例" class="headerlink" title="Nginx 基本配置 &amp; 示例"></a><strong>Nginx 基本配置 &amp; 示例</strong></h2><p>下面，我们通过实操来感受下 Nginx 的魔力。</p><p>首先，在本地创建如下的目录结构:</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">.├── nginx-demo│  ├── content│  │  ├── first.txt│  │  ├── index.html│  │  └── index.md│  └── main│    └── index.html└── temp-nginx  └── outsider    └── index.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然，**.html** 和 <strong>.md</strong> 文件中要包含基本信息。</p><p><strong>我们想要得到什么呢？</strong></p><p>这里，我们有两个单独的文件夹 <code>nginx-demo</code> 和 <code>temp-nginx</code>，每个文件夹都包含静态 HTML 文件。我们将着力在一个公共端口上运行这两个文件夹，并设置我们想要的规则。</p><p>回到之前说的，如果要修改 Nginx 默认配置，得修改 <code>usr/local/etc/nginx</code> 目录下的 <code>nginx.conf</code>文件。我的系统中有 vim，所以在这里用 vim 来更改 Nginx 配置，你可以用自己的编辑器来修改配置。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ cd /usr/local/etc/nginx$ vim nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上面的命令会打开一个 Nginx 默认配置文件，我真的不想直接使用默认配置。因此，我通常的做法是复制这个配置文件，然后对主文件进行更改。这里也不例外。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ cp nginx.conf copy-nginx.conf$ rm nginx.conf &amp;&amp; vim nginx.conf <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上面命令将打开一个空文件，我们将为它添加配置。</p><ol><li><p>添加配置的基本设置。一定要添加 <code>events {}</code>，因为在 Nginx 架构中，它通常用来表示 worker 的数量。在这里我们用 <code>http</code> 告诉 Nginx 我们将在 <strong><a href="https://link.zhihu.com/?target=https://www.forcepoint.com/cyber-edu/osi-model">OSI 模型</a></strong> 的第 7 层作业。<br>这里，我们告诉 Nginx 监听 5000 端口，并指向 main 文件夹中的静态文件。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">http <span class="token punctuation">{</span> server <span class="token punctuation">{</span>   listen <span class="token number">5000</span><span class="token punctuation">;</span>   root /path/to/nginx-demo/main/<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>events <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>接下来我们将为 <code>/content</code> 和 <code>/outsider</code> URL 添加其他的规则，其中 <strong>outsider</strong> 将指向第一步中提到的根目录之外的目录。<br>这里的 <code>location /content</code>  表示无论我在叶（leaf）目录中定义了什么根（root），<strong>content</strong> 子 URL 都会被添加到定义的根 URL 的末尾。因此，当我指定 root 为 <code>root /path/to/nginx-demo/</code>时，这仅仅意味着我告诉 Nginx 在 <code>http://localhost:5000/path/to/nginx-demo/content/</code> 文件夹中显示静态文件的内容。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">http <span class="token punctuation">{</span> server <span class="token punctuation">{</span>     listen <span class="token number">5000</span><span class="token punctuation">;</span>     root /path/to/nginx-demo/main/<span class="token punctuation">;</span>       location /content <span class="token punctuation">{</span>         root /path/to/nginx-demo/<span class="token punctuation">;</span>      <span class="token punctuation">}</span>         location /outsider <span class="token punctuation">{</span>          root /path/temp-nginx/<span class="token punctuation">;</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>events <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  酷毙了！现在 Nginx 不仅能定义 URL 根路径，还可以设置规则，这样我们就能阻止客户端访问某个文件了。</p></li><li><p>接下来，我们在主服务器上编写一个规则来防止任意 <strong>.md</strong> 文件被访问。我们可以在 Nginx 中使用正则表达式，因此我们将这样定义规则：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">location ~ .md <span class="token punctuation">{</span>    <span class="token builtin class-name">return</span> <span class="token number">403</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>最后，让我们学习下 <code>proxy_pass</code> 命令来结束这个章节。我们已经了解了什么是代理和反向代理，在这里我们从定义另一个运行在 8888 端口上的后端服务器开始。现在，我们在 5000 和 8888 端口上运行了 2 个后端服务器。<br>我们要做的是，当客户端通过 Nginx 访问 8888 端口时，将这个请求传到 5000 端口，并将响应返回给客户端！</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">server <span class="token punctuation">{</span>    listen <span class="token number">8888</span><span class="token punctuation">;</span>    location / <span class="token punctuation">{</span>        proxy_pass http://localhost:5000/<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    location /new <span class="token punctuation">{</span>        proxy_pass http://localhost:5000/outsider/<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>看下，这是所有的配置信息  </p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">http <span class="token punctuation">{</span>    server <span class="token punctuation">{</span>        listen <span class="token number">5000</span><span class="token punctuation">;</span>        root /path/to/nginx-demo/main/<span class="token punctuation">;</span>         location /content <span class="token punctuation">{</span>            root /path/to/nginx-demo/<span class="token punctuation">;</span>        <span class="token punctuation">}</span>           location /outsider <span class="token punctuation">{</span>            root /path/temp-nginx/<span class="token punctuation">;</span>        <span class="token punctuation">}</span>                location ~ .md <span class="token punctuation">{</span>          <span class="token builtin class-name">return</span> <span class="token number">403</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>      server <span class="token punctuation">{</span>        listen <span class="token number">8888</span><span class="token punctuation">;</span>        location / <span class="token punctuation">{</span>            proxy_pass http://localhost:5000/<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        location /new <span class="token punctuation">{</span>            proxy_pass http://localhost:5000/outsider/<span class="token punctuation">;</span>        <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>events <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用 <code>sudo nginx</code> 来运行此配置。</p><h2 id="其他-Nginx-命令"><a href="#其他-Nginx-命令" class="headerlink" title="其他 Nginx 命令"></a><strong>其他 Nginx 命令</strong></h2><ol><li><p>首次启动 Nginx Web 服务器。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ nginx *<span class="token comment">#OR* $ sudo nginx</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>重新加载正在运行的 Nginx Web 服务器。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ nginx -s reload*<span class="token comment">#OR* $ sudo nginx -s reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>停止正在运行中的 Nginx Web 服务器。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ nginx -s stop*<span class="token comment">#OR* $ sudo nginx -s stop</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>查看系统上运行的 Nginx 进程。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> Nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p>第 4 条命令很重要，如果前 3 条命令产生了一些问题，通常你可以用第 4 条命令找到所有正在运行的 Nginx 进程并杀死进程，然后重新启动它们。</p><p>要杀死一个进程，你需要 PID，再用以下命令杀死它：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">kill</span> -9 <span class="token operator">&lt;</span>PID<span class="token operator">&gt;</span><span class="token comment">#OR $ sudo kill -9 &lt;PID&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>结束本文之前，声明下，文中我用了些来自 Google 的图片和 <strong><a href="https://link.zhihu.com/?target=https://www.youtube.com/user/GISIGeometry">Hussein Nasser</a></strong> 发布在油管的视频教程。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>什么是VLAN</title>
      <link href="2021/052058690.html"/>
      <url>2021/052058690.html</url>
      
        <content type="html"><![CDATA[<h3 id="什么是VLAN"><a href="#什么是VLAN" class="headerlink" title="什么是VLAN"></a><strong>什么是VLAN</strong></h3><p>VLAN中文是“虚拟局域网”。LAN可以是由少数几台家用计算机构成的网络，也可以是数以百计的计算机构成的企业网络。VLAN所指的LAN特指使用路由器分割的网络——也就是广播域。</p><p>听上面的概念，肯定有不少朋友是一头雾水的，什么是虚拟局域网？好好的，为什么要划分vlan？</p><p><strong>这里举个例：通俗的了解</strong></p><p>一所高中，新学期高一招了800个学生，这800个学生，如果放在一个班里，那肯定是管理不过来，面对800个人，老师看了也头疼，这边在授课，那边完全听不到，老师布置什么任务，也会有一些传达不到，老师要是想找某个学生的信息，要从800份信息中去找，极其麻烦，浪费时间；</p><p>而实际中，也是一样，电脑A要想要与电脑B通信，于是电脑A就需要发送arp请求，而网络中电脑众多，最终ARP请求会被转发到同一网络中的所有电脑，才能找到电脑B，如此一来，为了找到电脑B，消耗了网络整体的带宽，收到广播信息的计算机还要消耗一部分CPU时间来对它进行处理。造成了网络带宽和CPU运算能力的大量无谓消耗。</p><p><strong>那么怎么办呢？</strong></p><p>学校就针对这800个学生，分成了10个班，每个班80人，分别命名为高一（1）班，高一（2）班 ··· 高一（10）班，每个人都会获得一个班级编号。</p><p>1101表示一班01号学生。</p><p>1102表示一班02号学生。</p><p>1201表示2班01号学生。</p><p>同一个班的学生编号尾数不同，其它的都相同。</p><p>那么这样老师再管理起来就轻松多了，可以把一班这80人管理的妥妥的，隔壁2班与3班乱成一锅粥也不管一班的事，我就要这一班80人好好上课就行。</p><p>这就是vlan，每个班就相当于一个vlan，而每个班名称，就相当于vlan的名称，而每个学生的编号就是ip地址；同班同学（同一个vlan的ip），因为同一个教室，朝夕相处，且可以相互通信，不同班的同学，若不做其它工作，很难往来通信。</p><p>所以同一个vlan间，可以相互通信；不同vlan，若不做配置，不能相互通信。</p><p>那么不同vlan如何通通信呢？就需要单臂路由与三层交换机。</p><h3 id="单臂路由与三层交换机"><a href="#单臂路由与三层交换机" class="headerlink" title="单臂路由与三层交换机"></a><strong>单臂路由与三层交换机</strong></h3><p>我们知道要实现不同vlan间通信，就必须需要有路由功能，不同VLAN之间相互通信的两种方式（单臂路由、三层交换机）。</p><p><strong>什么是单臂路由？</strong></p><p>单臂路由的实现方式，其实就是普通二层交换机加路由器，从而实现不同vlan间的可以互相通信。</p><p><img src="http://5coder.cn/img/sXF6iOJ5BpS4kNC.jpg"></p><p><strong>那什么是三层交换机呢？</strong></p><p>对于小型的网络，单臂路由可以应付，但随着VLAN之间流量的不断增加，很可能导致路由器成为整个网络的瓶颈，出现掉包、或者通信堵塞。</p><p>为了解决上述问题，三层交换机应运而生。三层交换机，本质上就是“带有路由功能的（二层）交换机”。路由属于OSI参照模型中第三层网络层的功能，因此带有第三层路由功能的交换机才被称为“三层交换机”。</p><p>关于三层交换机的内部结构，可以参照下面的简图。</p><p><img src="http://5coder.cn/img/QNSoe1xaEkpODib.jpg"></p><p>在一台本体内，分别设置了交换机模块和路由器模块；而内置的路由模块与交换模块相同，使用ASIC硬件处理路由。因此，与传统的路由器相比，可以实现高速路由。并且，路由与交换模块是汇聚链接的，由于是内部连接，可以确保相当大的带宽，所以对于正规的项目，需要使用三层交换机来实现网网络间的通信。</p><h3 id="什么是网关"><a href="#什么是网关" class="headerlink" title="什么是网关"></a><strong>什么是网关</strong></h3><p>在了解了vlan与三层交换机后，能不能通信，还需要看网关是否正确。</p><h3 id="什么是网关-1"><a href="#什么是网关-1" class="headerlink" title="什么是网关"></a><strong>什么是网关</strong></h3><p>网关(Gateway)又称网间连接器、协议转换器。网关在传输层上以实现网络互连，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连。</p><h3 id="如何来理解网关"><a href="#如何来理解网关" class="headerlink" title="如何来理解网关"></a><strong>如何来理解网关</strong></h3><p>大家都知道，从一个房间走到另一个房间，必然要经过<strong>一扇门</strong>。同样，从一个网络向另一个网络发送信息，也必须经过一道“关口”，这道关口就是网关。顾名思义，网关(Gateway)就是一个网络连接到另一个网络的“<strong>关口</strong>”。</p><p>按照不同的分类标准，网关也有很多种。TCP/IP协议里的网关是最常用的，在这里我们所讲的“网关”均指TCP/IP协议下的网关。</p><h3 id="网关的ip地址"><a href="#网关的ip地址" class="headerlink" title="网关的ip地址"></a><strong>网关的ip地址</strong></h3><p><strong>那么网关到底是什么呢？</strong></p><p>网关实质上是一个网络通向其他网络的IP地址，网关在网段内的可用<strong>ip中选一个</strong>，不过，一般用的是<strong>第1个和最后一个</strong>。</p><p><strong>例如</strong></p><blockquote><p>比如有网络A和网络B，<br><strong>网络A：</strong>的IP地址范围为“192.168.1.1~192. 168.1.254”，子网掩255.255.255.0；<br>如果需要与其它网段通信，那么它的网关可以设置为192.168.1.1，当然也可以设置为<strong>网段内</strong>其它的一个ip地址。</p><p><strong>网络B：</strong>的IP地址范为“192.168.2.1~192.168.2.254”，子网掩码255.255.255.0。<br>如果需要与其它网段通信，那么它的网关可以设置为192.168.2.1，当然也可以设置为<strong>网段内</strong>其它的一个ip地址。</p></blockquote><p><img src="http://5coder.cn/img/FdwNiZLtQoepXMD.jpg"></p><h3 id="网关是如何实现通信？"><a href="#网关是如何实现通信？" class="headerlink" title="网关是如何实现通信？"></a><strong>网关是如何实现通信？</strong></h3><p>在没有<strong>路由器</strong>的情况下，不同的两个网络之间是<strong>不能</strong>进行TCP/IP通信的，即使是两个网络连接在同一台交换机(或集线器)上，TCP/IP协议也会根据子网掩码(255.255.255.0)判定两个网络中的主机处在不同的网络里。而要实现这两个网络之间的通信，则<strong>必须通过网关</strong>。</p><p>如果<strong>网络A</strong>中的主机发现<strong>数据包</strong>的目的主机<strong>不在</strong>本地网络中，就把数据包转发给它<strong>自己的网关</strong>，再由网关转发给网络B的网关，网络B的网关再转发给网络B的某个主机(如附图所示)。网络B向网络A转发数据包的过程。</p><p>所以说，只有设置好网关的<strong>IP地址</strong>，TCP/IP协议才能实现不同网络之间的相互通信。</p><h3 id="什么是默认网关？"><a href="#什么是默认网关？" class="headerlink" title="什么是默认网关？"></a><strong>什么是默认网关？</strong></h3><p>如果搞清了什么是网关，默认网关也就好理解了。就好像一个房间可以有多扇门一样，一台主机可以有多个网关。<strong>默认网关</strong>的意思是一台主机如果找不到可用的网关，就把数据包发给默认<strong>指定的网关</strong>，由这个网关来处理数据包。现在<strong>主机</strong>使用的网关，一般指的是默认网关。 </p><h3 id="什么是DNS"><a href="#什么是DNS" class="headerlink" title="什么是DNS"></a><strong>什么是DNS</strong></h3><p>DNS是域名解析服务器（Domain Name System），是把网址变成IP地址的服务器。</p><p>DNS说白了是把域名翻译成IP地址用的，这里面<strong>举个例子</strong>，大家就很容易清楚了。</p><p>例如我们在浏览器里面输入<a href="https://zhuanlan.zhihu.com/www.baidu.com">www.baidu.com</a>的时候，机器要跟百度这个网站进行<strong>通信</strong>，机器要往外面<strong>发送</strong>数据包，数据包里面要写百度这台服务器的IP地址，我们不知道<strong>IP地址</strong>是多少，那么就需要主机<strong>问DNS服务器</strong>，DNS服务器就自动帮我们把<a href="https://zhuanlan.zhihu.com/www.baidu.com">www.baidu.com</a>这个域名<strong>翻译成</strong>了IP地址61.135.169.105。然后写到了数据包的目的IP地址里面就可以进行通信。</p><p>就跟我们写信一样，你得写个收信人的<strong>地址</strong>邮局才能给你发送吧，你给国外写信，你写中文地址邮局不认识，需要这个一个人帮你翻译成英语。这就是DNS的作用，所以你的在本地连接里面写DNS才可以正常浏览网页，如果不设置DNS，是无法正常访问网页的。</p><h3 id="MAC地址"><a href="#MAC地址" class="headerlink" title="MAC地址"></a><strong>MAC地址</strong></h3><p>讲到MAC地址，就不得不提ip地址，这里顺便把ip地址也说下。</p><p><strong>IP与MAC</strong></p><p>虽然现在已经ipv6了，但我们基本用的大多数还是ipv4协议，所谓ip就是你电脑整个<strong>网络的编号</strong>。其他电脑想访问电脑就得需要这个编号。但是这个编号很多情况下是一直在<strong>变化</strong>的。唯一不变的是你的MAC地址：<strong>物理地址</strong>。</p><p>MAC是网络中用来标识网卡设备的唯一网络地址。由相关硬件制造商统一分配，每台电脑的MAC地址都是<strong>唯一</strong>的。</p><p>做个比喻，你经常搬家，你没搬一次家都有一个地址，XX小区XX单元XX号，这个就是IP。但是你的名字不变，这个就是MAC，不同的是我们的<strong>MAC不允许重名</strong>。</p><p><img src="http://5coder.cn/img/a29fgLdsZJrPp6A.jpg"></p><p>我们的<strong>IP分为两个部分</strong>：如上图分为<strong>网络部分</strong>和<strong>主机部分</strong>。网络部分好比就是你在XX省XX市XX镇，这个是国家固定下来了的。但是XX小区XX单元XX号是开发商自己定的。两个编号加起来就是你的ip了。不同的是在现实中两个编号的长度是固定的，在网络上A、B、C、D的ip地址却是变化的，这个在前天有详细讲到。</p><h3 id="MAC地址-1"><a href="#MAC地址-1" class="headerlink" title="MAC地址"></a><strong>MAC地址</strong></h3><p>子网掩码是为了区分网络位和主机位，上面我们说到过，一个ip地址是由<strong>网络部分</strong>和<strong>主机部分</strong>。正如一个人的名字由姓与名组成。</p><p>那么我们可以把IP地址比作一个人的名字，那么子网掩码就像是一份名单，可以快速的知道那些人同姓，那些人不同姓，把同姓的人分在一组，让他们之前可以互相交流。</p><blockquote><p><strong>举个例子</strong><br><strong>有一个网段</strong>是192.168.1.0-192.168.1.254，这个网段就像一个村子一样，就称它为<strong>安防村</strong>，此这网段有个ip地址是192.168.1.1，我们就叫他安防一，另外一个人叫安防二，它的ip地址为192.168.1.2，我们一看他们，就知道他们是同村的。</p><p><strong>另外有一个网段，</strong>是192.168.0.0——192.168.255.254，我们叫它<strong>安村</strong>，村里有个同样有两个ip地址为92.168.1.1与192.168.1.2，也叫安防一，安防二，那么问题来了？这个时候，如何区分他们是属于那个村的？<br>这个时候就需要<strong>子网掩码</strong>了来判断他们是属于那个网段的，需要把安防一、安防二带到村里去认下，就知道他们是属于那个村了，<strong>安防村</strong>的网段是255.255.255.0，<strong>安村</strong>的网段是255.255.0.0。</p><p>网络中也会出现类似于“同名”“同姓”的ip地址，如何区分他们到底是属于那个网段，就需要依靠子网掩码了。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 网络 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VLAN </tag>
            
            <tag> DNS </tag>
            
            <tag> 网关 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从ES6到ES10的新特性万字大总结</title>
      <link href="2021/052021044.html"/>
      <url>2021/052021044.html</url>
      
        <content type="html"><![CDATA[<h1 id="从ES6到ES10的新特性万字大总结"><a href="#从ES6到ES10的新特性万字大总结" class="headerlink" title="从ES6到ES10的新特性万字大总结"></a>从ES6到ES10的新特性万字大总结</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h2><p>ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会）在标准ECMA-262中定义的脚本语言规范。这种语言在万维网上应用广泛，它往往被称为JavaScript或JScript，但实际上后两者是ECMA-262标准的实现和扩展。</p><p><strong>历史版本</strong></p><p><strong>至发稿日为止有九个ECMA-262版本发表。其历史版本如下：</strong></p><ol><li>1997年6月：第一版</li><li>1998年6月：修改格式，使其与ISO/IEC16262国际标准一样</li><li>1999年12月：强大的正则表达式，更好的词法作用域链处理，新的控制指令，异常处理，错误定义更加明确，数据输出的格式化及其它改变</li><li>2009年12月：添加严格模式(<code>"use strict"</code>)。修改了前面版本模糊不清的概念。增加了getters，setters，JSON以及在对象属性上更完整的反射。</li><li>2011年6月：ECMAScript标5.1版形式上完全一致于国际标准ISO/IEC 16262:2011。</li><li>2015年6月：ECMAScript 2015（ES2015），第 6 版，最早被称作是 ECMAScript 6（ES6），添加了类和模块的语法，其他特性包括迭代器，Python风格的生成器和生成器表达式，箭头函数，二进制数据，静态类型数组，集合（maps，sets 和 weak maps），promise，reflection 和 proxies。作为最早的 ECMAScript Harmony 版本，也被叫做ES6 Harmony。</li><li>2016年6月：ECMAScript 2016（ES2016），第 7 版，多个新的概念和语言特性。</li><li>2017年6月：ECMAScript 2017（ES2017），第 8 版，多个新的概念和语言特性。</li><li>2018年6月：ECMAScript 2018 （ES2018），第 9 版，包含了异步循环，生成器，新的正则表达式特性和 rest/spread 语法。</li><li>2019年6月：ECMAScript 2019 （ES2019），第 10 版。</li></ol><h2 id="2-发展标准"><a href="#2-发展标准" class="headerlink" title="2.发展标准"></a>2.发展标准</h2><p>TC39（Technical Committee 39）是一个推动JavaScript发展的委员会，它的成语来自各个主流浏览器的代表成语。会议实行多数决，每一项决策只有大部分人同意且没有强烈反对才能去实现。</p><p>TC39成员制定着ECMAScript的未来。</p><p>每一项新特性最终要进入到ECMAScript规范里，需要经历5个阶段，这5个阶段如下：</p><ul><li><strong>Stage 0</strong>: Strawperson<br>只要是TC39成员或者贡献者，都可以提交想法</li><li><strong>Stage 1</strong>: Proposal<br>这个阶段确定一个正式的提案</li><li><strong>Stage 2</strong>: draft<br>规范的第一个版本，进入此阶段的提案大概率会成为标准</li><li><strong>Stage 3</strong>: Candidate<br>进一步完善提案细则</li><li><strong>Stage 4</strong>: Finished<br>表示已准备好将其添加到正式的ECMAScript标准中</li></ul><p><strong>由于ES6以前的属性诞生年底久远，我们使用也比较普遍，遂不进行说明，ES6之后的语言风格跟ES5以前的差异比较大，所以单独拎出来做个记录。</strong></p><p>ES6(ES2015)</p><p>ES6是一次重大的革新，比起过去的版本，改动比较大，本文仅对常用的API以及语法糖进行讲解。</p><p>Let 和 Const</p><p>在ES6以前，<code>JS</code>只有<code>var</code>一种声明方式，但是在ES6之后，就多了<code>let</code>跟<code>const</code>这两种方式。用<code>var</code>定义的变量没有块级作用域的概念，而<code>let</code>跟<code>const</code>则会有，因为这三个关键字创建是不一样的。</p><p>区别如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">{</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span>    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">20</span>    <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">}</span>a <span class="token comment">// 10</span>b <span class="token comment">// Uncaught ReferenceError: b is not defined</span>c <span class="token comment">// c is not defined</span><span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token number">40</span><span class="token keyword">const</span> e <span class="token operator">=</span> <span class="token number">50</span>d <span class="token operator">=</span> <span class="token number">60</span>d <span class="token comment">// 60</span>e <span class="token operator">=</span> <span class="token number">70</span> <span class="token comment">// VM231:1 Uncaught TypeError: Assignment to constant variable.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/xu1SIUeEoKasc7V.png" alt="img"></p><h2 id="3-类（Class）"><a href="#3-类（Class）" class="headerlink" title="3.类（Class）"></a>3.类（Class）</h2><p>在ES6之前，如果我们要生成一个实例对象，传统的方法就是写一个构造函数，例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">}</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">information</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">'My name is '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">', I am '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是在ES6之后，我们只需要写成以下形式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age    <span class="token punctuation">}</span>    <span class="token function">information</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">'My name is '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">', I am '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-箭头函数（Arrow-function）"><a href="#4-箭头函数（Arrow-function）" class="headerlink" title="4.箭头函数（Arrow function）"></a>4.箭头函数（Arrow function）</h2><p>箭头函数表达式的语法比函数表达式更简洁，并且没有自己的<code>this</code>，<code>arguments</code>，<code>super</code>或 <code>new.target</code>。这些函数表达式更适用于那些本来需要匿名函数的地方，并且它们不能用作构造函数。</p><p>在ES6以前，我们写函数一般是：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token keyword">var</span> newList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> item <span class="token operator">*</span> item<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>但是在ES6里，我们可以：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token keyword">const</span> newList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">*</span> item<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>看，是不是简洁了不少</p><h2 id="5-函数参数默认值（Function-parameter-defaults）"><a href="#5-函数参数默认值（Function-parameter-defaults）" class="headerlink" title="5.函数参数默认值（Function parameter defaults）"></a>5.函数参数默认值（Function parameter defaults）</h2><p>在ES6之前，如果我们写函数需要定义初始值的时候，需要这么写：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">config</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> data <span class="token operator">=</span> data <span class="token operator">||</span> <span class="token string">'data is empty'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这样看起来也没有问题，但是如果参数的布尔值为<strong>false</strong>时就会出问题，例如我们这样调用config：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">config</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>那么结果就永远是后面的值</p><p>如果我们用函数参数默认值就没有这个问题，写法如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">(</span>data <span class="token operator">=</span> <span class="token string">'data is empty'</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="6-模板字符串（Template-string）"><a href="#6-模板字符串（Template-string）" class="headerlink" title="6.模板字符串（Template string）"></a>6.模板字符串（Template string）</h2><p>在ES6之前，如果我们要拼接字符串，则需要像这样：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'kris'</span><span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">24</span>var info <span class="token operator">=</span> <span class="token string">'My name is '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">', I am '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是在ES6之后，我们只需要写成以下形式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'kris'</span><span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">24</span>const info <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">My name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="7-解构赋值（Destructuring-assignment）"><a href="#7-解构赋值（Destructuring-assignment）" class="headerlink" title="7.解构赋值（Destructuring assignment）"></a>7.解构赋值（Destructuring assignment）</h2><p>我们通过解构赋值, 可以将属性/值从对象/数组中取出,赋值给其他变量。</p><ul><li><p>数组解构赋值</p><p>比如我们需要交换两个变量的值，在ES6之前我们可能需要：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span>var b <span class="token operator">=</span> <span class="token number">20</span>var temp <span class="token operator">=</span> aa <span class="token operator">=</span> bb <span class="token operator">=</span> temp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是在ES6里，我们有：</p><pre class="line-numbers language-JavaScript" data-language="JavaScript"><code class="language-JavaScript">let a = 10let b = 20[a, b] = [b, a]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token comment">// 数组的解构赋值let [a, b, c] = [, 123, ]  // 数组的解构赋值,未赋值的变量为undefinedlet [a = 123, b, c] = [, 456, 789]  // a使用默认值</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>对象的解构赋值</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// let {foo, bar} = {foo: 'hello', bar: 'world'}let {foo, bar} = {bar: 'world', foo: 'hello'}console.log(foo, bar)  // hello world,把对应属性的名字赋值给前面的变量,与顺序无关// 对象属性别名（如果有了别名，原来的名字就无效了）let {foo:qux, bar:baz} = {foo: 'hello', bar: 'world'}console.log(qux, baz)  // hello world,此时foo以及bar已经不能使用// 对象默认值解构赋值(既设置别名，又设置默认值)let {foo:qux='hi', bar:baz} = {foo: 'hello', bar: 'world'}console.log(qux)  // hi// 内置对象let {cos, sin, random} = Mathconsole.log(typeof cos)  // functionconsole.log(typeof sin)  // functionconsole.log(typeof random)  // function</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>字符串的解构赋值</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'hello'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment">// hconsole.log(b)  // econsole.log(c)  // lconsole.log(d)  // lconsole.log(e)  // oconsole.log(length)  // undefinedconsole.log("hello".length)// 获取字符串的长度let {length} = "nihao"console.log(length)  // 5</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h2 id="8-模块化（Module）"><a href="#8-模块化（Module）" class="headerlink" title="8.模块化（Module）"></a>8.模块化（Module）</h2><p>在ES6之前，JS并没有模块化的概念，有的也只是社区定制的类似CommonJS和AMD之类的规则。例如基于CommonJS的NodeJS：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// circle.js// 输出const { PI } = Mathexports.area = (r) =&gt; PI * r ** 2exports.circumference = (r) =&gt; 2 * PI * r// index.js// 输入const circle = require('./circle.js')console.log(`半径为 4 的圆的面积是 ${circle.area(4)}`)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在ES6之后我们则可以写成以下形式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// circle.js// 输出const { PI } = Mathexport const area = (r) =&gt; PI * r ** 2export const circumference = (r) =&gt; 2 * PI * r// index.js// 输入import {    area} = './circle.js'console.log(`半径为 4 的圆的面积是: ${area(4)}`)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="9-扩展操作符（Spread-operator）"><a href="#9-扩展操作符（Spread-operator）" class="headerlink" title="9.扩展操作符（Spread operator）"></a>9.扩展操作符（Spread operator）</h2><p>扩展操作符可以在函数调用/数组构造时, 将数组表达式或者string在语法层面展开；还可以在构造字面量对象时, 将对象表达式按key-value的方式展开。</p><p>比如在ES5的时候，我们要对一个数组的元素进行相加，在不使用<code>reduce</code>或者<code>reduceRight</code>的场合，我们需要：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token keyword">var</span> total <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是如果我们使用扩展操作符，只需要如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y <span class="token operator">+</span> zconst list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token keyword">const</span> total <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token operator">...</span>list<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>非常的简单，但是要注意的是扩展操作符只能用于可迭代对象</p><p>如果是下面的情况，是会报错的：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'key1'</span><span class="token operator">:</span> <span class="token string">'value1'</span><span class="token punctuation">}</span><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>obj<span class="token punctuation">]</span> <span class="token comment">// TypeError: obj is not iterable</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>对象属性简写（Object attribute shorthand）</p><p>在ES6之前，如果我们要将某个变量赋值为同样名称的对象元素，则需要：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> cat <span class="token operator">=</span> <span class="token string">'Miaow'</span><span class="token keyword">var</span> dog <span class="token operator">=</span> <span class="token string">'Woof'</span><span class="token keyword">var</span> bird <span class="token operator">=</span> <span class="token string">'Peet peet'</span><span class="token keyword">var</span> someObject <span class="token operator">=</span> <span class="token punctuation">{</span>  cat<span class="token operator">:</span> cat<span class="token punctuation">,</span>  dog<span class="token operator">:</span> dog<span class="token punctuation">,</span>  bird<span class="token operator">:</span> bird<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是在ES6里我们就方便很多：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> cat <span class="token operator">=</span> <span class="token string">'Miaow'</span><span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token string">'Woof'</span><span class="token keyword">let</span> bird <span class="token operator">=</span> <span class="token string">'Peet peet'</span><span class="token keyword">let</span> someObject <span class="token operator">=</span> <span class="token punctuation">{</span>  cat<span class="token punctuation">,</span>  dog<span class="token punctuation">,</span>  bird<span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>someObject<span class="token punctuation">)</span><span class="token comment">//{//  cat: "Miaow",//  dog: "Woof",//  bird: "Peet peet"//}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>非常方便</p><h2 id="10-Promise"><a href="#10-Promise" class="headerlink" title="10.Promise"></a>10.Promise</h2><p>Promise 是ES6提供的一种异步解决方案，比回调函数更加清晰明了。</p><p><code>Promise</code> 翻译过来就是承诺的意思，这个承诺会在未来有一个确切的答复，并且该承诺有三种状态，分别是：</p><ol><li>等待中（pending）</li><li>完成了 （resolved）</li><li>拒绝了（rejected）</li></ol><p>这个承诺一旦从等待状态变成为其他状态就永远不能更改状态了，也就是说一旦状态变为 resolved 后，就不能再次改变</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>  <span class="token comment">// 无效  reject('reject')})</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当我们在构造<code>Promise</code>的时候，构造函数内部的代码是立即执行的</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'new Promise'</span><span class="token punctuation">)</span>  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finifsh'</span><span class="token punctuation">)</span><span class="token comment">// new Promise -&gt; finifsh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Promise</code>实现了链式调用，也就是说每次调用<code>then</code>之后返回的都是一个<code>Promise</code>，并且是一个全新的<code>Promise</code>，原因也是因为状态不可变。如果你在<code>then</code>中 使用了<code>return</code>，那么<code>return</code>的值会被<code>Promise.resolve()</code>包装</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// =&gt; 1    return 2 // 包装成 Promise.resolve(2)  })  .then(res =&gt; {    console.log(res) // =&gt; 2  })</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当然了，<code>Promise</code>也很好地解决了回调地狱的问题，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 处理逻辑    ajax(url1, () =&gt; {        // 处理逻辑        ajax(url2, () =&gt; {            // 处理逻辑        })    })})</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以改写成：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url1<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url2<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>for…of</strong></p><p><code>for...of</code>语句在可迭代对象（包括 <code>Array，Map，Set，String，TypedArray，arguments</code> 对象等等）上创建一个迭代循环，调用自定义迭代钩子，并为每个不同属性的值执行语句。</p><p>例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> element <span class="token keyword">of</span> array1<span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// "a"// "b"// "c"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Symbol</strong></p><p><strong>symbol</strong> 是一种基本数据类型，<code>Symbol()</code>函数会返回<strong>symbol</strong>类型的值，该类型具有静态属性和静态方法。它的静态属性会暴露几个内建的成员对象；它的静态方法会暴露全局的symbol注册，且类似于内建对象类，但作为构造函数来说它并不完整，因为它不支持语法：”<code>new Symbol()</code>“。</p><p>每个从<code>Symbol()</code>返回的symbol值都是唯一的。一个symbol值能作为对象属性的标识符；这是该数据类型仅有的目的。</p><p>例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> symbol1 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> symbol2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> symbol3 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> symbol1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "symbol"console.log(symbol3.toString()); // "Symbol(foo)"console.log(Symbol('foo') === Symbol('foo')); // false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="11-迭代器（Iterator）-生成器（Generator）"><a href="#11-迭代器（Iterator）-生成器（Generator）" class="headerlink" title="11.迭代器（Iterator）/ 生成器（Generator）"></a>11.迭代器（Iterator）/ 生成器（Generator）</h2><p>迭代器（Iterator）是一种迭代的机制，为各种不同的数据结构提供统一的访问机制。任何数据结构只要内部有 Iterator 接口，就可以完成依次迭代操作。</p><p>一旦创建，迭代器对象可以通过重复调用next()显式地迭代，从而获取该对象每一级的值，直到迭代完，返回<code>{ value: undefined, done: true }</code></p><p>虽然自定义的迭代器是一个有用的工具，但由于需要显式地维护其内部状态，因此需要谨慎地创建。生成器函数提供了一个强大的选择：它允许你定义一个包含自有迭代算法的函数， 同时它可以自动维护自己的状态。 生成器函数使用 <code>function*</code>语法编写。 最初调用时，生成器函数不执行任何代码，而是返回一种称为Generator的迭代器。 通过调用生成器的下一个方法消耗值时，Generator函数将执行，直到遇到yield关键字。</p><p>可以根据需要多次调用该函数，并且每次都返回一个新的Generator，但每个Generator只能迭代一次。</p><p>所以我们可以有以下例子：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">makeRangeIterator</span><span class="token punctuation">(</span><span class="token parameter">start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token number">Infinity</span><span class="token punctuation">,</span> step <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> end<span class="token punctuation">;</span> i <span class="token operator">+=</span> step<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">yield</span> i<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">makeRangeIterator</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// {value: 1, done: false}a.next() // {value: 3, done: false}a.next() // {value: 5, done: false}a.next() // {value: 7, done: false}a.next() // {value: 9, done: false}a.next() // {value: undefined, done: true}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Set/WeakSet</strong></p><p><code>Set</code> 对象允许你存储任何类型的唯一值，无论是原始值或者是对象引用。</p><p>所以我们可以通过<code>Set</code>实现数组去重</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [2, 3, 4, 5, 6, 7, 32]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>WeakSet</code> 结构与 <code>Set</code> 类似，但区别有以下两点：</p><ul><li><code>WeakSet</code> 对象中只能存放对象引用, 不能存放值, 而 <code>Set</code> 对象都可以。</li><li><code>WeakSet</code> 对象中存储的对象值都是被弱引用的, 如果没有其他的变量或属性引用这个对象值, 则这个对象值会被当成垃圾回收掉. 正因为这样, <code>WeakSet</code> 对象是无法被枚举的, 没有办法拿到它包含的所有元素。</li></ul><p>所以代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>ws<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span>ws<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>ws<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span> <span class="token comment">// truews.has(foo)    // false, 对象 foo 并没有被添加进 ws 中 ws.delete(window) // 从集合中删除 window 对象ws.has(window)    // false, window 对象已经被删除了ws.clear() // 清空整个 WeakSet 对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="12-Map-WeakMap"><a href="#12-Map-WeakMap" class="headerlink" title="12.Map/WeakMap"></a>12.Map/WeakMap</h2><p><code>Map</code> 对象保存键值对。任何值(对象或者原始值) 都可以作为一个键或一个值。</p><p>例子如下，我们甚至可以使用<code>NaN</code>来作为键值：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> myMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>myMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token string">"not a number"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>myMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "not a number"var otherNaN = Number("foo");myMap.get(otherNaN); // "not a number"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>WeakMap</code> 对象是一组键/值对的集合，其中的键是弱引用的。其键必须是对象，而值可以是任意的。</p><p>跟<code>Map</code>的区别与<code>Set</code>跟<code>WeakSet</code>的区别相似，具体代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> wm1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    wm2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    wm3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> o1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function-variable function">o2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    o3 <span class="token operator">=</span> window<span class="token punctuation">;</span>wm1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">;</span>wm1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>o2<span class="token punctuation">,</span> <span class="token string">"azerty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>wm2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// value可以是任意值,包括一个对象wm2.set(o3, undefined);wm2.set(wm1, wm2); // 键和值可以是任意对象,甚至另外一个WeakMap对象wm1.get(o2); // "azerty"wm2.get(o2); // undefined,wm2中没有o2这个键wm2.get(o3); // undefined,值就是undefinedwm1.has(o2); // truewm2.has(o2); // falsewm2.has(o3); // true (即使值是undefined)wm3.set(o1, 37);wm3.get(o1); // 37wm3.clear();wm3.get(o1); // undefined,wm3已被清空wm1.has(o1);   // truewm1.delete(o1);wm1.has(o1);   // false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Proxy/Reflect</strong></p><p><code>Proxy</code> 对象用于定义基本操作的自定义行为（如属性查找，赋值，枚举，函数调用等）。</p><p><code>Reflect</code> 是一个内置的对象，它提供拦截 JavaScript 操作的方法。这些方法与 <code>Proxy</code> 的方法相同。<code>Reflect</code>不是一个函数对象，因此它是不可构造的。</p><p><code>Proxy</code>跟<code>Reflect</code>是非常完美的配合，例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">observe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>            <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> proxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token function">callback</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>                  target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>                    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> proxy<span class="token punctuation">)</span>            <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> FooBar <span class="token operator">=</span> <span class="token punctuation">{</span> open<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> FooBarObserver <span class="token operator">=</span> <span class="token function">observe</span><span class="token punctuation">(</span>FooBar<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">property<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  property <span class="token operator">===</span> <span class="token string">'open'</span> <span class="token operator">&amp;&amp;</span> value           <span class="token operator">?</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FooBar is open!!!'</span><span class="token punctuation">)</span>           <span class="token operator">:</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'keep waiting'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>FooBarObserver<span class="token punctuation">.</span>open<span class="token punctuation">)</span> <span class="token comment">// falseFooBarObserver.open = true // FooBar is open!!!</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当然也不是什么都可以被代理的，如果对象带有<code>configurable: false</code> 跟<code>writable: false</code> 属性，则代理失效。</p><h2 id="13-Regex对象的扩展"><a href="#13-Regex对象的扩展" class="headerlink" title="13.Regex对象的扩展"></a>13.Regex对象的扩展</h2><p>正则新增符号</p><p><code>i</code>修饰符</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// i 修饰符/[a-z]/i.test('\u212A') // false/[a-z]/iu.test('\u212A') // true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>y</code>修饰符</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// y修饰符var s = 'aaa_aa_a';var r1 = /a+/g;var r2 = /a+/y;r1.exec(s) // ["aaa"]r2.exec(s) // ["aaa"]r1.exec(s) // ["aa"]r2.exec(s) // null</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>String.prototype.flags</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 查看RegExp构造函数的修饰符var regex = new RegExp('xyz', 'i')regex.flags // 'i'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>unicode模式</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string">' '</span><span class="token operator">/</span><span class="token operator">^</span><span class="token punctuation">.</span>$<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// false/^.$/u.test(s) // true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>u转义</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// u转义/\,/ // /\,//\,/u // 报错 没有u修饰符时，逗号前面的反斜杠是无效的，加了u修饰符就报错。</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>引用</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">RE_TWICE</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(?&lt;word&gt;[a-z]+)!\k&lt;word&gt;$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span><span class="token constant">RE_TWICE</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'abc!abc'</span><span class="token punctuation">)</span> <span class="token comment">// trueRE_TWICE.test('abc!ab') // falseconst RE_TWICE = /^(?&lt;word&gt;[a-z]+)!\1$/;RE_TWICE.test('abc!abc') // trueRE_TWICE.test('abc!ab') // false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>字符串方法的实现改为调用<code>RegExp</code>方法</p><ul><li><code>String.prototype.match</code> 调用 <code>RegExp.prototype[Symbol.match]</code></li><li><code>String.prototype.replace</code> 调用 <code>RegExp.prototype[Symbol.replace]</code></li><li><code>String.prototype.search</code> 调用 <code>RegExp.prototype[Symbol.search]</code></li><li><code>String.prototype.split</code> 调用 <code>RegExp.prototype[Symbol.split]</code></li></ul><h2 id="14-正则新增属性"><a href="#14-正则新增属性" class="headerlink" title="14.正则新增属性"></a>14.正则新增属性</h2><ul><li><code>RegExp.prototype.sticky</code> 表示是否有<code>y</code>修饰符</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hello\d</span><span class="token regex-delimiter">/</span><span class="token regex-flags">y</span></span><span class="token punctuation">.</span>sticky <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>RegExp.prototype.flags</code>获取修饰符</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">abc</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">.</span>flags <span class="token comment">// 'gi'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Math对象的扩展</strong></p><ul><li><code>二进制表示法</code> : <code>0b或0B开头</code>表示二进制(<code>0bXX</code>或<code>0BXX</code>)</li><li><code>二进制表示法</code> : <code>0b或0B开头</code>表示二进制(<code>0bXX</code>或<code>0BXX</code>)</li><li><code>八进制表示法</code> : <code>0o或0O开头</code>表示二进制(<code>0oXX</code>或<code>0OXX</code>)</li><li><code>Number.EPSILON</code> : 数值最小精度</li><li><code>Number.MIN_SAFE_INTEGER</code> : 最小安全数值(<code>-2^53</code>)</li><li><code>Number.MAX_SAFE_INTEGER</code> : 最大安全数值(<code>2^53</code>)</li><li><code>Number.parseInt()</code> : 返回转换值的整数部分</li><li><code>Number.parseFloat()</code> : 返回转换值的浮点数部分</li><li><code>Number.isFinite()</code> : 是否为有限数值</li><li><code>Number.isNaN()</code> : 是否为NaN</li><li><code>Number.isInteger()</code> : 是否为整数</li><li><code>Number.isSafeInteger()</code> : 是否在数值安全范围内</li><li><code>Math.trunc()</code> : 返回数值整数部分</li><li><code>Math.sign()</code> : 返回数值类型(<code>正数1</code>、<code>负数-1</code>、<code>零0</code>)</li><li><code>Math.cbrt()</code> : 返回数值立方根</li><li><code>Math.clz32()</code> : 返回数值的32位无符号整数形式</li><li><code>Math.imul()</code> : 返回两个数值相乘</li><li><code>Math.fround()</code> : 返回数值的32位单精度浮点数形式</li><li><code>Math.hypot()</code> : 返回所有数值平方和的平方根</li><li><code>Math.expm1()</code> : 返回<code>e^n - 1</code></li><li><code>Math.log1p()</code> : 返回<code>1 + n</code>的自然对数(<code>Math.log(1 + n)</code>)</li><li><code>Math.log10()</code> : 返回以10为底的n的对数</li><li><code>Math.log2()</code> : 返回以2为底的n的对数</li><li><code>Math.sinh()</code> : 返回n的双曲正弦</li><li><code>Math.cosh()</code> : 返回n的双曲余弦</li><li><code>Math.tanh()</code> : 返回n的双曲正切</li><li><code>Math.asinh()</code> : 返回n的反双曲正弦</li><li><code>Math.acosh()</code> : 返回n的反双曲余弦</li><li><code>Math.atanh()</code> : 返回n的反双曲正切</li></ul><h2 id="15-Array对象的扩展"><a href="#15-Array对象的扩展" class="headerlink" title="15.Array对象的扩展"></a>15.Array对象的扩展</h2><ul><li><code>Array.prototype.from</code>：转换具有<code>Iterator接口</code>的数据结构为真正数组，返回新数组。</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ["f", "o", "o"]console.log(Array.from([1, 2, 3], x =&gt; x + x)) // [2, 4, 6]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Array.prototype.of()</code>：转换一组值为真正数组，返回新数组。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Array<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>       <span class="token comment">// [7] Array.of(1, 2, 3) // [1, 2, 3]Array(7)          // [empty, empty, empty, empty, empty, empty]Array(1, 2, 3)    // [1, 2, 3]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Array.prototype.copyWithin()</code>：把指定位置的成员复制到其他位置，返回原数组</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ["d", "b", "c", "d", "e"]console.log(array1.copyWithin(1, 3)) // ["d", "d", "e", "d", "e"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Array.prototype.find()</code>：返回第一个符合条件的成员</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token keyword">const</span> found <span class="token operator">=</span> array1<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=&gt;</span> element <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span> <span class="token comment">// 12</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Array.prototype.findIndex()</code>：返回第一个符合条件的成员索引值</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token function-variable function">isLargeNumber</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> element <span class="token operator">&gt;</span> <span class="token number">13</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>isLargeNumber<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Array.prototype.fill()</code>：根据指定值填充整个数组，返回原数组</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 2, 0, 0]console.log(array1.fill(5, 1)) // [1, 5, 5, 5]console.log(array1.fill(6)) // [6, 6, 6, 6]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Array.prototype.keys()</code>：返回以索引值为遍历器的对象</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token keyword">const</span> iterator <span class="token operator">=</span> array1<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> iterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 0// 1// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Array.prototype.values()</code>：返回以属性值为遍历器的对象</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token keyword">const</span> iterator <span class="token operator">=</span> array1<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> iterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// a// b// c</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Array.prototype.entries()</code>：返回以索引值和属性值为遍历器的对象</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token keyword">const</span> iterator <span class="token operator">=</span> array1<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// [0, "a"]console.log(iterator.next().value) // [1, "b"]数组空位`：ES6明确将数组空位转为`undefined`或者`emptyArray.from(['a',,'b']) // [ "a", undefined, "b" ][...['a',,'b']] // [ "a", undefined, "b" ]Array(3) //  [empty × 3][,'a'] // [empty, "a"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="16-ES7-ES2016"><a href="#16-ES7-ES2016" class="headerlink" title="16.ES7(ES2016)"></a>16.ES7(ES2016)</h2><p><strong>Array.prototype.includes()</strong></p><p><code>includes()</code> 方法用来判断一个数组是否包含一个指定的值，根据情况，如果包含则返回 true，否则返回false。</p><p>代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// trueconst pets = ['cat', 'dog', 'bat']console.log(pets.includes('cat')) // trueconsole.log(pets.includes('at')) // false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="17-幂运算符"><a href="#17-幂运算符" class="headerlink" title="17.幂运算符"></a>17.幂运算符</h2><p>幂运算符**，具有与Math.pow()一样的功能，代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 1024console.log(Math.pow(2, 10)) // 1024</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>模板字符串（Template string）</p><p>自ES7起，带标签的模版字面量遵守以下转义序列的规则：</p><ul><li>Unicode字符以”\u”开头，例如<code>\u00A9</code></li><li>Unicode码位用”\u{}”表示，例如<code>\u{2F804}</code></li><li>十六进制以”\x”开头，例如<code>\xA9</code></li><li>八进制以””和数字开头，例如<code>\251</code></li></ul><p>这表示类似下面这种带标签的模版是有问题的，因为对于每一个ECMAScript语法，解析器都会去查找有效的转义序列，但是只能得到这是一个形式错误的语法：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">latex<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\unicode</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 在较老的ECMAScript版本中报错（ES2016及更早）// SyntaxError: malformed Unicode character escape sequence</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="18-ES8-ES2017"><a href="#18-ES8-ES2017" class="headerlink" title="18.ES8(ES2017)"></a>18.ES8(ES2017)</h2><p><strong>async/await</strong></p><p>虽然<code>Promise</code>可以解决回调地狱的问题，但是链式调用太多，则会变成另一种形式的回调地狱 —— 面条地狱，所以在ES8里则出现了<code>Promise</code>的语法糖<code>async/await</code>，专门解决这个问题。</p><p>我们先看一下下面的<code>Promise</code>代码：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'coffee.jpg'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">myBlob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token keyword">let</span> objectURL <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>myBlob<span class="token punctuation">)</span>          <span class="token keyword">let</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>          image<span class="token punctuation">.</span>src <span class="token operator">=</span> objectURL          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'There has been a problem with your fetch operation: '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后再看看<code>async/await</code>版的，这样看起来是不是更清晰了。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">myFetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'coffee.jpg'</span><span class="token punctuation">)</span>      <span class="token keyword">let</span> myBlob <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">let</span> objectURL <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>myBlob<span class="token punctuation">)</span>      <span class="token keyword">let</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>      image<span class="token punctuation">.</span>src <span class="token operator">=</span> objectURL      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">myFetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当然，如果你喜欢，你甚至可以两者混用</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">myFetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'coffee.jpg'</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">myFetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> objectURL <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>      <span class="token keyword">let</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>      image<span class="token punctuation">.</span>src <span class="token operator">=</span> objectURL      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="19-Object-values"><a href="#19-Object-values" class="headerlink" title="19.Object.values()"></a>19.Object.values()</h2><p><code>Object.values()</code>方法返回一个给定对象自身的所有可枚举属性值的数组，值的顺序与使用for…in循环的顺序相同 ( 区别在于 for-in 循环枚举原型链中的属性 )。</p><p>代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> object1 <span class="token operator">=</span> <span class="token punctuation">{</span>      a<span class="token operator">:</span> <span class="token string">'somestring'</span><span class="token punctuation">,</span>      b<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>      c<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>object1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ["somestring", 42, false]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="20-Object-entries"><a href="#20-Object-entries" class="headerlink" title="20.Object.entries()"></a>20.Object.entries()</h2><p><code>Object.entries()</code>方法返回一个给定对象自身可枚举属性的键值对数组，其排列与使用 for…in 循环遍历该对象时返回的顺序一致（区别在于 for-in 循环还会枚举原型链中的属性）。</p><p>代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> object1 <span class="token operator">=</span> <span class="token punctuation">{</span>      a<span class="token operator">:</span> <span class="token string">'somestring'</span><span class="token punctuation">,</span>      b<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>object1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// "a: somestring"// "b: 42"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="21-padStart"><a href="#21-padStart" class="headerlink" title="21.padStart()"></a>21.padStart()</h2><p><code>padStart()</code> 方法用另一个字符串填充当前字符串(重复，如果需要的话)，以便产生的字符串达到给定的长度。填充从当前字符串的开始(左侧)应用的。</p><p>代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> str1 <span class="token operator">=</span> <span class="token string">'5'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str1<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// "05"const fullNumber = '2034399002125581'const last4Digits = fullNumber.slice(-4)const maskedNumber = last4Digits.padStart(fullNumber.length, '*') console.log(maskedNumber) // "************5581"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>padEnd()</strong></p><p><code>padEnd()</code> 方法会用一个字符串填充当前字符串（如果需要的话则重复填充），返回填充后达到指定长度的字符串。从当前字符串的末尾（右侧）开始填充。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> str1 <span class="token operator">=</span> <span class="token string">'Breaded Mushrooms'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str1<span class="token punctuation">.</span><span class="token function">padEnd</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// "Breaded Mushrooms........"const str2 = '200'console.log(str2.padEnd(5)) // "200  "</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>###函数参数结尾逗号（Function parameter lists and calls trailing commas）</p><p>在ES5里就添加了对象的尾逗号，不过并不支持函数参数，但是在ES8之后，便开始支持这一特性，代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 参数定义function f(p) {}function f(p,) {} (p) =&gt; {}(p,) =&gt; {}class C {  one(a,) {},  two(a, b,) {},}var obj = {  one(a,) {},  two(a, b,) {},};// 函数调用f(p)f(p,)Math.max(10, 20)Math.max(10, 20,)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是以下的方式是不合法的：</p><p>仅仅包含逗号的函数参数定义或者函数调用会抛出 SyntaxError。 而且，当使用剩余参数的时候，并不支持尾后逗号，例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">,</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// SyntaxError: missing formal parameter(,) =&gt; {}       // SyntaxError: expected expression, got ','f(,)             // SyntaxError: expected expression, got ','function f(...p,) {} // SyntaxError: parameter after rest parameter(...p,) =&gt; {}        // SyntaxError: expected closing parenthesis, got ','</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在解构里也可以使用，代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 带有尾后逗号的数组解构[a, b,] = [1, 2]// 带有尾后逗号的对象解构var o = {  p: 42,   q: true,}var {p, q,} = o</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>同样地，在使用剩余参数时，会抛出 SyntaxError，代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> <span class="token operator">...</span>b<span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment">// SyntaxError: rest element may not have a trailing comma</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="22-ShareArrayBuffer（因安全问题，暂时在Chrome跟FireFox中被禁用）"><a href="#22-ShareArrayBuffer（因安全问题，暂时在Chrome跟FireFox中被禁用）" class="headerlink" title="22.ShareArrayBuffer（因安全问题，暂时在Chrome跟FireFox中被禁用）"></a>22.ShareArrayBuffer（因安全问题，暂时在Chrome跟FireFox中被禁用）</h2><p>SharedArrayBuffer 对象用来表示一个通用的，固定长度的原始二进制数据缓冲区，类似于 ArrayBuffer 对象，它们都可以用来在共享内存（shared memory）上创建视图。与 ArrayBuffer 不同的是，SharedArrayBuffer 不能被分离。</p><p>代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> sab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedArrayBuffer</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">// 必须实例化worker.postMessage(sab)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Atomics对象</p><p><strong>Atomics对象</strong> 提供了一组静态方法用来对 <code>SharedArrayBuffer</code> 对象进行原子操作。</p><p>方法如下：</p><ul><li><strong>Atomics.add()</strong> ：将指定位置上的数组元素与给定的值相加，并返回相加前该元素的值。</li><li>**Atomics.and()**：将指定位置上的数组元素与给定的值相与，并返回与操作前该元素的值。</li><li>**Atomics.compareExchange()**：如果数组中指定的元素与给定的值相等，则将其更新为新的值，并返回该元素原先的值。</li><li>**Atomics.exchange()**：将数组中指定的元素更新为给定的值，并返回该元素更新前的值。</li><li>**Atomics.load()**：返回数组中指定元素的值。</li><li>**Atomics.or()**：将指定位置上的数组元素与给定的值相或，并返回或操作前该元素的值。</li><li>**Atomics.store()**：将数组中指定的元素设置为给定的值，并返回该值。</li><li>**Atomics.sub()**：将指定位置上的数组元素与给定的值相减，并返回相减前该元素的值。</li><li>**Atomics.xor()**：将指定位置上的数组元素与给定的值相异或，并返回异或操作前该元素的值。</li><li>**Atomics.wait()**：检测数组中某个指定位置上的值是否仍然是给定值，是则保持挂起直到被唤醒或超时。返回值为 “ok”、“not-equal” 或 “time-out”。调用时，如果当前线程不允许阻塞，则会抛出异常（大多数浏览器都不允许在主线程中调用 wait()）。</li><li>**Atomics.wake()**：唤醒等待队列中正在数组指定位置的元素上等待的线程。返回值为成功唤醒的线程数量。</li><li>**Atomics.isLockFree(size)**：可以用来检测当前系统是否支持硬件级的原子操作。对于指定大小的数组，如果当前系统支持硬件级的原子操作，则返回 true；否则就意味着对于该数组，Atomics 对象中的各原子操作都只能用锁来实现。此函数面向的是技术专家。</li></ul><p><strong>Object.getOwnPropertyDescriptors()</strong></p><p><code>Object.getOwnPropertyDescriptors()</code> 方法用来获取一个对象的所有自身属性的描述符。代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> object1 <span class="token operator">=</span> <span class="token punctuation">{</span>  property1<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">}</span><span class="token keyword">const</span> descriptors1 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>object1<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>descriptors1<span class="token punctuation">.</span>property1<span class="token punctuation">.</span>writable<span class="token punctuation">)</span> <span class="token comment">// trueconsole.log(descriptors1.property1.value) // 42// 浅拷贝一个对象Object.create(  Object.getPrototypeOf(obj),   Object.getOwnPropertyDescriptors(obj) )// 创建子类function superclass() {}superclass.prototype = {  // 在这里定义方法和属性}function subclass() {}subclass.prototype = Object.create(superclass.prototype, Object.getOwnPropertyDescriptors({  // 在这里定义方法和属性}))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="23-ES9-ES2018"><a href="#23-ES9-ES2018" class="headerlink" title="23.ES9(ES2018)"></a>23.<strong>ES9(ES2018)</strong></h2><p><strong>for await…of</strong></p><p><code>for await...of</code> 语句会在异步或者同步可迭代对象上创建一个迭代循环，包括 <code>String</code>，<code>Array</code>，<code>Array-like</code> 对象（比如<code>arguments</code> 或者<code>NodeList</code>)，<code>TypedArray</code>，<code>Map</code>， <code>Set</code>和自定义的异步或者同步可迭代对象。其会调用自定义迭代钩子，并为每个不同属性的值执行语句。</p><p>配合迭代异步生成器，例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">asyncGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">yield</span> i<span class="token operator">++</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span>num <span class="token keyword">of</span> <span class="token function">asyncGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 0// 1// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="24-模板字符串（Template-string）"><a href="#24-模板字符串（Template-string）" class="headerlink" title="24.模板字符串（Template string）"></a>24.模板字符串（Template string）</h2><p>ES9开始，模板字符串允许嵌套支持常见转义序列，移除对ECMAScript在带标签的模版字符串中转义序列的语法限制。</p><p>不过，非法转义序列在”cooked”当中仍然会体现出来。它们将以<code>undefined</code>元素的形式存在于”cooked”之中，代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">latex</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token string">"cooked"</span><span class="token operator">:</span> str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"raw"</span><span class="token operator">:</span> str<span class="token punctuation">.</span>raw<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> latex<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\unicode</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// { cooked: undefined, raw: "\\unicode" }</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>正则表达式反向(lookbehind)断言</p><p>首先我们得先知道什么是**断言(Assertion)**。</p><p>**断言(Assertion)**是一个对当前匹配位置之前或之后的字符的测试， 它不会实际消耗任何字符，所以断言也被称为“非消耗性匹配”或“非获取匹配”。</p><p>正则表达式的断言一共有 4 种形式：</p><ul><li><code>(?=pattern)</code> 零宽正向肯定断言(zero-width positive lookahead assertion)</li><li><code>(?!pattern)</code> 零宽正向否定断言(zero-width negative lookahead assertion)</li><li><code>(?&lt;=pattern)</code> 零宽反向肯定断言(zero-width positive lookbehind assertion)</li><li><code>(?&lt;!pattern)</code> 零宽反向否定断言(zero-width negative lookbehind assertion)</li></ul><p>在ES9之前，JavaScript 正则表达式，只支持正向断言。正向断言的意思是：当前位置后面的字符串应该满足断言，但是并不捕获。例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'fishHeadfishTail'</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">fish(?=Head)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span> <span class="token comment">// ["fish"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>反向断言和正向断言的行为一样，只是方向相反。例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'abc123'</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;=(\d+)(\d+))$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span> <span class="token comment">//  ["", "1", "23", index: 6, input: "abc123", groups: undefined]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="25-正则表达式-Unicode-转义"><a href="#25-正则表达式-Unicode-转义" class="headerlink" title="25.正则表达式 Unicode 转义"></a>25.正则表达式 Unicode 转义</h2><p>正则表达式中的Unicode转义符允许根据Unicode字符属性匹配Unicode字符。 它允许区分字符类型，例如大写和小写字母，数学符号和标点符号。</p><p>部分例子代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 匹配所有数字const regex = /^\p{Number}+$/u;regex.test('²³¹¼½¾') // trueregex.test('㉛㉜㉝') // trueregex.test('ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅪⅫ') // true// 匹配所有空格\p{White_Space}// 匹配各种文字的所有字母，等同于 Unicode 版的 \w[\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]// 匹配各种文字的所有非字母的字符，等同于 Unicode 版的 \W[^\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]// 匹配 Emoji/\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F/gu// 匹配所有的箭头字符const regexArrows = /^\p{Block=Arrows}+$/u;regexArrows.test('←↑→↓⇏⇐⇑⇒⇓⇔⇕⇖⇗⇘⇙⇧⇩') // true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>具体的属性列表可查看：<a href="https://link.zhihu.com/?target=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Unicode_Property_Escapes">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Unicode_Property_Escapes</a></p><h2 id="26-正则表达式-s-dotAll-模式"><a href="#26-正则表达式-s-dotAll-模式" class="headerlink" title="26.正则表达式 s/dotAll 模式"></a>26.正则表达式 s/dotAll 模式</h2><p>在以往的版本里，JS的正则的<code>.</code>只能匹配emoji跟行终结符以外的所有文本，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> regex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>regex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// falseregex.test('\r');       // falseregex.test('\u{2028}'); // falseregex.test('\u{2029}'); // falseregex.test('\v');       // trueregex.test('\f');       // trueregex.test('\u{0085}'); // true/foo.bar/.test('foo\nbar');     // false/foo[^]bar/.test('foo\nbar');   // true/foo.bar/.test('foo\nbar');     // false/foo[\s]bar/.test('foo\nbar');   // true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是在ES9之后，JS正则增加了一个新的标志<code>s</code>用来表示 dotAll，这可以匹配任意字符。代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">foo.bar</span><span class="token regex-delimiter">/</span><span class="token regex-flags">s</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'foo\nbar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// trueconst re = /foo.bar/s;  //  等价于 const re = new RegExp('foo.bar', 's');re.test('foo\nbar');    // truere.dotAll;      // truere.flags;       // "s"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="27-正则表达式命名捕获组"><a href="#27-正则表达式命名捕获组" class="headerlink" title="27.正则表达式命名捕获组"></a>27.正则表达式命名捕获组</h2><p>在以往的版本里，JS的正则分组是无法命名的，所以容易混淆。例如下面获取年月日的例子，很容易让人搞不清哪个是月份，哪个是年份:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> matched <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\d{4})-(\d{2})-(\d{2})</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'2019-01-01'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>matched<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 2019-01-01console.log(matched[1]);    // 2019console.log(matched[2]);    // 01console.log(matched[3]);    // 01</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ES9引入了命名捕获组，允许为每一个组匹配指定一个名字，既便于阅读代码，又便于引用。代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">RE_DATE</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span><span class="token keyword">const</span> matchObj <span class="token operator">=</span> <span class="token constant">RE_DATE</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'1999-12-31'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> year <span class="token operator">=</span> matchObj<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>year<span class="token punctuation">;</span> <span class="token comment">// 1999const month = matchObj.groups.month; // 12const day = matchObj.groups.day; // 31const RE_OPT_A = /^(?&lt;as&gt;a+)?$/;const matchObj = RE_OPT_A.exec('');matchObj.groups.as // undefined'as' in matchObj.groups // true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="28-对象扩展操作符"><a href="#28-对象扩展操作符" class="headerlink" title="28.对象扩展操作符"></a>28.对象扩展操作符</h2><p>ES6中添加了数组的扩展操作符，让我们在操作数组时更加简便，美中不足的是并不支持对象扩展操作符，但是在ES9开始，这一功能也得到了支持，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> x<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'baz'</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">13</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> clonedObj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>obj1 <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">// 克隆后的对象: { foo: "bar", x: 42 }var mergedObj = { ...obj1, ...obj2 };// 合并后的对象: { foo: "baz", x: 42, y: 13 }</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>上面便是一个简便的浅拷贝。这里有一点小提示，就是<code>Object.assign()</code> 函数会触发 <code>setters</code>，而展开语法则不会。所以不能替换也不能模拟<code>Object.assign()</code> 。</p><p>如果存在相同的属性名，只有最后一个会生效。</p><h2 id="29-Promise-prototype-finally"><a href="#29-Promise-prototype-finally" class="headerlink" title="29.Promise.prototype.finally()"></a>29.Promise.prototype.finally()</h2><p><code>finally()</code>方法会返回一个<code>Promise</code>，当promise的状态变更，不管是变成<code>rejected</code>或者<code>fulfilled</code>，最终都会执行<code>finally()</code>的回调。</p><p>例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'结束'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="30-ES10-ES2019"><a href="#30-ES10-ES2019" class="headerlink" title="30.ES10(ES2019)"></a>30.ES10(ES2019)</h2><p>Array.prototype.flat() / flatMap()</p><p><code>flat()</code> 方法会按照一个可指定的深度递归遍历数组，并将所有元素与遍历到的子数组中的元素合并为一个新数组返回。</p><p><code>flatMap()</code>与 <code>map()</code> 方法和深度为1的 <code>flat()</code> 几乎相同.，不过它会首先使用映射函数映射每个元素，然后将结果压缩成一个新数组，这样效率会更高。</p><p>例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>arr1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [[2], [4], [6], [8]]arr1.flatMap(x =&gt; [x * 2]) // [2, 4, 6, 8]// 深度为1arr1.flatMap(x =&gt; [[x * 2]]) // [[2], [4], [6], [8]]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>flatMap()</code>可以代替<code>reduce()</code>与<code>concat()</code>，例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>arr<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [1, 2, 2, 4, 3, 6, 4, 8]// 等价于arr.reduce((acc, x) =&gt; acc.concat([x, x * 2]), []) // [1, 2, 2, 4, 3, 6, 4, 8]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但这是非常低效的，在每次迭代中，它创建一个必须被垃圾收集的新临时数组，并且它将元素从当前的累加器数组复制到一个新的数组中，而不是将新的元素添加到现有的数组中。</p><p>String.prototype.trimStart() / trimLeft() / trimEnd() / trimRight()</p><p>在ES5中，我们可以通过<code>trim()</code>来去掉字符首尾的空格，但是却无法只去掉单边的，但是在ES10之后，我们可以实现这个功能。</p><p>如果我们要去掉开头的空格，可以使用<code>trimStart()</code>或者它的别名<code>trimLeft()</code>，</p><p>同样的，如果我们要去掉结尾的空格，我们可以使用<code>trimEnd()</code>或者它的别名<code>trimRight()</code>。</p><p>例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Str <span class="token operator">=</span> <span class="token string">'   Hello world!  '</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Str<span class="token punctuation">)</span> <span class="token comment">// '   Hello world!  'console.log(Str.trimStart()) // 'Hello world!  'console.log(Str.trimLeft()) // 'Hello world!  'console.log(Str.trimEnd()) // '   Hello world!'console.log(Str.trimRight()) // '   Hello world!'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>不过这里有一点要注意的是，<code>trimStart()</code>跟<code>trimEnd()</code>才是标准方法，<code>trimLeft()</code>跟<code>trimRight()</code>只是别名。</p><p>在某些引擎里（例如Chrome），有以下的等式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">String</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>trimLeft<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">"trimStart"</span><span class="token class-name">String</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>trimRight<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">"trimEnd"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="31-Object-fromEntries"><a href="#31-Object-fromEntries" class="headerlink" title="31.Object.fromEntries()"></a>31.Object.fromEntries()</h2><p><code>Object.fromEntries()</code> 方法把键值对列表转换为一个对象，它是<code>Object.entries()</code>的反函数。</p><p>例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> entries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">const</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// Object { foo: "bar", baz: 42 }</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="32-Symbol-prototype-description"><a href="#32-Symbol-prototype-description" class="headerlink" title="32.Symbol.prototype.description"></a>32.Symbol.prototype.description</h2><p><code>description</code> 是一个只读属性，它会返回<code>Symbol</code>对象的可选描述的字符串。与 <code>Symbol.prototype.toString()</code> 不同的是它不会包含<code>Symbol()</code>的字符串。例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'desc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// "Symbol(desc)"Symbol('desc').description;  // "desc"Symbol('').description;      // ""Symbol().description;        // undefined// 具名 symbolsSymbol.iterator.toString();  // "Symbol(Symbol.iterator)"Symbol.iterator.description; // "Symbol.iterator"//全局 symbolsSymbol.for('foo').toString();  // "Symbol(foo)"Symbol.for('foo').description; // "foo"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="33-String-prototype-matchAll"><a href="#33-String-prototype-matchAll" class="headerlink" title="33.String.prototype.matchAll"></a>33.String.prototype.matchAll</h2><p><code>matchAll()</code> 方法返回一个包含所有匹配正则表达式的结果及分组捕获组的迭代器。并且返回一个不可重启的迭代器。例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> regexp <span class="token operator">=</span> <span class="token operator">/</span><span class="token function">t</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">st</span><span class="token punctuation">(</span>\d<span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>gvar str <span class="token operator">=</span> <span class="token string">'test1test2'</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>regexp<span class="token punctuation">)</span> <span class="token comment">// ['test1', 'test2']str.matchAll(regexp) // RegExpStringIterator {}[...str.matchAll(regexp)] // [['test1', 'e', 'st1', '1', index: 0, input: 'test1test2', length: 4], ['test2', 'e', 'st2', '2', index: 5, input: 'test1test2', length: 4]]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="34-Function-prototype-toString-返回注释与空格"><a href="#34-Function-prototype-toString-返回注释与空格" class="headerlink" title="34.Function.prototype.toString() 返回注释与空格"></a>34.Function.prototype.toString() 返回注释与空格</h2><p>在以往的版本中，<code>Function.prototype.toString()</code>得到的字符串是去掉空白符号的，但是从ES10开始会保留这些空格，如果是原生函数则返回你控制台看到的效果，例子如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// "function sum(a, b) {// return a + b;//  }"console.log(Math.abs.toString()) // "function abs() { [native code] }"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>try-catch</strong></p><p>在以往的版本中，<code>try-catch</code>里<code>catch</code>后面必须带异常参数，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ES10之前try {      // tryCode} catch (err) {      // catchCode}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是在ES10之后，这个参数却不是必须的，如果用不到，我们可以不用传，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Foobar'</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Bar'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>BigInt</p><p><strong>BigInt</strong> 是一种内置对象，它提供了一种方法来表示大于 <code>253 - 1</code> 的整数。这原本是 Javascript中可以用 <code>Number</code> 表示的最大数字。<strong>BigInt</strong> 可以表示任意大的整数。</p><p>可以用在一个整数字面量后面加 <code>n</code> 的方式定义一个 <code>BigInt</code> ，如：<code>10n</code>，或者调用函数<code>BigInt()</code>。</p><p>在以往的版本中，我们有以下的弊端：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 大于2的53次方的整数，无法保持精度2 ** 53 === (2 ** 53 + 1)// 超过2的1024次方的数值，无法表示2 ** 1024 // Infinity</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是在ES10引入<code>BigInt</code>之后，这个问题便得到了解决。</p><p>以下操作符可以和 <code>BigInt</code> 一起使用： <code>+</code>、<code>*</code>、<code>-</code>、<code>**</code>、<code>%</code> 。除 <code>&gt;&gt;&gt;</code> （无符号右移）之外的位操作也可以支持。因为 <code>BigInt</code> 都是有符号的， <code>&gt;&gt;&gt;</code> （无符号右移）不能用于 <code>BigInt</code>。<code>BigInt</code> 不支持单目 (<code>+</code>) 运算符。</p><p><code>/</code> 操作符对于整数的运算也没问题。可是因为这些变量是 <code>BigInt</code> 而不是 <code>BigDecimal</code> ，该操作符结果会向零取整，也就是说不会返回小数部分。</p><p><code>BigInt</code> 和 <code>Number</code>不是严格相等的，但是宽松相等的。</p><p>所以在<code>BigInt</code>出来以后，JS的原始类型便增加到了7个，如下：</p><ul><li>Boolean</li><li>Null</li><li>Undefined</li><li>Number</li><li>String</li><li>Symbol (ES6)</li><li>BigInt (ES10)</li></ul><h2 id="35-globalThis"><a href="#35-globalThis" class="headerlink" title="35.globalThis"></a>35.globalThis</h2><p><code>globalThis</code>属性包含类似于全局对象 <code>this</code>值。所以在全局环境下，我们有：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">globalThis <span class="token operator">===</span> <span class="token keyword">this</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>import()</strong></p><p>静态的<code>import</code> 语句用于导入由另一个模块导出的绑定。无论是否声明了 严格模式，导入的模块都运行在严格模式下。在浏览器中，<code>import</code> 语句只能在声明了 <code>type="module"</code> 的 <code>script</code> 的标签中使用。</p><p>但是在ES10之后，我们有动态 <code>import()</code>，它不需要依赖 <code>type="module"</code> 的script标签。</p><p>所以我们有以下例子：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> main <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> link <span class="token keyword">of</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"nav &gt; a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      link<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'/modules/my-module.js'</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                    module<span class="token punctuation">.</span><span class="token function">loadPageInto</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                    main<span class="token punctuation">.</span>javascriptContent <span class="token operator">=</span> err<span class="token punctuation">.</span>message<span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="36-私有元素与方法"><a href="#36-私有元素与方法" class="headerlink" title="36.私有元素与方法"></a>36.私有元素与方法</h2><p>在ES10之前，如果我们要实现一个简单的计数器组件，我们可能会这么写：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// web component 写法class Counter extends HTMLElement {      get x() {           return this.xValue      }      set x(value) {              this.xValue = value              window.requestAnimationFrame(this.render.bind(this))      }      clicked() {            this.x++      }      constructor() {            super()            this.onclick = this.clicked.bind(this)            this.xValue = 0      }      connectedCallback() {           this.render()      }      render() {            this.javascriptContent = this.x.toString()      }}window.customElements.define('num-counter', Counter)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是在ES10之后我们可以使用私有变量进行组件封装，如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>      #xValue <span class="token operator">=</span> <span class="token number">0</span>      get <span class="token function">#x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">return</span> #xValue      <span class="token punctuation">}</span>      set <span class="token function">#x</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>#xValue <span class="token operator">=</span> value            window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#render</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token function">#clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>#x<span class="token operator">++</span>      <span class="token punctuation">}</span>      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#clicked</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token function">#render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>javascriptContent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span>window<span class="token punctuation">.</span>customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'num-counter'</span><span class="token punctuation">,</span> Counter<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="37-字符串扩展相关"><a href="#37-字符串扩展相关" class="headerlink" title="37.字符串扩展相关"></a>37.字符串扩展相关</h2><ul><li><p>includes()</p><p>判断字符串中是否包含指定的子串，返回值为boolean。</p><ul><li><p>参数一：所要匹配的子串</p></li><li><p>参数二（可省略，默认从索引0开始）：从字符串的某个索引的位置开始判断</p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// trueconsole.log("hello world".includes("hi"))  // falseconsole.log("hello world".includes("world", 6))  // trueconsole.log("hello world".includes("world", 7))  // false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>startWith()</p><p>判断字符串是否以特定的子串开始</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'admin/index.php'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">startWith</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// trueconsole.log(url.startWith('aaa'))  // false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>endWith()</p><p>判断字符串是否以特定的子串结束</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'admin/index.php'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">startWith</span><span class="token punctuation">(</span><span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// trueconsole.log(url.startWith('html'))  // false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h2 id="38-函数扩展"><a href="#38-函数扩展" class="headerlink" title="38.函数扩展"></a>38.函数扩展</h2><ul><li><p>函数参数默认值</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// ES5function foo(param) {  let p = param || 'default value'  console.log(p)}// ES6function bar(param='default value') {  console.log(param)}foo('hello kitty')bar('hello tom')</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>参数解构赋值</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// ES5function foo(uname='lisi', age='12') {  console.log(uname, age)}foo('zhangsan', 15)  // zhangsan15// ES6function bar({uname='lisi', age='15'}={}){  console.log(uname, age)}bar()  // 不传参数会出现问题,在参数中加空对象bar({uname: 'zhangsan', age: '17'})</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>rest参数(剩余参数)</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// ES5function foo(a,c,b) {  console.log(a,b,c)}foo(1,2,3)  // 1 2 3// ES6function bar(a, ...rest) {  console.log(a,b,c)}bar(4,5,6)  // 4 [5,6]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>…扩展运算符</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token operator">+</span>c<span class="token operator">+</span>d<span class="token operator">+</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment">// 15// ES6let arr = [1,2,3,4,5]foo.apply(null, arr)  // 15foo(...arr)  // 15</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h2 id="39-参考资料"><a href="#39-参考资料" class="headerlink" title="39.参考资料"></a>39.参考资料</h2><ol><li><a href="https://link.zhihu.com/?target=https://es6.ruanyifeng.com/%23docs/">ECMAScript 6 入门</a></li><li><a href="https://link.zhihu.com/?target=https://juejin.im/post/5d9bf530518825427b27639d">1.5万字概括ES6全部特性</a></li><li><a href="https://link.zhihu.com/?target=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript">MDN</a></li><li><a href="https://link.zhihu.com/?target=https://segmentfault.com/a/1190000013519526">ES2018 新特征之：非转义序列的模板字符串</a></li><li><a href="https://link.zhihu.com/?target=https://esnext.justjavac.com/proposal/regexp-lookbehind.html">正则表达式反向(lookbehind)断言</a></li><li><a href="https://link.zhihu.com/?target=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Unicode_Property_Escapes">Unicode property escapes</a></li><li><a href="https://link.zhihu.com/?target=https://esnext.justjavac.com/proposal/exponentiation-operator.html">exnext提案</a></li><li><a href="https://link.zhihu.com/?target=https://mp.weixin.qq.com/s/JuWoahhnEunkOTi4qNtWQg">ES7、ES8、ES9、ES10新特性大盘点</a></li><li><a href="https://link.zhihu.com/?target=https://github.com/tc39">Ecma TC39</a></li><li>[<a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/b0877d1fc2a4">ECMAScript] TC39 process</a></li><li><a href="https://link.zhihu.com/?target=https://tc39.es/process-document/">The TC39 Process</a></li></ol><p>优质文章传送门：</p><p><a href="https://zhuanlan.zhihu.com/p/342789645">通过5个实际的功能来提升你JS的编码水平</a></p><p><a href="https://zhuanlan.zhihu.com/p/337601856">序列化/反序列化，我忍你很久了</a></p><p><a href="https://zhuanlan.zhihu.com/p/338490012">如何衡量一个人的 JavaScript 水平？</a></p><p><a href="https://zhuanlan.zhihu.com/p/339504658">JavaScript中的王者——正则匹配及15个常用案例</a></p><p><a href="https://zhuanlan.zhihu.com/p/291380673">你能使用 typescript 写好一个最简单的 Button 组件吗？</a></p><p><a href="https://zhuanlan.zhihu.com/p/263475235">JDK 15带来的14个新特性介绍</a></p><p><a href="https://zhuanlan.zhihu.com/p/210244307">跨域（CORS）产生原因分析与解决方案，这一次彻底搞懂它</a></p>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>彻底弄懂GMT、UTC、时区和夏令时</title>
      <link href="2021/052060930.html"/>
      <url>2021/052060930.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>格林威治时间、世界时、祖鲁时间、GMT、UTC、跨时区、夏令时，这些眼花缭乱的时间术语，我们可能都不陌生，但是真正遇到问题，可能又不那么确定，不得不再去查一查，处理完可能过段时间又忘记。今天，我们彻底来梳理一下它们。</p><h2 id="一、GMT"><a href="#一、GMT" class="headerlink" title="一、GMT"></a>一、GMT</h2><p><strong>什么是GMT</strong></p><p>GMT（Greenwich Mean Time）， 格林威治平时（也称格林威治时间）。</p><p>它规定太阳每天经过位于英国伦敦郊区的皇家格林威治天文台的时间为中午12点。</p><p><strong>GMT的历史</strong></p><p>格林威治皇家天文台为了海上霸权的扩张计划，在十七世纪就开始进行天体观测。为了天文观测，选择了穿过英国伦敦格林威治天文台子午仪中心的一条经线作为零度参考线，这条线，简称格林威治子午线。</p><p>1884年10月在美国华盛顿召开了一个国际子午线会议，该会议将格林威治子午线设定为本初子午线，并将格林威治平时 (GMT, Greenwich Mean Time) 作为世界时间标准（UT, Universal Time）。由此也确定了全球24小时自然时区的划分，所有时区都以和 GMT 之间的偏移量做为参考。</p><p>1972年之前，格林威治时间（GMT）一直是世界时间的标准。1972年之后，GMT 不再是一个时间标准了。</p><h2 id="二、UTC"><a href="#二、UTC" class="headerlink" title="二、UTC"></a>二、UTC</h2><p><strong>什么是UTC</strong></p><p>UTC（Coodinated Universal Time），协调世界时，又称世界统一时间、世界标准时间、国际协调时间。由于英文（CUT）和法文（TUC）的缩写不同，作为妥协，简称UTC。</p><p>UTC 是现在全球通用的时间标准，全球各地都同意将各自的时间进行同步协调。UTC 时间是经过平均太阳时（以格林威治时间GMT为准）、地轴运动修正后的新时标以及以秒为单位的国际原子时所综合精算而成。</p><p>在军事中，协调世界时会使用“Z”来表示。又由于Z在无线电联络中使用“Zulu”作代称，协调世界时也会被称为”Zulu time”。</p><p><strong>UTC 由两部分构成：</strong></p><ul><li>原子时间（TAI, International Atomic Time）:</li></ul><p>结合了全球400个所有的原子钟而得到的时间，它决定了我们每个人的钟表中，时间流动的速度。</p><ul><li>世界时间（UT, Universal Time）:</li></ul><p>也称天文时间，或太阳时，他的依据是地球的自转，我们用它来确定多少原子时，对应于一个地球日的时间长度。</p><p><strong>UTC的历史</strong></p><p>1960年，国际无线电咨询委员会规范统一了 UTC 的概念，并在次年投入实际使用。</p><p>“Coordinated Universal Time”这个名字则在1967年才被正式采纳。</p><p>1967年以前， UTC被数次调整过，原因是要使用闰秒（leap second）来将 UTC 与地球自转时间进行统一。</p><h2 id="三、GMT-vs-UTC"><a href="#三、GMT-vs-UTC" class="headerlink" title="三、GMT vs UTC"></a>三、GMT vs UTC</h2><p>GMT是前世界标准时，UTC是现世界标准时。</p><p>UTC 比 GMT更精准，以原子时计时，适应现代社会的精确计时。</p><p>但在不需要精确到秒的情况下，二者可以视为等同。</p><p>每年格林尼治天文台会发调时信息，基于UTC。</p><h2 id="四、时区"><a href="#四、时区" class="headerlink" title="四、时区"></a>四、时区</h2><p>随着火车铁路与其他交通和通讯工具的发展，以及全球化贸易的推动，各地使用各自的当地太阳时间带来了时间不统一的问题，在19世纪催生了统一时间标准的需求，时区由此诞生。</p><p><strong>时区是如何定义的</strong></p><p>从格林威治本初子午线起，经度每向东或者向西间隔15°，就划分一个时区，在这个区域内，大家使用同样的标准时间。</p><p>但实际上，为了照顾到行政上的方便，常将1个国家或1个省份划在一起。所以时区并不严格按南北直线来划分，而是按自然条件来划分。另外：由于目前，国际上并没有一个批准各国更改时区的机构。一些国家会由于特定原因改变自己的时区。</p><p>全球共分为24个标准时区，相邻时区的时间相差一个小时。</p><p><img src="http://5coder.cn/img/S4fRbqOoxJXg3Nj.jpg" alt="img"></p><p>在不同地区，同一个时区往往会有很多个不同的时区名称，因为名称中通常会包含该国该地区的地理信息。在夏令时期间，当地的时区名称及字母缩写会有所变化（通常会包含“daylight”或“summer”字样）。</p><p>例如美国东部标准时间叫：EST，Estern Standard Time；而东部夏令时间叫：EDT，Estern Daylight Time。</p><blockquote><p>想查看世界所有时区的名字可以访问这个网站：<a href="https://link.zhihu.com/?target=https://www.timeanddate.com/time/zones/">https://www.timeanddate.com/time/zones/</a></p></blockquote><h2 id="四、夏令时"><a href="#四、夏令时" class="headerlink" title="四、夏令时"></a>四、夏令时</h2><p><strong>什么是夏令时</strong></p><p>DST（Daylight Saving Time），夏令时又称夏季时间，或者夏时制。</p><p>它是为节约能源而人为规定地方时间的制度。一般在天亮早的夏季人为将时间提前一小时，可以使人早起早睡，减少照明量，以充分利用光照资源，从而节约照明用电。</p><p>全球约40%的国家在夏季使用夏令时，其他国家则全年只使用标准时间。标准时间在有的国家也因此被相应地称为冬季时间。</p><p>在施行夏令时的国家，一年里面有一天只有23小时（夏令时开始那一天），有一天有25小时（夏令时结束那一天），其他时间每天都是24小时。</p><p><img src="http://5coder.cn/img/HRT2InGFydZOeE9.jpg" alt="img"></p><p>绿色部分为2019年统计的在全球施行冬夏令时的国家和地区。</p><p><strong>夏令时的历史</strong></p><p>1784年，美国驻法国大使本杰明·富兰克林（Benjamin Franklin）提出“日光节约时间制”。1908年，英国建筑师威廉·维莱特（William Willett）再次提出，但当时该提案并未被采纳。</p><p>1916年，处于一战时期的德国政府下令将时钟推至一个小时后，通过获得额外一小时的日光来节省战争所需的煤炭，成为第一个实行夏时制的国家。随后，英法俄美四个一战参战国纷纷效仿。</p><p>美国在一战结束后于1919年取消夏时制，但在1942年二战时，美国重新启动夏令时制，1966年正式立法确定永久使用。1973至1975年石油危机爆发期间，美国连续两年延长夏令时制，以节省石油。</p><p>欧洲大部分国家则是从1976年——第四次中东战争导致首次石油危机（1973年）的3年后才开始施行夏令时制。</p><p>1986年4月，中国国务院办公厅发出《在全国范围内实行夏时制的通知》，要求全民早睡早起节约能源：每年4月中旬的第一个星期日2时，将时钟拨快一小时；10月中旬第一个星期日的2时，再将时钟拨慢一小时。但此夏令时只实行了6年，在1992年停止施行，主因是中国东西地域广阔却只奉行一个北京时间，实时夏令时制带来很多不切实际的反效果。</p><p><strong>夏令时的争议</strong></p><p>从过去的100多年来看，夏令时往往是在国家发生严重危机（如战争和能源短缺）的情况下才会受到青睐。而在相对和平的近10年里，这种时间制度则变得越来越不受欢迎。</p><p>它会使得人们的生物钟被扰乱，常常陷入睡眠不足的情况，不仅对人体健康有害、导致车祸，还会对旅游、航空领域造成极大的混乱。</p><p>另外，冬、夏令时究竟能否起到节能的作用，也仍有待商榷。美国一项截至2014年3月的研究表明，这种时间转换制度最多能在3、4月帮助美国减少1%的用电量，而美国国家标准局则认为，夏令时对用电量没有丝毫影响。</p><p>在俄罗斯，此前的一份报告也显示，夏令时帮助俄罗斯每年节约的电量，仅相当于两三个火力发电厂的发电量，十分的“鸡肋”。</p><p>去年（2019年）3月26日，作为全世界第一个提出并实行夏令时的国家，德国，在欧洲议会上以410比192的赞成票通过了取消冬、夏令时转换制提案，拟定于2021年4月起，所有欧盟国家不再实行冬、夏令时转换。待各成员国形成最终法案后，将选择永久使用夏令时时间或是冬令时时间。</p><h2 id="五、本地时间"><a href="#五、本地时间" class="headerlink" title="五、本地时间"></a>五、本地时间</h2><p>在日常生活中所使用的时间我们通常称之为本地时间。这个时间等于我们所在（或者所使用）时区内的当地时间，它由与世界标准时间（UTC）之间的偏移量来定义。这个偏移量可以表示为 UTC- 或 UTC+，后面接上偏移的小时和分钟数。</p><h2 id="六、JavaScript中的Date"><a href="#六、JavaScript中的Date" class="headerlink" title="六、JavaScript中的Date"></a>六、JavaScript中的Date</h2><p>得到本地时间，在不同时区打印 new Date() ，输出的结果将会不一样：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到本地时间距 1970年1月1日午夜（GMT时间）之间的毫秒数：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>返回本地时间与 GMT 时间之间的时间差，以分钟为单位：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTimezoneOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如何在任何地方都能正确显示当地时间（只要知道该地的timezone）：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//目标表时间，东八区</span><span class="token keyword">let</span> timezone <span class="token operator">=</span> <span class="token number">8</span>；<span class="token comment">//获取本地时间与格林威治时间的时间差(注意是分钟，记得转换)</span><span class="token keyword">const</span> diff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTimezoneOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//根据本地时间和时间差获得格林威治时间</span><span class="token keyword">const</span> absTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> diff <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span><span class="token comment">//根据格林威治时间和各地时区，得到各地时区的时间</span><span class="token keyword">let</span> localTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>absTime <span class="token operator">+</span> timeZone <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>；<span class="token comment">//处理夏令时(isDST为自己封装的处理方法)</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isDST</span><span class="token punctuation">(</span>localTime<span class="token punctuation">,</span> country<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  localTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>absTime <span class="token operator">+</span> <span class="token punctuation">(</span>timeZone <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>；<span class="token punctuation">}</span><span class="token keyword">return</span> localTime<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>以上分别从定义、来源等维度解释和扩展说明了GMT、UTC、时区和夏令时的概念、历史、意义，并在最后列举了这些概念在JS项目中的一个非常实用的应用。</p><p>简单地讲， GMT 是以前的世界时间标准；UTC 是现在在使用的世界时间标准；时区是基于格林威治子午线来偏移的，往东为正，往西为负；夏令时是地方时间制度，施行夏令时的地方，每年有2天很特殊（一天只有23个小时，另一天有25个小时）。</p><p>从源头上彻底了解了这些概念，将会让我们在处理与时间相关的问题时如虎添翼。</p>]]></content>
      
      
      <categories>
          
          <category> 通识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GMT </tag>
            
            <tag> UTC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>yarn与npm命令对比</title>
      <link href="2021/052024626.html"/>
      <url>2021/052024626.html</url>
      
        <content type="html"><![CDATA[<h1 id="yarn与npm命令对比"><a href="#yarn与npm命令对比" class="headerlink" title="yarn与npm命令对比"></a>yarn与npm命令对比</h1><blockquote><p>注：x 代表包名</p><p>| 代表有两个方式都可以 比如 npm i | install 可以直接npm i 或者 npm install</p><p>yarn global 这个顺序不可以改变</p><p>npm ls -g –depth 0 查看npm安装过的全局包</p></blockquote><table><thead><tr><th>npm</th><th>yarn</th><th></th></tr></thead><tbody><tr><td>npm init</td><td>yarn init</td><td>初始化</td></tr><tr><td>npm i | install</td><td>yarn (install)</td><td>安装依赖包</td></tr><tr><td>npm i x –S | –save</td><td>yarn add x</td><td>安装生产依赖并保存包名</td></tr><tr><td>npm i x –D | –save-dev</td><td>yarn add x -D</td><td>安装开发依赖并保存报名</td></tr><tr><td>npm un | uninstall x</td><td>yarn remove</td><td>删除依赖包</td></tr><tr><td>npm i -g | npm -g i x</td><td>yarn global add x</td><td>全局安装</td></tr><tr><td>npm un -g x</td><td>yarn global remove x</td><td>全局卸载</td></tr><tr><td>npm run dev</td><td>yarn dev | run dev</td><td>运行命令</td></tr><tr><td>npm config set registry url</td><td>yarn config set registry url</td><td>设置下载镜像地址</td></tr></tbody></table><h2 id="yarn"><a href="#yarn" class="headerlink" title="yarn"></a>yarn</h2><h3 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h3><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh"># 生成 package.json 文件（需要手动选择配置）yarn init# 生成 package.json 文件（使用默认配置）yarn init -y# 一键安装 package.json 下的依赖包yarn# 在项目中安装包名为 xxx 的依赖包（配置在 dependencies 下）,同时 yarn.lock 也会被更新yarn add xxx# 在项目中安装包名为 xxx 的依赖包（配置在配置在 devDependencies 下）,同时 yarn.lock 也会被更新yarn add xxx --dev# 全局安装包名为 xxx 的依yarn global add xxx# 运行 package.json 中 scripts 下的命令yarn xxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="不常用指令"><a href="#不常用指令" class="headerlink" title="不常用指令"></a>不常用指令</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 列出 xxx 包的版本信息</span><span class="token function">yarn</span> outdated xxx<span class="token comment"># 验证当前项目 package.json 里的依赖版本和 yarn 的 lock 文件是否匹配</span><span class="token function">yarn</span> check<span class="token comment"># 将当前模块发布到 npmjs.com，需要先登录</span><span class="token function">yarn</span> publish<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h2><h3 id="常用指令-1"><a href="#常用指令-1" class="headerlink" title="常用指令"></a>常用指令</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 查看全局安装过的模块</span><span class="token function">npm</span> list -g --depth <span class="token number">0</span><span class="token comment"># 查看node版本</span>node --version<span class="token comment"># 生成 package.json 文件（需要手动选择配置）</span><span class="token function">npm</span> init<span class="token comment"># 生成 package.json 文件（使用默认配置）</span><span class="token function">npm</span> init -y<span class="token comment"># 一键安装 package.json 下的依赖包</span><span class="token function">npm</span> i<span class="token comment"># 在项目中安装包名为 xxx 的依赖包（配置在 dependencies 下）</span><span class="token function">npm</span> i xxx<span class="token comment"># 在项目中安装包名为 xxx 的依赖包（配置在 dependencies 下）</span><span class="token function">npm</span> i xxx --save<span class="token comment"># 在项目中安装包名为 xxx 的依赖包（配置在 devDependencies 下）</span><span class="token function">npm</span> i xxx --save-dev<span class="token comment"># 全局安装包名为 xxx 的依赖包</span><span class="token function">npm</span> i -g xxx<span class="token comment"># 运行 package.json 中 scripts 下的命令</span><span class="token function">npm</span> run xxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="不常用指令-1"><a href="#不常用指令-1" class="headerlink" title="不常用指令"></a>不常用指令</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 打开 xxx 包的主页</span><span class="token function">npm</span> home xxx<span class="token comment"># 打开 xxx 包的代码仓库</span><span class="token function">npm</span> repo xxx<span class="token comment"># 将当前模块发布到 npmjs.com，需要先登录</span><span class="token function">npm</span> publish<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> yarn </tag>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初次登录Linux服务器马上要做的9件事</title>
      <link href="2021/052052386.html"/>
      <url>2021/052052386.html</url>
      
        <content type="html"><![CDATA[<h1 id="初次登录-Linux-服务器马上要做的-9-件事"><a href="#初次登录-Linux-服务器马上要做的-9-件事" class="headerlink" title="初次登录 Linux 服务器马上要做的 9 件事"></a>初次登录 Linux 服务器马上要做的 9 件事</h1><p>当我在 Linux 上测试软件时（这是我工作中的一个常规部分），我需要使用多台运行 Linux 的不同架构的服务器。我整备机器，安装所需的软件包，运行我的测试，收集结果，并将机器返回到仓库中，以便其他人可以使用它进行测试。</p><p>由于我经常这样做（甚至一天多次），我初次登录 Linux 服务器的前 10 分钟内的工作已经成为每天的仪式。当我初次登录 Linux 服务器时，我会使用命令来收集我需要的信息来寻找某些东西。我将在本文中介绍我的过程，但请注意，在大多数情况下，我只给出命令名称，所以你需要确定这些命令的具体选项，以获得你需要的信息。阅读命令的手册页是一个很好的起点。</p><h2 id="1、第一次接触"><a href="#1、第一次接触" class="headerlink" title="1、第一次接触"></a>1、第一次接触</h2><p>当我登录到一台服务器时，我做的第一件事就是检查它是否拥有我将要运行的测试所需的操作系统、内核和硬件架构。我经常会检查一台服务器已经运行了多久。虽然这对测试系统来说并不重要，因为它会被多次重启，但我还是发现这些信息很有帮助。</p><p>使用下面的命令来获取这些信息。我主要使用 Red Hat Linux 进行测试，所以如果你使用其他 Linux 发行版，请在文件名中使用 <code>*-release</code> 而不是 <code>redhat-release</code>：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">cat /etc/redhat-releaseuname -ahostnamectluptime<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2、有人登录在上面吗？"><a href="#2、有人登录在上面吗？" class="headerlink" title="2、有人登录在上面吗？"></a>2、有人登录在上面吗？</h2><p>一旦我知道这台机器符合我的测试需求，我需要确保没有其他人同时登录该系统运行他们自己的测试。虽然考虑到整备系统会帮我处理好这个问题，这种可能性很小，但偶尔检查一下还是有好处的 —— 尤其是当我第一次登录服务器的时候。我还会检查是否有其他用户（除了 root）可以访问系统。</p><p>使用下面的命令来查找这些信息。最后一条命令是查找 <code>/etc/passwd</code> 文件中具有 shell 访问权限的用户；它会跳过文件中没有 shell 访问权限或 shell 设置为 <code>nologin</code> 的其他服务：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">whowho -Hugrep sh$ /etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="3、物理机还是虚拟机"><a href="#3、物理机还是虚拟机" class="headerlink" title="3、物理机还是虚拟机"></a>3、物理机还是虚拟机</h2><p>现在我有了属于自己的机器，我需要确定它是一台物理机还是一台虚拟机（VM）。如果是我自己整备的这台机器，我可以确定这是我要求的东西。但是，如果你使用的是一台不是你自己整备的机器，你应该检查该机器是物理机还是虚拟机。</p><p>使用以下命令来识别这些信息。如果是物理系统，你会看到供应商的名称（如 HP、IBM 等）以及服务器的品牌和型号；而在虚拟机中，你应该看到 KVM、VirtualBox 等，这取决于创建虚拟机时使用了什么虚拟化软件：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">dmidecode -s system-manufacturerdmidecode -s system-product-namelshw -c system | grep product | head -1cat /sys/class/dmi/id/product_namecat /sys/class/dmi/id/sys_vendor<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4、硬件"><a href="#4、硬件" class="headerlink" title="4、硬件"></a>4、硬件</h2><p>因为我经常测试连接到 Linux 机器的硬件，所以我通常使用物理服务器，而不是虚拟机。在物理机器上，我的下一步是确定服务器的硬件能力 —— 例如，运行的是什么类型的 CPU，它有多少个核心，启用了哪些标志，以及有多少内存可用于运行测试。如果我正在运行网络测试，我会检查连接到服务器的以太网或其他网络设备的类型和容量。</p><p>使用以下命令来显示连接到 Linux 服务器的硬件。其中一些命令在新的操作系统版本中可能会被废弃，但你仍然可以从 yum 存储库中安装它们或切换到它们的等效新命令：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">lscpu or cat /proc/cpuinfolsmem or cat /proc/meminfoifconfig -aethtool &lt;devname&gt;lshwlspcidmidecode<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5、已安装的软件"><a href="#5、已安装的软件" class="headerlink" title="5、已安装的软件"></a>5、已安装的软件</h2><p>测试软件总是需要安装额外的依赖包、库等。然而，在安装任何东西之前，我都会检查已经安装了什么（包括是什么版本），以及配置了哪些存储库，这样我就知道软件来自哪里，并可以调试任何软件包安装问题。</p><p>使用下面的命令来确定安装了什么软件：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">rpm -qarpm -qa | grep &lt;pkgname&gt;rpm -qi &lt;pkgname&gt;yum repolistyum repoinfoyum install &lt;pkgname&gt;ls -l /etc/yum.repos.d/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6、运行的进程和服务"><a href="#6、运行的进程和服务" class="headerlink" title="6、运行的进程和服务"></a>6、运行的进程和服务</h2><p>检查了安装的软件之后，自然就会检查系统上有哪些进程在运行。当在系统上运行性能测试时，这一点至关重要 —— 如果一个正在运行的进程、守护进程、测试软件等占用了大部分 CPU/RAM，那么在运行测试之前停止该进程是有意义的。这也可以检查测试所需的进程或守护进程是否已经启动并运行。例如，如果测试需要 <code>httpd</code> 运行，那么即使安装了软件包，启动守护进程的服务也可能没有运行。</p><p>使用以下命令来识别系统上正在运行的进程和已启用的服务：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">pstree -pa 1ps -efps auxfsystemctl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7、网络连接"><a href="#7、网络连接" class="headerlink" title="7、网络连接"></a>7、网络连接</h2><p>如今的机器网络化程度很高，它们需要与网络上的其他机器或服务进行通信。我会识别服务器上哪些端口是开放的，是否有到测试机器的任何网络连接，是否启用了防火墙，如果启用了，是否屏蔽了任何端口，以及机器与哪些 DNS 服务器对话。</p><p>使用以下命令来识别网络服务相关信息。如果一个过时的命令不可用，请从 yum 存储库中安装它或使用等效的新命令：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">netstat -tulpnnetstat -anplsof -issiptables -L -ncat /etc/resolv.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="8、内核"><a href="#8、内核" class="headerlink" title="8、内核"></a>8、内核</h2><p>在进行系统测试时，我发现了解内核相关的信息是很有帮助的，比如内核版本和加载了哪些内核模块。我还会列出任何<a href="https://link.zhihu.com/?target=https://www.oreilly.com/library/view/red-hat-enterprise/9781785283550/ch10s05.html">可调整的内核参数</a>以及它们的设置，并检查启动运行中的内核时使用的选项。</p><p>使用以下命令来识别这些信息：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">uname -rcat /proc/cmdlinelsmodmodinfo &lt;module&gt;sysctl -acat /boot/grub2/grub.cfg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="9、日志"><a href="#9、日志" class="headerlink" title="9、日志"></a>9、日志</h2><p>现在，我已经对服务器有了很好的了解，包括安装了哪些软件，运行了哪些进程。还有一件事我无法逃避，那就是日志文件 —— 我需要知道在哪里可以查看不断更新的信息。</p><p>使用以下命令查看系统的日志：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">dmesgtail -f /var/log/messagesjournalctl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="接下来的步骤"><a href="#接下来的步骤" class="headerlink" title="接下来的步骤"></a>接下来的步骤</h2><p>虽然命令和实用程序会发生变化，但它们所显示的基本信息大致不变。在你专注于掌握哪些命令之前，你需要对你要寻找的信息以及它属于什么类别有一个宏观的看法。</p><p>由于 Linux 将大部分信息保存在文件中，这些命令基本上是从文件中读取信息，并以一种易于理解的方式呈现出来。下一步的好做法是找出每个命令用来获取信息显示的文件。一个提示：寻找这些信息的方法是 <code>strace</code> 命令。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git版本控制</title>
      <link href="2021/052064901.html"/>
      <url>2021/052064901.html</url>
      
        <content type="html"><![CDATA[<h2 id="Git版本控制"><a href="#Git版本控制" class="headerlink" title="Git版本控制"></a>Git版本控制</h2><p><strong>为什么要进行版本控制？</strong>  最简单的例子，当我们用文字处理软件工作时（如Word）时需要进行修改，而有时候又不确定修改的内容是不是需要的，因此会产生许多个文件，如图：  </p><p><img src="http://5coder.cn/img/image-20210617191834286.png"></p><p>每一个文件都是在之前的文件基础上进行微小的修改，久而久之，不但文件冗杂，而且还不清楚修改的内容是什么，是一种很杂乱的方式。</p><p>而版本控制就是解决这一问题——通过记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统。</p><p>采取版本控制后，你可以将文件还原到之前的状态，比较各状态之间的细节从而查出是修改了哪个地方，找出哪里出了问题。甚至你可以随意删改项目中的文件，照样可以恢复到之前的样子，因而增加了容错率，提供了更多可能性。</p><p>版本控制有三种，第一种是本地式版本控制，也就是在本地的硬盘上用数据库记录历代文件；第二种是集中式版本控制，通过一个服务器，多个用户连接到服务器进行文件的记录。 而第三种是我们着重介绍的<em>分布式版本控制</em>，它将前两种结合起来，在本地和服务器都建立数据库，每次工作时从服务器克隆（clone）下来，同时又与服务器交互，从而兼顾协同性和安全性。</p><p><em>我们所说的git就是一个分布式版本控制软件，GitHub就是一个git的托管服务。</em></p><p>​    </p><h2 id="git本地操作"><a href="#git本地操作" class="headerlink" title="git本地操作"></a>git本地操作</h2><p>git设计简单，是完全分布式，允许成千上万个并行开发的分支(Branch)，有能力管理超大规模的项目，是目前首选的版本控制软件。</p><h2 id="一、工作流程"><a href="#一、工作流程" class="headerlink" title="一、工作流程"></a>一、工作流程</h2><p>git的三个工作区域，对应着三种状态：</p><p><img src="http://5coder.cn/img/image-20210617191854594.png"></p><p> git 工作流程如下：    </p><ol><li><p> 在工作目录中修改文件。（modified）  </p></li><li><p> 暂存文件，将文件的快照放入暂存区域。（staged）  </p></li><li><p> 提交更新，找到暂存区域的文件，将快照永久性存储到 git 仓库目录。（committed）</p></li></ol><p>这是最基本的流程，需要时刻记住。  </p><h2 id="二、安装git"><a href="#二、安装git" class="headerlink" title="二、安装git"></a>二、安装git</h2><p><a href="https://link.zhihu.com/?target=https://git-scm.com/downloads">git官方网站</a>下载对应自己电脑的版本，按照指引进行安装。</p><h2 id="三、git使用知识"><a href="#三、git使用知识" class="headerlink" title="三、git使用知识"></a>三、git使用知识</h2><p>首先我们需要在本地创建一个仓库，用于存放历代版本。</p><p>1.命令行中运用cd指令进入项目的目录，输入  </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这将创建一个名为.git的隐藏子目录。    </p><p>2.git status:查看哪些文件处于什么状态  </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git statusOn branch masternothing to commit, working directory clean（创建git仓库后目录下没有文件时的情况）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>创建一个文件（test）后再使用git status命令，将会看到一个新的提示  </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git statusOn branch masterYour branch is up-to-date with 'origin/master'.Untracked files:(use "git add &lt;file&gt;..." to include in what will be committed)testnothing added to commit but untracked files present (use "git add" to track)（新建的“test”文件出现在Untracked files下）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.git add：跟踪文件 运行     </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git add test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时再运行git status，会看到test文件已被跟踪，处于暂存状态(staged)，显示Changes to be committed    </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git statusOn branch masterYour branch is up-to-date with 'origin/master'.Changes to be committed:(use "git reset HEAD &lt;file&gt;..." to unstage)test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4.git commit：提交更新至仓库  </p><p>先用git status命令确定暂存区域准备妥当， 再运行$git commit -m ”提交信息”（提交信息指本次提交的说明，类似于注释）    </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git commit -m "first"[master 5e43df6] first 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>此时会显示提交成功的信息。  </p><p>5.git diff：显示尚未暂存的改动（并不是所有改动）</p><p>6.git rm test：删除暂存区域中的文件test</p><p>7.git log:查看提交历史  </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git logcommit 5e43df6b6d003ea70444ee3125456fd75b066803Author: *** &lt;****@gmail.com&gt;Date:   Thu Mar 16 19:37:52 2017 +0800firstcommit 1c83e2a07f0279ea510e2a323fada53166c3c657Author: *** &lt;****@gmail.com&gt;Date:   Thu Mar 16 19:16:26 2017 +0800test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>8.版本回退  </p><p>在git log命令中我们可以看到类似<em>5e43……6803</em>的一大串字符，那就是版本号（commit id）我们可以用 git reset命令回退到之前任何一个版本:    </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git reset --hard 1c83e2a0   HEAD is now at 1c83e2a test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>（版本号不必补全，Git会自动去查找）</p><p>以上就是git的本地基本操作，包括创建一个仓库，更改、暂存和提交，查看仓库的提交历史，版本回退。  </p><h2 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h2><p>分支是把工作从主线上分离开来，以免影响开发主线。在不同的分支上你可以尝试各种各样的增删改，实现不同的设想。而git的分支模型是它最突出的特点，也是git脱颖而出的原因。</p><h2 id="一、分支概念"><a href="#一、分支概念" class="headerlink" title="一、分支概念"></a>一、分支概念</h2><p>在版本回退里，你可以回溯到之前的任意版本，而这些版本都是处于一条时间线上，这条时间线就是一个分支。<br> 默认的分支为master分支，本身可以看做一个指针，HEAD指针则指向master指针，如图：    </p><p><img src="http://5coder.cn/img/image-20210617191928000.png"></p><p>每次提交都会多出一个节点，指针也随之移动。<br> 当我们创建新的分支时，也就创建了一个新的指针，我们通过命令将HEAD指针移到新指针上：  </p><p><img src="http://5coder.cn/img/image-20210617192002448.png"></p><p>新提交一次后，新指针向前移动，master指针不变，这就产生了分支：<br> 我们可以将两条分支合并，之后可以删掉新分支。</p><p><img src="http://5coder.cn/img/image-20210617192018984.png"></p><p><img src="http://5coder.cn/img/image-20210617192039725.png"></p><p>这样就完成了分支的合并。</p><h2 id="二、分支使用"><a href="#二、分支使用" class="headerlink" title="二、分支使用"></a>二、分支使用</h2><p>1.git branch：查看当前所有分支      </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git branch* master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>（*标示当前分支，默认处于master分支）  </p><p>2.git branch testing : 创建testing分支      </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git branch testing<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时创建了testing分支，运行git branch命令验证       </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$git branch    *mastertesting<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>3.git checkout testing： 切换到testing分支      </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git checkout testingSwitched to branch 'testing'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>此时主分支位于testing，运行git branch命令验证   </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git branch  master* testing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>4.git merge testing：将master分支和testing分支合并  （假设处于master分支）      </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git merge testingAlready up-to-date.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>如果在两个不同的分支中，对同一个文件的同一个部分进行了不同的修改，则会产生冲突从而无法合并，只能手动解决后再合并。    </p><p>5.git branch -d删除分支  </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git branch -d testingDeleted branch testing (was 1c83e2a).<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="使用GitHub"><a href="#使用GitHub" class="headerlink" title="使用GitHub"></a>使用GitHub</h2><p>GitHub 是最大的 Git 版本库托管商，尽管这不是 Git 开源项目的直接部分，但如果想要专业地使用 Git，你将不可避免地与 GitHub 打交道。  </p><h3 id="创建帐户及配置"><a href="#创建帐户及配置" class="headerlink" title="创建帐户及配置"></a>创建帐户及配置</h3><p>1.访问<a href="https://link.zhihu.com/?target=https://github.com">https://github.com</a>进行注册  </p><p>2.SSH访问：    </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ cd ~/.ssh$ ls id_rsa     id_rsa.pub  known_hosts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>寻找到id_rsa命名的文件，.pub文件是公钥，另一个是私钥。    </p><p>如果找不到，可以运行如下命令创建它们    </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ ssh-keygen<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>进入github的帐户设置，点击左侧的SSH and GPG keys，将~/.ssh/id_rsa.pub公钥文件的内容粘贴到文本区，然后点击”Add key”    </p><p>SSH访问配置成功     </p><h3 id="创建、维护和管理你自己的项目。"><a href="#创建、维护和管理你自己的项目。" class="headerlink" title="创建、维护和管理你自己的项目。"></a>创建、维护和管理你自己的项目。</h3><p>1.点击页面右上角的＋号，点击New repository按钮</p><p><img src="http://5coder.cn/img/v2-3cf6e399f56ab213b6626c3420fee410_b.png"></p><p><img src="http://5coder.cn/img/v2-f518348e215125a7cf1e044adf9567cb_b.png"></p><p>Respository name是必填项目，而其余都是选填项，可以默认。<br> 点击Create respository按钮  ，即创建了一个新的仓库<br> 这时候可以将项目分享给其他人，通过HTTP和SSH的形式。  </p><p><img src="http://5coder.cn/img/image-20210617192124001.png"></p><p>2.对仓库进行操作，使本地和github同步  </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git remote add origin     **********（仓库地址）   （添加远程仓库至本地） $ git pull --rebase origin master    （更新远程更新到本地） $ git push -u origin master  （将本地仓库和远程仓库合并）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在今后的项目工作中就是用以上命令同步本地和Github，需要记住。  </p><p>3.克隆仓库  我们可以将远程仓库的内容克隆到本地</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ git clone git@github.com:Liuwt1997/github-photo.gitCloning into 'github-photo'...remote: Counting objects: 3, done.remote: Compressing objects: 100% (3/3), done.remote: Total 3 (delta 0), reused 3 (delta 0), pack-reused 0Receiving objects: 100% (3/3), 196.28 KiB | 67.00 KiB/s, done.Checking connectivity... done.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时远程仓库的文件全部克隆至本地。</p><p>4.添加合作者<br> 点击边栏的 “Settings” 链接，然后从左侧菜单中选择 “Collaborators” 。 然后，在输入框中填写用户名，点击 “Add collaborator.” 此时可以给予他们提交的权限。  </p><p><img src="http://5coder.cn/img/image-20210617192752177.png"></p><p>5.Fork按钮可以将他人项目派生下来，在你的空间中创建一个完全属于你的项目副本。  </p><p><img src="http://5coder.cn/img/image-20210617192804015.png"></p><p>如何对项目做出贡献呢？    </p><ol><li><p> 将派生出的副本克隆到本地</p></li><li><p> 创建出名称有意义的分支</p></li><li><p> 修改代码</p></li><li><p> 检查改动</p></li><li><p> 将改动提交到分支中</p></li><li><p> 将新分支推送到 GitHub 的副本中    </p></li></ol><p>现在到 GitHub 上查看之前的项目副本，可以看到 GitHub 提示我们有新的分支，并且显示了一个大大的绿色按钮让我们可以检查我们的改动，并给源项目创建合并请求。    </p><p>如果你点击了那个绿色按钮，就会看到一个新页面，在这里我们可以对改动填写标题和描述，让项目的拥有者考虑一下我们的改动。通常花点时间来编写个清晰有用的描述是个不错的主意，这能让作者明白为什么这个改动可以给他的项目带来好处，并且让他接受合并请求。</p>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>混子前端24个ES6代码片段</title>
      <link href="2021/052037482.html"/>
      <url>2021/052037482.html</url>
      
        <content type="html"><![CDATA[<p><strong>这篇文章基于实际使用场景总结了24个ES6代码片段，可用来解决项目中遇到的一系列问题</strong></p><h2 id="1、如何隐藏所有指定元素？"><a href="#1、如何隐藏所有指定元素？" class="headerlink" title="1、如何隐藏所有指定元素？"></a>1、如何隐藏所有指定元素？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">hide</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token operator">...</span>el<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Example</span><span class="token function">hide</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 隐藏页面上所有&lt;img /&gt;元素</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2、如何确认元素是否具有指定的类？"><a href="#2、如何确认元素是否具有指定的类？" class="headerlink" title="2、如何确认元素是否具有指定的类？"></a>2、如何确认元素是否具有指定的类？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">hasClass</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> className</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">hasClass</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"p.special"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"special"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3、如何切换元素的类？"><a href="#3、如何切换元素的类？" class="headerlink" title="3、如何切换元素的类？"></a>3、如何切换元素的类？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">toggleClass</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> className</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">toggleClass</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span> p<span class="token punctuation">.</span>special <span class="token punctuation">)</span><span class="token punctuation">,</span>  special <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 该段不再有 "special" 类</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4、如何获取当前页面的滚动位置？"><a href="#4、如何获取当前页面的滚动位置？" class="headerlink" title="4、如何获取当前页面的滚动位置？"></a>4、如何获取当前页面的滚动位置？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getScrollPosition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el <span class="token operator">=</span> window</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>     x<span class="token operator">:</span> el<span class="token punctuation">.</span>pageXOffset <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> el<span class="token punctuation">.</span>pageXOffset <span class="token operator">:</span> el<span class="token punctuation">.</span>scrollLeft<span class="token punctuation">,</span>     y<span class="token operator">:</span> el<span class="token punctuation">.</span>pageYOffset <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> el<span class="token punctuation">.</span>pageYOffset <span class="token operator">:</span> el<span class="token punctuation">.</span>scrollTop <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">getScrollPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {x: 0, y: 200}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5、如何评价滚动到页面顶部？"><a href="#5、如何评价滚动到页面顶部？" class="headerlink" title="5、如何评价滚动到页面顶部？"></a>5、如何评价滚动到页面顶部？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">scrollToTop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         <span class="token keyword">const</span> c <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>scrollToTop<span class="token punctuation">)</span><span class="token punctuation">;</span>                 window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> c <span class="token operator">-</span> c <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">scrollToTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6、如何确认父元素是否包含子元素？"><a href="#6、如何确认父元素是否包含子元素？" class="headerlink" title="6、如何确认父元素是否包含子元素？"></a>6、如何确认父元素是否包含子元素？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">elementContains</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> parent <span class="token operator">!==</span> child <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Examples  </span><span class="token function">elementContains</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"head"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true  </span><span class="token function">elementContains</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7、如何确认指定元素是否在视口可见？"><a href="#7、如何确认指定元素是否在视口可见？" class="headerlink" title="7、如何确认指定元素是否在视口可见？"></a>7、如何确认指定元素是否在视口可见？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">elementIsVisibleInViewport</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> partiallyVisible <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         <span class="token keyword">const</span> <span class="token punctuation">{</span> top<span class="token punctuation">,</span> left<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> right <span class="token punctuation">}</span> <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">const</span> <span class="token punctuation">{</span> innerHeight<span class="token punctuation">,</span> innerWidth <span class="token punctuation">}</span> <span class="token operator">=</span> window<span class="token punctuation">;</span>         <span class="token keyword">return</span> partiallyVisible <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>top <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> top <span class="token operator">&lt;</span> innerHeight<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>bottom <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> bottom <span class="token operator">&lt;</span> innerHeight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>left <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> left <span class="token operator">&lt;</span> innerWidth<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>right <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> right <span class="token operator">&lt;</span> innerWidth<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> top <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> left <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> bottom <span class="token operator">&lt;=</span> innerHeight <span class="token operator">&amp;&amp;</span> right <span class="token operator">&lt;=</span> innerWidth<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Examples </span><span class="token function">elementIsVisibleInViewport</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (不完全可见) </span><span class="token function">elementIsVisibleInViewport</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (部分可见)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="8、如何获取一个元素内的所有图像？"><a href="#8、如何获取一个元素内的所有图像？" class="headerlink" title="8、如何获取一个元素内的所有图像？"></a>8、如何获取一个元素内的所有图像？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getImages</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> includeDuplicates <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         <span class="token keyword">const</span> images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>el<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">img</span> <span class="token operator">=&gt;</span> img<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"hide"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">return</span> includeDuplicates <span class="token operator">?</span> images <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Examples </span><span class="token function">getImages</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["image1.jpg", "image2.png", "image1.png", "..."] </span><span class="token function">getImages</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["image1.jpg", "image2.png", "..."]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="9、如何分辨设备是移动设备还是桌面设备？"><a href="#9、如何分辨设备是移动设备还是桌面设备？" class="headerlink" title="9、如何分辨设备是移动设备还是桌面设备？"></a>9、如何分辨设备是移动设备还是桌面设备？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">detectDeviceType</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"Mobile"</span> <span class="token operator">:</span> <span class="token string">"Desktop"</span><span class="token punctuation">;</span> <span class="token comment">// Example detectDeviceType(); // "Mobile" or "Desktop"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="10、如何获取当前-URL？"><a href="#10、如何获取当前-URL？" class="headerlink" title="10、如何获取当前 URL？"></a>10、如何获取当前 URL？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">currentURL</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">;</span> <span class="token comment">// Example currentURL(); // "https://google.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="11、如何创建一个包含当前-URL-参数的对象？"><a href="#11、如何创建一个包含当前-URL-参数的对象？" class="headerlink" title="11、如何创建一个包含当前 URL 参数的对象？"></a>11、如何创建一个包含当前 URL 参数的对象？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getURLParameters</span> <span class="token operator">=</span> <span class="token parameter">url</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([^?=&amp;]+)(=([^&amp;]*))</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span> <span class="token operator">=</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span> <span class="token operator">=</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Examples </span><span class="token function">getURLParameters</span><span class="token punctuation">(</span><span class="token string">"http://url.com/page?n=Adam&amp;s;=Smith"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {n: "Adam", s: "Smith"} getURLParameters("google.com"); // {}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="12、如何将一组表单元素编码为一个对象？"><a href="#12、如何将一组表单元素编码为一个对象？" class="headerlink" title="12、如何将一组表单元素编码为一个对象？"></a>12、如何将一组表单元素编码为一个对象？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">formToObject</span> <span class="token operator">=</span> <span class="token parameter">form</span> <span class="token operator">=&gt;</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token operator">...</span>acc<span class="token punctuation">,</span>  <span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">:</span> value  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">formToObject</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#form"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { email: "test@email.com", name: "Test Name" }</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="13、如何从对象检索给定选择器指示的一组属性？"><a href="#13、如何从对象检索给定选择器指示的一组属性？" class="headerlink" title="13、如何从对象检索给定选择器指示的一组属性？"></a>13、如何从对象检索给定选择器指示的一组属性？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token operator">...</span>selectors</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token operator">...</span>selectors<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">s</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[([^[]]*)]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">".$1."</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> t <span class="token operator">!==</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> prev <span class="token operator">&amp;&amp;</span> prev<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> selector<span class="token operator">:</span> <span class="token punctuation">{</span> to<span class="token operator">:</span> <span class="token punctuation">{</span> val<span class="token operator">:</span> <span class="token string">"val to select"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> target<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">"test"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">"selector.to.val"</span><span class="token punctuation">,</span> <span class="token string">"target[0]"</span><span class="token punctuation">,</span> <span class="token string">"target[2].a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["val to select", 1, "test"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="14、如何在等待一定时间后调用提供的函数（单位毫秒）？"><a href="#14、如何在等待一定时间后调用提供的函数（单位毫秒）？" class="headerlink" title="14、如何在等待一定时间后调用提供的函数（单位毫秒）？"></a>14、如何在等待一定时间后调用提供的函数（单位毫秒）？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">"later"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一秒后记录 "later"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="15、如何在给定元素上触发特定事件，且可选传递自定义数据？"><a href="#15、如何在给定元素上触发特定事件，且可选传递自定义数据？" class="headerlink" title="15、如何在给定元素上触发特定事件，且可选传递自定义数据？"></a>15、如何在给定元素上触发特定事件，且可选传递自定义数据？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">triggerEvent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> eventType<span class="token punctuation">,</span> detail</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token punctuation">{</span> detail <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Examples </span><span class="token function">triggerEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"myId"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"click"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">triggerEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> myId <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">"bob"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="16、如何移除一个元素的事件侦听器？"><a href="#16、如何移除一个元素的事件侦听器？" class="headerlink" title="16、如何移除一个元素的事件侦听器？"></a>16、如何移除一个元素的事件侦听器？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">off</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> evt<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> opts <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>evt<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">off</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token string">"click"</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// no longer logs "!" upon clicking on the page</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="17、如何获得给定毫秒数的可读格式？"><a href="#17、如何获得给定毫秒数的可读格式？" class="headerlink" title="17、如何获得给定毫秒数的可读格式？"></a>17、如何获得给定毫秒数的可读格式？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">formatDuration</span> <span class="token operator">=</span> <span class="token parameter">ms</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>ms <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> ms <span class="token operator">=</span> <span class="token operator">-</span>ms<span class="token punctuation">;</span>     <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token punctuation">{</span>                 day<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>ms <span class="token operator">/</span> <span class="token number">86400000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                 hour<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>ms <span class="token operator">/</span> <span class="token number">3600000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">24</span><span class="token punctuation">,</span>                 minute<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>ms <span class="token operator">/</span> <span class="token number">60000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">,</span>                 second<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>ms <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">,</span>                 millisecond<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1000</span>          <span class="token punctuation">}</span><span class="token punctuation">;</span>         <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> val<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span> val<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val <span class="token operator">!==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"s"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Examples </span><span class="token function">formatDuration</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 second, 1 millisecond</span><span class="token function">formatDuration</span><span class="token punctuation">(</span><span class="token number">34325055574</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 397 days, 6 hours, 44 minutes, 15 seconds, 574 milliseconds</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="18、如何获取两个日期之间的天数间隔？"><a href="#18、如何获取两个日期之间的天数间隔？" class="headerlink" title="18、如何获取两个日期之间的天数间隔？"></a>18、如何获取两个日期之间的天数间隔？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getDaysDiffBetweenDates</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dateInitial<span class="token punctuation">,</span> dateFinal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>dateFinal <span class="token operator">-</span> dateInitial<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">getDaysDiffBetweenDates</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2017-12-13"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2017-12-22"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="19、如何对传递的-URL-进行-GET-请求？"><a href="#19、如何对传递的-URL-进行-GET-请求？" class="headerlink" title="19、如何对传递的 URL 进行 GET 请求？"></a>19、如何对传递的 URL 进行 GET 请求？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">httpGet</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> err <span class="token operator">=</span> console<span class="token punctuation">.</span>error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    request<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>         request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">err</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>         request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token function">httpGet</span><span class="token punctuation">(</span>    <span class="token string">"https://jsonplaceholder.typicode.com/posts/1"</span><span class="token punctuation">,</span>     console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Logs: {"userId": 1, "id": 1, "title": "sample title", "body": "my text"}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="20、如何对传递的-URL-进行-POST-请求？"><a href="#20、如何对传递的-URL-进行-POST-请求？" class="headerlink" title="20、如何对传递的 URL 进行 POST 请求？"></a>20、如何对传递的 URL 进行 POST 请求？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">httpPost</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> err <span class="token operator">=</span> console<span class="token punctuation">.</span>error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span> <span class="token constant">POST</span> <span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         request<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span> Content<span class="token operator">-</span>type <span class="token punctuation">,</span>  application<span class="token operator">/</span>json<span class="token punctuation">;</span> charset<span class="token operator">=</span>utf<span class="token operator">-</span><span class="token number">8</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>         request<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>         request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">err</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>         request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">const</span> newPost <span class="token operator">=</span> <span class="token punctuation">{</span>     userId<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>     id<span class="token operator">:</span> <span class="token number">1337</span><span class="token punctuation">,</span>     title<span class="token operator">:</span>  Foo <span class="token punctuation">,</span>         body<span class="token operator">:</span>  bar bar bar  <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>newPost<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">httpPost</span><span class="token punctuation">(</span>    <span class="token string">"https://jsonplaceholder.typicode.com/posts"</span><span class="token punctuation">,</span>     data<span class="token punctuation">,</span>    console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Logs: {"userId": 1, "id": 1337, "title": "Foo", "body": "bar bar bar"}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="21、如何为指定选择器创建具有指定范围、步长和持续时间的计时器？"><a href="#21、如何为指定选择器创建具有指定范围、步长和持续时间的计时器？" class="headerlink" title="21、如何为指定选择器创建具有指定范围、步长和持续时间的计时器？"></a>21、如何为指定选择器创建具有指定范围、步长和持续时间的计时器？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">counter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">selector<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> step <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> duration <span class="token operator">=</span> <span class="token number">2000</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         <span class="token keyword">let</span> current <span class="token operator">=</span> start<span class="token punctuation">,</span>         _step <span class="token operator">=</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">*</span> step <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token operator">-</span>step <span class="token operator">:</span> step<span class="token punctuation">,</span>         timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                 current <span class="token operator">+=</span> _step<span class="token punctuation">;</span>                 document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> current<span class="token punctuation">;</span>                 <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">&gt;=</span> end<span class="token punctuation">)</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> end<span class="token punctuation">;</span>                 <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">&gt;=</span> end<span class="token punctuation">)</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>duration <span class="token operator">/</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">return</span> timer<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">counter</span><span class="token punctuation">(</span> #my<span class="token operator">-</span>id <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 为 id="my-id" 的元素创建一个两秒的计时器</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="22、如何将一个字符串复制到剪贴板？"><a href="#22、如何将一个字符串复制到剪贴板？" class="headerlink" title="22、如何将一个字符串复制到剪贴板？"></a>22、如何将一个字符串复制到剪贴板？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">copyToClipboard</span> <span class="token operator">=</span> <span class="token parameter">str</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span> textarea <span class="token punctuation">)</span><span class="token punctuation">;</span>         el<span class="token punctuation">.</span>value <span class="token operator">=</span> str<span class="token punctuation">;</span>         el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span> readonly <span class="token punctuation">,</span>   <span class="token punctuation">)</span><span class="token punctuation">;</span>         el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span>  absolute <span class="token punctuation">;</span>         el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span>  <span class="token operator">-</span><span class="token number">9999</span>px <span class="token punctuation">;</span>         document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">const</span> selected <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rangeCount <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>         el<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span> copy <span class="token punctuation">)</span><span class="token punctuation">;</span>         document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>selected<span class="token punctuation">)</span> <span class="token punctuation">{</span>                 document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>selected<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">copyToClipboard</span><span class="token punctuation">(</span> Lorem ipsum <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  Lorem ipsum  copied to clipboard.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="23、如何确定页面的浏览器选项卡是否处于前台活跃状态？"><a href="#23、如何确定页面的浏览器选项卡是否处于前台活跃状态？" class="headerlink" title="23、如何确定页面的浏览器选项卡是否处于前台活跃状态？"></a>23、如何确定页面的浏览器选项卡是否处于前台活跃状态？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">isBrowserTabFocused</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>document<span class="token punctuation">.</span>hidden<span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">isBrowserTabFocused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="24、如果一个目录不存在，如何创建它？"><a href="#24、如果一个目录不存在，如何创建它？" class="headerlink" title="24、如果一个目录不存在，如何创建它？"></a>24、如果一个目录不存在，如何创建它？</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span> fs <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">const</span> <span class="token function-variable function">createDirIfNotExists</span> <span class="token operator">=</span> <span class="token parameter">dir</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token operator">?</span> fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Example </span><span class="token function">createDirIfNotExists</span><span class="token punctuation">(</span> test <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// creates the directory  test , if it doesn t exist</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>es6之扩展运算符</title>
      <link href="2021/052022356.html"/>
      <url>2021/052022356.html</url>
      
        <content type="html"><![CDATA[<h1 id="es6扩展运算符"><a href="#es6扩展运算符" class="headerlink" title="es6扩展运算符"></a>es6扩展运算符</h1><h2 id="对象的扩展运算符"><a href="#对象的扩展运算符" class="headerlink" title="对象的扩展运算符"></a>对象的扩展运算符</h2><p>理解对象的扩展运算符其实很简单，只要记住一句话就可以：</p><blockquote><p><strong><code>对象中的扩展运算符(...)用于取出参数对象中的所有可遍历属性，拷贝到当前对象之中</code></strong></p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> baz <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>bar <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// { a: 1, b: 2 }</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>上述方法实际上等价于:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> baz <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { a: 1, b: 2 }</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>Object.assign</code>方法用于对象的合并，将源对象<code>（source）</code>的所有可枚举属性，复制到目标对象<code>（target）</code>。</p><p><code>Object.assign</code>方法的第一个参数是目标对象，后面的参数都是源对象。(<strong>如果目标对象与源对象有同名属性，或多个源对象有同名属性，则后面的属性会覆盖前面的属性</strong>)。</p><p>同样，如果用户自定义的属性，放在扩展运算符后面，则扩展运算符内部的同名属性会被覆盖掉。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> baz <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>bar<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// {a: 2, b: 4}</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>利用上述特性就可以很方便的修改对象的部分属性。在<code>redux</code>中的<code>reducer</code>函数规定必须是<strong>一个纯函数</strong>（如果不是很清楚什么是纯函数的可以参考<a href="http://huziketang.mangojuice.top/books/react/lesson32">这里</a>），<code>reducer</code>中的<code>state</code>对象要求不能直接修改，可以通过扩展运算符把修改路径的对象都复制一遍，然后产生一个新的对象返回。</p><p>这里有点需要注意的是<strong>扩展运算符对对象实例的拷贝属于一种浅拷贝</strong>。肯定有人要问什么是浅拷贝？我们知道<code>javascript</code>中有两种数据类型，分别是<em>基础数据类型</em>和<em>引用数据类型</em>。<em>基础数据类型</em>是按值访问的，常见的<em>基础数据类型</em>有<code>Number</code>、<code>String</code>、<code>Boolean</code>、<code>Null</code>、<code>Undefined</code>，这类变量的拷贝的时候会完整的复制一份；<em>引用数据类型</em>比如<code>Array</code>，在拷贝的时候拷贝的是对象的引用，当原对象发生变化的时候，拷贝对象也跟着变化，比如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>obj1<span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">'2-edited'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a: 1, b: 2}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  {a: 1, b: "2-edited"}</span><span class="token number">1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面这个例子扩展运算符拷贝的对象是<em>基础数据类型</em>，因此对<code>obj2</code>的修改并不会影响<code>obj1</code>，如果改成这样：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token punctuation">{</span>nickName<span class="token operator">:</span> <span class="token string">'d'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>obj1<span class="token punctuation">}</span><span class="token punctuation">;</span>obj2<span class="token punctuation">.</span>c<span class="token punctuation">.</span>nickName <span class="token operator">=</span> <span class="token string">'d-edited'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a: 1, b: 2, c: {nickName: 'd-edited'}}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a: 1, b: 2, c: {nickName: 'd-edited'}}</span><span class="token number">12345</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里可以看到，对<code>obj2</code>的修改影响到了被拷贝对象<code>obj1</code>，原因上面已经说了，因为<code>obj1</code>中的对象<code>c</code>是一个引用数据类型，拷贝的时候拷贝的是对象的引用。</p><h2 id="数组的扩展运算符"><a href="#数组的扩展运算符" class="headerlink" title="数组的扩展运算符"></a>数组的扩展运算符</h2><p>扩展运算符同样可以运用在对数组的操作中。</p><ul><li>可以将数组转换为参数序列</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">...</span>numbers<span class="token punctuation">)</span> <span class="token comment">// 42</span><span class="token number">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>可以复制数组</li></ul><p>如果直接通过下列的方式进行数组复制是不可取的：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> arr2 <span class="token operator">=</span> arr1<span class="token punctuation">;</span>arr2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>arr1 <span class="token comment">// [2, 2]</span><span class="token number">1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>原因上面已经介绍过，用扩展运算符就很方便：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arr1<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>还是记住那句话：<strong>扩展运算符(…)用于取出参数对象中的所有可遍历属性，拷贝到当前对象之中</strong>，这里参数对象是个数组，数组里面的所有对象都是基础数据类型，将所有基础数据类型重新拷贝到新的数组中。</p><ul><li>扩展运算符可以与解构赋值结合起来，用于生成数组</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>first<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>first <span class="token comment">// 1</span>rest  <span class="token comment">// [2, 3, 4, 5]</span><span class="token number">123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>需要注意的一点是：</p><blockquote><p><strong>如果将扩展运算符用于数组赋值，只能放在参数的最后一位，否则会报错。</strong></p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token operator">...</span>rest<span class="token punctuation">,</span> last<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 报错</span><span class="token keyword">const</span> <span class="token punctuation">[</span>first<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">,</span> last<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 报错</span><span class="token number">1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>扩展运算符还可以将字符串转为真正的数组</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token operator">...</span><span class="token string">'hello'</span><span class="token punctuation">]</span><span class="token comment">// [ "h", "e", "l", "l", "o" ]</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>任何 Iterator 接口的对象（参阅 Iterator 一章），都可以用扩展运算符转为真正的数组</li></ul><p>这点说的比较官方，大家具体可以参考阮一峰老师的<a href="http://es6.ruanyifeng.com/?search=map&amp;x=0&amp;y=0#docs/array">ECMAScript 6入门教程</a>。</p><p>比较常见的应用是可以将某些数据结构转为数组,比如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// arguments对象</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token number">1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用于替换<code>es5</code>中的<code>Array.prototype.slice.call(arguments)</code>写法。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>扩展运算符的用法就说到这里，介绍的不全但都是些最常见的用法。</p>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue生命周期</title>
      <link href="2021/052019670.html"/>
      <url>2021/052019670.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue学习——生命周期"><a href="#Vue学习——生命周期" class="headerlink" title="Vue学习——生命周期"></a>Vue学习——生命周期</h1><p>每个 Vue 实例在被创建时都要经过一系列的初始化过程——例如，需要设置数据监听、编译模板、将实例挂载到 DOM 并在数据变化时更新 DOM 等。同时在这个过程中也会运行一些叫做<strong>生命周期钩子</strong>的函数，这给了用户在不同阶段添加自己的代码的机会。</p><p><img src="http://5coder.cn/img/ufJwjZr6YklT4F7.png"></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>数据更新<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg=<span class="token punctuation">'</span>No<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>h3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{msg}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      msg<span class="token operator">:</span> <span class="token string">'ok'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'show方法被调用'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log(this.msg)  // undefined</span>      <span class="token comment">// this.show()  // this.show is not a function</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log(this.msg)  // ok</span>      <span class="token comment">// this.show()  // show方法被调用</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log(document.getElementById('h3').innerHTML)  // {{msg}}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log(document.getElementById('h3').innerHTML)  // ok</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log(document.getElementById('h3').innerHTML)  // ok</span>      <span class="token comment">// console.log('data中的数据' + this.msg)  // No</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// console.log('界面上的内容' + document.getElementById('h3').innerHTML)  // ok</span>      <span class="token comment">// console.log('data中的数据' + this.msg)  // ok</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue过滤器、修饰符、动画</title>
      <link href="2021/05201929.html"/>
      <url>2021/05201929.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue——过滤器、键盘修饰符、动画等"><a href="#Vue——过滤器、键盘修饰符、动画等" class="headerlink" title="Vue——过滤器、键盘修饰符、动画等"></a>Vue——过滤器、键盘修饰符、动画等</h1><h2 id="1-过滤器"><a href="#1-过滤器" class="headerlink" title="1.过滤器"></a>1.过滤器</h2><blockquote><p>Vue.js 允许你自定义过滤器，可被用于一些常见的文本格式化。过滤器可以用在两个地方：<strong>双花括号插值（Mustache）和 <code>v-bind</code> 表达式</strong> (后者从 2.1.0+ 开始支持)。过滤器应该被添加在 JavaScript 表达式的尾部，由“管道”符号指示</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--在Mustache中使用过滤器--&gt;</span>{{message | capitalize}}<span class="token comment">&lt;!--在v-bind中使用过滤器--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rawId | formatId<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-1私有过滤器"><a href="#1-1私有过滤器" class="headerlink" title="1.1私有过滤器"></a>1.1私有过滤器</h3><p>在组件的选项中定义本地的过滤器，使用filters</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{msg | capitalize}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      msg<span class="token operator">:</span> <span class="token string">'hello world'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    filters<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function-variable function">capitalize</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">''</span>        value <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2全局过滤器"><a href="#1-2全局过滤器" class="headerlink" title="1.2全局过滤器"></a>1.2全局过滤器</h3><p>在创建Vue实例之前定义全局过滤器</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{msg | capitalize2}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'capitalize2'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">''</span>    <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      msg<span class="token operator">:</span> <span class="token string">'hello world'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注意：当局部和全局有两个同名过滤器时，被控制实例优先使用私有过滤器，即局部过滤器优先于全局过滤器被调用！</strong></p></blockquote><h2 id="2-键盘修饰符及"><a href="#2-键盘修饰符及" class="headerlink" title="2.键盘修饰符及"></a>2.键盘修饰符及</h2><blockquote><p>在监听键盘事件时，我们经常需要检查详细的按键。Vue 允许为 <code>v-on</code> 在监听键盘事件时添加按键修饰符</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- 只有在 `key` 是 `Enter` 时调用 `vm.submit()` --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup.enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--使用 keyCode attribute 也是允许的--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup.13</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为在必要的情况下支持旧浏览器，Vue提供了绝大多数常用的按键码的别名：</p><ul><li>.enter</li><li>.tab</li><li>.delete(捕获删除和退格键)</li><li>.esc</li><li>.space</li><li>.up</li><li>.down</li><li>.left</li><li>.right</li></ul><blockquote><p>通过config.ketCodes对象自定义按键修饰符别名</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html">Vue.config.keyCodes.f1 = 112<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-系统修饰键"><a href="#3-系统修饰键" class="headerlink" title="3.系统修饰键"></a>3.系统修饰键</h2><p>可以通过一下修饰符来实现**<u>仅在按下相应按键时才出发鼠标或键盘事件的监听器</u>**</p><ul><li>.ctrl</li><li>.alt</li><li>.shift</li><li>.meta</li></ul><blockquote><p><strong>注意：在 Mac 系统键盘上，meta 对应 command 键 (⌘)。在 Windows 系统键盘 meta 对应 Windows 徽标键 (⊞)。在 Sun 操作系统键盘上，meta 对应实心宝石键 (◆)。在其他特定键盘上，尤其在 MIT 和 Lisp 机器的键盘、以及其后继产品，比如 Knight 键盘、space-cadet 键盘，meta 被标记为“META”。在 Symbolics 键盘上，meta 被标记为“META”或者“Meta”。</strong></p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- Alt + C --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup.alt.67</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- Ctrl + Click --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click.ctrl</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>doSomething<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Do Something<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注意：修饰键与常规按键不同，在和 keyup 时间一起使用时，时间触发时修饰键必须处于按下状态。换句话说，只有在按住Ctrl的情况下释放其他按键，才能触发keyUp.ctrl。而单单释放ctrl也不会出发时间。如果想要这样的行为，请为Ctrl换用keyCode:keyup.17。</strong></p></blockquote><h3 id="3-1-exact修饰符"><a href="#3-1-exact修饰符" class="headerlink" title="3.1 .exact修饰符"></a>3.1 .exact修饰符</h3><p>.exact修饰符允许控制由精确的系统修饰符组合触发的事件。</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 即使Alt或Shift被同时按下时也会触发 --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click.ctrl</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onClick<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>即使Alt或Shift被同时按下时也会触发<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--  有且只有Ctrl被按下的时候才会触发--&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click.ctrl.exact</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onCtrlClick<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>有且只有Ctrl被按下的时候才会触发<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--  没有任何系统修饰符被按下的是否才触发--&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click.exact</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onClickWithout<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>没有任何系统修饰符被按下的是否才触发<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'即使Alt或Shift被同时按下时也会触发'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">onCtrlClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'有且只有Ctrl被按下的时候才会触发'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">onClickWithout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'没有任何系统修饰符被按下的是否才触发'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2鼠标按钮修饰符"><a href="#3-2鼠标按钮修饰符" class="headerlink" title="3.2鼠标按钮修饰符"></a>3.2鼠标按钮修饰符</h3><ul><li>.left</li><li>.right</li><li>.middle</li></ul><p>这些修饰符会限制处理函数仅响应特定的鼠标按钮。</p><h2 id="4-vue-resource实现get-post-jsonp请求"><a href="#4-vue-resource实现get-post-jsonp请求" class="headerlink" title="4.vue-resource实现get/post/jsonp请求"></a>4.vue-resource实现get/post/jsonp请求</h2><h3 id="4-1-JSONP"><a href="#4-1-JSONP" class="headerlink" title="4.1 JSONP"></a>4.1 JSONP</h3><p>jsonp实现原理</p><blockquote><ul><li>由于浏览器安全限制，不允许ajax访问协议不同、域名不同、端口号不同的数据接口，浏览器认为这种访问不安全</li><li>可以通过动态创建script标签的形式，把script标签的src属性指向数据接口的地址，因为script标签不存在跨域限制，这种数据获取方式称作JSONP（注意：根据JSONP实现原理，了解到JSONP只能实现GET请求）</li></ul></blockquote><p>具体实现过程</p><ul><li>```<br>先在客户端定义一个回调方法，预定义对数据的操作<br>再把这个回调方法的名称，通过URL传参的形式，提交到服务器的数据接口<br>服务器数据接口组织好要发给客户端的数据，再拿着客户端传递过来的回调方法名称，拼接出一个调用这个方法的字符串，发送给客户端去解析执行<br>客户端拿到服务器返回的字符串之后，当做script脚本去解析之星，这就拿到了JSONP的数据了<pre class="line-numbers language-none"><code class="language-none">Node.js手动实现JSONP请求案例（服务器案例）```jsconst http = require('http')// 导入解析URL地址的核心模块const urlModule = require('url')const server = http.createServer();// 监听服务器request请求事件，处理每个请求server.on('request', (req, res) =&gt; {  const url = req.url    // 解析客户端请求的URL地址  let info = urlModule.parse(url, true)    // 如果请求的URL地址是/getjsonp，则表示要获取JSONP类型的数据  if (info.pathname === '/getjsonp') {    // 获取客户端指定的回调函数的名称    let cbName = info.query.callback    console.log(info)        // 手动拼接要返回给客户端的数据    let data = {      name: 'zhangsan',      age: '12',      gender: 'man',      hobby: ['eating', 'sleeping', 'play doudou']    }        // 拼接出一个方法的调用，把要发送给客户端的数据，序列化为字符串，作为参数传递给这个调用的方法    let result = `${cbName}(${JSON.stringify(data)})`    // 将拼接好的方法的调用，返回给客户端去解析执行    res.end(result)  } else {    res.end('404')  }})server.listen(3000, () =&gt; {  console.log('server running at 3000')})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>原生JavaScript实现jsonp案例</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">function</span> <span class="token function">myJSONP</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">URL</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> cbName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 给系统定义一个全局按量callbackName, 指向callback</span>    window<span class="token punctuation">[</span>cbName<span class="token punctuation">]</span> <span class="token operator">=</span> callback    <span class="token comment">// 创建script节点</span>    <span class="token keyword">let</span> scriptObj <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>    <span class="token comment">// 和image不同，script的src不会发送http请求</span>    scriptObj<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span>    scriptObj<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/javascript'</span>    <span class="token comment">// script标签的请求是在上树的时候发出，请求的是一个函数的执行语句</span>    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>scriptObj<span class="token punctuation">)</span>    <span class="token comment">// 为了不污染页面，迅速把script拿掉</span>    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>scriptObj<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// 使用</span>  <span class="token function">myJSONP</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:3000/getjsonp?callback=cbName'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'cbName'</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">[</span><span class="token string">'cbName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-2-vue-resource基本使用"><a href="#4-2-vue-resource基本使用" class="headerlink" title="4.2 vue-resource基本使用"></a>4.2 vue-resource基本使用</h3><p>vue-resource配置步骤</p><ul><li><p>直接通过script标签引入，先引入vue.js，再引入vue-resource.js</p></li><li><p>发送get请求：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 在vue实例上的method中添加方法</span><span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8899/api/getlunbo'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>body<span class="token punctuation">)</span> <span class="token comment">// 数据在response响应对象中的body中  </span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>发送post请求：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">postInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:8899/api/post'</span>      <span class="token comment">// post方法接收三个参数</span>      <span class="token comment">// 1.要请求的URL地址；</span>      <span class="token comment">// 2.要发送的数据对象；</span>      <span class="token comment">// 3.指定post提交的编码类型为application/x-www-form-urlencode</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'zhangsan'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>emulateJSON<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>发送JSONP请求</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">jsonpInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:8899/api/jsonp'</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">jsonp</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>body<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="5-Vue动画"><a href="#5-Vue动画" class="headerlink" title="5.Vue动画"></a>5.Vue动画</h2><blockquote><p>vue在插入、更新或者移除DOM时，提供了多种不同方式的应用过渡效果，包括以下工具：</p><ul><li>在CSS过度和动画中自动应用class</li><li>配合第三方CSS动画库，如Animate.css</li><li>在过渡钩子函数中使用JavaScript直接操作DOM（Vue不推荐直接操作DOM）</li><li>配合第三方JavaScript动画库，如Velocity.js</li></ul></blockquote><h3 id="5-1-单元素-组件过度"><a href="#5-1-单元素-组件过度" class="headerlink" title="5.1 单元素/组件过度"></a>5.1 单元素/组件过度</h3><p>Vue提供了transition的封装组件，在下列情况下可以给任何元素和组件添加进入/离开过渡</p><ul><li>条件渲染（v-if）</li><li>条件展示（v-show）</li><li>动态组件</li><li>组件根节点</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">      <span class="token selector">.fade-enter-active, .fade-leave-active</span> <span class="token punctuation">{</span>        <span class="token property">transition</span><span class="token punctuation">:</span> opacity 0.5s<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector">.fade-enter, .fade-leave-to</span> <span class="token punctuation">{</span>  <span class="token comment">/* .fade-leave-active below version 2.1.8 */</span>          <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>      <span class="token punctuation">}</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show=!show<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>show<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fade<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--name属性定义动画--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>这是需要动画效果的元素<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      show<span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当插入或删除包含在<font color="red">&nbsp;transition</font>组件中的元素时，Vue会做以下处理：</p><ul><li>自动嗅探目标元素是否应用了CSS过度或动画，如果是，在恰当的时机添加/删除css类名</li><li>如果过度组件提供了<font color="lightgreen">JavaScript钩子函数</font>,这些钩子函数将在恰当的时机被调用</li><li>如果没有找到JavaScript钩子函数并且也没有检测到css过渡/动画，DOM操作（插入或删除）在下一帧中立即执行（注意：此指浏览器逐帧动画机制，和Vue的<font color="red">nextTick</font>）不同</li></ul><h3 id="5-3-使用过渡类名"><a href="#5-3-使用过渡类名" class="headerlink" title="5.3 使用过渡类名"></a>5.3 使用过渡类名</h3><p>在进入/离开的过渡中，会有6个class切换。</p><ol><li><font color="red">v-enter</font>：定义进入过渡的开始状态。在元素被插入之前生效，在元素被插入之后的下一帧移除。</li><li><font color="red">v-enter-active：</font>定义进入过渡生效时的状态。在整个进入过渡的阶段中应用，在元素被插入之前生效，在过渡/动画完成之后移除。这个类可以被用来定义进入过渡的过程时间，延迟和曲线函数。</li><li><font color="red">v-enter-to：</font><strong>2.1.8版本以上</strong>定义进入过渡的结束状态。在元素被插入之后下一帧生效（与此同时<font color="red">v-enter</font>被移除），在过渡/动画完成之后移除。</li><li><font color="red">v-leave：</font>定义离开过渡的开始状态。在离开过渡被触发时立刻生效，下一帧被移除。</li><li><font color="red">v-leave-active：</font>定义过渡生效时的状态。在整个离开过渡的阶段中应用，在离开过渡被触发时立刻生效，在过渡/动画完成之后移除。这个类可以被用来定义离开过渡的过渡时间，延迟和曲线函数。</li><li><font color="red">v-leave-to：</font><strong>2.1.8版本以上</strong>定义离开过渡的结束状态。在离开过渡被触发之后的下一帧生效（与此同时<font color="red">v-leave</font>被删除），在过渡/动画完成之后移除。</li></ol><p>对于这些在过渡中切换的类名来说，如果你使用一个没有名字的 <code>&lt;transition&gt;</code>，则 <code>v-</code> 是这些类名的默认前缀。如果你使用了 <code>&lt;transition name="my-transition"&gt;</code>，那么 <code>v-enter</code> 会替换为 <code>my-transition-enter</code>。</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">      <span class="token selector">.fade-enter-active,      .fade-leave-active</span> <span class="token punctuation">{</span>          <span class="token property">transition</span><span class="token punctuation">:</span> all 2s ease<span class="token punctuation">;</span>          <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector">.fade-enter,      .fade-leave-to</span> <span class="token punctuation">{</span>          <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>          <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>100px<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>动起来<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myAnimate<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- 使用transition将需要过渡的元素包裹起来 --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fade<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--transition使用name属性，则style样式中就会以定义的name作为前缀--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isShow<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>动画哦<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      isShow<span class="token operator">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function">myAnimate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>isShow <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isShow      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-4-CSS动画"><a href="#5-4-CSS动画" class="headerlink" title="5.4 CSS动画"></a>5.4 CSS动画</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">      <span class="token selector">.bounce-enter-active</span> <span class="token punctuation">{</span>          <span class="token property">animation</span><span class="token punctuation">:</span> bounce-in .5s<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector">.bounce-leave-active</span> <span class="token punctuation">{</span>          <span class="token property">animation</span><span class="token punctuation">:</span> bounce-in .5s reverse<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token atrule"><span class="token rule">@keyframes</span> bounce-in</span> <span class="token punctuation">{</span>  <span class="token comment">/* 定义动画 */</span>          <span class="token selector">0%</span> <span class="token punctuation">{</span>              <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token selector">50%</span> <span class="token punctuation">{</span>              <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1.5<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token selector">100%</span> <span class="token punctuation">{</span>              <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show = !show<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Toggle Show<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bounce<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>这是一大段话这是一大段话这是一大段话这是一大段话这是一大段话这是一大段话这是一大段话这是一大段话这是一大段话这是一大段话<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      show<span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-5-自定义过渡的类名"><a href="#5-5-自定义过渡的类名" class="headerlink" title="5.5 自定义过渡的类名"></a>5.5 自定义过渡的类名</h3><p>通过以下attribute自定义过渡类名：</p><ul><li>enter-class</li><li>enter-active-class</li><li>enter-to-calss(2.1.8+)</li><li>leave-class</li><li>leave-active-class</li><li>leave-to-calss(2.1.8+)</li></ul><p>示例：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/animate.css@3.5.1<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show = !show<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Toggle render<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--自定义过渡的类名--&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span>    <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>custom-classes-transition<span class="token punctuation">"</span></span>    <span class="token attr-name">enter-active</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>animated tada<span class="token punctuation">"</span></span>    <span class="token attr-name">leave-active-class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>animated bounceOutRight<span class="token punctuation">"</span></span>  <span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      show<span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-6-显性的过度持续时间"><a href="#5-6-显性的过度持续时间" class="headerlink" title="5.6 显性的过度持续时间"></a>5.6 显性的过度持续时间</h3><blockquote><p>很多情况下，Vue可以自动得出过渡效果的完成时机。默认情况下，Vue会等待其在过渡效果的根元素的第一个transitionend或animateend事件。然而也可以不这样设定，比如可以拥有一个精心编排的一系列过渡效果，其中一些嵌套的内部元素相比于过渡相国的根元素有延迟或更长的过渡效果。</p><p>这种情况下可以用<transition>组件上的duration prop定制一个显性的过度持续时间（单位为毫秒）</transition></p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">:duration</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>也可以告知进入和移出的持续时间：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">:duration</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ enter: 500, leave: 800}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="5-7-JavaScript动画钩子函数"><a href="#5-7-JavaScript动画钩子函数" class="headerlink" title="5.7 JavaScript动画钩子函数"></a>5.7 JavaScript动画钩子函数</h3><p>可以在transition的attribute中声明JavaScript钩子</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span>    <span class="token attr-name">@before-enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beforeEnter<span class="token punctuation">"</span></span>    <span class="token attr-name">@enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>enter<span class="token punctuation">"</span></span>    <span class="token attr-name">@after-enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>afterEnter<span class="token punctuation">"</span></span>    <span class="token attr-name">@enter-cancelled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>enterCancelled<span class="token punctuation">"</span></span>    <span class="token attr-name">@before-leave</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beforeLeave<span class="token punctuation">"</span></span>    <span class="token attr-name">@leave</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>leave<span class="token punctuation">"</span></span>    <span class="token attr-name">@after-leave</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>afterLeave<span class="token punctuation">"</span></span>    <span class="token attr-name">@leave-cancelled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>leaveCancelled<span class="token punctuation">"</span></span>  <span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--  DOM元素  --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token comment">// ----进入中-----</span>      <span class="token function">beforeEnter</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ...</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token comment">// 当与CSS结合使用时，回调函数done是可选的</span>      <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ...</span>        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">afterEnter</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ...</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">enterCancelled</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ...</span>      <span class="token punctuation">}</span>      <span class="token comment">// ----离开时----</span>      <span class="token function">beforeLeave</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ...</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token comment">// 当与 CSS 结合使用时</span>      <span class="token comment">// 回调函数 done 是可选的</span>      <span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ...</span>        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">afterLeave</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ...</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token comment">// leaveCancelled 只用于 v-show 中</span>      <span class="token function">leaveCancelled</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ...</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这些钩子函数可以结合CSS <font color="red">transitions/animations</font>使用，也可以单独使用。</p><p>当只用 JavaScript 过渡的时候，<strong>在 <code>enter</code> 和 <code>leave</code> 中必须使用 <code>done</code> 进行回调</strong>。否则，它们将被同步调用，过渡会立即完成。</p><p>推荐对于仅使用 JavaScript 过渡的元素添加 <code>v-bind:css="false"</code>，Vue 会跳过 CSS 的检测。这也可以避免过渡过程中 CSS 的影响。</p><p>案例：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show = !show<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Toggle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">@before-enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beforeEnter<span class="token punctuation">"</span></span> <span class="token attr-name">@enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>enter<span class="token punctuation">"</span></span> <span class="token attr-name">@leave</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>leave<span class="token punctuation">"</span></span> <span class="token attr-name">:css</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.3/velocity.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      show<span class="token operator">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function">beforeEnter</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">0</span>        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transformOrigin <span class="token operator">=</span> <span class="token string">'left'</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">Velocity</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span>opacity<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> fontSize<span class="token operator">:</span> <span class="token string">'1.4em'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>duration<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token function">Velocity</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span>fontSize<span class="token operator">:</span> <span class="token string">'1em'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>complete<span class="token operator">:</span> done<span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">Velocity</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span>translateX<span class="token operator">:</span> <span class="token string">'15px'</span><span class="token punctuation">,</span> rotateZ<span class="token operator">:</span> <span class="token string">'50deg'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>duration<span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token function">Velocity</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span>rotateZ<span class="token operator">:</span> <span class="token string">'100deg'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>loop<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token function">Velocity</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span>          rotateZ<span class="token operator">:</span> <span class="token string">'45deg'</span><span class="token punctuation">,</span>          translateY<span class="token operator">:</span> <span class="token string">'30px'</span><span class="token punctuation">,</span>          translateX<span class="token operator">:</span> <span class="token string">'30px'</span><span class="token punctuation">,</span>          opacity<span class="token operator">:</span> <span class="token number">0</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>complete<span class="token operator">:</span> done<span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-8-transition-mode"><a href="#5-8-transition-mode" class="headerlink" title="5.8  transition mode"></a>5.8  transition mode</h3><p><code>&lt;transition&gt;</code> 的默认行为 - 进入和离开同时发生。</p><p>同时生效的进入和离开的过渡不能满足所有要求，所以 Vue 提供了<strong>过渡模式</strong></p><ul><li><code>in-out</code>：新元素先进行过渡，完成之后当前元素过渡离开。</li><li><code>out-in</code>：当前元素先进行过渡，完成之后新元素过渡进入。</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fade<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>out-in<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- ... the buttons ... --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fade<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>in-out<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- ... the buttons ... --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="5-9-多个组件的过渡"><a href="#5-9-多个组件的过渡" class="headerlink" title="5.9 多个组件的过渡"></a>5.9 多个组件的过渡</h3><p>多个组件的过渡简单很多 - 我们不需要使用 <code>key</code> attribute。相反，我们只需要使用<a href="https://cn.vuejs.org/v2/guide/components.html#%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6">动态组件</a>：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"><span class="token selector">.component-fade-enter-active, .component-fade-leave-active</span> <span class="token punctuation">{</span>    <span class="token property">transition</span><span class="token punctuation">:</span> opacity .3s ease<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  .component-fade-enter<span class="token punctuation">,</span> .component-fade-leave-to  <span class="token comment">/* .component-fade-leave-active for below version 2.1.8 */</span> <span class="token punctuation">{</span>    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>  <span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>component-fade<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>out-in<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token operator">:</span> <span class="token string">'#transition-components-demo'</span><span class="token punctuation">,</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span>    view<span class="token operator">:</span> <span class="token string">'v-a'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  components<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token string">'v-a'</span><span class="token operator">:</span> <span class="token punctuation">{</span>      template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;Component A&lt;/div&gt;'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token string">'v-b'</span><span class="token operator">:</span> <span class="token punctuation">{</span>      template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;Component B&lt;/div&gt;'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-10-列表过渡"><a href="#5-10-列表过渡" class="headerlink" title="5.10 列表过渡"></a>5.10 列表过渡</h3><p>那么怎么同时渲染整个列表，比如使用 <code>v-for</code>？在这种场景中，使用 <strong><code>&lt;transition-group&gt;</code></strong> 组件。在我们深入例子之前，先了解关于这个组件的几个特点：</p><ul><li>不同于 <code>&lt;transition&gt;</code>，它会以一个真实元素呈现：默认为一个 <code>&lt;span&gt;</code>。你也可以通过 <code>tag</code> attribute 更换为其他元素。</li><li><a href="https://cn.vuejs.org/v2/guide/transitions.html#%E8%BF%87%E6%B8%A1%E6%A8%A1%E5%BC%8F">过渡模式</a>不可用，因为我们不再相互切换特有的元素。</li><li>内部元素<strong>总是需要</strong>提供唯一的 <code>key</code> attribute 值。</li><li>CSS 过渡的类将会应用在内部的元素中，而不是这个组/容器本身。</li></ul><p>列表的进入/离开过渡</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">      <span class="token comment">/* transition-group中自定义了name属性，因此需要使用list为前缀 */</span>      <span class="token selector">.list-enter,      .list-leave-to</span> <span class="token punctuation">{</span>          <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>          <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>10px<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector">.list-enter-active,      .list-leave-active</span> <span class="token punctuation">{</span>          <span class="token property">transition</span><span class="token punctuation">:</span> all 0.3s ease<span class="token punctuation">;</span>      <span class="token punctuation">}</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txt<span class="token punctuation">"</span></span> <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition-group</span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ul<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(item, i) in list<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>i<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ item }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition-group</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      txt<span class="token operator">:</span> <span class="token string">''</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>txt<span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>txt <span class="token operator">=</span> <span class="token string">''</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-11-列表的排序过渡"><a href="#5-11-列表的排序过渡" class="headerlink" title="5.11 列表的排序过渡"></a>5.11 列表的排序过渡</h3><p><code>&lt;transition-group&gt;</code> 组件还有一个特殊之处。不仅可以进入和离开动画，<strong>还可以改变定位</strong>。要使用这个新功能只需了解新增的 <code>v-move</code> 特性，<strong>它会在元素的改变定位的过程中应用</strong>。</p><p><code>v-move</code> 和 <code>v-leave-active</code> 结合使用，能够让列表的过渡更加平缓柔和：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.v-move</span><span class="token punctuation">{</span>  <span class="token property">transition</span><span class="token punctuation">:</span> all 0.8s ease<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">.v-leave-active</span><span class="token punctuation">{</span>  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">    <span class="token selector">.flip-list-move</span> <span class="token punctuation">{</span>        <span class="token property">transition</span><span class="token punctuation">:</span> transform 1s<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shuffle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition-group</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flip-list<span class="token punctuation">"</span></span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ul<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in items<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      {{ item }}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition-group</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.14.1/lodash.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue指令</title>
      <link href="2021/052044857.html"/>
      <url>2021/052044857.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue学习-指令"><a href="#Vue学习-指令" class="headerlink" title="Vue学习-指令"></a>Vue学习-指令</h1><h2 id="1-v-if"><a href="#1-v-if" class="headerlink" title="1.v-if"></a>1.v-if</h2><blockquote><p>v-if可以完全根据表达式的值在DOM中生成或移除一个元素。true-&gt;生成元素；false-&gt;移除元素。</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flag<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>如果条件为真，我显示；条件为假我不显示<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flag2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>俺也一样<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      flag<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      flag2<span class="token operator">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>切换多个元素时，把template元素当做包装元素，并在其上使用v-if，最终渲染的结果不会包含它</em></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>templateFlag<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Paragraph1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Paragraph2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/20210323152850534.png"></p><h2 id="2-v-show"><a href="#2-v-show" class="headerlink" title="2.v-show"></a>2.v-show</h2><blockquote><p>v-show指令是根据表达式的值来显示或隐藏，其原理是动态的在元素上添加style=”display:none”。</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flag<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>v-show是否显示？<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      flag<span class="token operator">:</span><span class="token boolean">false</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>v-show不支持template语法</em></p><blockquote><p>v-if与v-show</p><p>在切换v-if模块时Vue.js有一个局部编译/卸载的过程，因为v-if中的模板可能包括数据绑定或子组件。v-if时真实的条件渲染，因为他会确保条件在切换时合适的销毁与重建条件快内的事件监听器和子组件</p><p>v-if时惰性的——若初始渲染条件为假，则什么也不做，在条件第一次变为真时才开始拒不变异（编译会被缓存起来）</p><p>v-show简单得多——元素始终被编译保留，知识简单的基于CSS切换。</p><p><em>一般来时v-if有更高的切花小号，而v-show有更高的初始渲染消耗。因此</em>如果需要频繁的切换，则使用v-show较好；如果在运行时条件不大可能改变，则使用v-if较好。</p></blockquote><h2 id="3-v-else"><a href="#3-v-else" class="headerlink" title="3.v-else"></a>3.v-else</h2><blockquote><p>v-else必须跟着v-if或v-show，充当else功能。</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ok<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>我是对的<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-else</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ok<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>我是错的<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      ok<span class="token operator">:</span><span class="token boolean">false</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-v-model"><a href="#4-v-model" class="headerlink" title="4.v-model"></a>4.v-model</h2><blockquote><p>v-model指令使用来在input、select、text、checkbox、radio等表单控件元素上创建<strong>双向数据绑定</strong>。根据空间类型v-model自动选取正确的方式更新元素。v-model不过是语法糖，在用户输入时间中更新数据，以及特别处理一些极端例子。</p></blockquote><p>简易计算器计算器：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>number<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>operator<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>+<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>number<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>calculator<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>=<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      a<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>      operator<span class="token operator">:</span><span class="token string">'+'</span><span class="token punctuation">,</span>      b<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>      result<span class="token operator">:</span><span class="token number">0</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token function">calculator</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>operator <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>v-model除了上面的用法，还可以添加多个参数：number、lazy、debounce（vue2.0后移除，移除原因：其实现的是控制状态更新频率而不是控制高耗任务你是）</p><ul><li><p>number：将用户输入自动转换为Number类型（如果转换结果为NaN，则返回原值）</p></li><li><p>lazy：默认情况下，v-model在inout时间中同步输入框的值与数据，可以添加一个lazy特性，从而将数据改到在change时间中发生</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model.lazy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  {{msg}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      msg<span class="token operator">:</span> <span class="token string">'内容实在change事件后才改变的'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></blockquote><h2 id="5-v-for"><a href="#5-v-for" class="headerlink" title="5.v-for"></a><a href="https://cn.vuejs.org/v2/guide/list.html">5.v-for</a></h2><blockquote><p>v-for指令基础原始局重复渲染元素。</p><p>v-for需要特殊的别名，形式为“item in items”(items是数据数组，item是别名)，也可以用 <code>of</code> 替代 <code>in</code> 作为分隔符，因为它更接近 JavaScript 迭代器的语法(<strong>一般 js for in 是遍历 key, 而 for of 遍历 value</strong>)</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item of items<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(item,i) in list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{i}} + {{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--v-for 还支持一个可选的第二个参数，即当前项的索引。--&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    method<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>当 Vue 正在更新使用 <code>v-for</code> 渲染的元素列表时，它默认使用“就地更新”的策略。如果数据项的顺序被改变，Vue 将不会移动 DOM 元素来匹配数据项的顺序，而是就地更新每个元素，并且确保它们在每个索引位置正确渲染。</p><p>这个默认的模式是高效的，但是<strong>只适用于不依赖子组件状态或临时 DOM 状态 (例如：表单输入值) 的列表渲染输出</strong>。</p><p>建议尽可能在使用 <code>v-for</code> 时提供 <code>key</code> attribute，除非遍历输出的 DOM 内容非常简单，或者是刻意依赖默认行为以获取性能上的提升。</p><p><strong>不要使用对象或数组之类的非基本类型值作为 <code>v-for</code> 的 <code>key</code>。请用字符串或数值类型的值。</strong></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>ID: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>                                                                                               <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>添加： <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>添加<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in list<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.id<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>        {{item.id}}------{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span>    id<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'id'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token operator">:</span> <span class="token string">'李斯'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token operator">:</span> <span class="token string">'嬴政'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token operator">:</span> <span class="token string">'赵高'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>      <span class="token string">'id'</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>      <span class="token string">'name'</span><span class="token operator">:</span> <span class="token string">'韩非子'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token operator">:</span> <span class="token string">'荀子'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    obj<span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Leo'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span> sex<span class="token operator">:</span> <span class="token string">'male'</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><h3 id="数组更新检查"><a href="#数组更新检查" class="headerlink" title="数组更新检查"></a>数组更新检查</h3><h4 id="变更方法"><a href="#变更方法" class="headerlink" title="变更方法"></a>变更方法</h4><ul><li>push()：向尾部添加元素。改变原数组。</li><li>pop()：从数组中删除最后一个元素，并返回该元素的值。并重置数组的长度。改变原数组。</li><li>shift()：删除<strong>第一个</strong>元素并返回该元素的值，并重置数组的长度。改变原数组。</li><li>unshift()：将一个或多个元素添加到数组的<strong>开头</strong>，并返回该数组的<strong>新长度</strong>。改变原数组。</li><li>splice()：通过删除或替换现有元素或者原地添加新的元素来修改数组,并以数组形式返回被修改的内容。改变原数组。</li><li>sort()：方法用<a href="https://en.wikipedia.org/wiki/In-place_algorithm">原地算法</a>对数组的元素进行排序，并返回数组。默认排序顺序是在将元素转换为字符串，然后比较它们的UTF-16代码单元值序列时构建的。改变原数组。</li><li>reverse()：将数组中元素的位置颠倒，并返回该数组。数组的第一个元素会变成最后一个，数组的最后一个元素变成第一个。改变原数组。</li></ul><h4 id="替换数组"><a href="#替换数组" class="headerlink" title="替换数组"></a>替换数组</h4><p>变更方法，顾名思义，会变更调用了这些方法的原始数组。相比之下，也有非变更方法，例如 <code>filter()</code>、<code>concat()</code> 和 <code>slice()</code>。它们不会变更原始数组，而<strong>总是返回一个新数组</strong>。当使用非变更方法时，可以用新数组替换旧数组：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">example1<span class="token punctuation">.</span>items <span class="token operator">=</span> example1<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> item<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Foo</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>你可能认为这将导致 Vue 丢弃现有 DOM 并重新渲染整个列表。幸运的是，事实并非如此。Vue 为了使得 DOM 元素得到最大范围的重用而实现了一些智能的启发式方法，所以用一个含有相同元素的数组去替换原来的数组是非常高效的操作。</p><h2 id="6-v-text"><a href="#6-v-text" class="headerlink" title="6.v-text"></a>6.v-text</h2><blockquote><p>v-text指令可以更新元素的textContent。在内部，差值也被编译为textNode的一个v-text指令。v-text会将DOM元素中的textContent完全替换。</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">v-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>这段话会被v-text完全替换！！！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      msg<span class="token operator">:</span><span class="token string">'用你自己的方式，去成为一个真正的神。'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-v-html"><a href="#7-v-html" class="headerlink" title="7.v-html"></a>7.v-html</h2><blockquote><p>v-html指令可以更新元素的innerHTML。内容按普通的HTML插入——数据绑定被忽略。</p><p><strong>在网站上动态渲染任意 HTML 是非常危险的，因为容易导致 <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">XSS 攻击</a>。只在可信内容上使用 <code>v-html</code>，永不用在用户提交的内容上。</strong></p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">v-html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>htmlStr<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>      htmlStr<span class="token operator">:</span><span class="token string">'&lt;h1&gt;用你自己的方式，去成为一个真正的神！&lt;/h1&gt;'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>在网站上动态渲染任意 HTML 是非常危险的，因为容易导致 <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">XSS 攻击</a>。只在可信内容上使用 <code>v-html</code>，<strong>永不</strong>用在用户提交的内容上。</p></blockquote><h2 id="8-v-bind"><a href="#8-v-bind" class="headerlink" title="8.v-bind"></a>8.v-bind</h2><blockquote><p>v-bind指令用于响应更新HTML特性，讲一个或多个attribute或者一个组件prop动态绑定到表达式。</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myTitle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>鼠标悬浮显示title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myTitle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>鼠标悬浮显示title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--缩写--&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- 绑定一个 attribute --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imageSrc<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 动态 attribute 名 (2.6.0+) --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>[key]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 缩写 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imageSrc<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 动态 attribute 名缩写 (2.6.0+) --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">:[key]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 内联字符串拼接 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>/path/to/images/<span class="token punctuation">'</span> + fileName<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- class 绑定 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ red: isRed }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[classA, classB]<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[classA, { classB: isB, classC: isC }]<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- style 绑定 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ fontSize: size + <span class="token punctuation">'</span>px<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[styleObjectA, styleObjectB]<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 绑定一个全是 attribute 的对象 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ id: someProp, <span class="token punctuation">'</span>other-attr<span class="token punctuation">'</span>: otherProp }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 通过 prop 修饰符绑定 DOM attribute --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>text-content.prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- prop 绑定。“prop”必须在 my-component 中声明。--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-component</span> <span class="token attr-name">:prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>someThing<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-component</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 通过 $props 将父组件的 props 一起传给子组件 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child-component</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$props<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child-component</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- XLink --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">:xlink:special</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>foo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="9-v-on"><a href="#9-v-on" class="headerlink" title="9.v-on"></a>9.v-on</h2><blockquote><p>v-on指令用于绑定事件监听器。事件类型由参数指定；表达式可以是一个方法的名字或一个内敛语句；如果没有修饰符，也可以省略。</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>button<span class="token punctuation">'</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>doSomething<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>button<span class="token punctuation">'</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>doSomething<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--缩写--&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>绑定事件监听器。事件类型由参数指定。表达式可以是一个方法的名字或一个内联语句，如果没有修饰符也可以省略。</p><p>用在普通元素上时，只能监听<a href="https://developer.mozilla.org/zh-CN/docs/Web/Events"><strong>原生 DOM 事件</strong></a>。用在自定义元素组件上时，也可以监听子组件触发的<strong>自定义事件</strong>。</p><p>在监听原生 DOM 事件时，方法以事件为唯一的参数。如果使用内联语句，语句可以访问一个 <code>$event</code> property：<code>v-on:click="handle('ok', $event)"</code>。</p><p>从 <code>2.4.0</code> 开始，<code>v-on</code> 同样支持不带参数绑定一个事件/监听器键值对的对象。注意当使用对象语法时，是不支持任何修饰器的。</p></blockquote><h4 id="事件修饰符"><a href="#事件修饰符" class="headerlink" title="事件修饰符"></a>事件修饰符</h4><blockquote><ul><li><code>.stop</code> - 调用 <code>event.stopPropagation()</code>。阻止冒泡。</li><li><code>.prevent</code> - 调用 <code>event.preventDefault()</code>。阻止默认事件，例如a链接的跳转事件。</li><li><code>.capture</code> - 添加事件侦听器时使用 capture 模式。</li><li><code>.self</code> - 只当事件是从侦听器绑定的元素本身触发时才触发回调。</li><li><code>.{keyCode | keyAlias}</code> - 只当事件是从特定键触发时才触发回调。</li><li><code>.native</code> - 监听组件根元素的原生事件。</li><li><code>.once</code> - 只触发一次回调。</li><li><code>.left</code> - (2.2.0) 只当点击鼠标左键时触发。</li><li><code>.right</code> - (2.2.0) 只当点击鼠标右键时触发。</li><li><code>.middle</code> - (2.2.0) 只当点击鼠标中键时触发。</li><li><code>.passive</code> - (2.3.0) 以 <code>{ passive: true }</code> 模式添加侦听器</li></ul><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- 方法处理器 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>doThis<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 动态事件 (2.6.0+) --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>[event]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>doThis<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 内联语句 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>doThat(<span class="token punctuation">'</span>hello<span class="token punctuation">'</span>, $event)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 缩写 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>doThis<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 动态事件缩写 (2.6.0+) --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@[event]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>doThis<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 停止冒泡 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click.stop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>doThis<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 阻止默认行为 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click.prevent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>doThis<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 阻止默认行为，没有表达式 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">@submit.prevent</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--  串联修饰符 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click.stop.prevent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>doThis<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 键修饰符，键别名 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onEnter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 键修饰符，键代码 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">@keyup.13</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onEnter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 点击回调只会触发一次 --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click.once</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>doThis<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 对象语法 (2.4.0+) --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ mousedown: doThis, mouseup: doThat }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><h4 id="键盘修饰符以及自定义键盘修饰符"><a href="#键盘修饰符以及自定义键盘修饰符" class="headerlink" title="键盘修饰符以及自定义键盘修饰符"></a>键盘修饰符以及自定义键盘修饰符</h4><h5 id="1-x中自定义键盘修饰符【了解即可】"><a href="#1-x中自定义键盘修饰符【了解即可】" class="headerlink" title="1.x中自定义键盘修饰符【了解即可】"></a>1.x中自定义键盘修饰符【了解即可】</h5><pre class="line-numbers language-js" data-language="js"><code class="language-js">Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'on'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keyCodes<span class="token punctuation">.</span>f2 <span class="token operator">=</span> <span class="token number">113</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="2-x中自定义键盘修饰符"><a href="#2-x中自定义键盘修饰符" class="headerlink" title="2.x中自定义键盘修饰符"></a><a href="https://cn.vuejs.org/v2/guide/events.html#%E9%94%AE%E5%80%BC%E4%BF%AE%E9%A5%B0%E7%AC%A6">2.x中自定义键盘修饰符</a></h5><ol><li>通过<code>Vue.config.keyCodes.名称 = 按键值</code>来自定义案件修饰符的别名：</li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js">Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>keyCodes<span class="token punctuation">.</span>f2 <span class="token operator">=</span> <span class="token number">113</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>使用自定义的按键修饰符：</li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"name"</span> @keyup<span class="token punctuation">.</span>f2<span class="token operator">=</span><span class="token string">"add"</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="10-v-cloak"><a href="#10-v-cloak" class="headerlink" title="10.v-cloak"></a>10.v-cloak</h2><blockquote><p>v-cloak这个指令保持在元素上直到关联实例结束编译。和 CSS 规则如 <code>[v-cloak] { display: none }</code> 一起用时，这个指令可以隐藏未编译的 Mustache 标签直到实例准备完毕。</p><p>放置页面出现Mustache标签</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html">[v-cloak] {  display: none;}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-cloak</span><span class="token punctuation">&gt;</span></span>  {{ message }}  <span class="token comment">&lt;!--不会显示，直到编译结束。--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>Vue.directive('on').keyCodes.f2 = 113;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-x中自定义键盘修饰符-1"><a href="#2-x中自定义键盘修饰符-1" class="headerlink" title="2.x中自定义键盘修饰符"></a><a href="https://cn.vuejs.org/v2/guide/events.html#%E9%94%AE%E5%80%BC%E4%BF%AE%E9%A5%B0%E7%AC%A6">2.x中自定义键盘修饰符</a></h5><ol><li>通过<code>Vue.config.keyCodes.名称 = 按键值</code>来自定义案件修饰符的别名：</li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js">Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>keyCodes<span class="token punctuation">.</span>f2 <span class="token operator">=</span> <span class="token number">113</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>使用自定义的按键修饰符：</li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"name"</span> @keyup<span class="token punctuation">.</span>f2<span class="token operator">=</span><span class="token string">"add"</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端(杂识) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自动化构建</title>
      <link href="2021/052054283.html"/>
      <url>2021/052054283.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-自动化构建初体验"><a href="#1-自动化构建初体验" class="headerlink" title="1.自动化构建初体验"></a>1.自动化构建初体验</h2><ol><li>项目结构：</li></ol><p><img src="http://5coder.cn/img/yGCZXDYgaRS1JLi.png"></p><p>   我们使用sass使编写css提高效率，但需要对sass进行编译。</p>   <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> init --yes  <span class="token comment"># 初始化项目目录</span><span class="token function">yarn</span> <span class="token function">add</span> sass --dev  <span class="token comment"># 在开发环境安装sass</span><span class="token function">yarn</span> <span class="token function">add</span> browser-sync --dev  <span class="token comment"># 在开发环境安装browser-sync</span><span class="token function">yarn</span> <span class="token function">add</span> npm-run-all  --dev  <span class="token comment"># 在开发环境安装npm-run-all用来运行所有script</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>   编辑package.json文件：</p>   <pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">{</span>  <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"my-web-app"</span><span class="token punctuation">,</span>  <span class="token string">"version"</span><span class="token operator">:</span> <span class="token string">"0.1.0"</span><span class="token punctuation">,</span>  <span class="token string">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>  <span class="token string">"author"</span><span class="token operator">:</span> <span class="token string">"zce &lt;w@zce.me&gt; (https://zce.me)"</span><span class="token punctuation">,</span>  <span class="token string">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>  <span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token string">"build"</span><span class="token operator">:</span> <span class="token string">"sass scss/main.scss css/style.css --watch"</span><span class="token punctuation">,</span>     <span class="token string">"serve"</span><span class="token operator">:</span> <span class="token string">"browser-sync . --files \"css/*.css\""</span><span class="token punctuation">,</span>    <span class="token string">"start"</span><span class="token operator">:</span> <span class="token string">"run-p build serve"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token string">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token string">"browser-sync"</span><span class="token operator">:</span> <span class="token string">"^2.26.7"</span><span class="token punctuation">,</span>    <span class="token string">"npm-run-all"</span><span class="token operator">:</span> <span class="token string">"^4.1.5"</span><span class="token punctuation">,</span>    <span class="token string">"sass"</span><span class="token operator">:</span> <span class="token string">"^1.29.0"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>   命令行运行：</p>   <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>   自动执行：</p><ul><li><p>yarn build</p></li><li><p>yarn browser-sync</p></li></ul><h2 id="2-常用的自动化构建工具"><a href="#2-常用的自动化构建工具" class="headerlink" title="2.常用的自动化构建工具"></a>2.常用的自动化构建工具</h2><blockquote><p>为什么要使用自动化构建工具：</p><p>一句话：自动化。对于需要反复重复的任务，例如压缩（minification）、编译、单元测试、linting等，自动化工具可以减轻你的劳动，简化你的工作。</p></blockquote><h3 id="2-1Grunt"><a href="#2-1Grunt" class="headerlink" title="2.1Grunt"></a>2.1Grunt</h3><blockquote><p>Grunt 生态系统非常庞大，并且一直在增长。由于拥有数量庞大的插件可供选择，因此，你可以利用 Grunt <strong>自动完成任何事</strong>，并且花费最少的代价。如果找不到你所需要的插件，那就自己动手创造一个 Grunt 插件，然后将其发布到 npm 上吧。</p></blockquote><p>由于其工作过程是基于临时文件的，所以构建的速度相对较慢，频繁的磁盘读写导致速度慢</p><h3 id="2-2Gulp"><a href="#2-2Gulp" class="headerlink" title="2.2Gulp"></a>2.2Gulp</h3><blockquote><p>gulp 将开发流程中让人痛苦或耗时的任务自动化，从而减少你所浪费的时间、创造更大价值。</p></blockquote><p>工作过程是基于内存实现的，解决了Grunt的速度问题。默认支持同时去处理多个任务，效率大大提高，使用方式相对于Grunt相对通俗易懂，插件生态也同样完善。个人安利。</p><h3 id="2-3FIS"><a href="#2-3FIS" class="headerlink" title="2.3FIS"></a>2.3FIS</h3><blockquote><p>解决前端开发中自动化工具、性能优化、模块化框架、开发规范、代码部署、开发流程等问题</p></blockquote><p>百度团队的工具，捆绑套餐，将很多功能都提供给我们。</p><h2 id="3-Grunt使用"><a href="#3-Grunt使用" class="headerlink" title="3.Grunt使用"></a>3.Grunt使用</h2><h3 id="3-1-Grunt基本使用"><a href="#3-1-Grunt基本使用" class="headerlink" title="3.1 Grunt基本使用"></a>3.1 Grunt基本使用</h3><ol><li><p>创建空项目grunt-sample</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> init --yes<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>安装grunt模块</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> grunt --dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>项目根目录添加gruntfile.js文件,并编写以下内容</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// grunt入口文件</span><span class="token comment">// 用于定义一些需要Grunt自动执行的任务</span><span class="token comment">// 需要导出一个函数</span><span class="token comment">// 此函数接收一个grtun对象，内部体用一些创建任务时可以用的API</span>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">grunt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 第二个字符串为任务描述</span>    grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span><span class="token string">'a sample task'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello grunt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'other task'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// // default 是默认任务名称</span>    <span class="token comment">// // 通过grunt执行时可以省略任务名</span>    <span class="token comment">// // grunt.registerTask('default', () =&gt; {</span>    <span class="token comment">// //     console.log('default task');</span>    <span class="token comment">// // })</span>    <span class="token comment">// // 第二个参数可以指定此任务的映射任务</span>    <span class="token comment">// // 这样执行default就相当于执行对应的任务</span>    <span class="token comment">// // 这里的映射的任务会按照顺序一次执行，不会同步执行</span>    <span class="token comment">// grunt.registerTask('default', ['foo', 'bar'])</span>    <span class="token comment">// // 也可以在任务函数中执行其他任务</span>    <span class="token comment">// grunt.registerTask('run-other', () =&gt; {</span>    <span class="token comment">//     // foo和bar会在当前任务执行完成过后自动依次执行</span>    <span class="token comment">//     grunt.task.run('foo', 'bar')</span>    <span class="token comment">//     console.log('current task runing');</span>    <span class="token comment">// })</span>    <span class="token comment">// // 默认grunt采用同步模式编码</span>    <span class="token comment">// // 如果需要异步可以使用this.async()方法创建回调函数</span>    <span class="token comment">// // 下面代码不会再settimeout后打印语句</span>    <span class="token comment">// // grunt.registerTask('async-task', () =&gt; {</span>    <span class="token comment">// //     setTimeout(() =&gt; {</span>    <span class="token comment">// //         console.log('async task working');</span>    <span class="token comment">// //     }, 1000);</span>    <span class="token comment">// // })</span>    <span class="token comment">// // 由于函数体重需要使用this，所以这里不能使用箭头函数</span>    grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'async-task'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> done <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async task working'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>命令行运行</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> grunt  <span class="token comment"># 后面添加任务名或不添加任务名默认执行default</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h3 id="3-2-Grunt标记任务失败"><a href="#3-2-Grunt标记任务失败" class="headerlink" title="3.2 Grunt标记任务失败"></a>3.2 Grunt标记任务失败</h3><p>标记任务失败需要在函数体中返回false。默认情况下(yarn grunt default)，如果为任务列表，则当前面的任务执行失败后，后续的任务不再执行。如果在yarn grunt default后面添加–force时，则前面任务失败后，强制执行后面的任务yarn grunt default –force。</p><p><strong>异步函数中标记当前任务执行失败的方式是为回调函数指定一个 false 的实参</strong></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">grunt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 任务函数执行过程中如果返回 false</span>  <span class="token comment">// 则意味着此任务执行失败</span>  grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'bad'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bad working~'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">false</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo working~'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar working~'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 如果一个任务列表中的某个任务执行失败</span>  <span class="token comment">// 则后续任务默认不会运行</span>  <span class="token comment">// 除非 grunt 运行时指定 --force 参数强制执行</span>  grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bad'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 异步函数中标记当前任务执行失败的方式是为回调函数指定一个 false 的实参</span>  grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'bad-async'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> done <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async task working~'</span><span class="token punctuation">)</span>      <span class="token function">done</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-Grunt的配置方法"><a href="#3-3-Grunt的配置方法" class="headerlink" title="3.3 Grunt的配置方法"></a>3.3 Grunt的配置方法</h3><p>除了grunt.registerTask外，grunt还提供了一个去添加配置选项的API：initConfig</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">grunt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// grunt.initConfig() 用于为任务添加一些配置选项</span>  grunt<span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment">// 键一般对应任务的名称</span>    <span class="token comment">// 值可以是任意类型的数据</span>    foo<span class="token operator">:</span> <span class="token punctuation">{</span>      bar<span class="token operator">:</span> <span class="token string">'baz'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 任务中可以使用 grunt.config() 获取配置</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>grunt<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// 如果属性值是对象的话，config 中可以使用点的方式定位对象中属性的值</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>grunt<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'foo.bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-4-Grunt多目标任务"><a href="#3-4-Grunt多目标任务" class="headerlink" title="3.4 Grunt多目标任务"></a>3.4 Grunt多目标任务</h3><p>命令行运行yarn grunt build时，可以同时运行目标任务。如果需要运行指定目标任务，可以使用yarn grunt build:foo命令</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">grunt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 多目标模式，可以让任务根据配置形成多个子任务</span>  <span class="token comment">// grunt.initConfig({</span>  <span class="token comment">//   build: {</span>  <span class="token comment">//     foo: 100,</span>  <span class="token comment">//     bar: '456'</span>  <span class="token comment">//   }</span>  <span class="token comment">// })</span>  <span class="token comment">// grunt.registerMultiTask('build', function () {</span>  <span class="token comment">//   console.log(`task: build, target: ${this.target}, data: ${this.data}`)</span>  <span class="token comment">// })</span>  grunt<span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    build<span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token comment">// 任务配置选项，并不会执行</span>      options<span class="token operator">:</span> <span class="token punctuation">{</span>        msg<span class="token operator">:</span> <span class="token string">'task options'</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      foo<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token comment">// 会覆盖build中的option</span>        options<span class="token operator">:</span> <span class="token punctuation">{</span>          msg<span class="token operator">:</span> <span class="token string">'foo target options'</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      bar<span class="token operator">:</span> <span class="token string">'456'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  grunt<span class="token punctuation">.</span><span class="token function">registerMultiTask</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-5-Grunt插件的使用"><a href="#3-5-Grunt插件的使用" class="headerlink" title="3.5 Grunt插件的使用"></a>3.5 Grunt插件的使用</h3><ol><li>安装插件</li><li>gruntfile中载入插件</li><li>根据文档完成相关的配置选项</li></ol><h4 id="grunt-sass"><a href="#grunt-sass" class="headerlink" title="grunt sass"></a><strong>grunt sass</strong></h4><p>项目初始</p><p><img src="http://5coder.cn/img/XD9TqVIvYtKZHAf.png"></p><ol><li><p>安装插件grunt-sass以及npm模块sass</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> grunt-sass sass --dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>编写gruntfile.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sass'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">grunt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    grunt<span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        sass<span class="token operator">:</span> <span class="token punctuation">{</span>            options<span class="token operator">:</span> <span class="token punctuation">{</span>                implementation<span class="token operator">:</span>sass<span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            main<span class="token operator">:</span> <span class="token punctuation">{</span>                files<span class="token operator">:</span> <span class="token punctuation">{</span>                    <span class="token string">'dist/css/main.css'</span><span class="token operator">:</span> <span class="token string">'src/scss/main.scss'</span>  <span class="token comment">// 键为目标文件路径，值为需要编译的文件</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    grunt<span class="token punctuation">.</span><span class="token function">loadNpmTasks</span><span class="token punctuation">(</span><span class="token string">'grunt-sass'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>命令运行后的目录</p></li></ol><p>  <img src="http://5coder.cn/img/BCSxIWhVab9UR5X.png"></p><h4 id="grunt-babel"><a href="#grunt-babel" class="headerlink" title="grunt-babel"></a><strong>grunt-babel</strong></h4><p>初始目录</p><p><img src="http://5coder.cn/img/k174jsLfOv5idZy.png"></p><ol><li><p>安装grunt-babel</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> grunt-babel @babel/core @babel/preset-env --dev<span class="token function">yarn</span> <span class="token function">add</span> load-grunt-tasks --dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>编辑上面sass中js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sass'</span><span class="token punctuation">)</span><span class="token keyword">const</span> loadGruntTasks <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'load-grunt-tasks'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">grunt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    grunt<span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        sass<span class="token operator">:</span> <span class="token punctuation">{</span>            options<span class="token operator">:</span> <span class="token punctuation">{</span>                sourceMap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                implementation<span class="token operator">:</span>sass<span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            main<span class="token operator">:</span> <span class="token punctuation">{</span>                files<span class="token operator">:</span> <span class="token punctuation">{</span>                    <span class="token string">'dist/css/main.css'</span><span class="token operator">:</span> <span class="token string">'src/scss/main.scss'</span>  <span class="token comment">// 键为目标文件路径，值为需要编译的文件</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        babel<span class="token operator">:</span> <span class="token punctuation">{</span>            options<span class="token operator">:</span> <span class="token punctuation">{</span>                sourceMap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>  <span class="token comment">// 最新的ECMAScript中的特性加载进来</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            main<span class="token operator">:</span><span class="token punctuation">{</span>                files<span class="token operator">:</span> <span class="token punctuation">{</span>                    <span class="token string">'dist/js/app.js'</span><span class="token operator">:</span> <span class="token string">'src/js/app.js'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// grunt.loadNpmTasks('grunt-sass')</span>    <span class="token function">loadGruntTasks</span><span class="token punctuation">(</span>grunt<span class="token punctuation">)</span>  <span class="token comment">// 自动加载所有的grunt插件中的所有任务</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>命令后的目录</p><p><img src="http://5coder.cn/img/gRuXow36UWtFETv.png"></p></li></ol><h4 id="grunt-contrib-watch"><a href="#grunt-contrib-watch" class="headerlink" title="grunt-contrib-watch"></a>grunt-contrib-watch</h4><p>源文件变化时，实时编译文件</p><ol><li><p>安装grunt-contrib-watch</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">yarn add grunt<span class="token operator">-</span>contrib<span class="token operator">-</span>watch <span class="token operator">--</span>dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>编辑js文件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sass'</span><span class="token punctuation">)</span><span class="token keyword">const</span> loadGruntTasks <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'load-grunt-tasks'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">grunt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    grunt<span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        sass<span class="token operator">:</span> <span class="token punctuation">{</span>            options<span class="token operator">:</span> <span class="token punctuation">{</span>                sourceMap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                implementation<span class="token operator">:</span>sass<span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            main<span class="token operator">:</span> <span class="token punctuation">{</span>                files<span class="token operator">:</span> <span class="token punctuation">{</span>                    <span class="token string">'dist/css/main.css'</span><span class="token operator">:</span> <span class="token string">'src/scss/main.scss'</span>  <span class="token comment">// 键为目标文件路径，值为需要编译的文件</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        babel<span class="token operator">:</span> <span class="token punctuation">{</span>            options<span class="token operator">:</span> <span class="token punctuation">{</span>                sourceMap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>  <span class="token comment">// 最新的ECMAScript中的特性加载进来</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            main<span class="token operator">:</span><span class="token punctuation">{</span>                files<span class="token operator">:</span> <span class="token punctuation">{</span>                    <span class="token string">'dist/js/app.js'</span><span class="token operator">:</span> <span class="token string">'src/js/app.js'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        watch<span class="token operator">:</span> <span class="token punctuation">{</span>            js<span class="token operator">:</span> <span class="token punctuation">{</span>                files<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'src/js/*.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                tasks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel'</span><span class="token punctuation">]</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            css<span class="token operator">:</span> <span class="token punctuation">{</span>                files<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'src/scss/*.scss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                tasks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sass'</span><span class="token punctuation">]</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// grunt.loadNpmTasks('grunt-sass')</span>    <span class="token function">loadGruntTasks</span><span class="token punctuation">(</span>grunt<span class="token punctuation">)</span>  <span class="token comment">// 自动加载所有的grunt插件中的所有任务</span>    grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'sass'</span><span class="token punctuation">,</span> <span class="token string">'babel'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 确保启动watch瞬间先执行sass任务和babel</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>监听文件时terminal的状态：</p></li></ol><p>  <img src="http://5coder.cn/img/qnuNl6LoDMAXURt.png"></p><h2 id="4-Gulp使用"><a href="#4-Gulp使用" class="headerlink" title="4.Gulp使用"></a>4.Gulp使用</h2><p>当下最流行的前端构建系统，其核心特性就是高效、易用。现在项目中安装gulp开发依赖。添加gulpfile.js，用于编写需要gulp自动执行的任务。随后可以再命令行使用gulp提供cli工具运行构建任务。</p><h3 id="4-1-Gulp的基本使用"><a href="#4-1-Gulp的基本使用" class="headerlink" title="4.1 Gulp的基本使用"></a>4.1 Gulp的基本使用</h3><ol><li><p>初始化项目目录</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkdir</span> gulp-test  <span class="token comment"># 创建项目目录</span><span class="token builtin class-name">cd</span> gulp-test  <span class="token comment"># 切换目录</span><span class="token function">yarn</span> init --yes  <span class="token comment"># 初始化目录</span><span class="token function">yarn</span> <span class="token function">add</span> gulp --dev  <span class="token comment"># 安装gulp到开发环境</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>根目录创建gulpfile.js文件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// gulp入口文件</span><span class="token comment">// 导出函数成员</span>exports<span class="token punctuation">.</span><span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo task working~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>通过命令行运行任务</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> gulp foo<span class="token comment"># [22:23:50] Using gulpfile D:\DeskTop\02-01-study-materials\gulp-test\gulpfile.js</span><span class="token comment"># [22:23:50] Starting 'foo'...</span><span class="token comment"># foo task working~</span><span class="token comment"># [22:23:50] The following tasks did not complete: foo</span><span class="token comment"># [22:23:50] Did you forget to signal async completion?</span><span class="token comment"># error Command failed with exit code 1.</span><span class="token comment"># info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The following tasks did not complete: foo,foo任务未完成，因为最新的gulp中取消了同步代码运行模式，默认约定为异步任务，任务执行完成后，需要调用回调函数或其他方式去标记这个任务表示完成。这里我们手动的调用回调函数。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// gulp入口文件</span><span class="token comment">// 导出函数成员</span>exports<span class="token punctuation">.</span><span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo task working~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 表示任务完成</span><span class="token punctuation">}</span>exports<span class="token punctuation">.</span><span class="token function-variable function">default</span> <span class="token operator">=</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'default task working~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 标记任务完成</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时foo任务会正常启动，正常结束。此时我们直接运行yarn gulp，他会自动运行default任务，同grunt一样。除此之外，gulp4.0前，注册gulp任务需要通过gulp模块中的方法来实现，具体来看：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> gulp  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span><span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar task working~'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="4-2-Gulp的组合使用"><a href="#4-2-Gulp的组合使用" class="headerlink" title="4.2 Gulp的组合使用"></a>4.2 Gulp的组合使用</h3><blockquote><p>glup中需要使用到并行任务和串行任务，在我们项目过程中，编译scss文件和js文件是不冲突的，所以我们需要使用并行任务。而我们在编译文件和部署服务时，我们需要先进行编译scss和css文件，然后进行服务部署，这时候需要使用串行任务。在glup中提供了两个API serires以及parallel，分别提供串行和并行任务。</p></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>series<span class="token punctuation">,</span> parallel<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">reqire</span><span class="token punctuation">(</span>‘gulp’<span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">task1</span> <span class="token operator">=</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">SetTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>‘task1 working<span class="token operator">~</span>’<span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">task2</span> <span class="token operator">=</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">SetTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>‘task2 working<span class="token operator">~</span>’<span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">task3</span> <span class="token operator">=</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">SetTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>‘task3 working<span class="token operator">~</span>’<span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span>exports<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token function">series</span><span class="token punctuation">(</span>task1<span class="token punctuation">,</span> task2<span class="token punctuation">,</span> task3<span class="token punctuation">)</span> <span class="token comment">// 执行串行任务</span>exports<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token function">parallel</span><span class="token punctuation">(</span>task1<span class="token punctuation">,</span> task2<span class="token punctuation">,</span> task3<span class="token punctuation">)</span> <span class="token comment">// 执行并行任务</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> gulp foo <span class="token comment"># 此时三个任务会依次等待1秒后执行console.log()方法</span><span class="token function">yarn</span> gulp bar <span class="token comment"># 此时三个任务会同时开始，在1秒后同时执行conssole.log()方法。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="4-3-Gulp的异步任务"><a href="#4-3-Gulp的异步任务" class="headerlink" title="4.3 Gulp的异步任务"></a>4.3 Gulp的异步任务</h3><blockquote><p>gulp中的任务都是异步任务，也就是我们经常提到的一部函数。我们调用一个异步函数时是没有办法去直接明确这个调用是否完成的。都是在函数内部通过回调或者事件去通知外部这个函数是否调用完成。在异步任务中，同样面临如何去通知gulp任务的完成情况。上面我们使用同步任务done()来模仿异步任务。</p></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 通过同步任务进行模拟</span>exports<span class="token punctuation">.</span>call <span class="token function-variable function">ask</span> <span class="token operator">=</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>‘callback task’<span class="token punctuation">)</span>    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 同步任务失败情况</span><span class="token keyword">export</span><span class="token punctuation">.</span><span class="token function-variable function">callback_error</span> <span class="token operator">=</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>‘callback_error task’<span class="token punctuation">)</span>    <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>‘callback_error task failed<span class="token operator">!</span>’<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 使用promise去完成异步任务</span>exports<span class="token punctuation">.</span><span class="token function-variable function">promise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>‘promise task<span class="token operator">~</span>’<span class="token punctuation">)</span>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 标记promise任务完成</span><span class="token punctuation">}</span><span class="token comment">// promise任务失败情况</span>exports<span class="token punctuation">.</span><span class="token function-variable function">promise_error</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>‘promise_error task’<span class="token punctuation">)</span>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>‘promise_error failed<span class="token operator">!</span>’<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 使用ES7中提供的async和await语法糖</span><span class="token keyword">const</span> <span class="token function-variable function">timeout</span> <span class="token operator">=</span> <span class="token parameter">time</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> time<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>exports<span class="token punctuation">.</span><span class="token function-variable function">async</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">await</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>‘<span class="token keyword">async</span> task<span class="token operator">~</span>’<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 使用stream</span><span class="token keyword">const</span> <span class="token punctuation">{</span> doesNotMatch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'assert'</span><span class="token punctuation">)</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>exports<span class="token punctuation">.</span><span class="token function-variable function">stream</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> read <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'yarn.lock'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> write <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span>    read<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>write<span class="token punctuation">)</span>    <span class="token keyword">return</span> read<span class="token punctuation">}</span><span class="token comment">// 模仿stream</span>exports<span class="token punctuation">.</span><span class="token function-variable function">stream_copy</span> <span class="token operator">=</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> read <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'yarn.lock'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> write <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'b.txt'</span><span class="token punctuation">)</span>    read<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>write<span class="token punctuation">)</span>    read<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-4-Gulp构建过程核心工作原理"><a href="#4-4-Gulp构建过程核心工作原理" class="headerlink" title="4.4 Gulp构建过程核心工作原理"></a>4.4 Gulp构建过程核心工作原理</h3><p>构建过程大多数都是将文件读取然后进行一些转换，最后写入另外一个位置。</p><p>这里我们模拟压缩css到吗为min.css的过程，主要分为以下几个步骤：</p><ol><li>创建文件读取流-目标css</li><li>创建文件写入流-目标min.css</li><li>文件转换流，将读取的文件流使用replace进行替换空白字符与注释</li><li>使用pipe将文件流先转换，然后再讲转换流写入</li></ol><p>具体代码如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">{</span>Transform<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span>exports<span class="token punctuation">.</span><span class="token function-variable function">default</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 文件流读取</span>  <span class="token keyword">const</span> readStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'normalize.css'</span><span class="token punctuation">)</span>  <span class="token comment">// 写入文件流</span>  <span class="token keyword">const</span> writeStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'normalize.min.css'</span><span class="token punctuation">)</span>  <span class="token comment">// readStream.pipe(writeStream)</span>  <span class="token comment">//</span>  <span class="token comment">// return readStream</span>  <span class="token comment">// 文件流转换</span>  <span class="token keyword">const</span> transformStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transform</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment">// 核心转换过程</span>    <span class="token function-variable function">transform</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> input <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">const</span> output <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/\*.+?\*\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> output<span class="token punctuation">)</span>  <span class="token comment">// 第一个参数为错误对象，output为转换完的结果</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> readStream    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>transformStream<span class="token punctuation">)</span>  <span class="token comment">// 先转换</span>    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span>  <span class="token comment">// 再写入</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-5-Gulp文件操作API"><a href="#4-5-Gulp文件操作API" class="headerlink" title="4.5 Gulp文件操作API"></a>4.5 Gulp文件操作API</h3><p>Gulp中为我们提供读取流和写入流 的API，相比于底层Node的API，Gulp的API更强大、更易用，至于负责文件的转换流，绝大多数情况我们都是通过独立的插件来提供。我们在实际去通过Gulp创建构建任务时的流程就是：先通过src方法去创建一个读取流，然后再借助插件提供的转换流来实现文件加工，最后我们再通过Gulp提供的dest方法去创建一个写入流，从而写入到目标文件。具体工作过程如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token keyword">const</span> cleanCSS <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-clean-css'</span><span class="token punctuation">)</span><span class="token keyword">const</span> rename <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-rename'</span><span class="token punctuation">)</span>exports<span class="token punctuation">.</span><span class="token function-variable function">default</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/*.css'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">cleanCSS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extname<span class="token operator">:</span> <span class="token string">'.min.css'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-6-Gulp案例-样式编译"><a href="#4-6-Gulp案例-样式编译" class="headerlink" title="4.6 Gulp案例-样式编译"></a>4.6 Gulp案例-样式编译</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token comment">//  gulp.src:gulp底层是使用的nodejs的stream，首先获取到stream流，然后使用pipe()方法把流数据导入到你想让它去的地方。</span><span class="token comment">//  gulp.dest:src函数是读取文件，那dest函数就是写文件,gulp.dest(path[,options]),path是要写入的文件的路径，这里注意只能是路径，不能是具体的文件</span><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-sass'</span><span class="token punctuation">)</span>  <span class="token comment">// 真是执行css编译的，其调用node-sass，而node-sass是c++的二进制模块，所以安装时需要设置淘宝镜像进行安装</span><span class="token keyword">const</span> <span class="token function-variable function">style</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/styles/*.scss'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// base作用是以src为基准，原样输出目录结构</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>outputStyle<span class="token operator">:</span> <span class="token string">'expanded'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// outputStyle作用是将sass生成的css文件最后的花括号放在块末尾</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>style<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>命令行运行：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> gulp style<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-7-Gulp案例-脚本编译"><a href="#4-7-Gulp案例-脚本编译" class="headerlink" title="4.7 Gulp案例-脚本编译"></a>4.7 Gulp案例-脚本编译</h3><p>安装依赖：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> gulp-babel --dev<span class="token function">yarn</span> <span class="token function">add</span> @babel/core @babel/preset-env  <span class="token comment"># preset-env会将ECMAScript中所有的新特性进行转换</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-babel'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">script</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/scripts/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>style<span class="token punctuation">,</span>script<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>命令行运行：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> gulp script<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-8-Gulp案例-页面编译"><a href="#4-8-Gulp案例-页面编译" class="headerlink" title="4.8 Gulp案例-页面编译"></a>4.8 Gulp案例-页面编译</h3><p>安装依赖：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> gulp-swig --dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> parallel<span class="token punctuation">,</span> series<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token comment">//  gulp.src:gulp底层是使用的nodejs的stream，首先获取到stream流，然后使用pipe()方法把流数据导入到你想让它去的地方。</span><span class="token comment">//  gulp.dest:要说src函数是读取文件，那么dest函数就是写文件,gulp.dest(path[,options]),path是要写入的文件的路径，这里注意只能是路径，不能是具体的文件</span><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-sass'</span><span class="token punctuation">)</span><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-babel'</span><span class="token punctuation">)</span><span class="token keyword">const</span> swig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-swig'</span><span class="token punctuation">)</span><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">style</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/styles/*.scss'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// base作用是以src为基准，原样输出目录结构</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>outputStyle<span class="token operator">:</span> <span class="token string">'expanded'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// outputStyle作用是将sass生成的css文件最后的花括号放在块末尾</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">script</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/scripts/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">page</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/*.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">swig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 填充模板页面的数据</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> compile <span class="token operator">=</span> <span class="token function">parallel</span><span class="token punctuation">(</span>style<span class="token punctuation">,</span> script<span class="token punctuation">,</span> page<span class="token punctuation">)</span>  <span class="token comment">// 任务并行</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>compile<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>命令行输入：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> gulp compile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-9-Gulp案例-图片和字体文件转换"><a href="#4-9-Gulp案例-图片和字体文件转换" class="headerlink" title="4.9 Gulp案例-图片和字体文件转换"></a>4.9 Gulp案例-图片和字体文件转换</h3><p>安装依赖：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> gulp-imagemin --dev  <span class="token comment"># 与node-sass相同，需要引入二进制文件，科学上网</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> parallel<span class="token punctuation">,</span> series<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token comment">//  gulp.src:gulp底层是使用的nodejs的stream，首先获取到stream流，然后使用pipe()方法把流数据导入到你想让它去的地方。</span><span class="token comment">//  gulp.dest:要说src函数是读取文件，那么dest函数就是写文件,gulp.dest(path[,options]),path是要写入的文件的路径，这里注意只能是路径，不能是具体的文件</span><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-sass'</span><span class="token punctuation">)</span><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-babel'</span><span class="token punctuation">)</span><span class="token keyword">const</span> swig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-swig'</span><span class="token punctuation">)</span><span class="token keyword">const</span> imagemin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-imagemin'</span><span class="token punctuation">)</span><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">style</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/styles/*.scss'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// base作用是以src为基准，原样输出目录结构</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>outputStyle<span class="token operator">:</span> <span class="token string">'expanded'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// outputStyle作用是将sass生成的css文件最后的花括号放在块末尾</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">script</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/scripts/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">page</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/*.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">swig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 填充模板页面的数据</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">image</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/images/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> base<span class="token operator">:</span> <span class="token string">'src'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">font</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/fonts/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> base<span class="token operator">:</span> <span class="token string">'src'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> compile <span class="token operator">=</span> <span class="token function">parallel</span><span class="token punctuation">(</span>style<span class="token punctuation">,</span> script<span class="token punctuation">,</span> page<span class="token punctuation">,</span> image<span class="token punctuation">,</span> font<span class="token punctuation">)</span>  <span class="token comment">// 任务并行</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>compile<span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行命令：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">yarn gulp imageyarn gulp font<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="4-10-Gulp案例-其他文件及文件清除"><a href="#4-10-Gulp案例-其他文件及文件清除" class="headerlink" title="4.10 Gulp案例-其他文件及文件清除"></a>4.10 Gulp案例-其他文件及文件清除</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> parallel<span class="token punctuation">,</span> series<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token comment">//  gulp.src:gulp底层是使用的nodejs的stream，首先获取到stream流，然后使用pipe()方法把流数据导入到你想让它去的地方。</span><span class="token comment">//  gulp.dest:要说src函数是读取文件，那么dest函数就是写文件,gulp.dest(path[,options]),path是要写入的文件的路径，这里注意只能是路径，不能是具体的文件</span><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-sass'</span><span class="token punctuation">)</span><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-babel'</span><span class="token punctuation">)</span><span class="token keyword">const</span> swig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-swig'</span><span class="token punctuation">)</span><span class="token keyword">const</span> imagemin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-imagemin'</span><span class="token punctuation">)</span><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">style</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/styles/*.scss'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// base作用是以src为基准，原样输出目录结构</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>outputStyle<span class="token operator">:</span> <span class="token string">'expanded'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// outputStyle作用是将sass生成的css文件最后的花括号放在块末尾</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">script</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/scripts/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">page</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/*.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">swig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 填充模板页面的数据</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">image</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/images/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> base<span class="token operator">:</span> <span class="token string">'src'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">font</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/fonts/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> base<span class="token operator">:</span> <span class="token string">'src'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">extra</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'public/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'public'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 额外拷贝的任务</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> compile <span class="token operator">=</span> <span class="token function">parallel</span><span class="token punctuation">(</span>style<span class="token punctuation">,</span> script<span class="token punctuation">,</span> page<span class="token punctuation">,</span> image<span class="token punctuation">,</span> font<span class="token punctuation">)</span>  <span class="token comment">// 任务并行</span><span class="token keyword">const</span> build <span class="token operator">=</span> <span class="token function">parallel</span><span class="token punctuation">(</span>compile<span class="token punctuation">,</span> extra<span class="token punctuation">)</span>  <span class="token comment">// 任务并行</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>build<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>需要在build任务之前先自动清除dist文件，因此使用series创建串行任务。</p><p>安装依赖</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> del --dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> parallel<span class="token punctuation">,</span> series<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token comment">//  gulp.src:gulp底层是使用的nodejs的stream，首先获取到stream流，然后使用pipe()方法把流数据导入到你想让它去的地方。</span><span class="token comment">//  gulp.dest:要说src函数是读取文件，那么dest函数就是写文件,gulp.dest(path[,options]),path是要写入的文件的路径，这里注意只能是路径，不能是具体的文件</span><span class="token keyword">const</span> del <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'del'</span><span class="token punctuation">)</span><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-sass'</span><span class="token punctuation">)</span><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-babel'</span><span class="token punctuation">)</span><span class="token keyword">const</span> swig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-swig'</span><span class="token punctuation">)</span><span class="token keyword">const</span> imagemin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-imagemin'</span><span class="token punctuation">)</span><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">clean</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dist'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 返回promise</span><span class="token punctuation">}</span>              <span class="token keyword">const</span> <span class="token function-variable function">style</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/styles/*.scss'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// base作用是以src为基准，原样输出目录结构</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>outputStyle<span class="token operator">:</span> <span class="token string">'expanded'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// outputStyle作用是将sass生成的css文件最后的花括号放在块末尾</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">script</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/scripts/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">page</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/*.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">swig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 填充模板页面的数据</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">image</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/images/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> base<span class="token operator">:</span> <span class="token string">'src'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">font</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/fonts/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> base<span class="token operator">:</span> <span class="token string">'src'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">extra</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'public/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'public'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 额外拷贝的任务</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> compile <span class="token operator">=</span> <span class="token function">parallel</span><span class="token punctuation">(</span>style<span class="token punctuation">,</span> script<span class="token punctuation">,</span> page<span class="token punctuation">,</span> image<span class="token punctuation">,</span> font<span class="token punctuation">)</span>  <span class="token comment">// 任务并行</span><span class="token keyword">const</span> build <span class="token operator">=</span> <span class="token function">series</span><span class="token punctuation">(</span>clean<span class="token punctuation">,</span> <span class="token function">parallel</span><span class="token punctuation">(</span>compile<span class="token punctuation">,</span> extra<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 任务并行</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>build<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-11-Gulp案例-自动加载插件"><a href="#4-11-Gulp案例-自动加载插件" class="headerlink" title="4.11 Gulp案例-自动加载插件"></a>4.11 Gulp案例-自动加载插件</h3><p>代码合理化，自动加载所有gulp的插件，使用gulp-load-plugins</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> parallel<span class="token punctuation">,</span> series<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token comment">//  gulp.src:gulp底层是使用的nodejs的stream，首先获取到stream流，然后使用pipe()方法把流数据导入到你想让它去的地方。</span><span class="token comment">//  gulp.dest:要说src函数是读取文件，那么dest函数就是写文件,gulp.dest(path[,options]),path是要写入的文件的路径，这里注意只能是路径，不能是具体的文件</span><span class="token keyword">const</span> del <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'del'</span><span class="token punctuation">)</span><span class="token keyword">const</span> loadPlugins <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span>  <span class="token comment">// 加载load-plugins</span><span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token function">loadPlugins</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//以下所有插件使用plugins.[插件名]，如果插件名为gulp-xx-xx，那么改为plugins.xxYy,驼峰命名</span><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">clean</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dist'</span><span class="token punctuation">,</span> <span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">style</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/styles/*.scss'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// base作用是以src为基准，原样输出目录结构</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>plugins<span class="token punctuation">.</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>outputStyle<span class="token operator">:</span> <span class="token string">'expanded'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// outputStyle作用是将sass生成的css文件最后的花括号放在块末尾</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">script</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/scripts/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>plugins<span class="token punctuation">.</span><span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">page</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/*.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>plugins<span class="token punctuation">.</span><span class="token function">swig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 填充模板页面的数据</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">image</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/images/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>plugins<span class="token punctuation">.</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">font</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/assets/fonts/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>plugins<span class="token punctuation">.</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token function-variable function">extra</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'public/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token operator">:</span> <span class="token string">'public'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 额外拷贝的任务</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> compile <span class="token operator">=</span> <span class="token function">parallel</span><span class="token punctuation">(</span>style<span class="token punctuation">,</span> script<span class="token punctuation">,</span> page<span class="token punctuation">,</span> image<span class="token punctuation">,</span> font<span class="token punctuation">)</span>  <span class="token comment">// 任务并行</span><span class="token keyword">const</span> build <span class="token operator">=</span> <span class="token function">series</span><span class="token punctuation">(</span>clean<span class="token punctuation">,</span> <span class="token function">parallel</span><span class="token punctuation">(</span>compile<span class="token punctuation">,</span> extra<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 任务并行</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>build<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-12-Gulp案例-开发服务器、监视变化以及构建优化"><a href="#4-12-Gulp案例-开发服务器、监视变化以及构建优化" class="headerlink" title="4.12 Gulp案例-开发服务器、监视变化以及构建优化"></a>4.12 Gulp案例-开发服务器、监视变化以及构建优化</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">serve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'src/assets/styles/*.scss'</span><span class="token punctuation">,</span> style<span class="token punctuation">)</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'src/assets/scripts/*.js'</span><span class="token punctuation">,</span> script<span class="token punctuation">)</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'src/*.html'</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token comment">// watch('src/assets/images/**', image)</span><span class="token comment">// watch('src/assets/fonts/**', font)</span><span class="token comment">// watch('public/**', extra)</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'src/assets/images/**'</span><span class="token punctuation">,</span><span class="token string">'src/assets/fonts/**'</span><span class="token punctuation">,</span><span class="token string">'public/**'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bs<span class="token punctuation">.</span>reload<span class="token punctuation">)</span>bs<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>notify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>port<span class="token operator">:</span> <span class="token number">2080</span><span class="token punctuation">,</span><span class="token comment">// open: false,</span><span class="token comment">// files: 'dist/**',</span>server<span class="token operator">:</span> <span class="token punctuation">{</span>baseDir<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>routes<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'/node_modules'</span><span class="token operator">:</span> <span class="token string">'node_modules'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> develop <span class="token operator">=</span> <span class="token function">series</span><span class="token punctuation">(</span>compile<span class="token punctuation">,</span> serve<span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>clean<span class="token punctuation">,</span>build<span class="token punctuation">,</span>develop<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-13Gulp案例-userer文件引用处理"><a href="#4-13Gulp案例-userer文件引用处理" class="headerlink" title="4.13Gulp案例-userer文件引用处理"></a>4.13Gulp案例-userer文件引用处理</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">useref</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'temp/*.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> base<span class="token operator">:</span> <span class="token string">'temp'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>plugins<span class="token punctuation">.</span><span class="token function">useref</span><span class="token punctuation">(</span><span class="token punctuation">{</span> searchPath<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// html js css</span>  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>plugins<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> plugins<span class="token punctuation">.</span><span class="token function">uglify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>plugins<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> plugins<span class="token punctuation">.</span><span class="token function">cleanCss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>plugins<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.html$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> plugins<span class="token punctuation">.</span><span class="token function">htmlmin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>   collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   minifyJS<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-14Gulp案例-重新规划构建过程"><a href="#4-14Gulp案例-重新规划构建过程" class="headerlink" title="4.14Gulp案例-重新规划构建过程"></a>4.14Gulp案例-重新规划构建过程</h3><p>暴露出任务</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">{</span>  <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"zce-gulp-demo"</span><span class="token punctuation">,</span>  <span class="token string">"version"</span><span class="token operator">:</span> <span class="token string">"0.1.0"</span><span class="token punctuation">,</span>  <span class="token string">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>  <span class="token string">"repository"</span><span class="token operator">:</span> <span class="token string">"https://github.com/zce/zce-gulp-demo.git"</span><span class="token punctuation">,</span>  <span class="token string">"author"</span><span class="token operator">:</span> <span class="token string">"zce &lt;w@zce.me&gt; (https://zce.me)"</span><span class="token punctuation">,</span>  <span class="token string">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>  <span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token string">"clean"</span><span class="token operator">:</span> <span class="token string">"gulp clean"</span><span class="token punctuation">,</span>  <span class="token comment">// 此时可以直接执行yarn clean</span>    <span class="token string">"build"</span><span class="token operator">:</span> <span class="token string">"gulp build"</span><span class="token punctuation">,</span>    <span class="token string">"develop"</span><span class="token operator">:</span> <span class="token string">"gulp develop"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token string">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token string">"bootstrap"</span><span class="token operator">:</span> <span class="token string">"^4.3.1"</span><span class="token punctuation">,</span>    <span class="token string">"jquery"</span><span class="token operator">:</span> <span class="token string">"^3.4.1"</span><span class="token punctuation">,</span>    <span class="token string">"popper.js"</span><span class="token operator">:</span> <span class="token string">"^1.15.0"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token string">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token string">"@babel/core"</span><span class="token operator">:</span> <span class="token string">"^7.5.5"</span><span class="token punctuation">,</span>    <span class="token string">"@babel/preset-env"</span><span class="token operator">:</span> <span class="token string">"^7.5.5"</span><span class="token punctuation">,</span>    <span class="token string">"browser-sync"</span><span class="token operator">:</span> <span class="token string">"^2.26.7"</span><span class="token punctuation">,</span>    <span class="token string">"del"</span><span class="token operator">:</span> <span class="token string">"^5.1.0"</span><span class="token punctuation">,</span>    <span class="token string">"gulp"</span><span class="token operator">:</span> <span class="token string">"^4.0.2"</span><span class="token punctuation">,</span>    <span class="token string">"gulp-babel"</span><span class="token operator">:</span> <span class="token string">"^8.0.0"</span><span class="token punctuation">,</span>    <span class="token string">"gulp-clean-css"</span><span class="token operator">:</span> <span class="token string">"^4.2.0"</span><span class="token punctuation">,</span>    <span class="token string">"gulp-htmlmin"</span><span class="token operator">:</span> <span class="token string">"^5.0.1"</span><span class="token punctuation">,</span>    <span class="token string">"gulp-if"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span><span class="token punctuation">,</span>    <span class="token string">"gulp-imagemin"</span><span class="token operator">:</span> <span class="token string">"^6.1.0"</span><span class="token punctuation">,</span>    <span class="token string">"gulp-load-plugins"</span><span class="token operator">:</span> <span class="token string">"^2.0.1"</span><span class="token punctuation">,</span>    <span class="token string">"gulp-sass"</span><span class="token operator">:</span> <span class="token string">"^4.0.2"</span><span class="token punctuation">,</span>    <span class="token string">"gulp-swig"</span><span class="token operator">:</span> <span class="token string">"^0.9.1"</span><span class="token punctuation">,</span>    <span class="token string">"gulp-uglify"</span><span class="token operator">:</span> <span class="token string">"^3.0.2"</span><span class="token punctuation">,</span>    <span class="token string">"gulp-useref"</span><span class="token operator">:</span> <span class="token string">"^3.1.6"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>gitignore忽略生成的目录</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">disttemp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Grunt </tag>
            
            <tag> Gulp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>脚手架工具</title>
      <link href="2021/052035200.html"/>
      <url>2021/052035200.html</url>
      
        <content type="html"><![CDATA[<h2 id="一、脚手架工具"><a href="#一、脚手架工具" class="headerlink" title="一、脚手架工具"></a>一、脚手架工具</h2><p>脚手架的本质作用：创建项目基础结构、提供项目规范和约定</p><ul><li>相同的组织架构</li><li>相同的开发范式</li><li>相同的模块依赖</li><li>相同的工具配置</li><li>相同的基础代码</li></ul><h2 id="二、前端脚手架"><a href="#二、前端脚手架" class="headerlink" title="二、前端脚手架"></a>二、前端脚手架</h2><h3 id="1-内容概要"><a href="#1-内容概要" class="headerlink" title="1.内容概要"></a>1.内容概要</h3><ul><li>脚手架的作用</li><li>常用的脚手架工具</li><li>通用脚手架工具剖析</li><li>开发一款脚手架</li></ul><h3 id="2-常用的脚手架"><a href="#2-常用的脚手架" class="headerlink" title="2.常用的脚手架"></a>2.常用的脚手架</h3><ul><li>React.js项目–&gt;create-react-app</li><li>Vue.js项目–&gt;vue-cli</li><li>Angular项目–&gt;angular-cli</li><li>Yeoman</li><li>Plop</li></ul><h3 id="3-Yeoman基本使用"><a href="#3-Yeoman基本使用" class="headerlink" title="3.Yeoman基本使用"></a>3.Yeoman基本使用</h3><ul><li><p>在全局范围安装yo</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> yo --global  <span class="token comment"># or yarn global add yo</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>安装对应的generator</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> generator-node --global  <span class="token comment"># or yarn global add generator-node</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>通过yo运行generator</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">cd</span> project-dir<span class="token function">mkdir</span> my-moduleyo node<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="4-Yeoman-Sub-Generator"><a href="#4-Yeoman-Sub-Generator" class="headerlink" title="4.Yeoman Sub Generator"></a>4.Yeoman Sub Generator</h3><p>常规使用步骤：</p><ol><li>明确需求</li><li>找到合适的Generator</li><li>全局范围安装找到Generator</li><li>通过yo运行对应的Generator</li><li>通过命令行交互填写选项</li><li>生成你所需要的项目结构</li></ol><p>Sub Generator使用示例：yo node:cli</p><ul><li>使用yo node:cli命令安装</li><li>yarn link引导全局</li><li>使用my-module –help查看</li></ul><h3 id="5-创建Generator模块"><a href="#5-创建Generator模块" class="headerlink" title="5.创建Generator模块"></a>5.创建Generator模块</h3><p>Generator本质上就是一个NPM模块</p><p><strong>Generator模块需求：名称必须为generator-<name></name></strong></p><ul><li>基本使用步骤</li></ul><ol><li><p>命令行内容</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkdir</span> generator-sample  <span class="token comment"># 创建项目目录</span><span class="token builtin class-name">cd</span> generator-sample<span class="token function">yarn</span> init  <span class="token comment">#初始化项目</span><span class="token function">yarn</span> <span class="token function">add</span> yeoman-generator  <span class="token comment"># 安装依赖</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>根据模板创建文件</p><ol><li>进入generator-sample，创建目录generators</li><li>进入generators创建index.js</li></ol></li><li><p>编写index.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 此文件作为 Generator 的核心入口</span><span class="token comment">// 需要导出一个继承自 Yeoman Generator 的类型</span><span class="token comment">// Yeoman Generator 在工作时会自动调用我们在此类型中定义的一些生命周期方法</span><span class="token comment">// 我们在这些方法中可以通过调用父类提供的一些工具方法实现一些功能，例如文件写入</span><span class="token keyword">const</span> Generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yeoman-generator'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Generator <span class="token punctuation">{</span>    <span class="token comment">// Yeoman 自动在生成文件阶段调用此方法</span>    <span class="token comment">// 我们这里尝试往项目目录中写入文件</span>    <span class="token function">writing</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destinationPath</span><span class="token punctuation">(</span><span class="token string">'temp.text'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>命令行运行</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">link</span>  <span class="token comment"># 将模块包引至全局</span><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>  <span class="token comment"># 切回上级目录</span><span class="token function">mkdir</span> my-project<span class="token builtin class-name">cd</span> my-projectyo sample  <span class="token comment"># 运行yo sample命令，查看生成的文件temp.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ul><li>进阶使用步骤</li></ul><p>上述过程中除index.js文件内容不同，其余都相同</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 此文件作为 Generator 的核心入口</span><span class="token comment">// 需要导出一个继承自 Yeoman Generator 的类型</span><span class="token comment">// Yeoman Generator 在工作时会自动调用我们在此类型中定义的一些生命周期方法</span><span class="token comment">// 我们在这些方法中可以通过调用父类提供的一些工具方法实现一些功能，例如文件写入</span><span class="token keyword">const</span> Generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yeoman-generator'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Generator <span class="token punctuation">{</span>  <span class="token function">prompting</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// Yeoman 在询问用户环节会自动调用此方法</span>    <span class="token comment">// 在此方法中可以调用父类的 prompt() 方法发出对用户的命令行询问</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>      <span class="token punctuation">{</span>        type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>        name<span class="token operator">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span>        message<span class="token operator">:</span> <span class="token string">'Your project name'</span><span class="token punctuation">,</span>        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appname <span class="token comment">// appname 为项目生成目录名称</span>      <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token comment">// answers =&gt; { name: 'user input value' }</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>answers <span class="token operator">=</span> answers    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">writing</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// Yeoman 自动在生成文件阶段调用此方法</span>    <span class="token comment">// // 我们这里尝试往项目目录中写入文件</span>    <span class="token comment">// this.fs.write(</span>    <span class="token comment">//   this.destinationPath('temp.txt'),  // 文件绝对路径</span>    <span class="token comment">//   Math.random().toString()</span>    <span class="token comment">// )</span>    <span class="token comment">// -------------------------------------------------------</span>    <span class="token comment">// // 通过模板方式写入文件到目标目录</span>    <span class="token comment">// // 模板文件路径</span>    <span class="token comment">// const tmpl = this.templatePath('foo.txt')</span>    <span class="token comment">// // 输出目标路径</span>    <span class="token comment">// const output = this.destinationPath('foo.txt')</span>    <span class="token comment">// // 模板数据上下文</span>    <span class="token comment">// const context = { title: 'Hello zce~', success: false }</span>    <span class="token comment">// this.fs.copyTpl(tmpl, output, context)</span>    <span class="token comment">// -------------------------------------------------------</span>    <span class="token comment">// 模板文件路径</span>    <span class="token keyword">const</span> tmpl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">templatePath</span><span class="token punctuation">(</span><span class="token string">'bar.html'</span><span class="token punctuation">)</span>    <span class="token comment">// 输出目标路径</span>    <span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destinationPath</span><span class="token punctuation">(</span><span class="token string">'bar.html'</span><span class="token punctuation">)</span>    <span class="token comment">// 模板数据上下文</span>    <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>answers    <span class="token keyword">this</span><span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">copyTpl</span><span class="token punctuation">(</span>tmpl<span class="token punctuation">,</span> output<span class="token punctuation">,</span> context<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-Plop使用"><a href="#6-Plop使用" class="headerlink" title="6.Plop使用"></a>6.Plop使用</h3><p>官方简介：</p><blockquote><p>我喜欢把Plop称为“微型发电机框架”。现在，我称其为“小工具”，因为它为您提供了一种以一致的方式生成代码或任何其他类型的纯文本文件的简单方法。您会看到，我们都在代码中创建了结构和模式（路由，控制器，组件，帮助程序等）。这些模式会随着时间的推移而变化和改进，因此当您需要在此处创建新的模式插入名称时，在代码库中查找代表当前“最佳实践”的文件并不总是那么容易。那就是挽救您的地方。使用plop，您将拥有在code中创建任何给定模式的“最佳实践”方法。可以通过输入plop轻松地从终端运行代码。这不仅使您免于在代码库中四处寻找要复制的正确文件，而且还使“正确的方式”变成了“创建新文件的最简单的方式”。</p></blockquote><p>React项目中使用plop步骤</p><p>项目初始结构</p><p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-dhLtMGaC-1606035018990)(%E6%93%B7%E5%8F%96-1605681121108.JPG)]</p><ol><li><p>安装plop至开发环境中</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> plop --dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>在项目根目录中创建plopfile.js文件，并编写以下代码</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Plop入口文件，需要导出一个函数</span><span class="token comment">// 此函数接受一个plop对象，用于创建生成器任务</span>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">plop</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    plop<span class="token punctuation">.</span><span class="token function">setGenerator</span><span class="token punctuation">(</span><span class="token string">'component'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        description<span class="token operator">:</span> <span class="token string">'Create a component'</span><span class="token punctuation">,</span>        prompts<span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>                type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>  <span class="token comment">// 问题的输入方式</span>                name<span class="token operator">:</span><span class="token string">'name'</span><span class="token punctuation">,</span>  <span class="token comment">// 问题返回值的键</span>                message<span class="token operator">:</span> <span class="token string">'Component name:'</span><span class="token punctuation">,</span>  <span class="token comment">// 屏幕上给出的提示</span>                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'MyComponent'</span><span class="token punctuation">,</span>  <span class="token comment">// 问题的默认答案</span>            <span class="token punctuation">}</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        actions<span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>                type<span class="token operator">:</span> <span class="token string">'add'</span><span class="token punctuation">,</span>  <span class="token comment">// 添加一个全新的文件</span>                path<span class="token operator">:</span> <span class="token string">'src/components/{{name}}/{{name}}.js'</span><span class="token punctuation">,</span>  <span class="token comment">// 添加文件的存放位置</span>                templateFile<span class="token operator">:</span> <span class="token string">'plop-templates/component.hbs'</span><span class="token punctuation">,</span>  <span class="token comment">// 模板文件的位置</span>            <span class="token punctuation">}</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>创建plop-templates目录，在其中添加模板文件component.hbs,内容如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"{{name}}"</span><span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>命令行运行</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> plop component  <span class="token comment"># component是我们在plop中plop.setGenerator中的第一个参数</span><span class="token function">yarn</span> run v1.22.10$ F:<span class="token punctuation">\</span><span class="token number">2020</span><span class="token punctuation">\</span>Others<span class="token punctuation">\</span>important<span class="token punctuation">\</span>lagou<span class="token punctuation">\</span>02-01-study-materials<span class="token punctuation">\</span>code<span class="token punctuation">\</span>02-01-02-05-react-app<span class="token punctuation">\</span>node_modules<span class="token punctuation">\</span>.bin<span class="token punctuation">\</span>plop component? Component name: Footer√  ++ <span class="token punctuation">\</span>src<span class="token punctuation">\</span>components<span class="token punctuation">\</span>Footer<span class="token punctuation">\</span>Footer.jsDone <span class="token keyword">in</span> <span class="token number">3</span>.79s.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>至此我们就可以在src/components中看到我们生成的Footer目录，其中文件为Footer.js</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Yeoman </tag>
            
            <tag> Plop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 性能优化</title>
      <link href="2021/051953564.html"/>
      <url>2021/051953564.html</url>
      
        <content type="html"><![CDATA[<h2 id="一、性能优化介绍"><a href="#一、性能优化介绍" class="headerlink" title="一、性能优化介绍"></a>一、性能优化介绍</h2><ul><li><p>性能优化时不可避免的</p></li><li><p>哪些内容可以看做是性能优化</p><p>任何一种可以提升程序运行效率，降低程序开销的行为，我们都可以看做是一种优化操作。这就意味着在软件开发的过程中，必然存在着很多值得优化的地方。</p></li><li><p>无处不在的前端性能优化</p><p>特别是在前端开发过程中，性能优化时无处不在的，例如请求资源时的网络、数据的传输方式，开发过程中所使用的的框架等。</p></li></ul><p>本篇的核心是JavaScript语言的优化，具体来说就是认知内存空间的使用，垃圾回收的方式介绍。从而可以让我们编写出高效的JavaScript代码。</p><p><strong>内容概要</strong>：</p><ul><li>内存管理<ul><li>为什么内存需要管理</li><li>内存管理的基本流程</li></ul></li><li>垃圾回收与常见的GC算法</li><li>V8引擎的垃圾回收<ul><li>V8中的GC算法实现垃圾回收</li></ul></li><li>Performance工具</li><li>代码优化实例</li></ul><h2 id="二、内存管理"><a href="#二、内存管理" class="headerlink" title="二、内存管理"></a>二、内存管理</h2><blockquote><p>Memory Management</p></blockquote><h3 id="1-内存为什么需要管理"><a href="#1-内存为什么需要管理" class="headerlink" title="1.内存为什么需要管理"></a>1.内存为什么需要管理</h3><p>随着近些年硬件技术的不断发展，同时高级编程语言中也都自带了GC（Garbage Collection）机制，这样的变化，让我们在不需要注意内存使用的情况下，也能够正常的完成相应的功能开发。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    arrList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    arrList<span class="token punctuation">[</span><span class="token number">100000</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Leo is a coder'</span><span class="token punctuation">}</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述函数体内定义一个数组，数组长度足够大，为了当前函数在调用的时，程序可以向内存申请比较大的内存空间。执行函数过程中，我们使用性能检测工具，我们会发现，内存变化如下，内存持续升高，且并没有回落，这就是<strong>内存泄漏</strong>。内存泄漏会导致我们的页面处于卡顿状态，因此需要对内存进行人为管理。</p><p><img src="http://5coder.cn/img/1ygFrKDCSvhGX6m.png"></p><h3 id="2-内存管理介绍"><a href="#2-内存管理介绍" class="headerlink" title="2.内存管理介绍"></a>2.内存管理介绍</h3><ul><li>内存：由可读写单元组成，表示一片可操作性空间</li><li>管理：<strong>人为的去操作</strong>一片空间的申请、使用和释放</li><li>内存管理：开发者主动申请空间、使用空间、释放空间</li><li>管理流程：申请-使用-释放</li></ul><p><strong>JavaScript中的内存管理</strong></p><p>和其他语言相通，JavaScript内存管理的流程也是申请内存空间-使用内存空间-释放内存空间。但是由于<strong>ECMAScript中并没有提供操作内存的相关API</strong>，所以JavaScript语言不能像C或者C++那样，由开发者主动去调用相应的API来完成内存管理。不过，我们仍然可以通过js脚本去演示当前空间的生命周期是怎样完成的。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 申请空间</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// 使用空间</span>obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Leo'</span><span class="token comment">// 释放空间</span>obj <span class="token operator">=</span> <span class="token keyword">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-JavaScript中的垃圾回收"><a href="#3-JavaScript中的垃圾回收" class="headerlink" title="3.JavaScript中的垃圾回收"></a>3.JavaScript中的垃圾回收</h3><p> JavaScript中的垃圾</p><ul><li>JavaScript中的内存管理时自动的</li><li>对象不再被引用时是垃圾</li><li>对象不能从根上访问到时是垃圾</li></ul><p>JavaScript中的可达对象</p><ul><li>可以访问到的对象就是可达对象（引用、作用域链）</li><li>可达的标准就是从根触发是否能够被找到</li><li>JavaScript中的根可以理解为全局变量</li></ul><p>引用说明代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'leo'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// obj引用leo对象，全局可达</span><span class="token keyword">let</span> bai <span class="token operator">=</span> obj<span class="token punctuation">;</span>  <span class="token comment">// bai引用leo内存地址</span>obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">// obj不再引用，但bai依然在引用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>可达说明代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">objGroup</span><span class="token punctuation">(</span><span class="token parameter">obj1<span class="token punctuation">,</span> obj2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    obj1<span class="token punctuation">.</span>next <span class="token operator">=</span> obj2<span class="token punctuation">;</span>    obj2<span class="token punctuation">.</span>prev <span class="token operator">=</span> obj1<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span>        o1<span class="token operator">:</span>obj1<span class="token punctuation">,</span>        o2<span class="token operator">:</span>obj2    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token function">objGroup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'obj1'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'obj2'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token comment">// {</span><span class="token comment">//     o1: {name: 'obj1', next: {name: 'obj2', prev: [Circular]}},</span><span class="token comment">//     o2: {name: 'obj2', prev: {name: 'obj1', prev: [Circular]}},   </span><span class="token comment">// }</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>可达对象图示</strong></p><p><img src="http://5coder.cn/img/dnkGj8bH4vzoZCp.png"></p><p>如果我们在代码中做一些操作，比如使用delete将obj上的o1的应用以及o2中对obj1的应用删除掉，那么出现下面的情况：o1无法被找到，则被标记为垃圾。</p><p><img src="http://5coder.cn/img/WgRhFJ7xmadZzfu.png"></p><h2 id="三、GC算法介绍"><a href="#三、GC算法介绍" class="headerlink" title="三、GC算法介绍"></a>三、GC算法介绍</h2><h3 id="1-GC定义与作用"><a href="#1-GC定义与作用" class="headerlink" title="1.GC定义与作用"></a>1.GC定义与作用</h3><ul><li>GC就是垃圾回收机制的简写（Garbage Collection）</li><li>GC可以找到内存中的垃圾、并释放和回收空间</li></ul><h3 id="2-GC里的垃圾是什么"><a href="#2-GC里的垃圾是什么" class="headerlink" title="2.GC里的垃圾是什么"></a>2.GC里的垃圾是什么</h3><ul><li><p>程序中不再需要使用的对象</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    name <span class="token operator">=</span> <span class="token string">'leo'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is a coder</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面例子中，当我们函数调用完成后，name不再被需要，因此它成为了一个垃圾</p></li><li><p>程序中不能再访问到的对象</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'leo'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is a coder</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面例子中，由于使用了const关键字进行声明变量，因此当函数执行结束后，外界无法再访问到它，它也会成为一个垃圾。</p></li></ul><h3 id="3-GC算法是什么"><a href="#3-GC算法是什么" class="headerlink" title="3.GC算法是什么"></a>3.GC算法是什么</h3><ul><li>GC是一种机制，垃圾回收器完成具体的工作</li><li>工作内容就是查找垃圾、释放空间、回收空间</li><li>算法就是工作时查找和回收所遵循的规则</li></ul><p>常见的GC算法有以下几种：</p><ul><li>引用计数</li><li>标记清除</li><li>标记整理</li><li>分代回收</li></ul><h3 id="4-引用计数算法"><a href="#4-引用计数算法" class="headerlink" title="4.引用计数算法"></a>4.引用计数算法</h3><p>所谓的引用计数法就是给每个对象一个引用计数器，每当有一个地方引用它时，计数器就会加1；当引用失效时，计数器的值就会减1；任何时刻计数器的值为0的对象就是不可能再被使用的。</p><p>这个引用计数法时没有被Java所使用的，但是python有使用到它。而且最原始的引用计数法没有用到GC Roots。</p><ul><li>核心思想：设置引用数，判断当前引用数是否为0</li><li>引用计数器</li><li>引用关系改变时修改引用数字</li><li>引用数字为0时立即回收</li></ul><p><strong>优点：</strong></p><ol><li>可即时回收垃圾，在该方法中，每个对象始终知道自己是否有被引用，当被引用的数值为0时，对象马上可以把自己当做空闲空间链接到空闲链表；</li><li>最大暂停时间短；</li><li>没有必要沿着指针查找；</li></ol><p><strong>缺点：</strong></p><ol><li>计数器的增减处理非常繁重；</li><li>计算器需要占用很多位；</li><li>实现繁琐；</li><li>循环引用无法回收；</li></ol><h3 id="5-标记清除算法"><a href="#5-标记清除算法" class="headerlink" title="5.标记清除算法"></a>5.标记清除算法</h3><p>该算法分为<strong>标记</strong>和<strong>清除</strong>两个阶段。标记就是把所有活动对象都做上标记的阶段；清除就是将没有做上标记的对象进行回收的阶段。</p><ul><li>核心思想：分标记和清除两个阶段完成</li><li>遍历所有对象找标记活动对象</li><li>遍历所有对象清除没有标记对象</li><li>回收相应的空间</li></ul><p><img src="http://5coder.cn/img/EbjthkT2PHoQWar.png"></p><p><strong>优点：</strong></p><ol><li>实现简单</li><li>与保守式GC算法兼容（保守式GC在后面介绍）</li></ol><p><strong>缺点：</strong></p><p><img src="http://5coder.cn/img/1661161556_6cda0071f708177d2abb214294ebde19.png"></p><ol><li>碎片化：如上图所示，在回收过程中会产生被细化的分块，到后面，即时堆中分块的总大小够用，但是却因为分块太小而不能执行分配</li><li>分配速度：因为分块不是连续的，因此每次分块都要遍历空闲链表，找到足够大的分块，从而造成时间短的浪费</li><li>与写时复制技术不兼容：所谓写时复制就是fork的时候，内存空间只引用而不复制，只有当该进程的数据发生变化时，才会将数据复制到该进程的内存空间。这样，当两个进程中的内存数据相同的时候，就能节约大量的内存空间了。而对于标记-清除算法，它的每个对象都有一个标志位来表示它是否被标记，在每一次运行标记-清除算法的时候，被引用的对象都会进行标记操作，这个仅仅标记位的改变，也会变成对象数据的改变，从而引发写时复制的复制过程，与写时复制的初衷就背道而驰了。</li></ol><h3 id="6-标记整理算法"><a href="#6-标记整理算法" class="headerlink" title="6.标记整理算法"></a>6.标记整理算法</h3><p>标记-整理算法与标记-清理算法类似，只是后续步骤是让所有存活的对象移动到一端，然后直接清除掉端边界以外的内存。</p><ul><li>标记整理可以看作是标记清除的增强</li><li>标记阶段的操作和标记清除一致</li><li><strong>清除阶段会先执行整理，移动对象位置</strong><br><img src="http://5coder.cn/img/fix37uO2hUNelFv.png"><br><img src="http://5coder.cn/img/YEVdhFxWa9CJPHw.png"></li></ul><p>优缺点：该算法可以有效的利用堆，但是整理需要花比较多的时间成本</p><h2 id="四、V8引擎"><a href="#四、V8引擎" class="headerlink" title="四、V8引擎"></a>四、V8引擎</h2><h3 id="1-认识V8"><a href="#1-认识V8" class="headerlink" title="1.认识V8"></a>1.认识V8</h3><ul><li>V8引擎是一个JavaScript实现，最初由一些语言方面专家设计，后被谷歌收购，随后谷歌对其进行了开源；</li><li>V8使用c++开发，在运行JavaScript之前，相比其他的JavaScript的引擎转换成字节码或解释执行，V8将其编译成原生机器码（IA-32, x86-64, ARM, or MIPS CPUs），并且使用了如<strong>内联缓存</strong>（Inline caching）等方法来提高性能</li><li>有了这些功能，JavaScript程序在V8引擎下的运行速度媲美二进制程序</li><li>V8支持众多操作系统，如Windows、Linux、Android等，也支持其他硬件架构，如IA32、X64、ARM等，具有很好的可移植和跨平台特性</li><li>V8内存设限（64位1.5GB，32位不超过800MB）</li></ul><h3 id="2-V8垃圾回收策略"><a href="#2-V8垃圾回收策略" class="headerlink" title="2.V8垃圾回收策略"></a>2.V8垃圾回收策略</h3><ul><li>采用分代回收的思想</li><li>内存分为新生代、老生代</li><li>针对不同对象采用不同算法</li></ul><p>V8 使用了分代和大数据的内存分配，在回收内存时使用精简整理的算法标记未引用的对象，然后消除没有标记的对象，最后整理和压缩那些还未保存的对象，即可完成垃圾回收。</p><p><img src="http://5coder.cn/img/UDEPWurlJf38TgN.png"></p><p><strong>V8中常用的GC算法</strong></p><ul><li>分代回收</li><li>空间复制</li><li>标记清除</li><li>标记整理</li><li>标记增量</li></ul><h3 id="3-V8回收新生代对象"><a href="#3-V8回收新生代对象" class="headerlink" title="3.V8回收新生代对象"></a>3.V8回收新生代对象</h3><blockquote><p><strong>年轻分代</strong>中的对象垃圾回收主要通过Scavenge算法进行垃圾回收。在Scavenge的具体实现中，主要采用了Cheney算法：通过复制的方式实现的垃圾回收算法。它将堆内存分为两个 semispace，<strong>一个处于使用中（From空间）</strong>，<strong>另一个处于闲置状态（To空间）</strong>。当分配对象时，先是在From空间中进行分配。当开始进行垃圾回收时，会检查From空间中的存活对象，这些存活对象将被复制到To空间中，而非存活对象占用的空间将会被释放。完成复制后，From空间和To空间的角色发生对换。在垃圾回收的过程中，就是通过将存活对象在两个 semispace 空间之间进行复制。</p><p><strong>年轻分代中的对象有机会晋升为年老分代，条件主要有两个：一个是对象是否经历过Scavenge回收，一个是To空间的内存占用比超过限制。</strong></p></blockquote><p><img src="http://5coder.cn/img/8MIBQo1xF6SYPz4.png"></p><p>V8<strong>内存分配</strong></p><ul><li>V8内存空间一分为二</li><li>小空间用于存储新生代对象（32M|16M）（From+To）</li><li>新生代值得是存货时间较短的对象</li></ul><p><strong>新生代对象回收实现</strong></p><ul><li>回收过程采用复制算法+标记整理算法</li><li>新生代内存分为两个等大小空间</li><li>使用空间为From，空闲空间为To</li><li>活动对象存储于From空间</li><li>标记整理后将活动对象拷贝至To</li><li>From与To交换空间完成释放</li><li>回收细节说明：<ul><li>拷贝过程中可能出现晋升</li><li>晋升就是将新生代对象移动至老生代</li><li>一轮GC还存活的新生代需要晋升</li><li>To的使用率超过25%</li></ul></li></ul><p><img src="http://5coder.cn/img/1661175081_4eed18a482b32b1ce1ce23ac145b288d.png"></p><h3 id="4-V8回收老生代对象"><a href="#4-V8回收老生代对象" class="headerlink" title="4.V8回收老生代对象"></a>4.V8回收老生代对象</h3><ul><li>老年代对象放在右侧老生代区域</li><li><strong>64位操作系统1.4G，32位操作系统700M</strong></li><li>老年代对象就是指存活时间较长的对象（全局变量、闭包中的数据）</li></ul><blockquote><p>对于年老分代中的对象，由于存活对象占较大比重，再采用上面的方式会有两个问题：一个是存活对象较多，复制存活对象的效率将会很低；另一个问题依然是浪费一半空间的问题。为此，V8在年老分代中主要采用了Mark-Sweep（标记清除）标记清除和Mark-Compact（标记整理）相结合的方式进行垃圾回收。</p></blockquote><p><strong>老年代对象回收实现</strong></p><ul><li>主要采用标记清除、标记整理、增量标记</li><li>首先使用标记清除完成垃圾空间的回收（主要采用标记清除）</li><li>采用标记整理进行空间优化（当新生代中的内容往老生代移动时，当老生代空间不足的时候，会进行整理空间）</li><li>采用增量标记进行效率优化</li></ul><p>老生代与新生代回收对象细节对比：</p><ul><li>新生代区域垃圾回收使用空间换时间-复制算法。每时每刻都会有空闲的空间存在，但是该部分空间很小。</li><li>老生代区域垃圾回收不适合复制算法<ul><li>老生代存储空间比较大，一分为二的话就会有大量的空间被浪费</li><li>老生代数据比较多，复制时消耗的时间就会比较多</li></ul></li></ul><p><strong>增量标记优化垃圾回收</strong></p><p><img src="http://5coder.cn/img/15sl9QVXnHtSxwo.png"></p><p>图示中，程序在标记阶段被暂停运行，等待标记完成自动运行，当遇到大块需要标记的对象时，程序需要暂停很长一段时间，对用户体验很不友好，因此采用增量标记，将一大块分解为多个小块进行标记，减少每次程序暂停的时长，优化用户体验。最后标记完成后统一进行回收。例如第一步先遍历查找第一层可达的属性，第二步进行查找第二层可达，最终完成清除。这样的垃圾回收对用户暂停的体验就比较友好了。</p><h3 id="5-V8垃圾回收总结"><a href="#5-V8垃圾回收总结" class="headerlink" title="5.V8垃圾回收总结"></a>5.V8垃圾回收总结</h3><ul><li>V8是一款主流的JavaScript引擎</li><li>V8设置内存上限</li><li>V8采用基于分代回收思想实现垃圾回收</li><li>V8内存分为新生代和老生代</li><li>V8垃圾回收常见的GC算法</li></ul><h3 id="6-V8引擎执行过程"><a href="#6-V8引擎执行过程" class="headerlink" title="6.V8引擎执行过程"></a>6.V8引擎执行过程</h3><p><img src="http://5coder.cn/img/1661225261_5e847cc87337ddef38070eee41e5bdf2.png"></p><ul><li>预解析优点<ul><li>跳过未被使用的代码</li><li>不生成AST语法树，创建无变量引用和声明的scopes</li><li>依据规范抛出特定错误</li><li>解析速度更快</li></ul></li><li>全量解析<ul><li>解析被使用的代码</li><li>生成AST语法树</li><li>构建具体scopes信息，变量引用、声明等</li><li>抛出所有语法错误</li></ul></li></ul><h2 id="五、Performance工具"><a href="#五、Performance工具" class="headerlink" title="五、Performance工具"></a>五、Performance工具</h2><h3 id="1-Performance工具介绍"><a href="#1-Performance工具介绍" class="headerlink" title="1.Performance工具介绍"></a>1.Performance工具介绍</h3><p>使用Chrome DevTools的<strong>performance</strong>面板可以记录和分析页面在运行时的所有活动。</p><p>为什么我们需要使用Performance工具，其原因有以下几点：</p><ul><li>GC的目的是为了实现内存空间的良性循环</li><li>良性循环的基石是合理使用</li><li>时刻关注才能确定是否合理</li><li>由于ECMAScript中未向开发者提供操作内存空间的API</li><li>Performance工具提供了多种监控方式</li></ul><p>Performance使用步骤为：</p><ol><li>打开浏览器输入目标地址</li><li>进入开发人员工具面板（F12），选择Performance</li><li>开启录制功能，访问具体界面</li><li>执行用户行为，一段时间后停止录制</li><li>分析界面中记录的内存信息</li></ol><h3 id="2-内存问题的体现"><a href="#2-内存问题的体现" class="headerlink" title="2.内存问题的体现"></a>2.内存问题的体现</h3><p>内存问题的体现分为外在表现和内在表现。</p><p>内存问题的外在表现：</p><ul><li>页面出现延迟加载或经常性暂停</li><li>页面持续性出现糟糕的性能</li><li>页面的性能随时间延长越来越差</li></ul><p>内存问题的内在表现：</p><ul><li>内存泄漏：内存使用持续升高</li><li>内存膨胀：在多数设备上都存在性能问题</li><li>频繁垃圾回收：通过内存变化图进行分析</li></ul><h3 id="3-监控内存的几种方式"><a href="#3-监控内存的几种方式" class="headerlink" title="3.监控内存的几种方式"></a>3.监控内存的几种方式</h3><h4 id="3-1任务管理器监控内存"><a href="#3-1任务管理器监控内存" class="headerlink" title="3.1任务管理器监控内存"></a>3.1任务管理器监控内存</h4><p>打开浏览器，按键【Shift】+ 【Esc】，调出浏览器任务管理器。找到我们的目标标签页，刚开始可能没有JavaScript内存，可以在目标标签页任务上右键，然后选择JavaScript内存。</p><p>记录JavaScript内存（<strong>JavaScript堆占用的内存，表示界面中所有可达对象占用的内存</strong>）及内存占用空间（<strong>原生内存，DOM节点占用的内存</strong>），点击按钮，记录每次内存的变化。</p><p><img src="http://5coder.cn/img/SPLj7pfv2G8uIgr.gif"></p><blockquote><p>注意：以上动图中，数组超过最大长度，为录制的时候失误，请调整数组长度后，点击按钮进行观察结果</p><p>array的最大长度为Math.pow(2,32)-1<br>var arr = new Array(Math.pow(2,32));//报错Invalid array length<br>为什么呢，无符号int型的最大长度为2的32次方-1<br>为什么是2的32次方-1<br>整型为4个字节，一个字节8，即32位，本来第一位为符号位，无符号整型就从第一位开始计数了，所以范围为0到2的32次方-1</p></blockquote><h4 id="3-2Timeline记录内存"><a href="#3-2Timeline记录内存" class="headerlink" title="3.2Timeline记录内存"></a>3.2Timeline记录内存</h4><p>上述浏览器任务管理器更多的是用于判断当前脚本是否存在内存问题，而不能具体定位到问题。我们使用Timeline时间线记录内存变化，更精确的记录到内存变化。</p><p><img src="http://5coder.cn/img/R7IQYzxwmM5WTnK.gif"></p><h4 id="3-3堆快照查找分离DOM"><a href="#3-3堆快照查找分离DOM" class="headerlink" title="3.3堆快照查找分离DOM"></a>3.3堆快照查找分离DOM</h4><p>什么是分离DOM</p><ul><li>界面元素存货在DOM树上</li><li>垃圾对象时的DOM节点（当前DOM从存活的DOM树上分离，且js中没有应用这个DOM）</li><li>分离状态的DOM节点（当前DOM节点从当前DOM树分离，但js中还在应用它）</li></ul><p><img src="http://5coder.cn/img/sG2P5SjBt6xdKRU.gif"></p><p>在点击按钮后，DOM中生成了分离的DOM，造成内存空间的浪费，因此我们需要将代码中的temEle置空，这样让GC对垃圾进行回收即可。</p><h4 id="3-4判断是否存在频繁GC"><a href="#3-4判断是否存在频繁GC" class="headerlink" title="3.4判断是否存在频繁GC"></a>3.4判断是否存在频繁GC</h4><p>为什么要确定频繁垃圾回收</p><ul><li>GC工作时应用程序是停止的</li><li>频繁且过长的GC会导致应用假死</li><li>用户使用中感知应用卡顿</li></ul><p>确定频繁的垃圾回收：</p><ul><li>Timeline中频繁的上升下降</li><li>任务管理器中的数据频繁增加减小</li></ul><h2 id="六、代码优化"><a href="#六、代码优化" class="headerlink" title="六、代码优化"></a>六、代码优化</h2><h3 id="1-代码优化介绍"><a href="#1-代码优化介绍" class="headerlink" title="1.代码优化介绍"></a>1.代码优化介绍</h3><p>如何精准测试JavaScript性能：</p><ul><li>本质上就是采集大量的执行脚本进行数学统计和分析</li><li>使用基于Benchmark.js的<a href="https://jsbench.me/">https://jsbench.me</a></li></ul><p><img src="http://5coder.cn/img/dK9hqBWRvkMaZEy.png"></p><p>代码需要优化的原因：</p><ul><li>JavaScript中的内存管理自动完成</li><li>执行引擎会使用不同的GC算法</li><li>算法工作的目的是为了实现内存空间良性循环</li><li>Performance工具检测内存变化</li><li>JavaScript是单线程机制的解释性语言</li></ul><h3 id="2-慎用全局变量及缓存全局变量"><a href="#2-慎用全局变量及缓存全局变量" class="headerlink" title="2.慎用全局变量及缓存全局变量"></a>2.慎用全局变量及缓存全局变量</h3><p>全局变量的特点：</p><ul><li>全局变量挂载在window下</li><li>全局变量至少有一个引用计数</li><li>全局变量存货更久，但持续占用内存</li></ul><p>全局查找相关：</p><ul><li>目标变量不存在于当前作用域内，通过作用域链向上查找</li><li>减少全局查找降低的时间消耗</li><li>减少不必要的全局变量定义</li><li>全局变量数据局部化</li></ul><p>慎用全局变量：</p><ul><li>全局变量定义在全局执行上下文，是否有作用域链的顶端</li><li>全局执行上下文一直存在于上下文执行栈，指导程序退出</li><li>如果某个局部作用于出现了同名的变量则会遮蔽或午饭全局</li></ul><p><strong>慎用全局变量</strong>代码演示：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  name <span class="token operator">=</span> <span class="token string">'lg'</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is a coder</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'lg'</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is a coder</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/IHKBSgCf3hk5eT7.png"></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> i<span class="token punctuation">,</span> str <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  str <span class="token operator">+=</span> i<span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span>  str <span class="token operator">+=</span> i<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/YCe95UdsnzbRIGy.png"></p><p><strong>缓存全局变量</strong>代码演示：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>缓存全局变量<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span>                                                                                                     <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span>                                                                                                     <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn4<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>1111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn5<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn6<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>222<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn7<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>333<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn9<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn10<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">function</span> <span class="token function">getBtn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> oBtn1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> oBtn3 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn3'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> oBtn5 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn5'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> oBtn7 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn7'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> oBtn9 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn9'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">getBtn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> obj <span class="token operator">=</span> document  <span class="token keyword">let</span> oBtn1 <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> oBtn3 <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn3'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> oBtn5 <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn5'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> oBtn7 <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn7'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> oBtn9 <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn9'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/qkaxNHsS9b51AV7.png"></p><h3 id="3-通过原型对象添加附加方法"><a href="#3-通过原型对象添加附加方法" class="headerlink" title="3.通过原型对象添加附加方法"></a>3.通过原型对象添加附加方法</h3><p>代码演示：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">fn1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">11111</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> f1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">var</span> <span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>fn2<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">11111</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">let</span> f2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/gB4rej8DLWpXE1V.png"></p><h3 id="4-避开闭包陷阱"><a href="#4-避开闭包陷阱" class="headerlink" title="4.避开闭包陷阱"></a>4.避开闭包陷阱</h3><p>关于闭包：</p><ul><li>闭包是一种强大的语法</li><li>闭包使用不当很容易出现内存泄漏</li><li>不要为了闭包而闭包</li></ul><p>代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'lg'</span>  <span class="token keyword">return</span> name<span class="token punctuation">}</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'lg'</span>  <span class="token keyword">return</span> name<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">test</span><span class="token punctuation">(</span>test2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-避免属性访问方法使用"><a href="#5-避免属性访问方法使用" class="headerlink" title="5.避免属性访问方法使用"></a>5.避免属性访问方法使用</h3><ul><li>JavaScript不需要属性的访问方法，所有属性都是外部可见的</li><li>使用属性访问方法只会增加一层重定义，没有访问的控制力</li></ul><p>代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'icoder'</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">18</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getAge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> a <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'icoder'</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> b <span class="token operator">=</span> p2<span class="token punctuation">.</span>age<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/DJc2S8mXkajpEtM.png"></p><h3 id="6-For循环优化及选择最优循环方法"><a href="#6-For循环优化及选择最优循环方法" class="headerlink" title="6.For循环优化及选择最优循环方法"></a>6.For循环优化及选择最优循环方法</h3><p>代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> arrList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>arrList<span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'icoder'</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arrList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arrList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> arrList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arrList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/Wxw3UcVpADs6IjO.png"></p><p><strong>选择最优循环方法</strong></p><p>代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> arrList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>arrList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> arrList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arrList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> arrList<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arrList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果（forEach效率最高）：</p><p><img src="http://5coder.cn/img/tes9K4yoF3XQH6T.png"></p><h3 id="7-文档碎片优化节点添加、克隆优化节点操作"><a href="#7-文档碎片优化节点添加、克隆优化节点操作" class="headerlink" title="7.文档碎片优化节点添加、克隆优化节点操作"></a>7.文档碎片优化节点添加、克隆优化节点操作</h3><p>代码示例：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>优化节点添加<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> oP <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>  oP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>oP<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">const</span> fragEle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> oP <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>  oP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i  fragEle<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>oP<span class="token punctuation">)</span><span class="token punctuation">}</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragEle<span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/rvEJSaMpK26j54Z.png"></p><p><strong>克隆优化节点操作</strong></p><p>代码示例：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>克隆优化节点操作<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>old<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> oP <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>  oP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>oP<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">var</span> oldP <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'box1'</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> newP <span class="token operator">=</span> oldP<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>  newP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newP<span class="token punctuation">)</span><span class="token punctuation">}</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/fzEUXm5dwyingl7.png"></p><h3 id="8-直接量替换new-Object"><a href="#8-直接量替换new-Object" class="headerlink" title="8.直接量替换new Object"></a>8.直接量替换new Object</h3><p>代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>a1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>a1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>a1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>测试结果：<br><img src="http://5coder.cn/img/BUjOkDgVzJPSIT9.png"></p><h3 id="9-堆栈中的JS执行过程"><a href="#9-堆栈中的JS执行过程" class="headerlink" title="9.堆栈中的JS执行过程"></a>9.堆栈中的JS执行过程</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> baz<span class="token punctuation">}</span><span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/FgN4vncbWzUrQp9.jpg"></p><h3 id="10-减少判断层"><a href="#10-减少判断层" class="headerlink" title="10.减少判断层"></a>10.减少判断层</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token parameter">part<span class="token punctuation">,</span> chapter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> parts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ES2015'</span><span class="token punctuation">,</span> <span class="token string">'工程化'</span><span class="token punctuation">,</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span> <span class="token string">'Reach'</span><span class="token punctuation">,</span> <span class="token string">'Node'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>part<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>parts<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'属于当前课程'</span><span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>chapter <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'您需要提供VIP身份'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请确认模块信息'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token string">'ES2015'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">doSomething2</span><span class="token punctuation">(</span><span class="token parameter">part<span class="token punctuation">,</span> chapter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> parts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ES2015'</span><span class="token punctuation">,</span> <span class="token string">'工程化'</span><span class="token punctuation">,</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span> <span class="token string">'Reach'</span><span class="token punctuation">,</span> <span class="token string">'Node'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>part<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'确认模块信息'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parts<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'属于当前课程'</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>chapter <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'您需要提供VIP身份'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">doSomething2</span><span class="token punctuation">(</span><span class="token string">'ES2015'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/1661332323_d67dd1968f9dabc5a536cc4549047e5e.png" alt="减少判断层"></p><h3 id="11-减少作用域链查找层级"><a href="#11-减少作用域链查找层级" class="headerlink" title="11.减少作用域链查找层级"></a>11.减少作用域链查找层级</h3><p>代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'zce'</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  name <span class="token operator">=</span> <span class="token string">'zce666'</span>  <span class="token comment">// 这里的name是全局的    </span>  <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">28</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'zce'</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'zce666'</span><span class="token comment">// 这里的name是全局的    </span>  <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">28</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/eFGblMkyauDAO8K.png"></p><h3 id="12-减少数据读取次数"><a href="#12-减少数据读取次数" class="headerlink" title="12.减少数据读取次数"></a>12.减少数据读取次数</h3><p>代码示例：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>减少数据读取次数<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skip<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skip<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">        <span class="token keyword">var</span> oBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'skip'</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">hasEle</span><span class="token punctuation">(</span><span class="token parameter">ele<span class="token punctuation">,</span> cls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> ele<span class="token punctuation">.</span>className <span class="token operator">===</span> cls<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">hasEle</span><span class="token punctuation">(</span><span class="token parameter">ele<span class="token punctuation">,</span> cls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> className <span class="token operator">=</span> ele<span class="token punctuation">.</span>className  <span class="token keyword">return</span> className <span class="token operator">===</span> cls<span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hasEle</span><span class="token punctuation">(</span>oBox<span class="token punctuation">,</span> <span class="token string">'skip'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/53YtRCWn2o1jsaT.png"></p><h3 id="13-字面量与构造式"><a href="#13-字面量与构造式" class="headerlink" title="13.字面量与构造式"></a>13.字面量与构造式</h3><p>代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'zce'</span><span class="token punctuation">;</span>  obj<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token string">'28'</span><span class="token punctuation">;</span>  obj<span class="token punctuation">.</span>slogan <span class="token operator">=</span> <span class="token string">'我为前端而活'</span>  <span class="token keyword">return</span> obj<span class="token punctuation">}</span><span class="token keyword">var</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'zce'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token string">'28'</span><span class="token punctuation">,</span> slogan<span class="token operator">:</span> <span class="token string">'喔喔前端而活'</span><span class="token punctuation">}</span>  <span class="token keyword">return</span> obj<span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/LUPtoS5zT64Nx8B.png"></p><h3 id="14-减少循环体中活动"><a href="#14-减少循环体中活动" class="headerlink" title="14.减少循环体中活动"></a>14.减少循环体中活动</h3><p>代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> i  <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'zce'</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token string">'我为前端而活'</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">var</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> i  <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'zce'</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token string">'我为前端而活'</span><span class="token punctuation">]</span>  <span class="token keyword">var</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果：</p><p><img src="http://5coder.cn/img/Lw4hojUnXibfu2x.png"></p><h3 id="15-惰性函数与性能"><a href="#15-惰性函数与性能" class="headerlink" title="15.惰性函数与性能"></a>15.惰性函数与性能</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">        <span class="token keyword">var</span> oBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    obj<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>    obj<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    obj<span class="token punctuation">[</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">]</span> <span class="token operator">=</span> fn  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    addEvent <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>    addEvent <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    addEvent <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">]</span> <span class="token operator">=</span> fn  <span class="token punctuation">}</span>  <span class="token keyword">return</span> addEvent<span class="token punctuation">}</span>        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="16-减少声明及语句数"><a href="#16-减少声明及语句数" class="headerlink" title="16.减少声明及语句数"></a>16.减少声明及语句数</h3><p>代码示例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> w <span class="token operator">=</span> <span class="token number">200</span>  <span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token number">300</span>  <span class="token keyword">return</span> w <span class="token operator">*</span> h<span class="token punctuation">}</span><span class="token keyword">var</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token number">200</span> <span class="token operator">*</span> <span class="token number">300</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="17-采用事件绑定"><a href="#17-采用事件绑定" class="headerlink" title="17.采用事件绑定"></a>17.采用事件绑定</h3><p>代码示例：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ul<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Leo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>我为前端而活<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">var</span> list <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">showText</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> listElement <span class="token keyword">of</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>  item<span class="token punctuation">.</span>onclick <span class="token operator">=</span> showText<span class="token punctuation">}</span><span class="token keyword">var</span> oUl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span>oUl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> showText<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript 语言</title>
      <link href="2021/051950148.html"/>
      <url>2021/051950148.html</url>
      
        <content type="html"><![CDATA[<h1 id="TypeScript语言-前置知识"><a href="#TypeScript语言-前置知识" class="headerlink" title="TypeScript语言-前置知识"></a>TypeScript语言-前置知识</h1><h2 id="一、强类型与弱类型、静态类型与动态类型"><a href="#一、强类型与弱类型、静态类型与动态类型" class="headerlink" title="一、强类型与弱类型、静态类型与动态类型"></a>一、强类型与弱类型、静态类型与动态类型</h2><h3 id="1-强类型与弱类型（类型安全）"><a href="#1-强类型与弱类型（类型安全）" class="headerlink" title="1.强类型与弱类型（类型安全）"></a>1.强类型与弱类型（类型安全）</h3><p><strong>①、强类型语言</strong>：强类型语言也称为强类型定义语言。是一种总是强制类型定义的语言，要求变量的使用要严格符合定义，所有变量都必须先定义后使用。**java、.NET、C++**等都是强制类型定义的。也就是说，一旦一个变量被指定了某个数据类型，如果不经过强制转换，那么它就永远是这个数据类型了。</p><p>1974年美国两个专家做出解释：语言层面限制函数的实参类型必须与形参类型相同</p><p>个人理解：强类型语言不允许有各种方式的隐式转换</p><p>例如你有一个整数，如果不显式地进行转换，你不能将其视为一个字符串。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>    <span class="token comment">// 接受一个整形的参数</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Main</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ok</span>                <span class="token class-name">Main</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">"100"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error "100" is a string，不允许传入其他类型的值</span>                <span class="token class-name">Main</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">Interger</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">"100"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ok，强制类型转换</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">D:<span class="token punctuation">\</span>DeskTop<span class="token punctuation">\</span>lagou<span class="token punctuation">\</span>Flow<span class="token operator">&gt;</span>pythonPython <span class="token number">3.7</span>.0 <span class="token punctuation">(</span>v3.7.0:1bf9cc5093, Jun <span class="token number">27</span> <span class="token number">2018</span>, 04:59:51<span class="token punctuation">)</span> <span class="token punctuation">[</span>MSC v.1914 <span class="token number">64</span> bit <span class="token punctuation">(</span>AMD64<span class="token punctuation">)</span><span class="token punctuation">]</span> on win32Type <span class="token string">"help"</span>, <span class="token string">"copyright"</span>, <span class="token string">"credits"</span> or <span class="token string">"license"</span> <span class="token keyword">for</span> <span class="token function">more</span> information.<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token string">'100'</span> - <span class="token number">50</span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:  File <span class="token string">"&lt;stdin&gt;"</span>, line <span class="token number">1</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>TypeError: unsupported operand type<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> -: <span class="token string">'str'</span> and <span class="token string">'int'</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> abs<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:  File <span class="token string">"&lt;stdin&gt;"</span>, line <span class="token number">1</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>TypeError: bad operand <span class="token builtin class-name">type</span> <span class="token keyword">for</span> abs<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token string">'str'</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>与其相对应的是弱类型语言：数据类型可以被忽略的语言。它与强类型定义语言相反， 一个变量可以赋不同数据类型的值。</p><p><strong>②、弱类型语言：</strong>弱类型语言也称为弱类型定义语言。与强类型定义相反。像<strong>vb、php、js</strong>等就属于弱类型语言，语言层面不会限制实参的类型。</p><p>个人理解：弱类型语言则允许任意的数据隐式类型转换</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">'100'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ok</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'100'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ok</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Microsoft Windows <span class="token punctuation">[</span>版本 <span class="token number">10.0</span>.18363.1139<span class="token punctuation">]</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2019</span> Microsoft Corporation。保留所有权利。D:<span class="token punctuation">\</span>DeskTop<span class="token punctuation">\</span>lagou<span class="token punctuation">\</span>Flow<span class="token operator">&gt;</span>nodeWelcome to Node.js v12.19.0.Type <span class="token string">".help"</span> <span class="token keyword">for</span> <span class="token function">more</span> information.<span class="token operator">&gt;</span> <span class="token string">'100'</span> - <span class="token number">50</span><span class="token number">50</span><span class="token operator">&gt;</span> Math.floor<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>NaN<span class="token operator">&gt;</span> Math.floor<span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>JavaScript中所有的类型错误都是在代码执行（逻辑判断）的过程中抛出的，并不是在语法层面进行抛出。</p><h3 id="2-静态类型与动态类型（类型检查）"><a href="#2-静态类型与动态类型（类型检查）" class="headerlink" title="2.静态类型与动态类型（类型检查）"></a>2.静态类型与动态类型（类型检查）</h3><ul><li><p>静态类型语言</p><p>一种在编译时，数据类型是固定的语言。大多数静态类型定义语言强制这一点，它要求你在使用所有变量之前要声明它们的数据类型。Java和C是静态类型定义语言。</p></li><li><p>动态类型语言</p><p>一种在执行期间才去发现数据类型的语言，与静态类型定义相反。VBScript和Python是动态类型定义的，因为它们是在第一次给一个变量赋值的时候找出它的类型的。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>foo <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 在JavaScript中，变量是没有类型的。而变量中存放的值是有类型的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><img src="http://5coder.cn/img/fPas346JDgeFwyu.png"></p><h3 id="3-JavaScript类型系统特征"><a href="#3-JavaScript类型系统特征" class="headerlink" title="3.JavaScript类型系统特征"></a>3.JavaScript类型系统特征</h3><p>JavaScript为弱类型且动态类型，语言本身的系统非常薄弱，甚至说JavaScript根本没有类型系统—-【任性】，其缺失类型系统的可靠性【不靠谱】。</p><p>早期JavaScript的目的并没有想到去处理很多程序，很多项目只有几十行上百行代码。</p><h3 id="4-弱类型的问题及强类型的优势"><a href="#4-弱类型的问题及强类型的优势" class="headerlink" title="4.弱类型的问题及强类型的优势"></a>4.弱类型的问题及强类型的优势</h3><ul><li><strong>弱类型的问题</strong>，运行阶段才能发现类型异常问题。例如在setTimeout中，当时间结束时才会发现错误，如果调试过程中没有等到足够的时间，那么这个类型错误就会形成隐患。</li></ul><p>示例一：运行时才能发现错误</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// obj.foo();</span><span class="token comment">// ^</span><span class="token comment">//</span><span class="token comment">// TypeError: obj.foo is not a function</span><span class="token comment">// at Object.&lt;anonymous&gt; (D:\DeskTop\lagou\Flow\01\01-getting-started.js:2:5)</span><span class="token comment">// at Module._compile (internal/modules/cjs/loader.js:1015:30)</span><span class="token comment">// at Object.Module._extensions..js (internal/modules/cjs/loader.js:1035:10)</span><span class="token comment">// at Module.load (internal/modules/cjs/loader.js:879:32)</span><span class="token comment">// at Function.Module._load (internal/modules/cjs/loader.js:724:14)</span><span class="token comment">// at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:60:12)</span><span class="token comment">// at internal/main/run_main_module.js:17:47</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>示例二：非预期结果</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token string">'100'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200</span><span class="token comment">// 100100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>示例三：数据错误</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>obj<span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">'true'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><strong>强类型的优势</strong>：错误更早的暴露、代码更智能，编码更准确、重构更方便、减少不必要的类型判断</li></ul><h2 id="②、Flow概述及方法"><a href="#②、Flow概述及方法" class="headerlink" title="②、Flow概述及方法"></a>②、Flow概述及方法</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h3><p>flow是 facebook 出品的 JavaScript <strong>静态类型检查工具，<a href="https://flow.org/en/docs/usage/">https://flow.org/en/docs/usage/</a></strong>  这是其官方文档链接。Vue.js 的源码利用了Flow 做了静态类型检查。</p><p><strong>JavaScript</strong> 是<strong>动态类型语言</strong>，它的灵活性有目共睹，但是过于灵活的副作用是很容易就写出<strong>非常隐蔽的隐患代码</strong>，在<strong>编译期</strong>甚至看上去都<strong>不会报错</strong>，但在<strong>运行阶段</strong>就可能出现<strong>各种奇怪的 bug</strong></p><p><strong>类型检查的定义</strong>：类型检查，就是在<strong>编译期</strong>尽早发现（<strong>由类型错误引起的</strong>）bug，又<strong>不影响代码运行</strong>（不需要运行时动态检查类型），使编写 JavaScript 具有和编写 Java 等强类型语言相近的体验</p><p><strong>在vue中使用Flow做静态类型检查</strong>，是因为 <strong>Babel</strong> 和 <strong>ESLint</strong> 都有对应的 <strong>Flow 插件</strong>以支持语法，可以完全沿用<strong>现有的构建配置</strong>，非常小成本的改动就可以拥有<strong>静态类型检查的能力</strong></p><p>类型注解</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> number<span class="token punctuation">,</span> y<span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>  <span class="token keyword">return</span> x <span class="token operator">+</span> y      <span class="token comment">//x的类型是number,y的类型是number，函数的返回值类型是number</span><span class="token punctuation">}</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-快速上手"><a href="#2-快速上手" class="headerlink" title="2.快速上手"></a>2.快速上手</h3><ol><li><p>初始化模块</p><ul><li>yarn init -yes</li></ul></li><li><p>安装flow</p><ul><li>yarn add flow-bin -dev</li></ul></li><li><p>使用flow类型注解</p><ul><li><p>必须在文件文件开始处标记：@flow</p></li><li><p>关闭VS Code语法校验：setting，搜索JavaScript validate，找到enable，取消勾选</p></li></ul></li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// @flow</span><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span>number<span class="token punctuation">,</span> b<span class="token operator">:</span>number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token string">'100'</span><span class="token punctuation">)</span><span class="token keyword">let</span> num<span class="token operator">:</span>number <span class="token operator">=</span> <span class="token number">100</span>num <span class="token operator">=</span> <span class="token string">'100'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> flow init<span class="token function">yarn</span> flow  <span class="token comment"># 第一次会很慢，后续会很快</span><span class="token comment"># yarn flow stop # 结束flow</span><span class="token comment">#Error ---------------------------------------------------------------------------------------------------- 01/01.js:8:12</span><span class="token comment">#Cannot call `sum` with `'100'` bound to `b` because string [1] is incompatible with number [2]. [incompatible-call]</span><span class="token comment">#   01/01.js:8:12</span><span class="token comment">#   8| sum('100', '100')</span><span class="token comment">#                 ^^^^^ [1]</span><span class="token comment">#References:</span><span class="token comment">#   01/01.js:3:26</span><span class="token comment">#   3| function sum(a:number, b:number) {</span><span class="token comment">#                               ^^^^^^ [2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-编译移除注解"><a href="#3-编译移除注解" class="headerlink" title="3.编译移除注解"></a>3.编译移除注解</h3><ul><li>方案一：自动移除类型注解，官方提供的模块：flow-remove-types</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> flow-remove-types --dev<span class="token function">yarn</span> flow-remove-types <span class="token builtin class-name">.</span> -d dist<span class="token comment"># yarn flow-remove-types [需要移除注解的文件，一般为src] -d [输出目录，如果不存在则新建，一般为dist]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>方案二：babel</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> @babel/core @babel/cli @babel/preset-flow --dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后在项目中添加项目文件-【.babelrc】,然后在文件中输入：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">{</span>    <span class="token string">"presets"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"@babel/preset-flow"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>随后使用命令行</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> babel src -d dist<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-开发者工具插件"><a href="#4-开发者工具插件" class="headerlink" title="4.开发者工具插件"></a>4.开发者工具插件</h3><blockquote><p><strong>VS Code搜索插件【flow language support】,flow官方提供的插件，可以实时显示类型异常。</strong>默认情况下，修改完代码，需要重新保存后才会检测类型异常。</p><p>flow官网：<a href="https://flow.org/en/docs/editors">https://flow.org/en/docs/editors</a></p></blockquote><h3 id="5-类型推断"><a href="#5-类型推断" class="headerlink" title="5.类型推断"></a>5.类型推断</h3><p>flow支持在代码编写过程中就进行类型推断，例如下面代码中，需要算一个数的平方，当传入非数字类型时，flow会进行代码提示，抛出类型错误。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// @flowfunction square(n: number) {return n * n;}square('100')</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="6-类型注解"><a href="#6-类型注解" class="headerlink" title="6.类型注解"></a>6.类型注解</h3><p>在绝大多数情况下一样，它可以帮我们推断出来变量，或者是参数的具体类型，但是没有必要给所有的成员都去添加，它可以更明确的去限制类型注解，而且对我们后期去理解，也是有帮助的可能去使用。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> num<span class="token operator">:</span>number <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>  <span class="token comment">// num = 'string',此时只能赋值数字类型</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>number <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token comment">// 此时函数只能返回数字类型，如果函数没有返回值，默认返回undefined，那么也会提醒报错。没有返回值的函数，我们需要将函数返回值类型标注为void</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-原始类型"><a href="#7-原始类型" class="headerlink" title="7.原始类型"></a>7.原始类型</h3><p>在用法上flow，几乎没有任何的难度，无外乎就是使用flow命令去根据我们代码当中添加的类型注解，去检测我们代码当中的那些类型使用上的异常。值得我们再去了解的无外乎就是flow当中，具体支持哪些类型，以及，我们在类型注解上有没有一些更高级的用法，这里呢，我们具体来看。</p><p>flow中能使用的类型有很多，最简单的就是JavaScript中的原始类型，目前原始类型共有6中，number、Boole、string、null、undefined、symbol。以下进行快速尝试：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * 原始类型 * * @flow */</span><span class="token keyword">const</span> a<span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'foobar'</span><span class="token keyword">const</span> b<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">Infinity</span> <span class="token comment">// NaN // 100</span><span class="token keyword">const</span> c<span class="token operator">:</span> boolean <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// true</span><span class="token keyword">const</span> d<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">const</span> e<span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token keyword">const</span> f<span class="token operator">:</span> symbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-数组类型"><a href="#8-数组类型" class="headerlink" title="8.数组类型"></a>8.数组类型</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * 数组类型 * * @flow */</span><span class="token keyword">const</span> arr1<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">const</span> arr2<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token comment">// 元组</span><span class="token keyword">const</span> foo<span class="token operator">:</span> <span class="token punctuation">[</span>string<span class="token punctuation">,</span> number<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="9-对象类型"><a href="#9-对象类型" class="headerlink" title="9.对象类型"></a>9.对象类型</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * 对象类型 * * @flow */</span><span class="token keyword">const</span> obj1<span class="token operator">:</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> string<span class="token punctuation">,</span> bar<span class="token operator">:</span> number <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token keyword">const</span> obj2<span class="token operator">:</span> <span class="token punctuation">{</span> foo<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">,</span> bar<span class="token operator">:</span> number <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> bar<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token keyword">const</span> obj3<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>string<span class="token punctuation">]</span><span class="token operator">:</span> string <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>obj3<span class="token punctuation">.</span>key1 <span class="token operator">=</span> <span class="token string">'value1'</span>obj3<span class="token punctuation">.</span>key2 <span class="token operator">=</span> <span class="token string">'value2'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="10-函数类型"><a href="#10-函数类型" class="headerlink" title="10.函数类型"></a>10.函数类型</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * 函数类型 * * @flow */</span><span class="token keyword">function</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">string<span class="token punctuation">,</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// str =&gt; string</span>  <span class="token comment">// n =&gt; number</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="11-特殊类型"><a href="#11-特殊类型" class="headerlink" title="11.特殊类型"></a>11.特殊类型</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * 特殊类型 * * @flow */</span><span class="token comment">// 字面量类型</span><span class="token keyword">const</span> a<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token keyword">const</span> type<span class="token operator">:</span> <span class="token string">'success'</span> <span class="token operator">|</span> <span class="token string">'warning'</span> <span class="token operator">|</span> <span class="token string">'danger'</span> <span class="token operator">=</span> <span class="token string">'success'</span><span class="token comment">// ------------------------</span><span class="token comment">// 声明类型</span>type StringOrNumber <span class="token operator">=</span> string <span class="token operator">|</span> number<span class="token keyword">const</span> b<span class="token operator">:</span> StringOrNumber <span class="token operator">=</span> <span class="token string">'string'</span> <span class="token comment">// 100</span><span class="token comment">// ------------------------</span><span class="token comment">// Maybe 类型</span><span class="token keyword">const</span> gender<span class="token operator">:</span> <span class="token operator">?</span>number <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token comment">// 相当于</span><span class="token comment">// const gender: number | null | void = undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="12-Mixed与Any"><a href="#12-Mixed与Any" class="headerlink" title="12.Mixed与Any"></a>12.Mixed与Any</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * Mixed Any * * @flow */</span><span class="token comment">// string | number | boolean | ....</span><span class="token keyword">function</span> <span class="token function">passMixed</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> mixed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    value<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    value <span class="token operator">*</span> value  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">passMixed</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token function">passMixed</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token comment">// ---------------------------------</span><span class="token keyword">function</span> <span class="token function">passAny</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  value<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  value <span class="token operator">*</span> value<span class="token punctuation">}</span><span class="token function">passAny</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token function">passAny</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="13-Flow类型小结"><a href="#13-Flow类型小结" class="headerlink" title="13.Flow类型小结"></a><strong>13.Flow类型小结</strong></h3><p>Flow所有类型的文档：</p><p><a href="https://flow.org/en/docs/types">https://flow.org/en/docs/types</a></p><p>第三方类型手册</p><p><a href="https://www.saltycrane.com/cheat-sheets/flow-type/latest/">https://www.saltycrane.com/cheat-sheets/flow-type/latest/</a></p><h3 id="14-Flow运行环境API"><a href="#14-Flow运行环境API" class="headerlink" title="14.Flow运行环境API"></a>14.Flow运行环境API</h3><ul><li><p><a href="https://github.com/facebook/flow/blob/master/lib/core.js">https://github.com/facebook/flow/blob/master/lib/core.js</a></p></li><li><p><a href="https://github.com/facebook/flow/blob/master/lib/dom.js">https://github.com/facebook/flow/blob/master/lib/dom.js</a></p></li><li><p><a href="https://github.com/facebook/flow/blob/master/lib/bom.js">https://github.com/facebook/flow/blob/master/lib/bom.js</a></p></li><li><p><a href="https://github.com/facebook/flow/blob/master/lib/cssom.js">https://github.com/facebook/flow/blob/master/lib/cssom.js</a></p></li><li><p><a href="https://github.com/facebook/flow/blob/master/lib/node.js">https://github.com/facebook/flow/blob/master/lib/node.js</a></p></li></ul><h1 id="TypeScript语言"><a href="#TypeScript语言" class="headerlink" title="TypeScript语言"></a>TypeScript语言</h1><h2 id="一、TypeScript概述"><a href="#一、TypeScript概述" class="headerlink" title="一、TypeScript概述"></a>一、TypeScript概述</h2><p>TypeScript是一种由微软开发的自由和开源的编程语言。它是 JavaScript 的一个超集，而且本质上向这个语言添加了可选的静态类型和基于类的面向对象编程。</p><p><img src="http://5coder.cn/img/1661157287_e5a684aca0ab3936570855fdde86b234.png"></p><p>TypeScript 扩展了 JavaScript 的句法，所以任何现有的 JavaScript 程序可以不加改变的在 TypeScript下工作。TypeScript 是为大型应用之开发而设计，而编译时它产生 JavaScript 以确保兼容性。任何一种JavaScript运行环境都支持TypeScript开发。</p><ul><li><p>缺点一：语言多了很多概念，提高学习成本。但其属于渐进式的，所以可以按照JavaScript标准语法来使用，在学习过程中了解到一个特性就可以使用一个特性。</p></li><li><p>缺点二：项目初期，TypeScript会增加一些时间成本，需要很多的类型声明。</p></li></ul><h2 id="二、TypeScript快速上手"><a href="#二、TypeScript快速上手" class="headerlink" title="二、TypeScript快速上手"></a>二、TypeScript快速上手</h2><ol><li><p>安装TypeScript</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> init --yes  <span class="token comment"># 初始化项目目录</span><span class="token function">yarn</span> <span class="token function">add</span> typescript --dev  <span class="token comment"># 开发依赖</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>新建TypeScript文件，文件名01-getting-started.ts,其文件扩展名默认为**.ts**</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 可以完全按照 JavaScript 标准语法编写代码</span><span class="token keyword">const</span> <span class="token function-variable function">hello</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>  <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">'TypeScript'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>使用TypeScript编译上述文件</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> tsc 01-getting-started.ts<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编译后的文件01-getting-started.js：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">"use strict"</span><span class="token punctuation">;</span><span class="token comment">// 可以完全按照 JavaScript 标准语法编写代码</span><span class="token keyword">var</span> <span class="token function-variable function">hello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello, "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">'TypeScript'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//# sourceMappingURL=01-getting-started.js.map</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="三、TypeScript配置文件"><a href="#三、TypeScript配置文件" class="headerlink" title="三、TypeScript配置文件"></a>三、TypeScript配置文件</h2><p>tsc不仅仅可以编译单个文件，还可以编译整个项目或者整个工程。在编译整个项目前，我们需要先给整个项目创建一个TypeScript的配置文件。</p><p>使用命令自动生成配置文件：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> tsc --init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在根目录下会多出tsconfig.json文件</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">{</span>  <span class="token string">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">/* Basic Options */</span>    <span class="token comment">// "incremental": true,                   /* Enable incremental compilation */</span>    <span class="token string">"target"</span><span class="token operator">:</span> <span class="token string">"ES2015"</span><span class="token punctuation">,</span>                          <span class="token comment">/* Specify ECMAScript target version: 'ES3' (default), 'ES5', 'ES2015', 'ES2016', 'ES2017', 'ES2018', 'ES2019' or 'ESNEXT'. */</span>    <span class="token string">"module"</span><span class="token operator">:</span> <span class="token string">"commonjs"</span><span class="token punctuation">,</span>                     <span class="token comment">/* Specify module code generation: 'none', 'commonjs', 'amd', 'system', 'umd', 'es2015', or 'ESNext'. */</span>    <span class="token string">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"ES2015"</span><span class="token punctuation">,</span> <span class="token string">"DOM"</span><span class="token punctuation">,</span> <span class="token string">"ES2017"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                             <span class="token comment">/* Specify library files to be included in the compilation. */</span>    <span class="token comment">// "allowJs": true,                       /* Allow javascript files to be compiled. */</span>    <span class="token comment">// "checkJs": true,                       /* Report errors in .js files. */</span>    <span class="token comment">// "jsx": "preserve",                     /* Specify JSX code generation: 'preserve', 'react-native', or 'react'. */</span>    <span class="token comment">// "declaration": true,                   /* Generates corresponding '.d.ts' file. */</span>    <span class="token comment">// "declarationMap": true,                /* Generates a sourcemap for each corresponding '.d.ts' file. */</span>    <span class="token string">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                     <span class="token comment">/* Generates corresponding '.map' file. */</span>    <span class="token comment">// "outFile": "./",                       /* Concatenate and emit output to single file. */</span>    <span class="token string">"outDir"</span><span class="token operator">:</span> <span class="token string">"dist"</span><span class="token punctuation">,</span>                        <span class="token comment">/* Redirect output structure to the directory. */</span>    <span class="token string">"rootDir"</span><span class="token operator">:</span> <span class="token string">"src"</span><span class="token punctuation">,</span>                       <span class="token comment">/* Specify the root directory of input files. Use to control the output directory structure with --outDir. */</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token comment">/* Experimental Options */</span>    <span class="token comment">// "experimentalDecorators": true,        /* Enables experimental support for ES7 decorators. */</span>    <span class="token comment">// "emitDecoratorMetadata": true,         /* Enables experimental support for emitting type metadata for decorators. */</span>    <span class="token comment">/* Advanced Options */</span>    <span class="token string">"forceConsistentCasingInFileNames"</span><span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">/* Disallow inconsistently-cased references to the same file. */</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="四、TypeScript原始类型"><a href="#四、TypeScript原始类型" class="headerlink" title="四、TypeScript原始类型"></a>四、TypeScript原始类型</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原始数据类型</span><span class="token keyword">const</span> a<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'foobar'</span><span class="token keyword">const</span> b<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">100</span> <span class="token comment">// NaN Infinity</span><span class="token keyword">const</span> c<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// false</span><span class="token comment">// 在非严格模式（strictNullChecks）下，</span><span class="token comment">// string, number, boolean 都可以为空</span><span class="token comment">// const d: string = null</span><span class="token comment">// const d: number = null</span><span class="token comment">// const d: boolean = null</span><span class="token keyword">const</span> e<span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token keyword">const</span> f<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">const</span> g<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="五、TypeScript标准库声明"><a href="#五、TypeScript标准库声明" class="headerlink" title="五、TypeScript标准库声明"></a>五、TypeScript标准库声明</h2><p>标准库就是内置对象多对应的声明，代码中使用内置对象就必须引用对应的标准库，否则TypeScript就会报错。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Symbol 是 ES2015 标准中定义的成员，</span><span class="token comment">// 使用它的前提是必须确保有对应的 ES2015 标准库引用</span><span class="token comment">// 也就是 tsconfig.json 中的 lib 选项必须包含 ES2015</span><span class="token comment">// "lib": ["ES2015", "DOM", "ES2017"],TypeScript把BOM和DOM都归结到一个标准库中，为DOM</span><span class="token keyword">const</span> h<span class="token operator">:</span> symbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// Promise</span><span class="token comment">// const error: string = 100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在上述**const h: symbol = Symbol()**中，如果配置文件中“target”为es5，那么会提示错误，因为，我们的symbol是es2015中新增的类型，所以需要将target改为es2015或以上才可以使用。</p><h2 id="六、TypeScript中文错误消息"><a href="#六、TypeScript中文错误消息" class="headerlink" title="六、TypeScript中文错误消息"></a>六、TypeScript中文错误消息</h2><p>使TypeScript显示中文的错误消息，这样方便国人进行快速定位问题。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">tsc --local zh-CN  <span class="token comment"># 绝大多数会使用中文</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>VS Code中，搜索TypeScript local，将TypeScript：local设置为zh-CN，此时VS Code报出的错误提示也会是中文的。不过，并不推荐这样做，锻炼英语，之后更便捷的阅读官方文档，这才是我这种菜鸟程序员的挑战。</p><h2 id="七、TypeScript作用域问题"><a href="#七、TypeScript作用域问题" class="headerlink" title="七、TypeScript作用域问题"></a>七、TypeScript作用域问题</h2><p>不同文件中会有相同变量名的情况，此时TypeScript就会报出错误，重复定义变量。为解决这个办法，我们需要将变量放到不同的作用域或者使用exports导出，这样文件就作为一个模块，模块是有单独的作用域的。</p><h2 id="八、TypeScript-Object类型"><a href="#八、TypeScript-Object类型" class="headerlink" title="八、TypeScript Object类型"></a>八、TypeScript Object类型</h2><p>TypeScript中的object并不单独指对象类型，而是泛指所有的非原始类型，也就是对象、数组、函数。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Object 类型</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 确保跟其它示例没有成员冲突</span><span class="token comment">// object 类型是指除了原始类型以外的其它类型</span><span class="token keyword">const</span> foo<span class="token operator">:</span> <span class="token function-variable function">object</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// [] // {}  可以接受对象、数组、函数</span><span class="token comment">// 如果需要明确限制对象类型，则应该使用这种类型对象字面量的语法，或者是「接口」</span><span class="token keyword">const</span> obj<span class="token operator">:</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> number<span class="token punctuation">,</span> bar<span class="token operator">:</span> string <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token comment">// 接口的概念后续介绍</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="九、TypeScript数组类型"><a href="#九、TypeScript数组类型" class="headerlink" title="九、TypeScript数组类型"></a>九、TypeScript数组类型</h2><p>TypeScript中定义数组的方式，与Flow中几乎完全一致。他有两种方式，第一种就是使用array泛型。第二种使用元素类型加方括号的形式。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 数组类型</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 确保跟其它示例没有成员冲突</span><span class="token comment">// 数组类型的两种表示方式</span><span class="token keyword">const</span> arr1<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">const</span> arr2<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>TypeScript中使用强类型的优势：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 案例 -----------------------</span><span class="token comment">// 如果是 JS，需要判断是不是每个成员都是数字</span><span class="token comment">// 使用 TS，类型有保障，不用添加类型判断</span><span class="token keyword">function</span> <span class="token function">sum</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> prev <span class="token operator">+</span> current<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// reduce回顾：第一个参数prev为累加的和，第二个参数为当前循环的项，函数体中写业务代码，默认值为0</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>一般情况下，数组应该保持同质，也就是说数组中的元素应该具有相同的类型。</strong></p><h2 id="十、TypeScript元组类型"><a href="#十、TypeScript元组类型" class="headerlink" title="十、TypeScript元组类型"></a>十、TypeScript元组类型</h2><p>元组是array的一种子类型，是定义数组的一种特殊类型。长度固定，各索引位置上的值具有固定的已知类型。与其他多数类型不同，声明元组时必须显示注解类型。这是因为，创建元组使用的语法与数组相同（都使用方括号），而TypeScript遇到方括号，推导出来的是数组的类型。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">const</span> tuple<span class="token operator">:</span><span class="token punctuation">[</span>number<span class="token punctuation">,</span> string<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'Leo'</span><span class="token punctuation">]</span><span class="token comment">// const age = tuple[0]</span><span class="token comment">// const name = tuple[1]</span><span class="token keyword">const</span> <span class="token punctuation">[</span>age<span class="token punctuation">,</span> name<span class="token punctuation">]</span> <span class="token operator">=</span> tuple<span class="token comment">// ---------------------</span><span class="token keyword">const</span> entries<span class="token operator">:</span> <span class="token punctuation">[</span>string<span class="token punctuation">,</span> number<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  foo<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>  bar<span class="token operator">:</span> <span class="token number">456</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment">// key =&gt; foo, value =&gt; 123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="十一、TypeScript枚举类型"><a href="#十一、TypeScript枚举类型" class="headerlink" title="十一、TypeScript枚举类型"></a>十一、TypeScript枚举类型</h2><p>枚举的作用是列举类型中包含的各个值。这是一种无序数结构，把键映射到值上。枚举可以理解为编译时键的固定访问对象，访问键时，TypeScript将检查指定的键是否存在。示例如下：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// 文章对象</span><span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token punctuation">{</span>    title<span class="token operator">:</span> <span class="token string">"TypeScript介绍"</span><span class="token punctuation">,</span>    content<span class="token operator">:</span> <span class="token string">"简单介绍一下TypeScript语言"</span><span class="token punctuation">,</span>    status<span class="token operator">:</span> <span class="token number">2</span> <span class="token comment">// 1  0,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里<strong>0表示草稿，1表示未发布，2代表已发布</strong>，为了防止出现其他值出现，我么可以使用枚举来限定其值。</p><p>枚举特点：</p><ul><li>给一组数值起一个更好理解的名字</li><li>一个枚举中只会存在几个固定的值，并不会出现超出范围的可能性</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 用对象模拟枚举</span><span class="token keyword">const</span> PostStatus <span class="token operator">=</span> <span class="token punctuation">{</span>  Draft<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  Unpublished<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  Published<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token comment">// 标准的数字枚举</span><span class="token keyword">enum</span> PostStatus2 <span class="token punctuation">{</span>  Draft <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>  Unpublished <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>  Published <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token comment">// 数字枚举，枚举值自动基于前一个值自增，如果不指定每个枚举类型的值，那么其值会从0自增</span><span class="token keyword">enum</span> PostStatus3 <span class="token punctuation">{</span>  Draft <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>  Unpublished<span class="token punctuation">,</span> <span class="token comment">// =&gt; 7</span>  Published <span class="token comment">// =&gt; 8</span><span class="token punctuation">}</span><span class="token comment">// 字符串枚举，需要手动给每个成员明确一个初始化的值</span><span class="token keyword">enum</span> PostStatus4 <span class="token punctuation">{</span>  Draft <span class="token operator">=</span> <span class="token string">'aaa'</span><span class="token punctuation">,</span>  Unpublished <span class="token operator">=</span> <span class="token string">'bbb'</span><span class="token punctuation">,</span>  Published <span class="token operator">=</span> <span class="token string">'ccc'</span><span class="token punctuation">}</span><span class="token comment">// 常量枚举，不会侵入编译结果</span><span class="token keyword">const</span> <span class="token keyword">enum</span> PostStatus5 <span class="token punctuation">{</span>  Draft<span class="token punctuation">,</span>  Unpublished<span class="token punctuation">,</span>  Published<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后根据上面的枚举值，我们可以将文章状态的写法进行如下转换：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token punctuation">{</span>  title<span class="token operator">:</span> <span class="token string">'Hello TypeScript'</span><span class="token punctuation">,</span>  content<span class="token operator">:</span> <span class="token string">'TypeScript is a typed superset of JavaScript.'</span><span class="token punctuation">,</span>  status<span class="token operator">:</span> PostStatus<span class="token punctuation">.</span>Draft <span class="token comment">// 3 // 1 // 0</span><span class="token punctuation">}</span><span class="token comment">// PostStatus[0] // =&gt; Draft</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用常量进行枚举时，编译ts文件后的js文件中会移出键值对形式的数组，改为在需要枚举的地方直接写入值，其他值则以注释的方式出现，如下为编译后的js文件：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">"use strict"</span><span class="token punctuation">;</span><span class="token comment">// 枚举（Enum）Object.defineProperty(exports, "__esModule", { value: true });var post = {    title: 'Hello TypeScript',    content: 'TypeScript is a typed superset of JavaScript.',    status: 0 /* Draft */ // 3 // 1 // 0};// PostStatus[0] // =&gt; Draft//# sourceMappingURL=07-enum-types.js.map</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="十二、TypeScript函数类型"><a href="#十二、TypeScript函数类型" class="headerlink" title="十二、TypeScript函数类型"></a>十二、TypeScript函数类型</h2><p>函数的类型约束无外乎就是对函数的输入、输出进行类型限制，输入指的就是函数的参数，输出指的是函数的返回值。JavaScript中有两种函数声明方式，分别是函数声明和函数表达式。所以我们需要了解在这两种声明方式下，我们如何进行函数的类型约束。</p><ul><li>函数声明式：</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 函数类型</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 确保跟其它示例没有成员冲突</span><span class="token keyword">function</span> <span class="token function">func1</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">'func1'</span><span class="token punctuation">}</span><span class="token comment">// a类型为数字类型，b类型为数字类型，...rest为参数默认值类型为数字，:string为函数返回值约束，如果没有...rest，则实参和形参个数必须相同</span><span class="token keyword">function</span> <span class="token function">func0</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b？<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">'func1'</span><span class="token punctuation">}</span><span class="token comment">// 在参数声明冒号前加问号？，表示这个参数为可选值，无论可选参数或参数默认值，都只能出现在参数最后面</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>函数表达式：</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">func2</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function-variable function">string</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token string">'func2'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="十三、TypeScript任意类型"><a href="#十三、TypeScript任意类型" class="headerlink" title="十三、TypeScript任意类型"></a>十三、TypeScript任意类型</h2><p>JavaScript本身是弱类型的语言，很多内置的API本身就支持接收任意类型的参数。而TypeScript又是基于JavaScript基础之上的，所以会在代码中用一个变量去接收任意一个类型的值。例：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">stringify</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>any属于动态类型</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> foo<span class="token operator">:</span> any <span class="token operator">=</span> <span class="token string">'string'</span>foo <span class="token operator">=</span> <span class="token number">100</span>foo<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 语法上不会报错，TypeScript不会对any进行类型检查，any 类型是不安全的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="十四、TypeScript隐式类型推断"><a href="#十四、TypeScript隐式类型推断" class="headerlink" title="十四、TypeScript隐式类型推断"></a>十四、TypeScript隐式类型推断</h2><p>在TypeScript中，如果我们没有通过类型注解取标记一个变量的类型，TypeScript会根据变量的使用情况去推断变量的类型。这种特性叫：隐式类型推断</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 隐式类型推断export {} // 确保跟其它示例没有成员冲突let age = 18 // number// age = 'string'  // 语法上会出现错误// 如果TypeScript无法对变量进行类型推断，那TypeScript就会对这个变量的类型注解为anylet foofoo = 100foo = 'string'  // 变量赋值任意类型的值，语法上都不会报错</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>虽然在TypeScript中支持隐式类型推断，这种隐式类型推断可以帮我们简化代码，但我们仍然建议大家对每个变量添加类型注解，这样便于我们后续更加直观的理解代码。</p><h2 id="十五、TypeScript类型断言"><a href="#十五、TypeScript类型断言" class="headerlink" title="十五、TypeScript类型断言"></a>十五、TypeScript类型断言</h2><p>特殊情况下，TypeScript无法推断出变量的具体类型，开发者根据代码的使用情况，总是根据使用情况可以知道变量是什么类型的。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 类型断言export {} // 确保跟其它示例没有成员冲突// 假定这个 nums 来自一个明确的接口const nums = [110, 120, 119, 112]const res = nums.find(i =&gt; i &gt; 0)// const square = res * res，TypeScript此时推断返回值为number或undefined，即无法找到大于0的数字const num1 = res as number  // 开发者告诉TypeScript：你相信我，我断言res为number类型const num2 = &lt;number&gt;res // JSX 下不能使用</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>类型断言的方式有两种：</p><ul><li><p>as关键词（推荐使用）</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> num1 <span class="token operator">=</span> res <span class="token keyword">as</span> number<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>变量前面使用&lt;类型&gt;进行断言</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> num2 <span class="token operator">=</span> <span class="token operator">&lt;</span>number<span class="token operator">&gt;</span>res <span class="token comment">// JSX 下不能使用</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><blockquote><p><strong>！注意：类型断言并不是类型转换</strong></p></blockquote><h2 id="十六、TypeScript接口"><a href="#十六、TypeScript接口" class="headerlink" title="十六、TypeScript接口"></a>十六、TypeScript接口</h2><p>Interfases接口，约定对象的结构，我们使用一个接口，就必须遵循这个接口全部的约定。TypeScript中，接口最直观的体现就是<strong>约定一个对象中应该有哪些成员</strong>，而且，成员的类型是固定的。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">printPost</span> <span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>title<span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时该函数对于接受的参数post有一定的要求，也就是说post一定要有title和content属性，只不过这种要求为隐形的，并没有明确的表达，这时我们可以用接口明确的表达出来，此时我们可以定义一个接口：使用interface关键词。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">interface</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>    title<span class="token operator">:</span> string  <span class="token comment">// 类型限定，可以使用逗号分隔多个成员，更标准的是使用分号，当然也可以省略    content: string}function printPost (post: Post) {    // 显示的要求传入的对象必须要有title和content成员console.log(post.title)console.log(post.content)}printPost({    title: 'Hello TypeScript',    content: 'A javascript superset'})</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>接口中可以使用<strong>逗号</strong>分隔多个成员，更标准的是使用<strong>分号</strong>，当然也可以省略，根据自己团队习惯来</p></blockquote><p>编译完成后的JavaScript文件，发现在js代码中并没有接口，也就是说TypeScript中的接口只是对代码进行类型约束的，在实际运行的阶段，接口并无意义。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">"use strict"</span><span class="token punctuation">;</span><span class="token comment">// 接口Object.defineProperty(exports, "__esModule", { value: true });function printPost(post) {    console.log(post.title);    console.log(post.content);}printPost({    title: 'Hello TypeScript',    content: 'A javascript superset'});//# sourceMappingURL=12-interface-basic.js.map</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>对于接口中约定的成员，还有一些特殊的用法。</p><ul><li><strong>可选成员</strong></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 可选成员、只读成员、动态成员</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 确保跟其它示例没有成员冲突</span><span class="token comment">// -------------------------------------------</span><span class="token keyword">interface</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>  title<span class="token operator">:</span> string  content<span class="token operator">:</span> string  subtitle<span class="token operator">?</span><span class="token operator">:</span> string  <span class="token comment">// 表示为可选成员，其实就是将subtitle类型标注为string|undefined</span>  readonly summary<span class="token operator">:</span> string<span class="token punctuation">}</span><span class="token keyword">const</span> hello<span class="token operator">:</span> Post <span class="token operator">=</span> <span class="token punctuation">{</span>  title<span class="token operator">:</span> <span class="token string">'Hello TypeScript'</span><span class="token punctuation">,</span>  content<span class="token operator">:</span> <span class="token string">'A javascript superset'</span><span class="token punctuation">,</span>  summary<span class="token operator">:</span> <span class="token string">'A javascript'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>只读成员</strong></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 可选成员、只读成员、动态成员</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 确保跟其它示例没有成员冲突</span><span class="token comment">// -------------------------------------------</span><span class="token keyword">interface</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>  title<span class="token operator">:</span> string  content<span class="token operator">:</span> string  readonly summary<span class="token operator">:</span> string  <span class="token comment">// readonly表示此成员只读不能修改，在summary初始化完成后不能修改</span><span class="token punctuation">}</span><span class="token keyword">const</span> hello<span class="token operator">:</span> Post <span class="token operator">=</span> <span class="token punctuation">{</span>  title<span class="token operator">:</span> <span class="token string">'Hello TypeScript'</span><span class="token punctuation">,</span>  content<span class="token operator">:</span> <span class="token string">'A javascript superset'</span><span class="token punctuation">,</span>  summary<span class="token operator">:</span> <span class="token string">'A javascript'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>动态成员</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">interface</span> <span class="token class-name">Cache</span> <span class="token punctuation">{</span>    <span class="token punctuation">[</span>prop<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> string<span class="token punctuation">}</span><span class="token keyword">const</span> cache<span class="token operator">:</span> Cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>cache<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'value1'</span>  <span class="token comment">// cache可以任意添加成员，只不过需要遵循成员必须为string类型</span>cache<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token string">'value2'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="十七、TypeScript类的基本使用"><a href="#十七、TypeScript类的基本使用" class="headerlink" title="十七、TypeScript类的基本使用"></a>十七、TypeScript类的基本使用</h2><p>类<strong>classes</strong>，可以用来描述一类具体事务的抽象特征，例如手机属于一种类型，特征是可以打电话、发短信，在这种类型下，又可以细分某智能手机、某非智能手机（具体事物）。ES6以前，JavaScript都是由函数+原型模拟实现类，ES6开始，JavaScript中有了专门的class，TypeScript中除了使用ES6中类的所有用法，它还额外添加一些用法功能。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 类（Class）</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 确保跟其它示例没有成员冲突</span><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    name<span class="token operator">:</span> string <span class="token comment">// = 'init name'</span>    age<span class="token operator">:</span> number    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token operator">:</span> string<span class="token punctuation">,</span> age<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age    <span class="token punctuation">}</span>    <span class="token function">sayHi</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在类的构造函数中，并不能直接使用this.name,需要在类中直接声明属性才可以使用。</p><h2 id="十八、TypeScript类的访问修饰符"><a href="#十八、TypeScript类的访问修饰符" class="headerlink" title="十八、TypeScript类的访问修饰符"></a>十八、TypeScript类的访问修饰符</h2><p>TypeScript中类的特殊用法，首先是类成员的访问修饰符，接着使用上面定义的person</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 类的访问修饰符</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 确保跟其它示例没有成员冲突</span><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> name<span class="token operator">:</span> string <span class="token comment">// = 'init name'  共有成员，默认的修饰符，加不加都一样，但建议加上</span>    <span class="token keyword">private</span> age<span class="token operator">:</span> number  <span class="token comment">// 私有属性，只能在类内部访问</span>    <span class="token keyword">protected</span> gender<span class="token operator">:</span> boolean  <span class="token comment">// 受保护的属性，</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token operator">:</span> string<span class="token punctuation">,</span> age<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age        <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span>    <span class="token function">sayHi</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token operator">:</span> string<span class="token punctuation">,</span> age<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gender<span class="token punctuation">)</span>  这里可以访问到projected修饰符修饰的属性    <span class="token punctuation">}</span>  构造函数默认的修饰符为<span class="token keyword">public</span>，当它修饰符为<span class="token keyword">private</span>时，外部无法访问，使用静态方法可以访问    <span class="token keyword">static</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token operator">:</span> string<span class="token punctuation">,</span> age<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>  使用静态方法创建对象实例    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> tom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tom<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token comment">// console.log(tom.age)  无法访问age属性，为私有属性</span><span class="token comment">// console.log(tom.gender)  无法访问gender，不能再外部使用，与private的区别是，projected只允许在此类中访问成员</span><span class="token comment">// const jack = Student.create('jack', 18)  使用静态方法创建对象实例</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="十九、TypeScript类的只读属性"><a href="#十九、TypeScript类的只读属性" class="headerlink" title="十九、TypeScript类的只读属性"></a>十九、TypeScript类的只读属性</h2><p>对于类属性的修饰，还可以使用readonly进行修饰,只允许访问，不允许修改。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 类的只读属性export {} // 确保跟其它示例没有成员冲突class Person {    public name: string // = 'init name'    private age: number    // 只读成员    protected readonly gender: boolean  // readonly跟在访问修饰符后面，对于只读属性可以再类型声明的时候直接初始化，也可以在构造函数中初始化，二者选     // 其一    constructor(name: string, age: number) {        this.name = name        this.age = age        this.gender = true    }    sayHi(msg: string): void {        console.log(`I am ${this.name}, ${msg}`)        console.log(this.age)    }}const tom = new Person('tom', 18)console.log(tom.name)// tom.gender = false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="二十、TypeScript类与接口"><a href="#二十、TypeScript类与接口" class="headerlink" title="二十、TypeScript类与接口"></a>二十、TypeScript类与接口</h2><p>相比于类，接口的概念更抽象。使用前面说到的手机的例子，手机是一个类型，这个类型的实例都是可以打电话发短信，但是能够打电话的不仅仅只有手机，座机也可以打电话，但座机并不属于手机这个类目，而是一个单独的类目，因为它不能发短信。这种情况下，这两个类之间有公共的特征，公共的特征我们一般使用接口进行抽象。第一次使用可能会有一些吃力，多从生活的角度思考。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 类与接口</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 确保跟其它示例没有成员冲突</span><span class="token comment">// 一个接口只实现一个方法</span><span class="token keyword">interface</span> <span class="token class-name">Eat</span> <span class="token punctuation">{</span>    <span class="token function">eat</span><span class="token punctuation">(</span>food<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">}</span><span class="token keyword">interface</span> <span class="token class-name">Run</span> <span class="token punctuation">{</span>    <span class="token function">run</span><span class="token punctuation">(</span>distance<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">}</span>    <span class="token comment">// 人类</span><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Eat</span><span class="token punctuation">,</span> Run <span class="token punctuation">{</span>    <span class="token function">eat</span><span class="token punctuation">(</span>food<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">优雅的进餐: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>food<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">distance<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">直立行走: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>distance<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 动物类</span><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token keyword">implements</span> <span class="token class-name">Eat</span><span class="token punctuation">,</span> Run <span class="token punctuation">{</span>    <span class="token function">eat</span><span class="token punctuation">(</span>food<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">呼噜呼噜的吃: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>food<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">distance<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">爬行: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>distance<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="二十一、TypeScript抽象类"><a href="#二十一、TypeScript抽象类" class="headerlink" title="二十一、TypeScript抽象类"></a>二十一、TypeScript抽象类</h2><p>抽象类在某种程度上说与接口有点类似，他也是可以用来约束子类中必须要有某个成员。但是不同的是，抽象类可以办函一些具体的实现。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 抽线类</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 确保跟其它示例没有成员冲突</span><span class="token comment">// abstract抽象类，在被abstract声明后，他只能被继承，不能被new一个实例对象</span>abstract <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>    <span class="token function">eat</span><span class="token punctuation">(</span>food<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">呼噜呼噜的吃: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>food<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    abstract <span class="token function">run</span><span class="token punctuation">(</span>distance<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>  <span class="token comment">// 抽象方法，不需要方法体，当父类中有抽象方法时，子类必须实现这个方法</span><span class="token punctuation">}</span><span class="token comment">// dog继承自animal</span><span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>    <span class="token function">run</span><span class="token punctuation">(</span>distance<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'四脚爬行'</span><span class="token punctuation">,</span> distance<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>d<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token string">'狗粮'</span><span class="token punctuation">)</span>d<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="二十二、TypeScript泛型"><a href="#二十二、TypeScript泛型" class="headerlink" title="二十二、TypeScript泛型"></a>二十二、TypeScript泛型</h2><p>泛型指我们在定义函数、接口或类的时候，没有去指定具体的类型，等到使用的时候再去指定具体类型的特征。以函数为例，泛型就是我们在声明这个函数的时候，不去指定具体的类型，只在函数调用的时候去传递一个类型。作用是极大程度的复用我们的代码。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 泛型</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 确保跟其它示例没有成员冲突</span><span class="token comment">// 创建一个指定长度的数组，数组元素为数字，返回值为数字类型的数组</span><span class="token keyword">function</span> <span class="token function">createNumberArray</span><span class="token punctuation">(</span><span class="token parameter">length<span class="token operator">:</span> number<span class="token punctuation">,</span> value<span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>    <span class="token comment">// ES6中的fill方法，Array创建一个长度为length，元素类型为number的空数组，然后使用fill填充值</span>    <span class="token comment">// Array为泛型类，在调用之前并不知道需要什么类型元素的数组，使用泛型参数进行声明元素类型&lt;number&gt;</span>    <span class="token keyword">const</span> arr <span class="token operator">=</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token keyword">return</span> arr<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">createStringArray</span><span class="token punctuation">(</span><span class="token parameter">length<span class="token operator">:</span> number<span class="token punctuation">,</span> value<span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> arr <span class="token operator">=</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token keyword">return</span> arr<span class="token punctuation">}</span><span class="token keyword">function</span> createArray<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>length<span class="token operator">:</span> number<span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> arr <span class="token operator">=</span> Array<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token keyword">return</span> arr<span class="token punctuation">}</span><span class="token comment">// const res = createNumberArray(3, 100)</span><span class="token comment">// res =&gt; [100, 100, 100]</span><span class="token keyword">const</span> res <span class="token operator">=</span> createArray<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述方法createNumberArray创建了一个数字类型的数组，但是当我们需要创建一个字符串类型的数组是，最笨的办法是再创建一个函数，更改其参数，这样就会造成冗余。更合理的办法就是使用泛型。将string或number变成一个参数createArray<t>,一般泛型参数为<strong>大写T</strong>。在使用的时候，我们在T的位置传递想要的类型，这样就可以同时满足上述两个需求了。</t></p><h2 id="二十三、TypeScript类型声明"><a href="#二十三、TypeScript类型声明" class="headerlink" title="二十三、TypeScript类型声明"></a>二十三、TypeScript类型声明</h2><p>在实际开发过程中，我们会经常使用到一些第三方的npm模块，而这些npm模块并不一定都是使用TypeScript编写的。所以他提供的成员就不会有强类型的体验。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> lodash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 类型声明</span><span class="token comment">// camelCase将字符串转换为驼峰格式</span><span class="token keyword">import</span> <span class="token punctuation">{</span> camelCase <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token keyword">import</span> qs <span class="token keyword">from</span> <span class="token string">'query-string'</span>  <span class="token comment">// </span>qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'?key=value&amp;key2=value2'</span><span class="token punctuation">)</span><span class="token comment">// declare function camelCase (input: string): string  // 如果我们使用的第三方模块没有对应的类型声明模块，我们需要declare手动进行类型声明</span><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">camelCase</span><span class="token punctuation">(</span><span class="token string">'hello typed'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在直接导入时，会报错，无法找到类型声明文件<strong>import { camelCase } from <u>‘lodash’</u></strong></p><p>目前很多第三方模块会提供类型声明的模块，我们安装@types-lodash。并且越来越多的模块在内部会直接支持类型声明。比如上面query-string模块。</p>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ECMAScript 新特性</title>
      <link href="2021/05191486.html"/>
      <url>2021/05191486.html</url>
      
        <content type="html"><![CDATA[<p><img src="http://5coder.cn/img/WA5K6I3aVkFueLb.png"></p><h2 id="一、ECMAScript概述"><a href="#一、ECMAScript概述" class="headerlink" title="一、ECMAScript概述"></a>一、ECMAScript概述</h2><p>ECMAScript，即 ECMA-262 定义的语言，并不局限于 Web 浏览器。事实上，这门语言没有输入和输出之类的方法。ECMA-262 将这门语言作为一个基准来定义，以便在它之上再构建更稳健的脚本语言。</p><p>Web 浏览器只是 ECMAScript 实现可能存在的一种宿主环境（host environment）。宿主环境提供ECMAScript 的基准实现和与环境自身交互必需的扩展。扩展（比如 DOM）使用 ECMAScript 核心类型和语法，提供特定于环境的额外功能。其他宿主环境还有服务器端 JavaScript 平台 Node.js 和即将被淘汰的 Adobe Flash。</p><p>日常使用的Web环境下，JavaScript语言包括：ECMAScript、浏览器提供的BOM对象、DOM树。</p><p>Node.js环境下，JavaScript包括：ECMAScript、Node API（fs、net、etc.）</p><h2 id="二、ES2015概述"><a href="#二、ES2015概述" class="headerlink" title="二、ES2015概述"></a>二、ES2015概述</h2><p>ECMA-262 阐述了什么是 ECMAScript 符合性。要成为 ECMAScript 实现，必须满足下列条件：</p><ul><li><p>支持 ECMA-262 中描述的所有“类型、值、对象、属性、函数，以及程序语法与语义”；</p></li><li><p>支持 Unicode 字符标准。</p></li></ul><p>此外，符合性实现还可以满足下列要求。</p><ul><li><p>增加 ECMA-262 中未提及的“额外的类型、值、对象、属性和函数”。ECMA-262 所说的这些额外内容主要指规范中未给出的新对象或对象的新属性。</p></li><li><p>支持 ECMA-262 中没有定义的“程序和正则表达式语法”（意思是允许修改和扩展内置的正则表达式特性）。</p></li></ul><p>以上条件为实现开发者基于 ECMAScript 开发语言提供了极大的权限和灵活度，也是其广受欢迎的原因之一。</p><h2 id="三、ES2015-let-与块级作用域"><a href="#三、ES2015-let-与块级作用域" class="headerlink" title="三、ES2015 let 与块级作用域"></a>三、ES2015 let 与块级作用域</h2><p>具体详情请阅读《JavaScript高级程序设计·第四版》中的第三章第三节（3.3）</p><h3 id="1-var"><a href="#1-var" class="headerlink" title="1.var"></a>1.var</h3><ul><li>var定义的变量会预解析，简单的说就是如果变量没有定义就直接使用的话，JavaScript回去解析这个变量，代码不会报错，只会输出undefined。</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>  <span class="token comment">// undefined</span><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>var定义的变量可以反复去定义，当然后面的会覆盖前面的</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>var在循环中使用的时候，循环体外依然可以使用</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'内层结束 i = '</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">//0</span><span class="token comment">//1</span><span class="token comment">//2</span><span class="token comment">//内层结束 i = 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在循环绑定事件过程中，var定义的变量无法保存，循环会在瞬间执行完</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>elements<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">onclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-let"><a href="#2-let" class="headerlink" title="2.let"></a>2.let</h3><ul><li>let定义的变量不会预解析，必须先声明再使用，否则会报错</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 报错</span><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token string">'bar'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>let不能定义已经定义过的变量（无论之前是用var定义的还是let或者const定义的）</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment">// 报错</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>let是块级作用域，函数内部使用let定义后，对函数外部无影响，简单说就是在一个{}里面生效</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token comment">// foo</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>由于let是块级作用域，在循环绑定事件过程中let会在这个循环中生效，再次循环时let会重新定义生效</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>elements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">onclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="四、ES2015-const"><a href="#四、ES2015-const" class="headerlink" title="四、ES2015 const"></a>四、ES2015 const</h2><ul><li>const定义的变量不会预解析，必须先声明再使用，否则会报错</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 报错 undefined</span><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><p>const定义的变量不允许修改</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>  <span class="token comment">// err</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>但是，在数组里面，const的值是允许被修改的，这是因为const存储的是地址，值的内容可以变化</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'array'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="五、ES2015-数组的解构"><a href="#五、ES2015-数组的解构" class="headerlink" title="五、ES2015 数组的解构"></a>五、ES2015 数组的解构</h2><p>ECMAScript2015 新增了一种从数组或者对象获取指定元素的快捷方式，这是一种新的语法，这种新语法叫做<strong>解构</strong>。如下代码所示，定义一个数组：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token keyword">const</span> foo <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">const</span> bar <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token keyword">const</span> baz <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">,</span> baz<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 ECMAScript2015 之前想要获取这个数组中的元素，需要通过索引访问对应的值，然后将访问的结果赋值给一个变量。</p><p>而在 ECMAScript2015 之后，可以通过数组的解构这种方式快速获取数组中的指定成员。如下代码所示：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">,</span> baz<span class="token punctuation">]</span> <span class="token operator">=</span> arrconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">,</span> baz<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这里会根据变量的位置进行分配数组中对应位置的成员。如果只要获取某一个位置上的成员，比如上个数组中的最后一个位置的成员，只需要保留前两个占位就可以了。如下代码所示：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> baz<span class="token punctuation">]</span> <span class="token operator">=</span> arrconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>baz<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>除此之外，还可以在变量名前面增加 <code>...</code> 来获取从当前位置到数组最后的所有成员。如下代码所示：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">]</span> <span class="token operator">=</span> arrconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span>  <span class="token comment">// [ 200, 300 ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>这里需要注意的是</strong>，这种解构的用法只能在成员变量的最后一个变量上才能使用。</p></blockquote><p>如果解构的变量数量少于数组的成员数量的话，那会按照从前到后的顺序进行获取。如下代码所示：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token punctuation">[</span>foo<span class="token punctuation">]</span> <span class="token operator">=</span> arrconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>  <span class="token comment">// 100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>从打印的结果可以看到，数组中剩下的成员都不会被获取到。反之，如果解构的变量数量多于数组的成员数量的话，那多出来的变量的值为 <code>undefined</code>。如下代码所示：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">,</span> baz<span class="token punctuation">,</span> more<span class="token punctuation">]</span> <span class="token operator">=</span> arrconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>more<span class="token punctuation">)</span>  <span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>使用 ECMAScript2015 之后的解构将大大进行简化。如下代码所示：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token string">'foo/bar/baz'</span><span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> rootDir<span class="token punctuation">]</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rootDir<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="六、ES2015-对象的解构"><a href="#六、ES2015-对象的解构" class="headerlink" title="六、ES2015 对象的解构"></a>六、ES2015 对象的解构</h2><p>在 ECMAScript2015 中，除了数组可以被解构之外，对象同样也可以被解构。只不过对象的解构，是需要通过属性名来获取，而不是位置。如下代码所示：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'拉勾大前端'</span><span class="token punctuation">,</span>  age<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token punctuation">{</span>  name<span class="token punctuation">}</span> <span class="token operator">=</span> objconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述代码的运行结果如下：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">拉勾大前端<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里解构中的变量名还有一个很重要的作用，就是匹配解构对象中的成员，从而获取指定成员的值。比如上述代码结构总的 <code>name</code> 获取了 <code>obj</code> 对象中的 <code>name</code> 属性值。</p><p>因为对象的解构的这种特性，如果当前作用域中存在一个同名的变量，就会产生冲突。如下代码所示：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'拉勾大前端'</span><span class="token punctuation">,</span>  age<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'拉勾大前端2'</span><span class="token keyword">const</span> <span class="token punctuation">{</span>  name<span class="token punctuation">}</span> <span class="token operator">=</span> objconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述代码的运行结果如下：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">object-destructuring.js:13  name  ^SyntaxError: Identifier 'name' has already been declared    at createScript (vm.js:80:10)    at Object.runInThisContext (vm.js:139:10)    at Module._compile (module.js:599:28)    at Object.Module._extensions..js (module.js:646:10)    at Module.load (module.js:554:32)    at tryModuleLoad (module.js:497:12)    at Function.Module._load (module.js:489:3)    at Function.Module.runMain (module.js:676:10)    at startup (bootstrap_node.js:187:16)    at bootstrap_node.js:608:3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为 <code>obj</code> 对象的 <code>name</code> 属性必须在解构中定义 <code>name</code> 变量进行获取，那么这一冲突就无法避免。这个时候可以通过重命名的方式来解决这样的问题，如下代码所示：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> <span class="token string">'拉勾大前端'</span><span class="token punctuation">,</span>  age<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'拉勾大前端'</span><span class="token keyword">const</span> <span class="token punctuation">{</span>  name<span class="token operator">:</span> objName<span class="token punctuation">}</span> <span class="token operator">=</span> objconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>objName<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="七、ES2015模板字符串"><a href="#七、ES2015模板字符串" class="headerlink" title="七、ES2015模板字符串"></a>七、ES2015模板字符串</h2><h3 id="1-模板字面量"><a href="#1-模板字面量" class="headerlink" title="1.模板字面量"></a>1.模板字面量</h3><p>ECMAScript 6 新增了使用模板字面量定义字符串的能力。与使用单引号或双引号不同，模板字面量保留换行字符，可以跨行定义字符串：</p><blockquote><p>使用键盘区域Esc下方【数字1左边】的反引号</p></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> myMultiLineString <span class="token operator">=</span> <span class="token string">'first line\nsecond line'</span><span class="token punctuation">;</span> <span class="token keyword">let</span> myMultiLineTemplateLiteral <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">first line second line</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myMultiLineString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// first line </span><span class="token comment">// second line" </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myMultiLineTemplateLiteral<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// first line</span><span class="token comment">// second line</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myMultiLineString <span class="token operator">===</span> myMultiLinetemplateLiteral<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以说，当我们需要写HTML模板时，这个方法非常有用：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> pageHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> &lt;div&gt;  &lt;a href="#"&gt;  &lt;span&gt;Jake&lt;/span&gt;  &lt;/a&gt; &lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于模板字面量会保持反引号内部的空格，因此在使用时要格外注意。格式正确的模板字符串看起来可能会缩进不当。</p><h3 id="2-字符串插值"><a href="#2-字符串插值" class="headerlink" title="2.字符串插值"></a>2.字符串插值</h3><blockquote><p>模板字面量最常用的一个特性是支持字符串插值，也就是可以在一个连续定义中插入一个或多个值。技术上讲，<strong>模板字面量不是字符串，而是一种特殊的 JavaScript 句法表达式，只不过求值后得到的是字符串。</strong>模板字面量在定义时立即求值并转换为字符串实例，任何插入的变量也会从它们最接近的作用域中取值。</p></blockquote><p>字符串插值通过在${}中使用一个 JavaScript 表达式实现：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token keyword">let</span> exponent <span class="token operator">=</span> <span class="token string">'second'</span><span class="token punctuation">;</span> <span class="token comment">// 以前，字符串插值是这样实现的：</span><span class="token keyword">let</span> interpolatedString <span class="token operator">=</span> value <span class="token operator">+</span> <span class="token string">' to the '</span> <span class="token operator">+</span> exponent <span class="token operator">+</span> <span class="token string">' power is '</span> <span class="token operator">+</span> <span class="token punctuation">(</span>value <span class="token operator">*</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 现在，可以用模板字面量这样实现：</span><span class="token keyword">let</span> interpolatedTemplateLiteral <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> value <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to the </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> exponent <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> power is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> value <span class="token operator">*</span> value <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>interpolatedString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5 to the second power is 25 </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>interpolatedTemplateLiteral<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5 to the second power is 25</span><span class="token comment">// 所有插入的值都会使用 toString()强制转型为字符串，而且任何 JavaScript 表达式都可以用于插值。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-模板字面量标签函数"><a href="#3-模板字面量标签函数" class="headerlink" title="3.模板字面量标签函数"></a>3.模板字面量标签函数</h3><p>模板字面量也支持定义<strong>标签函数（tag function）</strong>，而通过标签函数可以<strong>自定义插值行为</strong>。标签函数会接收<strong>被插值记号分隔后的模板</strong>和<strong>对每个表达式求值的结果</strong>。</p><p>标签函数本身是一个常规函数，通过前缀到模板字面量来应用自定义行为，如下例所示。标签函数接收到的参数依次是原始字符串数组和对每个表达式求值的结果。这个函数的返回值是对模板字面量求值得到的字符串。</p><p>这样概念解释很不清楚，通过下方的例子来加强理解：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token keyword">function</span> <span class="token function">simpleTag</span><span class="token punctuation">(</span><span class="token parameter">strings<span class="token punctuation">,</span> <span class="token operator">...</span>expressions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>strings<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> expression <span class="token keyword">of</span> expressions<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token string">'foobar'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">let</span> taggedResult <span class="token operator">=</span> simpleTag<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> a <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> b <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> a <span class="token operator">+</span> b <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// ["", " + ", " = ", ""] </span><span class="token comment">// 6 </span><span class="token comment">// 9 </span><span class="token comment">// 15 </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>taggedResult<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "foobar"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="八、ES2015参数默认值"><a href="#八、ES2015参数默认值" class="headerlink" title="八、ES2015参数默认值"></a>八、ES2015参数默认值</h2><p>在 ECMAScript5.1 及以前，实现默认参数的一种常用方式就是检测某个参数是否等于 undefined，如果是则意味着没有传这个参数，那就给它赋一个值：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token operator">?</span> name <span class="token operator">:</span> <span class="token string">'Henry'</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> VIII</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Henry VIII' </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token string">'Louis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Louis VIII'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ECMAScript 6 之后就不用这么麻烦了，因为它支持<strong>显式定义默认参数</strong>了。下面就是与前面代码等价的 ES6 写法，只要在函数定义中的参数后面用=就可以为参数赋一个默认值：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">makeKing</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'Henry'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> VIII</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token string">'Louis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Louis VIII' </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Henry VIII'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>上面给参数传 undefined 相当于没有传值</strong>，不过这样可以利用多个独立的默认值：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">makeKing</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'Henry'</span><span class="token punctuation">,</span> numerals <span class="token operator">=</span> <span class="token string">'VIII'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>numerals<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Henry VIII' </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token string">'Louis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Louis VIII' </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token string">'VI'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Henry VI'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在使用默认参数时，arguments 对象的值不反映参数的默认值，只反映传给函数的参数。当然，跟 ES5 严格模式一样，修改命名参数也不会影响 arguments 对象，它始终以调用函数时传入的值为准：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">makeKing</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'Henry'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      name <span class="token operator">=</span> <span class="token string">'Louis'</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King undefined' </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token string">'Louis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Louis'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>默认参数值并不限于原始值或对象类型，也可以使用调用函数返回的值：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> romanNumerals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'II'</span><span class="token punctuation">,</span> <span class="token string">'III'</span><span class="token punctuation">,</span> <span class="token string">'IV'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">,</span> <span class="token string">'VI'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">let</span> ordinality <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">function</span> <span class="token function">getNumerals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 每次调用后递增</span>     <span class="token keyword">return</span> romanNumerals<span class="token punctuation">[</span>ordinality<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">function</span> <span class="token function">makeKing</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'Henry'</span><span class="token punctuation">,</span> numerals <span class="token operator">=</span> <span class="token function">getNumerals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>numerals<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Henry I'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token string">'Louis'</span><span class="token punctuation">,</span> <span class="token string">'XVI'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Louis XVI' </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Henry II' </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'King Henry III'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>函数的默认参数只有在函数被调用时才会求值，不会在函数定义时求值。而且，计算默认值的函数只有在调用函数但未传相应参数时才会被调用。</p><p>箭头函数同样也可以这样使用默认参数，只不过在只有一个参数时，就必须使用括号而不能省略了：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> makeKing <span class="token operator">=</span> <span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'Henry'</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// King Henry</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="九、ES2015展开数组-Spread"><a href="#九、ES2015展开数组-Spread" class="headerlink" title="九、ES2015展开数组(Spread)"></a>九、ES2015展开数组(Spread)</h2><p>在 ECMAScript5.1 及以前，我们从打印出数组中的元素很麻烦，最笨的办法是：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">// foo bar baz</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是当数组的个数不确定是，就不能使用这个方法，并且这个方法属于硬展，我们可以使用函数的apply方法，第一个参数this指向console对象，第二个参数是要传递的数组对象：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token comment">// foo bar baz</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在ES6中，我们可以更简单的使用数组展开的方法，形式同与收集剩余参数，使用…arr展开数组，这样写起来非常方便：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span><span class="token comment">// foo bar baz</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="十、ES2015箭头函数"><a href="#十、ES2015箭头函数" class="headerlink" title="十、ES2015箭头函数"></a>十、ES2015箭头函数</h2><p>ECMAScript 6 新增了使用胖箭头（=&gt;）语法定义函数表达式的能力。很大程度上，箭头函数实例化的函数对象与正式的函数表达式创建的函数对象行为是相同的。任何可以使用函数表达式的地方，都可以使用箭头函数：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">arrowSum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">let</span> <span class="token function-variable function">functionExpressionSum</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">arrowSum</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 13 </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">functionExpressionSum</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 13</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果只有一个参数，那也可以不用括号。只有没有参数，或者多个参数的情况下，才需要使用括号：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 以下两种写法都有效</span><span class="token keyword">let</span> <span class="token function-variable function">double</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">let</span> <span class="token function-variable function">triple</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">3</span> <span class="token operator">*</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">// 没有参数需要括号</span><span class="token keyword">let</span> <span class="token function-variable function">getRandom</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 多个参数需要括号</span><span class="token keyword">let</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 无效的写法：</span><span class="token keyword">let</span> multiply <span class="token operator">=</span> a<span class="token punctuation">,</span> <span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>箭头函数也可以不用大括号，但这样会改变函数的行为。使用大括号就说明包含“函数体”，可以在一个函数中包含多条语句，跟常规的函数一样。如果不使用大括号，那么箭头后面就只能有一行代码，比如一个赋值操作，或者一个表达式。而且，省略大括号会隐式返回这行代码的值：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 以下两种写法都有效，而且返回相应的值</span><span class="token keyword">let</span> <span class="token function-variable function">double</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">let</span> <span class="token function-variable function">triple</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">3</span> <span class="token operator">*</span> x<span class="token punctuation">;</span> <span class="token comment">// 可以赋值</span><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">let</span> <span class="token function-variable function">setName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Matt"</span><span class="token punctuation">;</span> <span class="token function">setName</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Matt" </span><span class="token comment">// 无效的写法：</span><span class="token keyword">let</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>箭头函数虽然语法简洁，但也有很多场合不适用。箭头函数不能使用 arguments、super 和new.target，也不能用作构造函数。此外，箭头函数也没有 prototype 属性。</p><p>另外，箭头函数中的this指向也与普通函数不同，请参考一篇文章：</p><h2 id="十一、ES2015对象"><a href="#十一、ES2015对象" class="headerlink" title="十一、ES2015对象"></a>十一、ES2015对象</h2><h3 id="1-对象字面量的增强"><a href="#1-对象字面量的增强" class="headerlink" title="1.对象字面量的增强"></a>1.对象字面量的增强</h3><p>ES6中增强了对象的字面量，在之前，我们声明对象只能使用键+冒号+值的方式：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token string">'345'</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    name<span class="token operator">:</span> <span class="token string">'leo'</span><span class="token punctuation">,</span>    age<span class="token operator">:</span> <span class="token string">'26'</span><span class="token punctuation">,</span>    bar<span class="token operator">:</span> bar<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>而在ES6中,当我们的属性名与其值都为变量且相同时，我们可以省略冒号以及后面的值：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token string">'345'</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    name<span class="token operator">:</span> <span class="token string">'leo'</span><span class="token punctuation">,</span>    age<span class="token operator">:</span> <span class="token string">'26'</span><span class="token punctuation">,</span>    bar<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>同样，当我们需要使用动态的属性名时，之前的做法是在对象声明过后，再对对象赋值动态属性名的值：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    name<span class="token operator">:</span> <span class="token string">'leo'</span><span class="token punctuation">,</span>    age<span class="token operator">:</span> <span class="token string">'26'</span><span class="token punctuation">,</span>    bar<span class="token punctuation">}</span>obj<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'random'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在ES6中，我们可以直接使用方括号+表达式对对象添加动态的属性名，这种方式称之为【<strong>计算属性名</strong>】，方括号内部可以为任意表达式，表达式结果作为最终的属性名：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    name<span class="token operator">:</span> <span class="token string">'leo'</span><span class="token punctuation">,</span>    age<span class="token operator">:</span> <span class="token string">'26'</span><span class="token punctuation">,</span>    bar<span class="token punctuation">,</span>    <span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'random'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-Object扩展方法"><a href="#2-Object扩展方法" class="headerlink" title="2.Object扩展方法"></a>2.Object扩展方法</h3><ul><li>Object.assign</li></ul><p>此方法可以将多个源对象中的属性复制到一个目标对象中，如果对象之间有相同的属性名，那么源对象中的属性就会覆盖掉目标对象中的属性。源对象与目标对象都是普通的对象，只不过用处不同</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> source1 <span class="token operator">=</span> <span class="token punctuation">{</span>      a<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>      b<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">}</span><span class="token keyword">const</span> source2 <span class="token operator">=</span> <span class="token punctuation">{</span>      b<span class="token operator">:</span> <span class="token number">789</span><span class="token punctuation">,</span>      d<span class="token operator">:</span> <span class="token number">789</span><span class="token punctuation">}</span><span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>      a<span class="token operator">:</span> <span class="token number">456</span><span class="token punctuation">,</span>      c<span class="token operator">:</span> <span class="token number">456</span><span class="token punctuation">}</span><span class="token keyword">const</span> result <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> source1<span class="token punctuation">,</span> source2<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result <span class="token operator">===</span> target<span class="token punctuation">)</span><span class="token comment">// { a: 123, c: 456, b: 789, d: 789 }// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>应用场景：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">func</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// obj.name = 'func obj'      // console.log(obj)      const funcObj = Object.assign({}, obj)      funcObj.name = 'func obj'      console.log(funcObj)}const obj = { name: 'global obj' }func(obj)console.log(obj)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>assign方法多用于options对象参数设置默认值。</p><ul><li>Object.is</li></ul><p>用来判断两个值是否相等，在之前我们使用==和===分别判断值是否相等以及是否全等（值与类型都相等），在==中，js默认使用toString方法来进行隐式转换，而在ES6中，提供了全新的方法Object.is方法进行判断：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>  <span class="token comment">// 0 == false              // =&gt; true  // 0 === false             // =&gt; false  // +0 === -0               // =&gt; true  // NaN === NaN             // =&gt; false  // Object.is(+0, -0)       // =&gt; false  // Object.is(NaN, NaN)     // =&gt; true)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在实际使用中，仍然建议使用===来判断。</p><h2 id="十二、ES2015-Proxy"><a href="#十二、ES2015-Proxy" class="headerlink" title="十二、ES2015 Proxy"></a>十二、ES2015 Proxy</h2><blockquote><p>在 ES6 之前，ECMAScript 中并没有类似代理的特性。由于代理是一种新的基础性语言能力，很多转译程序都不能把代理行为转换为之前的 ECMAScript 代码，因为代理的行为实际上是无可替代的。为此，代理和反射只在百分之百支持它们的平台上有用。可以检测代理是否存在，不存在则提供后备代码。不过这会导致代码冗余，因此并不推荐。</p></blockquote><h3 id="1-空代理"><a href="#1-空代理" class="headerlink" title="1.空代理"></a>1.空代理</h3><p>最简单的代理是空代理，即除了作为一个抽象的目标对象，什么也不做。默认情况下，在代理对象上执行的所有操作都会无障碍地传播到目标对象。因此，在任何可以使用目标对象的地方，都可以通过同样的方式来使用与之关联的代理对象。</p><p>如下面的代码所示，在代理对象上执行的任何操作实际上都会应用到目标对象。唯一可感知的不同就是代码中操作的是代理对象。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>  id<span class="token operator">:</span> <span class="token string">'target'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// id 属性会访问同一个值</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// target </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// target </span><span class="token comment">// 给目标属性赋值会反映在两个对象上</span><span class="token comment">// 因为两个对象访问的是同一个值</span>target<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo </span><span class="token comment">// 给代理属性赋值会反映在两个对象上</span><span class="token comment">// 因为这个赋值会转移到目标对象</span>proxy<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bar </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bar </span><span class="token comment">// hasOwnProperty()方法在两个地方</span><span class="token comment">// 都会应用到目标对象</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span><span class="token comment">// Proxy.prototype 是 undefined </span><span class="token comment">// 因此不能使用 instanceof 操作符</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target <span class="token keyword">instanceof</span> <span class="token class-name">Proxy</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: Function has non-object prototype </span><span class="token string">'undefined'</span> <span class="token keyword">in</span> <span class="token keyword">instanceof</span> <span class="token class-name">check</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy <span class="token keyword">instanceof</span> <span class="token class-name">Proxy</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: Function has non-object prototype </span><span class="token string">'undefined'</span> <span class="token keyword">in</span> <span class="token keyword">instanceof</span> <span class="token class-name">check</span> <span class="token comment">// 严格相等可以用来区分代理和目标</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target <span class="token operator">===</span> proxy<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-定义捕获器："><a href="#2-定义捕获器：" class="headerlink" title="2.定义捕获器："></a>2.定义捕获器：</h3><p>使用代理的主要目的是可以定义捕获器（trap）。捕获器就是在处理程序对象中定义的“基本操作的拦截器”。每个处理程序对象可以包含零个或多个捕获器，每个捕获器都对应一种基本操作，可以直接或间接在代理对象上调用。每次在代理对象上调用这些基本操作时，代理可以在这些操作传播到目标对象之前先调用捕获器函数，从而拦截并修改相应的行为。</p><p>例如，可以定义一个 get()捕获器，在 ECMAScript 操作以某种形式调用 get()时触发。下面的例子定义了一个 get()捕获器：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>  foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token comment">// 捕获器在处理程序对象中以方法名为键</span>     <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token string">'handler override'</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bar </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// handler override </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bar </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// handler override </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bar </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// handler override</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>捕获器可以定义get、delete、set等方法。</p><h2 id="十三、ES2015-class类"><a href="#十三、ES2015-class类" class="headerlink" title="十三、ES2015 class类"></a>十三、ES2015 class类</h2><p>ECMAScript 6 新引入的 class 关键字具有正式定义类的能力。类（class）是ECMAScript 中新的基础性语法糖结构，因此刚开始接触时可能会不太习惯。虽然 ECMAScript 6 类表面上看起来可以支持正式的面向对象编程，但实际上它背后使用的仍然是原型和构造函数的概念。</p><h3 id="1-类的定义"><a href="#1-类的定义" class="headerlink" title="1.类的定义"></a>1.类的定义</h3><p>与函数类型相似，定义类也有两种主要方式：类声明和类表达式。这两种方式都使用 class 关键字加大括号：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 类声明class Person {} // 类表达式const Animal = class {};</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>类可以包含构造函数方法、实例方法、获取函数、设置函数和静态类方法，但这些都不是必需的。空的类定义照样有效。默认情况下，类定义中的代码都在严格模式下执行。</p><p>与函数构造函数一样，多数编程风格都建议类名的首字母要大写，以区别于通过它创建的实例（比如，通过 class Foo {}创建实例 foo）：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 空类定义，有效 class Foo {} // 有构造函数的类，有效class Bar {  constructor() {} } // 有获取函数的类，有效class Baz {  get myBaz() {} } // 有静态方法的类，有效class Qux {  static myQux() {} }</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-类构造函数"><a href="#2-类构造函数" class="headerlink" title="2.类构造函数"></a>2.类构造函数</h3><p><strong>constructor</strong> 关键字用于在类定义块内部创建类的构造函数。方法名 constructor 会告诉解释器在使用 new 操作符创建类的新实例时，应该调用这个函数。构造函数的定义不是必需的，不定义构造函数相当于将构造函数定义为空函数。</p><p>使用 new 操作符实例化 Person 的操作等于使用 new 调用其构造函数。唯一可感知的不同之处就是，JavaScript 解释器知道使用 new 和类意味着应该使用 constructor 函数进行实例化。</p><p>使用 new 调用类的构造函数会执行如下操作。</p><ul><li><p>在内存中创建一个新对象。</p></li><li><p>这个新对象内部的[[Prototype]]指针被赋值为构造函数的 prototype 属性。</p></li><li><p>构造函数内部的 this 被赋值为这个新对象（即 this 指向新对象）。</p></li><li><p>执行构造函数内部的代码（给新对象添加属性）。</p></li><li><p>如果构造函数返回非空对象，则返回该对象；否则，返回刚创建的新对象。</p></li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'person ctor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token keyword">class</span> <span class="token class-name">Vegetable</span> <span class="token punctuation">{</span>      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'orange'</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// person ctor let v = new Vegetable(); console.log(v.color); // orange</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-实例、原型、类成员"><a href="#3-实例、原型、类成员" class="headerlink" title="3.实例、原型、类成员"></a>3.实例、原型、类成员</h3><p>类的语法可以非常方便地定义应该存在于实例上的成员、应该存在于原型上的成员，以及应该存在于类本身的成员。</p><p>每次通过new调用类标识符时，都会执行类构造函数。在这个函数内部，可以为新创建的实例（this）添加“自有”属性。至于添加什么样的属性，则没有限制。另外，在构造函数执行完毕后，仍然可以给实例继续添加新成员。</p><p>每个实例都对应一个唯一的成员对象，这意味着所有成员都不会在原型上共享：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">// 这个例子先使用对象包装类型定义一个字符串         // 为的是在下面测试两个对象的相等性         this.name = new String('Jack');          this.sayName = () =&gt; console.log(this.name);          this.nicknames = ['Jake', 'J-Dog']      } } let p1 = new Person(),  p2 = new Person(); p1.sayName(); // Jack p2.sayName(); // Jack console.log(p1.name === p2.name); // false console.log(p1.sayName === p2.sayName); // false console.log(p1.nicknames === p2.nicknames); // false p1.name = p1.nicknames[0]; p2.name = p2.nicknames[1]; p1.sayName(); // Jake p2.sayName(); // J-Dog</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>静态类成员在类定义中使用 static 关键字作为前缀。在静态成员中，this 引用类自身。其他所有约定跟原型成员一样：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">// 添加到 this 的所有内容都会存在于不同的实例上</span>         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">locate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'instance'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token comment">// 定义在类的原型对象上</span>     <span class="token function">locate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'prototype'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>  <span class="token comment">// 定义在类本身上</span>     <span class="token keyword">static</span> <span class="token function">locate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> p<span class="token punctuation">.</span><span class="token function">locate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// instance, Person {} </span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">locate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prototype, {constructor: ... } </span>Person<span class="token punctuation">.</span><span class="token function">locate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// class, class Person {}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-继承"><a href="#4-继承" class="headerlink" title="4.继承"></a>4.继承</h3><p>ES6 类支持单继承。使用 extends 关键字，就可以继承任何拥有[[Construct]]和原型的对象。很大程度上，这意味着不仅可以继承一个类，也可以继承普通的构造函数（保持向后兼容）：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 继承类</span><span class="token keyword">class</span> <span class="token class-name">Bus</span> <span class="token keyword">extends</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token keyword">instanceof</span> <span class="token class-name">Bus</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token keyword">instanceof</span> <span class="token class-name">Vehicle</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 继承普通构造函数</span><span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Engineer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">Engineer</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">Person</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="十四、ES2015-Set数据结构"><a href="#十四、ES2015-Set数据结构" class="headerlink" title="十四、ES2015 Set数据结构"></a>十四、ES2015 Set数据结构</h2><p>ECMAScript 6 新增的 Set 是一种新集合类型，为这门语言带来集合数据结构。Set 在很多方面都像是加强的 Map，这是因为它们的大多数 API 和行为都是共有的。</p><p>使用 new 关键字和 Set 构造函数可以创建一个空集合：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 使用数组初始化集合 const s1 = new Set(["val1", "val2", "val3"]); alert(s1.size); // 3 // 使用自定义迭代器初始化集合const s2 = new Set({      [Symbol.iterator]: function*() {          yield "val1";          yield "val2";          yield "val3";      } }); alert(s2.size); // 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>初始化之后，可以使用 add()增加值，使用 has()查询，通过 size 取得元素数量，以及使用 delete()和 clear()删除元素：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"Matt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span><span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 </span>s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Matt"</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Frisbie"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// add函数返回的依然是set对象，所以可以使用链式调用</span><span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"Matt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span><span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 </span>s<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"Matt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"Matt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span><span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"Frisbie"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span><span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 </span>s<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 销毁集合实例中的所有值</span><span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"Matt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span><span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"Frisbie"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span><span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="十五、ES2015-Map数据结构"><a href="#十五、ES2015-Map数据结构" class="headerlink" title="十五、ES2015 Map数据结构"></a>十五、ES2015 Map数据结构</h2><p>作为 ECMAScript 6 的新增特性，Map 是一种新的集合类型，为这门语言带来了真正的键/值存储机制。Map 的大多数特性都可以通过 Object 类型实现，但二者之间还是存在一些细微的差异。具体实践中使用哪一个，还是值得细细甄别。</p><p>使用 new 关键字和 Map 构造函数可以创建一个空映射：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果想在创建的同时初始化实例，可以给 Map 构造函数传入一个可迭代对象，需要包含键/值对数组。可迭代对象中的每个键/值对都会按照迭代顺序插入到新映射实例中：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 使用嵌套数组初始化映射</span><span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>      <span class="token punctuation">[</span><span class="token string">"key1"</span><span class="token punctuation">,</span> <span class="token string">"val1"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">[</span><span class="token string">"key2"</span><span class="token punctuation">,</span> <span class="token string">"val2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">[</span><span class="token string">"key3"</span><span class="token punctuation">,</span> <span class="token string">"val3"</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">alert</span><span class="token punctuation">(</span>m1<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3 </span><span class="token comment">// 映射期待的键/值对，无论是否提供</span><span class="token keyword">const</span> m3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">alert</span><span class="token punctuation">(</span>m3<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span><span class="token function">alert</span><span class="token punctuation">(</span>m3<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> tom <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'tom'</span> <span class="token punctuation">}</span>m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>tom<span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>tom<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 输出</span><span class="token comment">// Map { { name: 'tom' } =&gt; 90 }</span><span class="token comment">// 90</span><span class="token comment">// 90 { name: 'tom' }</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同样，map也有has()、delete()、clear()方法。</p><h2 id="十六、Symbol符号"><a href="#十六、Symbol符号" class="headerlink" title="十六、Symbol符号"></a>十六、Symbol符号</h2><p>在ES6之前，对象的属性名都是用字符串表示，而这样会导致，对象的属性名重复造成冲突，例如属性值覆盖等问题。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// shared.js ====================================</span><span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// a.js =========================================</span>cache<span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// b.js =========================================</span>cache<span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'123'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cache<span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>之前的解决方式基本为约定，例如a.js文件中的键名都为a_foo,b.js文件中的键名为b_foo，这样就不会造成属性名重复冲突的问题。而约定只是为了规避这个问题，并没有实际解决这个问题。</p><p>ES6中为了解决这个问题，提出了一个新的数据类型<strong>（Symbol）符号</strong>。符号是原始值，且符号实例是唯一、不可变的。符号的用途是确保对象属性使用唯一标识符，不会发生属性冲突的危险。</p><h3 id="1-基本使用–Symbol"><a href="#1-基本使用–Symbol" class="headerlink" title="1.基本使用–Symbol()"></a>1.基本使用–Symbol()</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> s<span class="token punctuation">)</span><span class="token comment">// 两个 Symbol 永远不会相等</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>  <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用 Symbol()函数时，也可以传入一个字符串参数作为对符号的描述（description），将来可以通过这个字符串来调试代码。但是，这个字符串参数与符号定义或标识完全无关：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> genericSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">let</span> otherGenericSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">let</span> fooSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">let</span> otherFooSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>genericSymbol <span class="token operator">==</span> otherGenericSymbol<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fooSymbol <span class="token operator">==</span> otherFooSymbol<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>符号没有字面量语法</strong>，这也是它们发挥作用的关键。按照规范，你只要创建 Symbol()实例并将其用作对象的新属性，就可以保证它不会覆盖已有的对象属性，无论是符号属性还是字符串属性。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> genericSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>genericSymbol<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Symbol() </span><span class="token keyword">let</span> fooSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fooSymbol<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Symbol(foo);</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>最重要的是，Symbol()函数不能与 new 关键字一起作为构造函数使用。这样做是为了避免创建符号包装对象，像使用 Boolean、String 或 Number 那样，它们都支持构造函数且可用于初始化包含原始值的包装对象：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> myBoolean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> myBoolean<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "object" </span><span class="token keyword">let</span> myString <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> myString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "object" </span><span class="token keyword">let</span> myNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> myNumber<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "object" </span><span class="token keyword">let</span> mySymbol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: Symbol is not a constructor</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-使用全局符号注册表–Symbol-for"><a href="#2-使用全局符号注册表–Symbol-for" class="headerlink" title="2.使用全局符号注册表–Symbol.for()"></a>2.使用全局符号注册表–Symbol.for()</h3><p>如果运行时的不同部分需要共享和重用符号实例，那么可以用一个字符串作为键，在全局符号注册表中创建并重用符号。也就是说可以使用一个字符串参数作为Symbol的描述符，这样在使用过程中可以重用这一定义的symbol。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> fooGlobalSymbol <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建新符号</span><span class="token keyword">let</span> otherFooGlobalSymbol <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重用已有符号</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fooGlobalSymbol <span class="token operator">===</span> otherFooGlobalSymbol<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Symbol.for()对每个字符串键都执行幂等操作。第一次使用某个字符串调用时，它会检查全局运行时**注册表(也可以理解为一个映射关系表)**，发现不存在对应的符号，于是就会生成一个新符号实例并添加到注册表中。后续使用相同字符串的调用同样会检查注册表，发现存在与该字符串对应的符号，然后就会返回该符号实例。</p><p>即使采用相同的符号描述，在全局注册表中定义的符号跟使用 Symbol()定义的符号也并不等同：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> localSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">let</span> globalSymbol <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localSymbol <span class="token operator">===</span> globalSymbol<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>全局注册表中的符号必须使用<strong>字符串</strong>来创建，因此传递给Symbol的任何参数都会被转换为字符串：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> boolSymbol <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> stringSymbol <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>boolSymbol <span class="token operator">===</span> stringSymbol<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>还可以使用**Symbol.keyFor()**来查询全局注册表，这个方法接收符号，返回该全局符号对应的字符串键。如果查询的不是全局符号，则返回 undefined。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 创建全局符号</span><span class="token keyword">let</span> s <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo </span><span class="token comment">// 创建普通符号</span><span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined </span><span class="token comment">// 如果传给 Symbol.keyFor()的不是符号，则该方法抛出 TypeError：</span>Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: 123 is not a symbol</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-使用符号作为属性"><a href="#3-使用符号作为属性" class="headerlink" title="3.使用符号作为属性"></a>3.使用符号作为属性</h3><p><strong>凡是可以使用字符串或数值作为属性的地方，都可以使用符号。</strong>这就包括了对象字面量属性和**Object.defineProperty()/Object.defineProperties()**定义的属性。对象字面量只能在计算属性语法中使用符号作为属性。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     s2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     s3 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     s4 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'qux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token punctuation">[</span>s1<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'foo val'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 这样也可以：o[s1] = 'foo val'; </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {Symbol(foo): foo val} </span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token string">'bar val'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {Symbol(foo): foo val, Symbol(bar): bar val} </span>Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token punctuation">{</span>     <span class="token punctuation">[</span>s3<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token string">'baz val'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span>s4<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token string">'qux val'</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {Symbol(foo): foo val, Symbol(bar): bar val, </span><span class="token comment">// Symbol(baz): baz val, Symbol(qux): qux val}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>类似于 <strong>Object.getOwnPropertyNames()返回对象实例的常规属性数组</strong>，<strong>Object.getOwnPropertySymbols()返回对象实例的符号属性数组</strong>。这两个方法的返回值彼此互斥。<strong>Object.getOwnPropertyDescriptors()会返回同时包含常规和符号属性描述符的对象。Reflect.ownKeys()会返回两种类型的键</strong>：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>     <span class="token punctuation">[</span>s1<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'foo val'</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span>s2<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'bar val'</span><span class="token punctuation">,</span>     baz<span class="token operator">:</span> <span class="token string">'baz val'</span><span class="token punctuation">,</span>     qux<span class="token operator">:</span> <span class="token string">'qux val'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertySymbols</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Symbol(foo), Symbol(bar)] 返回对象实例的符号属性数组</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["baz", "qux"] 返回对象实例的常规属性数组</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {baz: {...}, qux: {...}, Symbol(foo): {...}, Symbol(bar): {...}} 返回同时包含常规和符号属性描述符的对象</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["baz", "qux", Symbol(foo), Symbol(bar)]返回两种类型的键**</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为符号属性是对内存中符号的一个引用，所以直接创建并用作属性的符号不会丢失。但是，如果没有显式地保存对这些属性的引用，那么必须遍历对象的所有符号属性才能找到相应的属性键：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>     <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'foo val'</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'bar val'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {Symbol(foo): "foo val", Symbol(bar): "bar val"} let barSymbol = Object.getOwnPropertySymbols(o)  .find((symbol) =&gt; symbol.toString().match(/bar/)); console.log(barSymbol); // Symbol(bar)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-常用内置符号"><a href="#4-常用内置符号" class="headerlink" title="4.常用内置符号"></a>4.常用内置符号</h3><p>ECMAScript 6 也引入了一批常用内置符号（well-known symbol），用于暴露语言内部行为，开发者可以直接访问、重写或模拟这些行为。这些内置符号都以 Symbol 工厂函数字符串属性的形式存在。这些内置符号最重要的用途之一是重新定义它们，从而改变原生结构的行为。比如，<strong>我们知道for-of 循环会在相关对象上使用 Symbol.iterator 属性，那么就可以通过在自定义对象上重新定义Symbol.iterator 的值，来改变 for-of 在迭代该对象时的行为。</strong></p><blockquote><p><strong>for of中的Symbol.iterator我们会在下面的一节讲到</strong></p></blockquote><p>这些内置符号也没有什么特别之处，它们就是全局函数 Symbol 的普通字符串属性，指向一个符号的实例。所有内置符号属性都是不可写、不可枚举、不可配置的。</p><blockquote><p>注意 在提到 ECMAScript 规范时，经常会引用符号在规范中的名称，前缀为@@。比如，@@iterator 指的就是 Symbol.iterator。</p></blockquote><h3 id="5-Symbol方法"><a href="#5-Symbol方法" class="headerlink" title="5.Symbol方法"></a>5.Symbol方法</h3><p>Symbol提供了一些方法，方法如下所示，具体使用技巧可查看<strong>MDN</strong>或《<strong>JavaScript高级程序设计第四版</strong>》</p><ul><li> <strong>Symbol.asyncIterator</strong><!--一个方法，该方法返回对象默认的 AsyncIterator。 由 for-await-of 语句使用--></li><li> <strong>Symbol.hasInstance</strong><!--一个方法，该方法决定一个构造器对象是否认可一个对象是它的实例。由 instanceof 操作符使用--></li><li> <strong>Symbol.isConcatSpreadable</strong><!--一个布尔值，如果是 true，则意味着对象应该用 Array.prototype.concat()打平其数组元素--></li><li> <strong>Symbol.iterator</strong><!--一个方法，该方法返回对象默认的迭代器。由 for-of 语句使用--></li><li> <strong>Symbol.match</strong><!--一个正则表达式方法，该方法用正则表达式去匹配字符串。由 String.prototype.match()方法使用--></li><li> <strong>Symbol.replace</strong><!--一个正则表达式方法，该方法替换一个字符串中匹配的子串。由 String.prototype.replace()方法使用--></li><li> <strong>Symbol.search</strong><!--一个正则表达式方法，该方法返回字符串中匹配正则表达式的索引。由 String.prototype.search()方法使用--></li><li> <strong>Symbol.species</strong><!--一个函数值，该函数作为创建派生对象的构造函数--></li><li> <strong>Symbol.split</strong><!--一个正则表达式方法，该方法在匹配正则表达式的索引位置拆分字符串。由 String.prototype.split()方法使用--></li><li> <strong>Symbol.toPrimitive</strong><!--一个方法，该方法将对象转换为相应的原始值。由 ToPrimitive 抽象操作使用--></li><li> <strong>Symbol.toStringTag</strong><!--一个字符串，该字符串用于创建对象的默认字符串描述。由内置方法 Object.prototype.toString()使用--></li><li> <strong>Symbol.unscopables</strong><!--一个对象，该对象所有的以及继承的属性，都会从关联对象的 with 环境绑定中排除--></li></ul><h2 id="十七、for…of循环"><a href="#十七、for…of循环" class="headerlink" title="十七、for…of循环"></a>十七、for…of循环</h2><p>在ECMAScript中，遍历数据有很多的方法。例如，for循环通常用来遍历数组，for…in循环通常用来遍历键值对，函数式的遍历方法如：forEach方法。这些方法都会有一定的局限性。所有ES2015引入了一种全新的遍历方式，for…of，其作为以后遍历所有数据结构的统一方式。</p><p>for-of 语句是一种严格的迭代语句，用于遍历可迭代对象的元素，语法如下:</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span>property <span class="token keyword">of</span> expression<span class="token punctuation">)</span> statement<span class="token comment">// 示例for (const el of [2,4,6,8]) { document.write(el); }</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在这个例子中，我们使用 for-of 语句显示了一个包含 4 个元素的数组中的所有元素。循环会一直持续到将所有元素都迭代完。与 for 循环一样，这里控制语句中的 const 是非必需的。但为了确保这个局部变量不被修改，推荐使用 const。</p><p>for-of 循环会按照可迭代对象的 next()方法产生值的顺序迭代元素。关于可迭代对象，将在下面进行详细介绍。</p><p>如果尝试迭代的变量不支持迭代，则 for-of 语句会抛出错误。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">]</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// for...of 循环可以替代 数组对象的 forEach 方法</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其可替代forEach方法进行遍历，而且优点是可以随时使用break方法终止循环：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">break</span>  <span class="token punctuation">}</span><span class="token comment">// forEach 无法跳出循环，必须使用 some 或者 every 方法</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>除了数组可以使用for…of遍历，一些伪数组同样也可以进行循环遍历，例如：函数中arguments对象、DOM中元素节点列表，他们与普通数组对象没有任何区别，这里就不单独演示了。</p><p>Set和Map对象：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 遍历 Set 与遍历数组相同</span><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// foo</span><span class="token comment">// bar</span><span class="token comment">// 遍历 Map 可以配合数组结构语法，直接获取键值</span><span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">)</span>m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'345'</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 使用数组展开方法</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// foo 123</span><span class="token comment">// bar 345</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>普通对象不能被for…of遍历，至于原因，请看下面的可迭代接口，其中包含了一下Symbol.iterator：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 普通对象不能被直接 for...of 遍历</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token number">456</span> <span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="十八、可迭代接口"><a href="#十八、可迭代接口" class="headerlink" title="十八、可迭代接口"></a>十八、可迭代接口</h2><p>ES中能够表示有结构的数据类型越来越多，从最早的数组和对象，到现在新增了set和map，并且还可以组合使用这些类型。为了提供一种统一的遍历方式，ES2015提供了一种统一的Iterable接口。例如ES中任意一种数据类型都有toString方法，这就是他们都实现了统一的规格标准（统一的接口）</p><p>实现Iterable接口就是for…of的前提，只要数据结构实现了可迭代接口，他就能被for…of遍历，也就是说之前的所有数据类型都实现了可迭代接口。</p><h3 id="1-Iterator"><a href="#1-Iterator" class="headerlink" title="1.Iterator"></a>1.Iterator</h3><p>在chrome浏览器的控制台进行测试：</p><blockquote><p>Chrome-console控制台</p></blockquote><p><img src="http://5coder.cn/img/1661133699_d2688d1e1f8dce39260f8248906ed768.png"></p><p><img src="http://5coder.cn/img/1661133738_b5a54153dc752f470515a5a85c6865be.png"></p><p><img src="http://5coder.cn/img/1661133761_22bf5332c64d90ac1dd9da489c6d2f70.png"></p><p>继续看看Symbol.iterator到底实现了什么：</p><blockquote><p>Chrome-console控制台</p></blockquote><p><img src="http://5coder.cn/img/1661133856_5577cfaa941e8c49807288e48c359d19.png"></p><p>value中的就是数组中的第一个元素，done为false，当再次调用时，结果为相同的结构，此时的done为false。done属性的作用就是表示数组内部的属性是否全部遍历完成。</p><p><img src="http://5coder.cn/img/1661134414_3a2dfd7a898ec2f141cc78fcc0e44b5e.png"></p><h3 id="2-实现iterator接口"><a href="#2-实现iterator接口" class="headerlink" title="2.实现iterator接口"></a>2.实现iterator接口</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span>          value<span class="token operator">:</span> <span class="token string">'zce'</span><span class="token punctuation">,</span>          done<span class="token operator">:</span> <span class="token boolean">true</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>  store<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">{</span>          value<span class="token operator">:</span> self<span class="token punctuation">.</span>store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>          done<span class="token operator">:</span> index <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>store<span class="token punctuation">.</span>length        <span class="token punctuation">}</span>        index<span class="token operator">++</span>        <span class="token keyword">return</span> result      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-迭代器模式"><a href="#3-迭代器模式" class="headerlink" title="3.迭代器模式"></a>3.迭代器模式</h3><p>迭代器模式（特别是在 ECMAScript 这个语境下）描述了一个方案，即可以把有些结构称为“可迭代对象”（iterable），因为它们实现了正式的 Iterable 接口，而且可以通过迭代器 Iterator 消费。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 迭代器设计模式// 场景：你我协同开发一个任务清单应用//</span><span class="token comment">// 我的代码 ===============================</span><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token punctuation">{</span>  life<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'吃饭'</span><span class="token punctuation">,</span> <span class="token string">'睡觉'</span><span class="token punctuation">,</span> <span class="token string">'打豆豆'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  learn<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'语文'</span><span class="token punctuation">,</span> <span class="token string">'数学'</span><span class="token punctuation">,</span> <span class="token string">'外语'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  work<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'喝茶'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 提供统一遍历访问接口</span>  <span class="token function-variable function">each</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>life<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>learn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> all<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 提供迭代器（ES2015 统一遍历访问接口）</span>  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>life<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>learn<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">]</span>    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span>          value<span class="token operator">:</span> all<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>          done<span class="token operator">:</span> index<span class="token operator">++</span> <span class="token operator">&gt;=</span> all<span class="token punctuation">.</span>length        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 你的代码 ===============================// 实现统一遍历接口之前//</span><span class="token comment">// for (const todoLife of todos.life) {</span><span class="token comment">//   console.log(todoLife)</span><span class="token comment">// }</span><span class="token comment">// for (const todoLearn of todos.learn) {</span><span class="token comment">//   console.log(todoLearn)</span><span class="token comment">// }</span><span class="token comment">// for (const todoWork of todos.work) {</span><span class="token comment">//   console.log(todoWork)</span><span class="token comment">// }</span><span class="token comment">// todos.each(function (item) {</span><span class="token comment">//   console.log(item)</span><span class="token comment">// })</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> todo <span class="token keyword">of</span> todos<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// for (const todo of todos.life) {</span><span class="token comment">//   console.log(todo)</span><span class="token comment">// }</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="十九、生成器及生成器的应用"><a href="#十九、生成器及生成器的应用" class="headerlink" title="十九、生成器及生成器的应用"></a>十九、生成器及生成器的应用</h2><p>生成器是 ECMAScript 6 新增的一个极为灵活的结构，拥有在一个函数块内暂停和恢复代码执行的能力。这种新能力具有深远的影响，比如，使用生成器可以自定义迭代器和实现协程。其可以避免异步编程中回调嵌套过深的问题，提供更好的额异步编程解决方案。</p><h3 id="1-基本用法"><a href="#1-基本用法" class="headerlink" title="1.基本用法"></a>1.基本用法</h3><p>生成器的形式是一个函数，函数名称前面加一个星号（*）表示它是一个生成器。只要是可以定义函数的地方，就可以定义生成器。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 生成器函数声明</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generatorFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// 生成器函数表达式</span><span class="token keyword">let</span> <span class="token function-variable function">generatorFn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// 作为对象字面量方法的生成器函数</span><span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token operator">*</span> <span class="token function">generatorFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 作为类实例方法的生成器函数</span><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>    <span class="token operator">*</span> <span class="token function">generatorFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 作为类静态方法的生成器函数</span><span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span><span class="token operator">*</span> <span class="token function">generatorFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用生成器函数会产生一个生成器对象。生成器对象一开始处于暂停执行（suspended）的状态。与迭代器相似，生成器对象也实现了 Iterator 接口，因此具有 next()方法。调用这个方法会让生成器开始或恢复执行。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'zce'</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment">// Object [Generator] {}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// { value: 100, done: false }</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>yield 关键字可以让生成器停止和开始执行，也是生成器最有用的地方。生成器函数在遇到 yield关键字之前会正常执行。遇到这个关键字后，执行会停止，函数作用域的状态会被保留。停止执行的生成器函数只能通过在生成器对象上调用 next()方法来恢复执行：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1111'</span><span class="token punctuation">)</span>    <span class="token keyword">yield</span> <span class="token number">100</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2222'</span><span class="token punctuation">)</span>    <span class="token keyword">yield</span> <span class="token number">200</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3333'</span><span class="token punctuation">)</span>    <span class="token keyword">yield</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 第一次调用，函数体开始执行，遇到第一个 yield 暂停console.log(generator.next()) // 第二次调用，从暂停位置继续，直到遇到下一个 yield 再次暂停console.log(generator.next()) // 。。。console.log(generator.next()) // 第四次调用，已经没有需要执行的内容了，所以直接得到 undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-实际应用"><a href="#2-实际应用" class="headerlink" title="2.实际应用"></a>2.实际应用</h3><p>在生成器对象上显式调用 next()方法的用处并不大。其实，如果把生成器对象当成可迭代对象，那么使用起来会更方便：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generatorFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>     <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> x <span class="token keyword">of</span> <span class="token function">generatorFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 1 // 2 // 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Generator 应用// 案例1：发号器function* createIdMaker() {    let id = 1    while (true) {        yield id++    }}const idMaker = createIdMaker()console.log(idMaker.next().value)  // 1console.log(idMaker.next().value)  // 2console.log(idMaker.next().value)  // 3console.log(idMaker.next().value)  // 4// 案例2：使用 Generator 函数实现 iterator 方法const todos = {    life: ['吃饭', '睡觉', '打豆豆'],    learn: ['语文', '数学', '外语'],    work: ['喝茶'],    [Symbol.iterator]: function* () {        const all = [...this.life, ...this.learn, ...this.work]        for (const item of all) {            yield item        }    }}for (const item of todos) {    console.log(item)}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="二十、ES2016和ES2017概述"><a href="#二十、ES2016和ES2017概述" class="headerlink" title="二十、ES2016和ES2017概述"></a>二十、ES2016和ES2017概述</h2><h3 id="1-ES2016"><a href="#1-ES2016" class="headerlink" title="1.ES2016"></a>1.ES2016</h3><blockquote><p>新增数组实例对象的includes方法，检查数组中是否包含某个指定元素</p></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span><span class="token comment">// 找到返回元素下标</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 找不到返回 -1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 无法找到数组中的 NaN</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span>includes方法<span class="token comment">// 直接返回是否存在指定元素</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 能够查找 NaN</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>新增指数运算符</p></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">**</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment">// 语言本身的运算符与加减乘除相同</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-ES2017"><a href="#2-ES2017" class="headerlink" title="2.ES2017"></a>2.ES2017</h3><blockquote><p>object对象的三个扩展方法</p></blockquote><ul><li>Object.values</li><li>Object.entries</li><li>Object.getOwnPropertyDescriptiors</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>    foo<span class="token operator">:</span> <span class="token string">'value1'</span><span class="token punctuation">,</span>    bar<span class="token operator">:</span> <span class="token string">'value2'</span><span class="token punctuation">}</span><span class="token comment">// Object.values -------------------返回对象中所有值组成的数组----------------------------------------</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// Object.entries ------------------以数组的形式返回对象中所有的键值对----------------------------------------</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 可以直接使用for...of遍历</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 将对象转换为Map类型的对象</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// Object.getOwnPropertyDescriptors ----------获取对象中属性的完整描述信息------------------------------</span><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token punctuation">{</span>    firstName<span class="token operator">:</span> <span class="token string">'Lei'</span><span class="token punctuation">,</span>    lastName<span class="token operator">:</span> <span class="token string">'Wang'</span><span class="token punctuation">,</span>    <span class="token keyword">get</span> <span class="token function">fullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastName    <span class="token punctuation">}</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>fullName<span class="token punctuation">)</span><span class="token keyword">const</span> p2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span>p2<span class="token punctuation">.</span>firstName <span class="token operator">=</span> <span class="token string">'zce'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token keyword">const</span> descriptors <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>descriptors<span class="token punctuation">)</span><span class="token keyword">const</span> p2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> descriptors<span class="token punctuation">)</span>p2<span class="token punctuation">.</span>firstName <span class="token operator">=</span> <span class="token string">'zce'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>fullName<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>字符串方法</p></blockquote><ul><li>String.prototype.padStart</li><li>String.prototype.padEnd</li></ul><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token punctuation">{</span>    html<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>    css<span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>    javascript<span class="token operator">:</span> <span class="token number">128</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> count<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>books<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> count<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>books<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token punctuation">.</span><span class="token function">padEnd</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">|</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">//html 5</span><span class="token comment">//css 16</span><span class="token comment">//javascript 128</span><span class="token comment">//html------------|005</span><span class="token comment">//css-------------|016</span><span class="token comment">//javascript------|128</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ECMAScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写Promise源码</title>
      <link href="2021/051933976.html"/>
      <url>2021/051933976.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/*@Author: 5coder@Data: 2022-08-16 @Descriptions: 07.手写Promise源码@Product: WebStorm*/</span><span class="token comment">/*  1. Promise就是一个类，在执行这个类的时候，需要传递一个执行器进去，执行器就会立即执行executor    执行器executor会有两个参数resolve和reject方法  2. Promise中有三种状态，分别为：成功-fulfilled， 失败-rejected， 等待-pending  3.状态只能有pending转换为另外两种    pending -&gt; fulfilled    pending -&gt; rejected  4.resolve和reject函数是用来更改状态的    resolve：fulfilled    reject： rejected  5.then方法内部做的事情就是判断状态，如果状态是成功，就调用成功的回调函数（successCallback），如果状态是失败，就调用失败回调函数（failCallback）  6.then成功回调有一个参数（value），表示成功之后的值；then失败回调有一个参数，表示失败之后的值（reason）*/</span><span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>  <span class="token comment">// 等待</span><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>  <span class="token comment">// 成功</span><span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>  <span class="token comment">// 失败</span><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>  <span class="token comment">// 需要传入执行器，并且立即执行</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  status <span class="token operator">=</span> <span class="token constant">PENDING</span>  <span class="token comment">// promise状态默认为等待</span>  value <span class="token operator">=</span> <span class="token keyword">undefined</span>  <span class="token comment">// 成功之后的值</span>  reason <span class="token operator">=</span> <span class="token keyword">undefined</span>  <span class="token comment">// 失败之后的原因</span>  successCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// 成功回调</span>  failCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// 失败回调</span>  <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果状态不是等待，组织程序向下执行</span>    <span class="token comment">// 将状态更改为成功</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token keyword">return</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>    <span class="token comment">// 保存成功之后的值</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value    <span class="token comment">// 成功回调是否存在，如果存在就调用--异步情况</span>    <span class="token comment">// this.successCallback &amp;&amp; this.successCallback(this.value)</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>successCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>successCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果状态不是等待，组织程序向下执行</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token keyword">return</span>    <span class="token comment">// 将状态更改为失败</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>    <span class="token comment">// 保存失败之后的值</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason    <span class="token comment">// 失败回调是否存在，如果存在就调用--异步情况</span>    <span class="token comment">// this.failCallback &amp;&amp; this.failCallback(reason)</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>failCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>failCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">successCallback<span class="token punctuation">,</span> failCallback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    successCallback <span class="token operator">=</span> successCallback <span class="token operator">?</span> <span class="token function-variable function">successCallback</span> <span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value    failCallback <span class="token operator">=</span> failCallback <span class="token operator">?</span> <span class="token function-variable function">failCallback</span> <span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">throw</span> reason    <span class="token punctuation">}</span>    <span class="token keyword">let</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 使用setTimeOut是因为在这里不能直接获取到promise2，需要等待同步代码执行完成之后，promise2被赋值后，在异步代码中进行获取</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// 成功回调</span>            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">successCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>            <span class="token comment">// 判断x的值是普通纸还是promise对象</span>            <span class="token comment">// 如果是普通值，直接调用resolve</span>            <span class="token comment">// 如果是promise对象，查看promise对象返回的结果，再根据promise对象返回的结果，决定调用resolve还是reject</span>            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 失败回调</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// 失败回调</span>            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">failCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>            <span class="token comment">// 判断x的值是普通纸还是promise对象</span>            <span class="token comment">// 如果是普通值，直接调用resolve</span>            <span class="token comment">// 如果是promise对象，查看promise对象返回的结果，再根据promise对象返回的结果，决定调用resolve还是reject</span>            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment">// 如果是等待状态，状态为pending，--异步情况</span>        <span class="token comment">// 将成功回调和失败回调存储下来</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>successCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>              <span class="token comment">// 成功回调</span>              <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">successCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>              <span class="token comment">// 判断x的值是普通纸还是promise对象</span>              <span class="token comment">// 如果是普通值，直接调用resolve</span>              <span class="token comment">// 如果是promise对象，查看promise对象返回的结果，再根据promise对象返回的结果，决定调用resolve还是reject</span>              <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>failCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>              <span class="token comment">// 失败回调</span>              <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">failCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>              <span class="token comment">// 判断x的值是普通纸还是promise对象</span>              <span class="token comment">// 如果是普通值，直接调用resolve</span>              <span class="token comment">// 如果是promise对象，查看promise对象返回的结果，再根据promise对象返回的结果，决定调用resolve还是reject</span>              <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> promise2  <span class="token punctuation">}</span>  <span class="token keyword">finally</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> MyPromise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> MyPromise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> reason      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">catch</span><span class="token punctuation">(</span>failCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> failCallback<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">static</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">function</span> <span class="token function">addData</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value        index<span class="token operator">++</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> array<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> current <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        <span class="token comment">// 判断是普通值还是promise对象</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">// promise对象</span>          current<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token function">addData</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> value<span class="token punctuation">)</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token comment">// 普通值</span>          <span class="token function">addData</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 如果是promise对象，直接返回</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">"Chaining cycle detected for promise #&lt;Promise&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// promise对象</span>    <span class="token comment">// x.then(value =&gt; resolve(value), reason =&gt; reject(reason))</span>    x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// 普通值</span>    <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Promise </tag>
            
            <tag> Review </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Promise对象使用回顾</title>
      <link href="2021/0519741.html"/>
      <url>2021/0519741.html</url>
      
        <content type="html"><![CDATA[<h2 id="Promise对象使用回顾"><a href="#Promise对象使用回顾" class="headerlink" title="Promise对象使用回顾"></a>Promise对象使用回顾</h2><p>抽象表达：Promise 是JS 中进行异步编程的新的解决方案<br>具体表达：Promise 是一个构造函数，promise对象用来封装一个异步操作并可以获取其结果</p><h3 id="1-promise诞生的意义是什么，为什么会有promise"><a href="#1-promise诞生的意义是什么，为什么会有promise" class="headerlink" title="1.promise诞生的意义是什么，为什么会有promise?"></a>1.promise诞生的意义是什么，为什么会有promise?</h3><ol><li>指定回调函数的方式更加灵活<br><strong>promise之前：必须在启动异步任务前指定</strong><br><strong>promise：启动异步任务=&gt; 返回promie 对象=&gt; 给promise 对象绑定回调函</strong><br><strong>数(甚至可以在异步任务结束后指定/多个)</strong></li><li>支持链式调用, 可以解决回调地狱问题<br><strong>什么是回调地狱? 回调函数嵌套调用, 外部回调函数异步执行的结果是嵌套的回调函数执行的条件</strong><br><strong>回调地狱的缺点? 不便于阅读/ 不便于异常处理</strong><br><strong>解决方案? promise 链式调用</strong><br><strong>终极解决方案? async/await</strong></li></ol><h3 id="2-promise的Api有哪些"><a href="#2-promise的Api有哪些" class="headerlink" title="2.promise的Api有哪些?"></a>2.promise的Api有哪些?</h3><ol><li>Promise 构造函数: Promise (excutor) {}</li><li>Promise.prototype.then 方法: (onResolved, onRejected) =&gt; {}</li><li>Promise.prototype.catch 方法: (onRejected) =&gt; {}</li><li>Promise.resolve 方法: (value) =&gt; {}</li><li>Promise.reject 方法: (reason) =&gt; {}</li><li>Promise.all 方法: (promises) =&gt; {}</li><li>Promise.race 方法: (promises) =&gt; {}</li></ol><h3 id="3-Promise基本用法"><a href="#3-Promise基本用法" class="headerlink" title="3.Promise基本用法"></a>3.Promise基本用法</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Promise 基本示例</span><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 这里用于“兑现”承诺</span>  <span class="token comment">// resolve(100) // 承诺达成</span>  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'promise rejected'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 承诺失败</span><span class="token punctuation">}</span><span class="token punctuation">)</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 即便没有异步操作，then 方法中传入的回调仍然会被放入队列，等待下一轮执行</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolved'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'rejected'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-Promise使用案例"><a href="#4-Promise使用案例" class="headerlink" title="4.Promise使用案例"></a>4.Promise使用案例</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Promise 方式的 AJAX</span><span class="token keyword">function</span> <span class="token function">ajax</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 返回一个promise对象</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/foo.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment">// ajax请求成功后调用</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>  <span class="token comment">// ajax请求失败后调用</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-Promise常见误区"><a href="#5-Promise常见误区" class="headerlink" title="5.Promise常见误区"></a>5.Promise常见误区</h3><p>promise最常见的误区的就是嵌套使用：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>        xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>        xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/urls.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">urls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">ajax</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">users</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">ajax</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">users</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">ajax</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">users</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">ajax</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">users</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>嵌套使用就失去了Promise通过状态变化获取结果的优势，依然无法获取其中某个回调是否完成的结果。</p><h3 id="6-Promise链式调用"><a href="#6-Promise链式调用" class="headerlink" title="6.Promise链式调用"></a>6.Promise链式调用</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Promise 链式调用</span><span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>        xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>        xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// var promise = ajax('/api/users.json')</span><span class="token comment">// var promise2 = promise.then(</span><span class="token comment">//   function onFulfilled (value) {</span><span class="token comment">//     console.log('onFulfilled', value)</span><span class="token comment">//   },</span><span class="token comment">//   function onRejected (error) {</span><span class="token comment">//     console.log('onRejected', error)</span><span class="token comment">//   }</span><span class="token comment">// )</span><span class="token comment">// console.log(promise2 === promise)</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/users.json'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/urls.json'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; Promise</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2222</span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/urls.json'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; Promise</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3333</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/urls.json'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; Promise</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4444</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">'foo'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; Promise</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5555</span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-Promise异常处理"><a href="#7-Promise异常处理" class="headerlink" title="7.Promise异常处理"></a>7.Promise异常处理</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Promise 异常处理</span><span class="token keyword">function</span> <span class="token function">ajax</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// foo()</span>    <span class="token comment">// throw new Error()</span>    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// ajax('/api/users11.json')</span><span class="token comment">//   .then(function onFulfilled (value) {</span><span class="token comment">//     console.log('onFulfilled', value)</span><span class="token comment">//   }, function onRejected (error) {</span><span class="token comment">//     console.log('onRejected', error)</span><span class="token comment">//   })</span><span class="token comment">// 使用 catch 注册失败回调是更常见的</span><span class="token comment">// ajax('/api/users11.json')</span><span class="token comment">//   .then(function onFulfilled (value) {</span><span class="token comment">//     console.log('onFulfilled', value)</span><span class="token comment">//   })</span><span class="token comment">//   .catch(function onRejected (error) {</span><span class="token comment">//     console.log('onRejected', error)</span><span class="token comment">//   })</span><span class="token comment">// then(onRejected) 实际上就相当于 then(undefined, onRejected)</span><span class="token comment">// ajax('/api/users11.json')</span><span class="token comment">//   .then(function onFulfilled (value) {</span><span class="token comment">//     console.log('onFulfilled', value)</span><span class="token comment">//   })</span><span class="token comment">//   .then(undefined, function onRejected (error) {</span><span class="token comment">//     console.log('onRejected', error)</span><span class="token comment">//   })</span><span class="token comment">// 同时注册的 onRejected 只是给当前 Promise 对象注册的失败回调</span><span class="token comment">// 它只能捕获到当前 Promise 对象的异常</span><span class="token comment">// ajax('/api/users.json')</span><span class="token comment">//   .then(function onFulfilled (value) {</span><span class="token comment">//     console.log('onFulfilled', value)</span><span class="token comment">//     return ajax('/error-url')</span><span class="token comment">//   }, function onRejected (error) {</span><span class="token comment">//     console.log('onRejected', error)</span><span class="token comment">//   })</span><span class="token comment">// 因为 Promise 链条上的任何一个异常都会被一直向后传递，直至被捕获</span><span class="token comment">// 分开注册的 onRejected 相当于给整个 Promise 链条注册失败回调</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/users.json'</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">onFulfilled</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onFulfilled'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/error-url'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; Promise {}</span>  <span class="token comment">// .catch(function onRejected (error) {</span>  <span class="token comment">//   console.log('onRejected', error)</span>  <span class="token comment">// })</span><span class="token comment">// 全局捕获 Promise 异常，类似于 window.onerror</span>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> reason<span class="token punctuation">,</span> promise <span class="token punctuation">}</span> <span class="token operator">=</span> event  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">,</span> promise<span class="token punctuation">)</span>  <span class="token comment">// reason =&gt; Promise 失败原因，一般是一个错误对象</span>  <span class="token comment">// promise =&gt; 出现异常的 Promise 对象</span>  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token comment">// Node.js 中使用以下方式</span><span class="token comment">// process.on('unhandledRejection', (reason, promise) =&gt; {</span><span class="token comment">//   console.log(reason, promise)</span><span class="token comment">//   // reason =&gt; Promise 失败原因，一般是一个错误对象</span><span class="token comment">//   // promise =&gt; 出现异常的 Promise 对象</span><span class="token comment">// })</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-Promise静态方法"><a href="#8-Promise静态方法" class="headerlink" title="8.Promise静态方法"></a>8.Promise静态方法</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 常用 Promise 静态方法</span><span class="token keyword">function</span> <span class="token function">ajax</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// foo()</span>    <span class="token comment">// throw new Error()</span>    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// Promise.resolve('foo')</span><span class="token comment">//   .then(function (value) {</span><span class="token comment">//     console.log(value)</span><span class="token comment">//   })</span><span class="token comment">// new Promise(function (resolve, reject) {</span><span class="token comment">//   resolve('foo')</span><span class="token comment">// })</span><span class="token comment">// 如果传入的是一个 Promise 对象，Promise.resolve 方法原样返回</span><span class="token comment">// var promise = ajax('/api/users.json')</span><span class="token comment">// var promise2 = Promise.resolve(promise)</span><span class="token comment">// console.log(promise === promise2)</span><span class="token comment">// 如果传入的是带有一个跟 Promise 一样的 then 方法的对象，</span><span class="token comment">// Promise.resolve 会将这个对象作为 Promise 执行</span><span class="token comment">// Promise.resolve({</span><span class="token comment">//   then: function (onFulfilled, onRejected) {</span><span class="token comment">//     onFulfilled('foo')</span><span class="token comment">//   }</span><span class="token comment">// })</span><span class="token comment">// .then(function (value) {</span><span class="token comment">//   console.log(value)</span><span class="token comment">// })</span><span class="token comment">// Promise.reject 传入任何值，都会作为这个 Promise 失败的理由</span><span class="token comment">// Promise.reject(new Error('rejected'))</span><span class="token comment">//   .catch(function (error) {</span><span class="token comment">//     console.log(error)</span><span class="token comment">//   })</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'anything'</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="9-Promise并行执行"><a href="#9-Promise并行执行" class="headerlink" title="9.Promise并行执行"></a>9.Promise并行执行</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Promise 并行执行</span><span class="token keyword">function</span> <span class="token function">ajax</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// foo()</span>    <span class="token comment">// throw new Error()</span>    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// ajax('/api/users.json')</span><span class="token comment">// ajax('/api/posts.json')</span><span class="token comment">// var promise = Promise.all([</span><span class="token comment">//   ajax('/api/users.json'),</span><span class="token comment">//   ajax('/api/posts.json')</span><span class="token comment">// ])</span><span class="token comment">// promise.then(function (values) {</span><span class="token comment">//   console.log(values)</span><span class="token comment">// }).catch(function (error) {</span><span class="token comment">//   console.log(error)</span><span class="token comment">// })</span><span class="token comment">// ajax('/api/urls.json')</span><span class="token comment">//   .then(value =&gt; {</span><span class="token comment">//     const urls = Object.values(value)</span><span class="token comment">//     const tasks = urls.map(url =&gt; ajax(url))</span><span class="token comment">//     return Promise.all(tasks)</span><span class="token comment">//   })</span><span class="token comment">//   .then(values =&gt; {</span><span class="token comment">//     console.log(values)</span><span class="token comment">//   })</span><span class="token comment">// Promise.race 实现超时控制</span><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/posts.json'</span><span class="token punctuation">)</span><span class="token keyword">const</span> timeout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  request<span class="token punctuation">,</span>  timeout<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="10-Promise执行时序"><a href="#10-Promise执行时序" class="headerlink" title="10.Promise执行时序"></a>10.Promise执行时序</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 微任务</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'global start'</span><span class="token punctuation">)</span><span class="token comment">// setTimeout 的回调是 宏任务，进入回调队列排队</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// Promise 的回调是 微任务，本轮调用末尾直接执行</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise 2'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise 3'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'global end'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Promise vs. Callback</span><span class="token keyword">function</span> <span class="token function">ajax</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token function-variable function">executor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// support callback</span>    <span class="token function">executor</span><span class="token punctuation">(</span>      <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>    <span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// ajax('/api/urls.json', (error, value) =&gt; {</span><span class="token comment">//   if (error) {</span><span class="token comment">//     return console.error(error)</span><span class="token comment">//   }</span><span class="token comment">//   console.log(value)</span><span class="token comment">// })</span><span class="token comment">// ajax('/api/urls.json')</span><span class="token comment">//   .then(value =&gt; {</span><span class="token comment">//     console.log(value)</span><span class="token comment">//   })</span><span class="token comment">//   .catch(error =&gt; {</span><span class="token comment">//     console.error(error)</span><span class="token comment">//   })</span><span class="token comment">// Callback hell</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/url1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/url2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/url3'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/url4'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// Promise chain</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/url1'</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'ajax/url2'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'ajax/url3'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'ajax/url4'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// sync mode code</span><span class="token keyword">try</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> value1 <span class="token operator">=</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/url1'</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value1<span class="token punctuation">)</span>  <span class="token keyword">const</span> value2 <span class="token operator">=</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/url2'</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value2<span class="token punctuation">)</span>  <span class="token keyword">const</span> value3 <span class="token operator">=</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/url3'</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value3<span class="token punctuation">)</span>  <span class="token keyword">const</span> value4 <span class="token operator">=</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/url4'</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value4<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="11-Generator异步方案"><a href="#11-Generator异步方案" class="headerlink" title="11.Generator异步方案"></a>11.Generator异步方案</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 生成器函数回顾</span><span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>  <span class="token keyword">try</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token string">'foo'</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> result <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment">// generator.next('bar')</span>generator<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Generator error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Generator 配合 Promise 的异步方案</span><span class="token keyword">function</span> <span class="token function">ajax</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">try</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/users.json'</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>    <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/posts.json'</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>posts<span class="token punctuation">)</span>    <span class="token keyword">const</span> urls <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/urls11.json'</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">co</span> <span class="token punctuation">(</span><span class="token parameter">generator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">function</span> <span class="token function">handleResult</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token comment">// 生成器函数结束</span>    result<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token function">handleResult</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      g<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">handleResult</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">co</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token comment">// const result = g.next()</span><span class="token comment">// result.value.then(data =&gt; {</span><span class="token comment">//   const result2 = g.next(data)</span><span class="token comment">//   if (result2.done) return</span><span class="token comment">//   result2.value.then(data =&gt; {</span><span class="token comment">//     const result3 = g.next(data)</span><span class="token comment">//     if (result3.done) return</span><span class="token comment">//     result3.value.then(data =&gt; {</span><span class="token comment">//       g.next(data)</span><span class="token comment">//     })</span><span class="token comment">//   })</span><span class="token comment">// })</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="12-Async方案"><a href="#12-Async方案" class="headerlink" title="12.Async方案"></a>12.Async方案</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// Async / Await 语法糖</span><span class="token keyword">function</span> <span class="token function">ajax</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>    xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">co</span> <span class="token punctuation">(</span><span class="token parameter">generator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">function</span> <span class="token function">handleResult</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token comment">// 生成器函数结束</span>    result<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token function">handleResult</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      g<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token function">handleResult</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">try</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/users.json'</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>    <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/posts.json'</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>posts<span class="token punctuation">)</span>    <span class="token keyword">const</span> urls <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'/api/urls.json'</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// co(main)</span><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'all completed'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>本篇主要从代码角度去了解primise，基本用法都写在注释内，若有疑问，欢迎留言</p>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Promise </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 异步编程</title>
      <link href="2021/05196342.html"/>
      <url>2021/05196342.html</url>
      
        <content type="html"><![CDATA[<h2 id="JavaScript异步编程"><a href="#JavaScript异步编程" class="headerlink" title="JavaScript异步编程"></a>JavaScript异步编程</h2><h3 id="一、同步模式"><a href="#一、同步模式" class="headerlink" title="一、同步模式"></a>一、同步模式</h3><blockquote><p>同步模式指的就是我们代码中的任务依次执行，程序执行的顺序与代码的编写顺序一致。</p><p>以下代码为同步模式的代码，具体分析其执行顺序</p></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Global begin'</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Bar task'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Foo task'</span><span class="token punctuation">)</span>    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Global end'</span><span class="token punctuation">)</span><span class="token comment">// Global begin</span><span class="token comment">// Foo task</span><span class="token comment">// Bar task</span><span class="token comment">// Global end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://5coder.cn/img/202208152208328.gif" alt="无法查看时复制链接到浏览器观看：http://5coder.cn/img/202208152208328.gif"></p><p>分析：</p><blockquote><ol><li><p>首先分析代码结构，本段代码为同步模式，js在读取到代码时，先将一个（anonymous）匿名函数放到调用栈。</p></li><li><p>在读取到第一行console.log(‘Global begin’)时，将其压到调用栈，随后去执行，当控制台打印出结果后，将其弹出调用栈，继续下一行代码；</p></li><li><p>在读取到bar函数及foo函数时，由于其并未执行，因此调用栈内无执行任务；</p></li><li><p>在读取到foo()函数调用时，首先将foo()压入调用栈，遇console.log(‘Foo task’)代码，将其压入调用栈，执行完毕后弹出调用栈。随后将bar()压入调用栈，程序去bar()函数内部解析，将console.log(‘Bar task’)压入调用栈。foo()函数执行完毕后，依次将bar()、foo()函数弹出调用栈；</p></li><li><p>最后将console.log(‘Global end’)压入调用栈并执行，随后将其弹出，代码运行完成，将(anonymous)弹出调用栈，程序完全结束。</p></li></ol></blockquote><h3 id="二、异步模式"><a href="#二、异步模式" class="headerlink" title="二、异步模式"></a>二、异步模式</h3><p>在浏览器端，耗时很长的操作都应该异步执行，避免浏览器失去响应，最好的例子就是Ajax操作。在服务器端，”异步模式”甚至是唯一的模式，因为执行环境是单线程的，如果允许同步执行所有http请求，服务器性能会急剧下降，很快就会失去响应。</p><p>异步调用并不会阻止代码的顺序执行，而是在将来的某一个时刻触发设置好的逻辑，所以我们</p><ol><li>并不知道逻辑什么时候会被调用</li><li>只能定义当触发的时候逻辑是什么</li><li>只能等待，同时可以去处理其他的逻辑</li></ol><pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'global begin'</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer1 invoke'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1800</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer2 invoke'</span><span class="token punctuation">)</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'inner invoke'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'global end'</span><span class="token punctuation">)</span><span class="token comment">// global begin</span><span class="token comment">// global end</span><span class="token comment">// timer2 invoke</span><span class="token comment">// timer1 invoke</span><span class="token comment">// inner invoke</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>复制地址到浏览器地址栏查看动图演示：</p><p><img src="http://5coder.cn/img/202208152208762.gif" alt="无法查看时复制链接到浏览器观看：http://5coder.cn/img/202208152208762.gif"></p><p>分析：</p><blockquote><p>首先分析代码结构，本段代码为异步模式，js在读取到代码时，先将一个（<code>anonymous</code>）匿名函数放到调用栈。</p><p>将第一行<code>console.log('global begin')</code>压入调用栈并执行后弹出，此时控制台打印<code>global begin</code>；</p><p>程序到<code>setTimeout</code>时，首先将<code>setTimeout(timer1)</code>压入调用栈，在web API线程放入timer1计时器，倒计时1.8s，随后将<code>setTimeout(timer1)</code>弹出调用栈；</p><p>同上步，将<code>setTimeout(timer2)</code>压入调用栈，web API线程放入<code>timer2</code>计时器，倒计时1s，随后将<code>setTimeout(timer2)</code>弹出调用栈；</p><p>随后将<code>console.log('global end')</code>压入调用栈并执行后弹出调用栈，代码执行完毕，将<code>anonymous</code>弹出调用栈；</p><p>web API将<code>timer1</code>与<code>timer2</code>依次放入事件队列，此时<code>timer2</code>优先倒计时完毕，进入调用栈，然后执行内部代码。将<code>console.log('timer2 invoke')</code>压入调用栈并执行后弹出。</p><p>随后遇<code>setTimeout(inner)</code>,将其压入调用栈并在Web API加入<code>inner</code>计时器，倒计时1s。<code>setTimeout(inner)</code>弹出调用栈。</p><p>此时随倒计时，<code>timer1</code>倒计时完毕，程序进入<code>timer1</code>内部，将<code>console.log('timer1 invoke')</code>压入调用栈并执行后弹出。</p><p>随后<code>inner()</code>计时器进入任务队列，在倒计时结束后，压入调用栈并执行后弹出。至此，程序执行完毕。</p></blockquote><h3 id="三、回调函数"><a href="#三、回调函数" class="headerlink" title="三、回调函数"></a>三、回调函数</h3><p>回调函数指的是需要在将来不确定的某一时刻异步调用的函数。通常，在这种回调函数中，我们经常需要频繁地访问外部数据。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这就是一个回到函数'</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用者定义这个函数，执行者执行这个函数'</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'起始就是调用者告诉执行者：异步任务结束后应该做什么'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="四、Promise概述"><a href="#四、Promise概述" class="headerlink" title="四、Promise概述"></a>四、Promise概述</h3><p>由于上述回调函数可以存在嵌套关系，因此容易导致<strong>回调地狱</strong>问题，即产生如下代码：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">$<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'url1'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'url2'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'url3'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'url4'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'url5'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'url6'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'url7'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token comment">// 略微夸张，但实际存在</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因此提出<code>Promise</code>承诺，即在回调函数中，承诺在异步完成后下一步干什么。</p><p><code>Promise</code>存在三种状态，及承诺开始<code>pending</code>，承诺兑现<code>fulfilled</code>以及承诺失败<code>rejected</code>。并且，承诺的状态一旦确定就不可在被改变，即当状态为<code>fulfilled</code>时，此<code>promise</code>的状态就不可再变为<code>rejected</code>，反之同样。</p><p><a href="http://5coder.cn/2021/0519741.html">传送：Promise基本使用</a></p><p><code>fulfilled</code>与<code>rejected</code>存在<code>onFulfilled</code>和<code>onRejected</code>状态。</p><ul><li>什么是<code>promise</code>?</li><li><code>promise</code>诞生的意义是什么，为什么会有<code>promise</code>?</li><li><code>promise</code>的Api有哪些?</li><li>如何使用这些Api呢？（mdn有详细的用法，详细的不能太详细）</li><li>终极解决方案<code>async</code>/<code>await</code>的使用！</li><li>手写一个promise吧！</li></ul>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>函数式编程范式</title>
      <link href="2021/051927847.html"/>
      <url>2021/051927847.html</url>
      
        <content type="html"><![CDATA[<h2 id="一、为什么要学习函数式编程"><a href="#一、为什么要学习函数式编程" class="headerlink" title="一、为什么要学习函数式编程"></a>一、为什么要学习函数式编程</h2><p>函数式编程功能是非常古老的一个概念，早于第一台计算机的诞生，<a href="https://zhuanlan.zhihu.com/p/24648375?refer=marisa">函数式编程的历史</a></p><p>学习函数式编程的目的：</p><ul><li>函数式编程是随着React的流行受到越来越多的关注；</li><li>Vue3也开始走入函数式编程的怀抱；</li><li>函数式编程可以抛弃this</li><li>打包过程中可以更好的利用<strong>tree shaking</strong>过滤无用的代码</li><li>方便测试、方便并行处理</li><li>有很多库可以帮助我们进行函数式开发：lodash、underscore、ramda</li></ul><hr><h2 id="二、什么是函数式编程"><a href="#二、什么是函数式编程" class="headerlink" title="二、什么是函数式编程"></a>二、什么是函数式编程</h2><p>函数式编程（Functional Programming，FP），FP是编程范式之一，常说的编程范式还有<strong>面向过程</strong>编程、<strong>面向对象</strong>编程。</p><ul><li>【面向对象编程】的思维模式：把现实世界中的事物抽象成程序世界中的<strong>类和对象</strong>，通过封装、继承和多态来演示事物事件的联系（人类-小明）</li><li>【函数式编程】的思维方式：把现实世界的事物和事物之间的联系抽象到程序世界（对运算过程进行抽象）<ul><li>程序的本质：根据输入通过某种运算获得相应的输出，程序开发过程中会涉及很多有输入和输出的函数</li><li>x -&gt; f(联系、映射) -&gt; y, y=f(x)</li><li><strong>函数式编程中的函数指的不是程序中的函数（或方法）</strong>，而是数学中的函数即<strong>映射关系</strong>，例如：y=sin(x)，x和y的关系</li><li><strong>相同的输入始终得到相同的输出（纯函数）</strong></li><li>函数式编程用来描述数据（函数）之间的映射</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 非函数式</span><span class="token keyword">let</span> num1 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">let</span> num2 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">let</span> sum <span class="token operator">=</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 函数式</span><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">}</span><span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="三、前置知识"><a href="#三、前置知识" class="headerlink" title="三、前置知识"></a>三、前置知识</h2><h3 id="1-函数是一等公民"><a href="#1-函数是一等公民" class="headerlink" title="1.函数是一等公民"></a>1.函数是一等公民</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/First-class_Function">MDN First-class Function</a></p><p>在JavaScript中<strong>函数就是一个普通的对象</strong>（可以通过new Function()），我们可以把函数存储到变量、数组中，它还可以作为另一个函数的参数和返回值，甚至我们可以在程序运行的时候通过new Function(‘alert(1)’)来构造一个新的函数</p><ul><li><p>函数可以存储在变量中</p></li><li><p>函数作为参数</p></li><li><p>函数作为返回值</p></li><li><p>把函数赋值给变量</p></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 把函数赋值给变量</span><span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello First-class Function'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 函数调用</span><span class="token comment">// 示例</span><span class="token keyword">const</span> BlogController <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token function">index</span><span class="token punctuation">(</span><span class="token parameter">posts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> views<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>ports<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">show</span> <span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Views<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">create</span> <span class="token punctuation">(</span><span class="token parameter">attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Db<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">update</span> <span class="token punctuation">(</span><span class="token parameter">post<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>post<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">destroy</span> <span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Db<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 示例优化</span><span class="token keyword">const</span> BlogController <span class="token operator">=</span> <span class="token punctuation">{</span>    index<span class="token operator">:</span> Views<span class="token punctuation">.</span>index<span class="token punctuation">,</span>    show<span class="token operator">:</span> Views<span class="token punctuation">.</span>show<span class="token punctuation">,</span>    create<span class="token operator">:</span> Db<span class="token punctuation">.</span>create<span class="token punctuation">,</span>    update<span class="token operator">:</span> Db<span class="token punctuation">.</span>update<span class="token punctuation">,</span>    destroy<span class="token operator">:</span> Db<span class="token punctuation">.</span>destroy<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>函数是一等公民</strong>是后面学习高阶函数、函数柯里化的基础</li></ul><h3 id="2-高阶函数"><a href="#2-高阶函数" class="headerlink" title="2.高阶函数"></a>2.高阶函数</h3><h4 id="什么是高阶函数"><a href="#什么是高阶函数" class="headerlink" title="什么是高阶函数"></a>什么是高阶函数</h4><ul><li>高阶函数（Higher-order Function）<ul><li>可以把函数作为参数传递给另一个函数</li><li>可以把函数作为另一个函数的返回结果</li></ul></li><li>函数作为参数</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 模拟forEach</span><span class="token keyword">function</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">fn</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 模拟filter</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> results<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>函数作为返回值</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">makeFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">'Hello Function'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">makeFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// once模拟支付，业务场景中用户支付次数只允许为一次</span><span class="token keyword">function</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// 默认置为false</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>done<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// 若未支付，则进入函数</span>            done <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// 进入后，将done置为true，确保下次不进入函数</span>            <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> pay <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">money</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'支付：'</span> <span class="token operator">+</span> money <span class="token operator">+</span> <span class="token string">'RMB'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// 只会打印一次</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply">apply函数提示</a></p><p><strong>apply()</strong> 方法调用一个具有给定<code>this</code>值的函数，以及以一个数组（或<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Indexed_collections#Working_with_array-like_objects">类数组对象</a>）的形式提供的参数。</p><p><strong>注意：</strong>call()方法的作用和 apply() 方法类似，区别就是<code>call()</code>方法接受的是<strong>参数列表（多个参数分开写）</strong>，而<code>apply()</code>方法接受的是<strong>一个参数数组（类似[agr1, agr2…]）</strong>。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// expected output: 7</span><span class="token keyword">const</span> min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// expected output: 2</span><span class="token comment">// 详情查看MDN：</span><span class="token comment">// https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><h4 id="使用高阶函数的意义"><a href="#使用高阶函数的意义" class="headerlink" title="使用高阶函数的意义"></a>使用高阶函数的意义</h4><ul><li>抽象可以帮助我们屏蔽细节（黑盒），只需要关注我们的目标</li><li>高阶函数是用来抽象通用的问题</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 面向过程的方式</span><span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 高阶函数</span><span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> irem <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="常用的高阶函数"><a href="#常用的高阶函数" class="headerlink" title="常用的高阶函数"></a>常用的高阶函数</h4><ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">forEach</a>：<code>forEach()</code> 方法对数组的每个元素执行一次给定的函数。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a>：<code>map()</code>方法创建一个新数组，这个新数组由原数组中的每个元素都调用一次提供的函数后的返回值组成。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> dictList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'5coder'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'leo'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token keyword">let</span> nameList <span class="token operator">=</span> dictList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nameList<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a>：<code>filter()</code> 方法创建一个新数组，其包含通过所提供函数实现的测试的所有元素。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token keyword">let</span> result <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/every">every</a>：<code>every()</code> 方法测试一个数组内的所有元素是否都能通过某个指定函数的测试。它返回一个布尔值。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token keyword">let</span> result <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// return item &gt; 0</span>  <span class="token keyword">return</span> item <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/some">some</a>：<code>some()</code> 方法测试数组中是不是至少有 1 个元素通过了被提供的函数测试。它返回的是一个 Boolean 类型的值。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token keyword">let</span> result <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> item <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/find">find</a>/<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex">findIndex</a></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// find() 方法返回数组中满足提供的测试函数的第一个元素的值。否则返回 undefined。</span><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> found <span class="token operator">=</span> array1<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=&gt;</span> element <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// expected output: 12</span><span class="token comment">// findIndex()方法返回数组中满足提供的测试函数的第一个元素的索引。若没有找到对应元素则返回-1。</span><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">isLargeNumber</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> element <span class="token operator">&gt;</span> <span class="token number">13</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>isLargeNumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// expected output: 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">reduce</a></p><blockquote><p><code>reduce()</code> 方法对数组中的每个元素按序执行一个由您提供的 <strong>reducer</strong> 函数，每一次运行 <strong>reducer</strong> 会将先前元素的计算结果作为参数传入，最后将其结果汇总为单个返回值。</p><p>第一次执行回调函数时，不存在“上一次的计算结果”。如果需要回调函数从数组索引为 0 的元素开始执行，则需要传递初始值。否则，数组索引为 0 的元素将被作为初始值 <em>initialValue</em>，迭代器将从第二个元素开始执行（索引为 1 而不是 0）。</p><p>下面的例子能够帮助你理解 <code>reduce()</code> 的用处——计算数组所有元素的总和：</p></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 0 + 1 + 2 + 3 + 4</span><span class="token keyword">const</span> initialValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">const</span> sumWithInitial <span class="token operator">=</span> array1<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token parameter">previousValue<span class="token punctuation">,</span> currentValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> previousValue <span class="token operator">+</span> currentValue<span class="token punctuation">,</span>  initialValue<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sumWithInitial<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// expected output: 10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">sort</a>：<code>sort()</code> 方法用<a href="https://en.wikipedia.org/wiki/In-place_algorithm">原地算法</a>对数组的元素进行排序，并返回数组。默认排序顺序是在将元素转换为字符串，然后比较它们的 UTF-16 代码单元值序列时构建的</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> months <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'March'</span><span class="token punctuation">,</span> <span class="token string">'Jan'</span><span class="token punctuation">,</span> <span class="token string">'Feb'</span><span class="token punctuation">,</span> <span class="token string">'Dec'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>months<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>months<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// expected output: Array ["Dec", "Feb", "Jan", "March"]</span><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>array1<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// expected output: Array [1, 100000, 21, 30, 4]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>模拟实现部分函数</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// map函数</span><span class="token keyword">const</span> <span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> value <span class="token keyword">of</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> results<span class="token punctuation">}</span><span class="token comment">// every函数</span><span class="token keyword">const</span> <span class="token function-variable function">every</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> value <span class="token keyword">of</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>        result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">break</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> result<span class="token punctuation">}</span><span class="token comment">// some函数</span><span class="token keyword">const</span> <span class="token function-variable function">some</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>conse value <span class="token keyword">of</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>        result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">break</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> result<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-闭包"><a href="#3-闭包" class="headerlink" title="3.闭包"></a>3.闭包</h3><ul><li><p>闭包（Closure）：函数和其周围的状态（词法环境）的引用捆绑在一起形成闭包。</p><ul><li>可以在另一个作用域中调用一个函数的内部函数并访问到高函数的作用域中的成员</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 函数作为返回值</span><span class="token keyword">function</span> <span class="token function">makeFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">'Hello Function'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">makeFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// once</span><span class="token keyword">function</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> pay <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">money</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'支付：'</span> <span class="token operator">+</span> money <span class="token operator">+</span> <span class="token string">'RMB'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 只会支付一次</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>闭包的本质</strong>：函数在执行的时候会放到一个执行栈上，当函数执行完毕后会从执行栈上移出，<strong>但是堆上的作用域成员因为被外部引用不能释放</strong>，因此内部函数依然可以访问外部函数的成员</p></li><li><p>闭包案例</p></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 生成计算数字多少次幂的函数</span><span class="token keyword">function</span> <span class="token function">makePower</span><span class="token punctuation">(</span><span class="token parameter">power</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> Matn<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> power<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> power2 <span class="token operator">=</span> <span class="token function">makePower</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> power3 <span class="token operator">=</span> <span class="token function">makePower</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">power2</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">power3</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 第一个函数是基本工资，第二个函数是绩效工资</span><span class="token keyword">function</span> <span class="token function">makeSalary</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> x <span class="token operator">+</span> y    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> salaryLevel1 <span class="token operator">=</span> <span class="token function">makeSalary</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> salaryLevel2 <span class="token operator">=</span> <span class="token function">makeSalary</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">alaryLevel1</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">alaryLevel1</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="四、纯函数"><a href="#四、纯函数" class="headerlink" title="四、纯函数"></a>四、纯函数</h2><h3 id="1-纯函数概念"><a href="#1-纯函数概念" class="headerlink" title="1.纯函数概念"></a>1.纯函数概念</h3><p><img src="http://5coder.cn/img/Qkcl9Iz3BiKFV6y.jpg"></p><ul><li><p><strong>纯函数：相同的输入永远会得到相同的输出</strong>，而且没有任何可观察的副作用</p><ul><li>纯函数就类似数学中的函数（用来描述输入和输出之间的关系），y=f(x)</li></ul></li><li><p>lodash是一个纯函数的功能库，提供了对数组、数字、对象、字符串、函数等操作的一些方法</p></li><li><p>数组slice和splice分别是：纯函数和不纯的函数</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">slice</a>返回数组中的指定部分，不会改变原数组</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/splice">splice</a>对数组进行操作返回该数组，会改变原数组</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 纯函数</span>numbers<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">// =&gt;[1,2,3]</span>numbers<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">// =&gt;[1,2,3]</span>numbers<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">// =&gt;[1,2,3]</span><span class="token comment">// 不纯的函数</span>numbers<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">// =&gt; [1,2,3]</span>numbers<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">// =&gt; [4,5]</span>numbers<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">// =&gt; []</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>函数式编程不会保留计算中间的结果，所以变量是不可变的（无状态的）</li><li>我们可以把一个函数的执行结果交给另一个函数去处理</li></ul><h3 id="2-纯函数的好处"><a href="#2-纯函数的好处" class="headerlink" title="2.纯函数的好处"></a>2.纯函数的好处</h3><ul><li><p>可缓存</p><ul><li>因为纯函数对相同的输入始终有相同的结果，所以可以把纯函数的结果缓存起来</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">}</span><span class="token keyword">let</span> getAreaWithMemory <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">memoize</span><span class="token punctuation">(</span>getArea<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getAreaWithMemory</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>自己模拟一个memoize函数</p></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getArea</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">memoize</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 使用对象将结果缓存起来，键为传入函数f的参数，值为传入函数f的返回值</span>    <span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment">// 返回一个function，在其中判断是否需要再次执行获取返回值</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// arg_str为传入函数f的参数，使用JSON.stringify将其转化为字符串</span>        <span class="token keyword">let</span> arg_str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>        <span class="token comment">// 对cache[arg_str]进行赋值，有两种情况：</span>        <span class="token comment">// 1.cache中存在arg_str键，则直接取值对其赋值</span>        <span class="token comment">// 2.cache中无arg_str键，需要调用传入的f函数</span>        <span class="token comment">// 使用f.apply调用f函数，第一个参数指向f本身，第二个参数为传入函数f的参数，随后取其返回值</span>        cache<span class="token punctuation">[</span>arg_str<span class="token punctuation">]</span> <span class="token operator">=</span> cache<span class="token punctuation">[</span>arg_str<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token function">f</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>        <span class="token keyword">return</span> cache<span class="token punctuation">[</span>arg_str<span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 4</span><span class="token comment">// 50.26548245743669</span><span class="token comment">// 50.26548245743669</span><span class="token comment">// 50.26548245743669</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>可测试<ul><li>纯函数让测试更方便</li></ul></li><li>并行处理<ul><li>在多线程环境下并行操作共享的内存数据很可能会出现意外情况</li><li>纯函数不需要访问共享的内存数据，所以在并行环境下可以任意运行纯函数（Web Work）</li></ul></li></ul><h3 id="3-副作用"><a href="#3-副作用" class="headerlink" title="3.副作用"></a>3.副作用</h3><ul><li>纯函数：对于相同的输入永远会得到相同的输出，而且没有任何可观察的副作用</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 不纯的</span><span class="token keyword">let</span> mini <span class="token operator">=</span> <span class="token number">18</span><span class="token keyword">function</span> <span class="token function">checkAge</span><span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> age <span class="token operator">&gt;=</span> mini<span class="token punctuation">}</span><span class="token comment">//纯函数（硬编码问题，后续通过柯里化解决）</span><span class="token keyword">function</span> <span class="token function">checkAge2</span><span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> mini <span class="token operator">=</span> <span class="token number">18</span>    <span class="token keyword">return</span> age <span class="token operator">&gt;=</span> mini<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>副作用让一个函数变得不纯（如上例），纯函数的根据相同的输入返回相同的输出，如果函数依赖于外部的状态就无法保证输出相同，就会带来副作用</p><p>副作用来源：</p><ul><li>配置文件</li><li>数据库</li><li>获取用户的输入</li><li>…</li></ul><p>所有的外部交互都有可能带来副作用，副作用也使得方法通用性下降，不适合扩展和可重用性，同时副作用会给程序中带来安全隐患，给程序带来不确定性，但副作用不可能完全禁止，尽可能控制他们在可控范围内发生。</p><h2 id="五、柯里化"><a href="#五、柯里化" class="headerlink" title="五、柯里化"></a>五、柯里化</h2><ul><li>使用柯里化解决上一个案例中硬编码的问题</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 不纯的</span><span class="token keyword">function</span> <span class="token function">checkAge</span><span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> mini <span class="token operator">=</span> <span class="token number">18</span>    <span class="token keyword">return</span> age <span class="token operator">&gt;=</span> mini<span class="token punctuation">}</span><span class="token comment">//普通纯函数</span><span class="token keyword">function</span> <span class="token function">checkAge</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> age <span class="token operator">&gt;=</span> mini<span class="token punctuation">}</span><span class="token function">checkAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token function">checkAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token function">checkAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token comment">// 柯里化</span><span class="token keyword">function</span> <span class="token function">checkAge</span><span class="token punctuation">(</span><span class="token parameter">min</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> age <span class="token operator">&gt;=</span> min    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// ES6写法</span><span class="token keyword">let</span> <span class="token function-variable function">checkAge</span> <span class="token operator">=</span> <span class="token parameter">min</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">age</span> <span class="token operator">=&gt;</span> age <span class="token operator">&gt;=</span> min<span class="token punctuation">)</span><span class="token keyword">let</span> checkAge18 <span class="token operator">=</span> <span class="token function">checkAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token keyword">let</span> checkAge20 <span class="token operator">=</span> <span class="token function">checkAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token function">checkAge18</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token function">checkAge18</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>柯里化<ul><li>当一个函数有多个参数的时候，先传递一部分参数调用它（这部分参数以后永远不变）</li><li>然后返回一个新的函数接收剩余的参数，返回结果</li></ul></li></ul><h3 id="1-lodash中的柯里化函数"><a href="#1-lodash中的柯里化函数" class="headerlink" title="1.lodash中的柯里化函数"></a>1.lodash中的柯里化函数</h3><ul><li>_.curry(func)<ul><li>功能：创建一个函数，该函数接收一个或多个func的参数，如果func所需要的参数都被提供则执行func并返回执行结果。否则继续返回该函数并等待接收剩余的参数。</li><li>参数：需要柯里化的函数</li><li>返回值：柯里化后的函数</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 要柯里化的函数</span><span class="token keyword">function</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">}</span><span class="token comment">// 柯里化后的函数</span><span class="token keyword">let</span> curried <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span>getSum<span class="token punctuation">)</span><span class="token comment">// 测试</span><span class="token function">curried</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token function">curried</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token function">curried</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>案例</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token keyword">const</span> match <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> haveSpace <span class="token operator">=</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token keyword">const</span> haveNumber <span class="token operator">=</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\d+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">haveSpace</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">haveNumber</span><span class="token punctuation">(</span><span class="token string">'$25'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> filter <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span>haveSpace<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'John Connor'</span><span class="token punctuation">,</span> <span class="token string">'John_Donne'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> findSpace <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>haveSpace<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">findSpace</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'John Connor'</span><span class="token punctuation">,</span> <span class="token string">'John Donne'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>模拟_.curry()的实现</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">curriedFn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 判断实参和形参的个数,func.length代表func的参数的长度</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> func<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// 将已传递的参数与未传递的参数拼接，concat用于数组拼接</span>                <span class="token keyword">return</span> <span class="token function">curriedFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h3><ul><li>柯里化可以让我们给一个函数传递较少的参数得到一个已经记住了某些固定参数的新函数</li><li>这是一种对函数参数的缓存</li><li>让函数变得更灵活，让函数的粒度更小</li><li>可以把多元函数转换成一元函数，可以组合使用函数产生强大的功能</li></ul><h2 id="六、函数组合"><a href="#六、函数组合" class="headerlink" title="六、函数组合"></a>六、函数组合</h2><ul><li>纯函数和柯里化很容易写出洋葱代码（一圈一圈又一圈h(g(f(x)))）<ul><li>获取数组的最后一个元素再转换成大写字母，<code>_.toUpper(__.first(___.reverse(array)))</code></li></ul></li><li>函数组合可以让我们把细粒度的函数重新组合生成一个新的函数</li></ul><h3 id="1-管道"><a href="#1-管道" class="headerlink" title="1.管道"></a>1.管道</h3><p>下面这张图表示程序中使用函数处理数据的过程，给fn函数输入参数a，返回结果b。可以想象a数据通过一个管道得到了b数据。<br><img src="http://5coder.cn/img/U7WhJzs6V4rlqT2.jpg"></p><p>当fn函数比较复杂的时候，我们可以把函数fn拆分成多个小函数，此时多了中间运算过程产生的m和n。</p><p>下面这张图中可以想象成把fn这个管道拆分成了3个管道f1，f2，f3，数据a通过管道f3得到结果m，m再通过管道f2得到结果n，n通过管道f1得到最终结果b。<br><img src="http://5coder.cn/img/sR7fNPpy1lZjDw8.jpg"></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">fn <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>f1<span class="token punctuation">,</span>f2<span class="token punctuation">,</span>f3<span class="token punctuation">)</span>b <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-函数组合"><a href="#2-函数组合" class="headerlink" title="2.函数组合"></a>2.函数组合</h3><ul><li>函数组合（compose）：如果一个函数要经过多个函数处理才能得到最终值，这个时候可以把中间过程的函数合并成一个函数<ul><li>函数就像是数据的管道，函数组合就是把这些管道连接起来，让数据穿过多个管道形成最终结果</li><li>函数组合默认是从右到左执行</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 组合函数  数组先翻转再去第一个元素</span><span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> g</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 从右到左执行</span><span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>lodash中的组合函数</li><li>lodash中组合函数flow()或者flowRight()，他们都可以组合多个函数</li><li>flow()是从左到右运行</li><li><strong>flowRight()是从右到左运行，使用的更多一点</strong></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">toUpper</span> <span class="token operator">=</span> <span class="token parameter">s</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">reverse</span> <span class="token operator">=</span> <span class="token parameter">arr</span> <span class="token operator">=&gt;</span> arr<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">first</span> <span class="token operator">=</span> <span class="token parameter">arr</span> <span class="token operator">=&gt;</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">const</span> f <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>toUpper<span class="token punctuation">,</span> first<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>模拟实现lodash的flowRight方法</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 多函数组合</span><span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 传入不定数量的函数，使用...fns代替，剩余参数</span>    <span class="token comment">// 返回一个函数，其需要接收一个参数value</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 返回调用，从...fns中最后一个函数开始调用，所以先需要将参数fns进行翻转</span>        <span class="token comment">// 每个函数需要对value进行处理并返回处理后的值</span>        <span class="token comment">// reduce对数组中的每一个元素去执行我们提供的函数，并将其汇总成单个的结果</span>        <span class="token comment">// reduce参数为一个函数，该函数需要两个参数，acc：累计的结果，fn如何处理每次结果并返回新的结果</span>        <span class="token keyword">return</span> fns<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// fn数组中的每一个函数，acc上一次返回的结果</span>            <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span>            <span class="token comment">// acc初始的值为第一次调用时传的value</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// ES6</span><span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> fns<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>函数的组合要满足<strong>结合律</strong>（associativity）<ul><li>我们既可以把g和h结合，也可以把f和g结合，结果都是一样的，即结合顺序不影响结果值</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 结合律（associativity）</span><span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token keyword">let</span> associative <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>所以代码还可以像下面这样</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token comment">// const f = _.flowRight(_.toUpper, _.first, _.reverse)</span><span class="token comment">// const f = _.flowRight(_.flowRight(_.toUpper, _.first), _.reverse)</span><span class="token keyword">const</span> f <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toUpper<span class="token punctuation">,</span> _<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>first<span class="token punctuation">,</span> _<span class="token punctuation">.</span>reverse<span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// =&gt; THREE</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-调试"><a href="#3-调试" class="headerlink" title="3.调试"></a>3.调试</h3><ul><li>如何调试组合函数</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> f <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toUpper<span class="token punctuation">,</span> _<span class="token punctuation">.</span>first<span class="token punctuation">,</span> _<span class="token punctuation">.</span>reverse<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> trace <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> v<span class="token punctuation">)</span>    <span class="token keyword">return</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> split <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sep<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> sep<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> join <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sep<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> sep<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> map <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> f <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'map 之后'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toLower<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'split 之后'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token string">'NEVER SAY DIE'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>lodash/fp<ul><li>lodash的fp模块提供了使用的对<strong>函数式编程</strong>友好的方法</li><li>提供了不可变auto-curried-first data-last的方法</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// lodash 模块</span><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>_<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _<span class="token punctuation">.</span>toUpper<span class="token punctuation">)</span><span class="token comment">// =&gt; ['A', 'B', 'C']</span>_<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">// =&gt; ['a', 'b', 'c']</span>_<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token comment">// lodash/fp 模块</span><span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span>fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>toUpper<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>toUpper<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>fp<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span>fp<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span><span class="token keyword">const</span> f <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toLower<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token string">'NEVER SAY DIE'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// never-say-die</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-Point-Free"><a href="#4-Point-Free" class="headerlink" title="4.Point Free"></a>4.Point Free</h3><p>Point Free：我们可以把数据处理的过程定义成与数据无关的合成运算，不需要用到代表数据的那个参</p><p>数，只要把简单的运算步骤合成到一起，在使用这种模式之前我们需要定义一些辅助的基本运算函数。</p><ul><li>不需要指明处理的数据</li><li>只需要合成运算过程</li><li>需要定义一些辅助的基本运算函数</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> f <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toLower<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> fp<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>案例演示</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 非 Point Free 模式</span><span class="token comment">// Hello World =&gt; hello_world</span><span class="token keyword">function</span> <span class="token function">f</span> <span class="token punctuation">(</span><span class="token parameter">word</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> word<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// Point Free</span><span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span><span class="token keyword">const</span> f <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span>toLower<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>使用Point Free的模式，把单词中的首字母提取并转换成大写</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span><span class="token keyword">const</span> firstLetterToUpper <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'. '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>first<span class="token punctuation">,</span> fp<span class="token punctuation">.</span>toUpper<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">firstLetterToUpper</span><span class="token punctuation">(</span><span class="token string">'world wild web'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// =&gt; W. W. W</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="七、Functor（函子）"><a href="#七、Functor（函子）" class="headerlink" title="七、Functor（函子）"></a>七、Functor（函子）</h2><h3 id="1-为什么要学函子"><a href="#1-为什么要学函子" class="headerlink" title="1.为什么要学函子"></a>1.为什么要学函子</h3><p>到目前为止已经已经学习了函数式编程的一些基础，但是我们还没有演示在函数式编程中如何把副作用<br>控制在可控的范围内、异常处理、异步操作等。</p><h3 id="2-什么是Functor"><a href="#2-什么是Functor" class="headerlink" title="2.什么是Functor"></a>2.什么是Functor</h3><ul><li>容器：包含值和值的变形关系(这个变形关系就是函数)</li><li>函子：是一个特殊的容器，通过一个普通的对象来实现，该对象具有 map 方法，map 方法可以运<br>行一个函数对值进行处理(变形关系)</li></ul><h3 id="3-Functor函子"><a href="#3-Functor函子" class="headerlink" title="3.Functor函子"></a>3.Functor函子</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ES6中引入类的概念，但是js中没有一个真正的class原始类型，仅仅只是对原型对象运用【语法糖】，所</span><span class="token comment">// 以只有理解如何使用原型对象实现类和继承，才能真正的用好</span><span class="token keyword">class</span> <span class="token class-name">Container</span> <span class="token punctuation">{</span>    <span class="token comment">// 实现of静态方法，不用每次都调用new Container创建对象</span>    <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// 创建构造函数，将传入的value值包含在容器内部（不对外展示）</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// _开头的变量一般定义为内部属性</span>        <span class="token comment">// 通常变量前加下划线表示“私有变量”。函数名前加下划线表示“私有函数”。</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> value    <span class="token punctuation">}</span>    <span class="token comment">// 向外部抛出map函数，用于接收处理value的方法</span>    <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> Container<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 测试</span><span class="token keyword">let</span> r <span class="token operator">=</span> Container<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">*</span> x<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token comment">//  ==&gt;Container { _value: 25 }</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>总结<ul><li>函数式编程的运算不直接操作值，而是由函子完成</li><li>函子就是一个实现了map契约的对象</li><li><strong>我们可以把函子想象成一个盒子，盒子内部封装一个值（value），不对外公布</strong></li><li><strong>想要处理盒子中的值，我们需要给盒子的map方法传递一个处理值得函数（纯函数），由这个函数来对值进行处理</strong></li><li>最终map方法返回一个包含新值得盒子（函子），多次调用map方法，会形成函子嵌套</li></ul></li><li>在Functor中如果传入空值（<strong>副作用</strong>）</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Container<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// TypeError: cannot read property 'toUpperCase' of null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="4-MayBe函子"><a href="#4-MayBe函子" class="headerlink" title="4.MayBe函子"></a>4.MayBe函子</h3><ul><li>我们在编程的过程中可能会遇到很多错误，需要对这些错误做相应的处理</li><li><strong>MayBe函子的作用就是可以对外部的空值情况做处理</strong>（控制副作用在允许的范围）</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MayBe</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MayBe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> value    <span class="token punctuation">}</span>    <span class="token function">isNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">===</span> <span class="token keyword">undefined</span>    <span class="token punctuation">}</span>    <span class="token comment">// 如果对空值变形的话直接返回【值为null的函子】</span>    <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> MayBe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">:</span> MayBe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 传入具体值</span><span class="token keyword">let</span> r1 <span class="token operator">=</span> MayBe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">'Hello world'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span>  <span class="token comment">// MayBe { _value: 'HELLO WORLD' }</span><span class="token comment">// 传入null的情况</span><span class="token keyword">let</span> r2 <span class="token operator">=</span> MayBe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span>  <span class="token comment">// MayBe { _value: null }</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在MayBe函子中，我们很难确认是哪一步产生的空值问题，如下例：</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">MayBe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token keyword">null</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// =&gt; MayBe { _value: null }</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-Either函子"><a href="#5-Either函子" class="headerlink" title="5.Either函子"></a>5.Either函子</h3><ul><li>Either两者中的任何一个，类似于if…else…处理</li><li>异常会让函数变得不纯，Either函子可以用来做异常处理</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Left</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Left</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> value    <span class="token punctuation">}</span>    <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Right</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Right</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> value    <span class="token punctuation">}</span>    <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> Right<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>Either用来处理异常</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">parseJSON</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> Right<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> Left<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> e<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">parseJSON</span><span class="token punctuation">(</span><span class="token string">'{ "name": "zs" }'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>  <span class="token comment">// Right { _value: 'ZS' }</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-IO函子"><a href="#6-IO函子" class="headerlink" title="6.IO函子"></a>6.IO函子</h3><ul><li>IO函子中的_value是一个函数，这里是把函数作为值来处理</li><li>IO函子可以把不纯的动作储存到_value中，延迟执行这个不纯的操作（惰性执行），包装当前的操作</li><li>把不纯的操作交给调用者来处理</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">IO</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> x        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> fn    <span class="token punctuation">}</span>    <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 把当前的value和传入的fn函数组合成一个新的函数</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// 调用</span><span class="token keyword">let</span> io <span class="token operator">=</span> <span class="token constant">IO</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>execPath<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>_value<span class="token punctuation">)</span>  <span class="token comment">//</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-Task异步执行"><a href="#7-Task异步执行" class="headerlink" title="7.Task异步执行"></a>7.Task异步执行</h3><ul><li>异步任务的实现过于复杂，我们使用folktale中的Task来演示</li><li>folktale是一个标准的函数编程库<ul><li>和 lodash、ramda 不同的是，他没有提供很多功能函数</li><li>只提供了一些函数式处理的操作，例如：compose、curry 等，一些函子 Task、Either、<br>MayBe 等</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span>compose<span class="token punctuation">,</span> curry<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'folktale/core/lambda'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">{</span>toUpper<span class="token punctuation">,</span> first<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span><span class="token comment">// 第一个参数是传入函数的参数个数</span><span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment">// 7</span><span class="token comment">// 7</span><span class="token comment">// 函数组合</span><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>toUpper<span class="token punctuation">,</span> first<span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token comment">// [function]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>Task 异步执行<ul><li>folktale(2.3.2) 2.x 中的 Task 和 1.0 中的 Task 区别很大，1.0 中的用法更接近我们现在演示的函子</li><li>这里以 2.3.2 来演示</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span>task<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'folktale/concurrency/task'</span><span class="token punctuation">)</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">{</span>split<span class="token punctuation">,</span> find<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token parameter">resolver</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> resolver<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>            resolver<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// 调用run执行</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'package.json'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'version'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function-variable function">onResolved</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-Pointed函子"><a href="#8-Pointed函子" class="headerlink" title="8.Pointed函子"></a>8.Pointed函子</h3><ul><li>Pointed函子是实现了of静态方法的函子</li><li>of方法是为了避免使用new来创建对象，更深层的韩一是of方法用来把值放到上下文Context（把值放到容器中，使用map来处理值）</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Container</span> <span class="token punctuation">{</span>  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token punctuation">}</span>……<span class="token punctuation">}</span>Contanier<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="9-Monad（单子）"><a href="#9-Monad（单子）" class="headerlink" title="9.Monad（单子）"></a>9.Monad（单子）</h3><p>在使用IO函子的时候，如果出现了以下代码：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">IO</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> x        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> fn    <span class="token punctuation">}</span>    <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 把当前的value和传入的fn函数组合成一个新的函数</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> <span class="token function-variable function">readFile</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">let</span> <span class="token function-variable function">print</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">return</span> x    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">let</span> cat <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>print<span class="token punctuation">,</span> readFile<span class="token punctuation">)</span><span class="token comment">// 调用</span><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">cat</span><span class="token punctuation">(</span><span class="token string">'package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>Monad函子是可以变变得Pointed函子，IO(IO(x))</li><li>一个函子如果具有join和of两个方法并遵守一些定律就是一个Monad</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// IO Monad</span><span class="token keyword">class</span> <span class="token class-name">IO</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> x        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> fn    <span class="token punctuation">}</span>    <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'package.json'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>toUpper<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>print<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="八、附录"><a href="#八、附录" class="headerlink" title="八、附录"></a>八、附录</h2><ul><li><p><a href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/ch1.html">函数式编程指北</a></p></li><li><p><a href="http://www.ruanyifeng.com/blog/2017/02/fp-tutorial.html">函数式编程入门</a></p></li><li><p><a href="http://www.ruanyifeng.com/blog/2017/03/pointfree.html">Pointfree编程风格指南</a></p></li><li><p><a href="http://www.ruanyifeng.com/blog/2015/07/monad.html">图解Monad</a></p></li><li><p><a href="http://www.ruanyifeng.com/blog/2015/07/monad.html">Functor,Applicatives,And Monads In Pictures</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
